<!doctype html>
<html lang="en" dir="ltr" class="mdx-wrapper mdx-page plugin-pages plugin-id-default" data-has-hydrated="false">
<head>
<meta charset="UTF-8">
<meta name="generator" content="Docusaurus v3.7.0">
<title data-rh="true">AMQP 0-9-1 Errata | RabbitMQ</title><meta data-rh="true" name="viewport" content="width=device-width,initial-scale=1"><meta data-rh="true" name="twitter:card" content="summary_large_image"><meta data-rh="true" property="og:image" content="https://www.rabbitmq.com/rabbitmq-website/img/rabbitmq-social-media-card.svg"><meta data-rh="true" name="twitter:image" content="https://www.rabbitmq.com/rabbitmq-website/img/rabbitmq-social-media-card.svg"><meta data-rh="true" property="og:url" content="https://www.rabbitmq.com/rabbitmq-website/amqp-0-9-1-errata"><meta data-rh="true" property="og:locale" content="en"><meta data-rh="true" name="docusaurus_locale" content="en"><meta data-rh="true" name="docusaurus_tag" content="default"><meta data-rh="true" name="docsearch:language" content="en"><meta data-rh="true" name="docsearch:docusaurus_tag" content="default"><meta data-rh="true" property="og:title" content="AMQP 0-9-1 Errata | RabbitMQ"><meta data-rh="true" name="description" content="Here we list errors and ambiguities in the 0-9-1 specification and provide our interpretations and corrections."><meta data-rh="true" property="og:description" content="Here we list errors and ambiguities in the 0-9-1 specification and provide our interpretations and corrections."><link data-rh="true" rel="icon" href="/rabbitmq-website/img/rabbitmq-logo.svg"><link data-rh="true" rel="canonical" href="https://www.rabbitmq.com/rabbitmq-website/amqp-0-9-1-errata"><link data-rh="true" rel="alternate" href="https://www.rabbitmq.com/rabbitmq-website/amqp-0-9-1-errata" hreflang="en"><link data-rh="true" rel="alternate" href="https://www.rabbitmq.com/rabbitmq-website/amqp-0-9-1-errata" hreflang="x-default"><link data-rh="true" rel="preconnect" href="https://H10VQIW16Y-dsn.algolia.net" crossorigin="anonymous"><link rel="alternate" type="application/rss+xml" href="/rabbitmq-website/blog/rss.xml" title="RabbitMQ RSS Feed">
<link rel="alternate" type="application/atom+xml" href="/rabbitmq-website/blog/atom.xml" title="RabbitMQ Atom Feed">




<link rel="search" type="application/opensearchdescription+xml" title="RabbitMQ" href="/rabbitmq-website/opensearch.xml">







<link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Raleway:400,700">
<script src="https://cdn.cookielaw.org/scripttemplates/otSDKStub.js" data-domain-script="018ee308-473e-754f-b0c2-cbe82d25512f"></script>
<script>function OptanonWrapper(){}</script>
<script>function setGTM(e,t,o,n,r){e[n]=e[n]||[],e[n].push({"gtm.start":(new Date).getTime(),event:"gtm.js"});var i=t.getElementsByTagName(o)[0],a=t.createElement(o),s="dataLayer"!=n?"&l="+n:"";a.async=!0,a.src="https://www.googletagmanager.com/gtm.js?id="+r+s,i.parentNode.insertBefore(a,i)}var timer;function waitForOnetrustActiveGroups(){document.cookie.indexOf("OptanonConsent")>-1&&document.cookie.indexOf("groups=")>-1?(clearTimeout(timer),setGTM(window,document,"script","dataLayer","GTM-TT84L8K")):timer=setTimeout(waitForOnetrustActiveGroups,250)}document.cookie.indexOf("OptanonConsent")>-1&&document.cookie.indexOf("groups=")>-1?setGTM(window,document,"script","dataLayer","GTM-TT84L8K"):waitForOnetrustActiveGroups()</script><link rel="stylesheet" href="/rabbitmq-website/styles.css">
<script src="/rabbitmq-website/runtime~main.js" defer="defer"></script>
<script src="/rabbitmq-website/main.js" defer="defer"></script>
</head>
<body class="navigation-with-keyboard">
<script>!function(){function t(t){document.documentElement.setAttribute("data-theme",t)}var e=function(){try{return new URLSearchParams(window.location.search).get("docusaurus-theme")}catch(t){}}()||function(){try{return window.localStorage.getItem("theme")}catch(t){}}();null!==e?t(e):window.matchMedia("(prefers-color-scheme: dark)").matches?t("dark"):(window.matchMedia("(prefers-color-scheme: light)").matches,t("light"))}(),function(){try{const n=new URLSearchParams(window.location.search).entries();for(var[t,e]of n)if(t.startsWith("docusaurus-data-")){var a=t.replace("docusaurus-data-","data-");document.documentElement.setAttribute(a,e)}}catch(t){}}(),document.documentElement.setAttribute("data-announcement-bar-initially-dismissed",function(){try{return"true"===localStorage.getItem("docusaurus.announcement.dismiss")}catch(t){}return!1}())</script><div id="__docusaurus"><div role="region" aria-label="Skip to main content"><a class="skipToContent_fXgn" href="#__docusaurus_skipToContent_fallback">Skip to main content</a></div><div class="announcementBar_mb4j" style="background-color:var(--ifm-color-primary-contrast-background);color:var(--ifm-font-color-base)" role="banner"><div class="announcementBarPlaceholder_vyr4"></div><div class="content_knG7 announcementBarContent_xLdY"><strong style="font-size: var(--ifm-h4-font-size);"><a href="https://github.com/rabbitmq/rabbitmq-server/releases/tag/v4.1.0">RabbitMQ 4.1.0 is out</a></strong></div><button type="button" aria-label="Close" class="clean-btn close closeButton_CVFx announcementBarClose_gvF7"><svg viewBox="0 0 15 15" width="14" height="14"><g stroke="currentColor" stroke-width="3.1"><path d="M.75.75l13.5 13.5M14.25.75L.75 14.25"></path></g></svg></button></div><nav aria-label="Main" class="navbar navbar--fixed-top"><div class="navbar__inner"><div class="navbar__items"><button aria-label="Toggle navigation bar" aria-expanded="false" class="navbar__toggle clean-btn" type="button"><svg width="30" height="30" viewBox="0 0 30 30" aria-hidden="true"><path stroke="currentColor" stroke-linecap="round" stroke-miterlimit="10" stroke-width="2" d="M4 7h22M4 15h22M4 23h22"></path></svg></button><a class="navbar__brand" href="/rabbitmq-website/"><div class="navbar__logo"><img src="/rabbitmq-website/img/rabbitmq-logo-with-name.svg" alt="RabbitMQ" class="themedComponent_mlkZ themedComponent--light_NVdE"><img src="/rabbitmq-website/img/rabbitmq-logo-with-name.svg" alt="RabbitMQ" class="themedComponent_mlkZ themedComponent--dark_xIcU"></div></a><a class="navbar__item navbar__link" href="/rabbitmq-website/tutorials">Getting Started</a><a class="navbar__item navbar__link" href="/rabbitmq-website/docs">Docs</a><a class="navbar__item navbar__link" href="/rabbitmq-website/blog">Blog</a><a class="navbar__item navbar__link" href="/rabbitmq-website/contact">Support</a></div><div class="navbar__items navbar__items--right"><div class="navbar__item dropdown dropdown--hoverable dropdown--right"><a class="navbar__link" aria-haspopup="true" aria-expanded="false" role="button" href="/rabbitmq-website/docs">4.1</a><ul class="dropdown__menu"><li class=""><strong>Release series</strong></li><li><a class="dropdown__link" href="/rabbitmq-website/docs/next">Next</a></li><li><a class="dropdown__link" href="/rabbitmq-website/docs">4.1</a></li><li><a class="dropdown__link" href="/rabbitmq-website/docs/4.0">4.0</a></li><li><a class="dropdown__link" href="/rabbitmq-website/docs/3.13">3.13</a></li><li><a href="https://v3-12.rabbitmq.com/documentation.html" target="_blank" rel="noopener noreferrer" class="dropdown__link">3.12<svg width="12" height="12" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_nPIU"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a></li><li><a class="dropdown__link" href="/rabbitmq-website/release-information">Release Information</a></li></ul></div><a href="https://github.com/rabbitmq/rabbitmq-website" target="_blank" rel="noopener noreferrer" class="navbar__item navbar__link">GitHub<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_nPIU"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a><div class="toggle_vylO colorModeToggle_DEke"><button class="clean-btn toggleButton_gllP toggleButtonDisabled_aARS" type="button" disabled="" title="Switch between dark and light mode (currently light mode)" aria-label="Switch between dark and light mode (currently light mode)" aria-live="polite" aria-pressed="false"><svg viewBox="0 0 24 24" width="24" height="24" class="lightToggleIcon_pyhR"><path fill="currentColor" d="M12,9c1.65,0,3,1.35,3,3s-1.35,3-3,3s-3-1.35-3-3S10.35,9,12,9 M12,7c-2.76,0-5,2.24-5,5s2.24,5,5,5s5-2.24,5-5 S14.76,7,12,7L12,7z M2,13l2,0c0.55,0,1-0.45,1-1s-0.45-1-1-1l-2,0c-0.55,0-1,0.45-1,1S1.45,13,2,13z M20,13l2,0c0.55,0,1-0.45,1-1 s-0.45-1-1-1l-2,0c-0.55,0-1,0.45-1,1S19.45,13,20,13z M11,2v2c0,0.55,0.45,1,1,1s1-0.45,1-1V2c0-0.55-0.45-1-1-1S11,1.45,11,2z M11,20v2c0,0.55,0.45,1,1,1s1-0.45,1-1v-2c0-0.55-0.45-1-1-1C11.45,19,11,19.45,11,20z M5.99,4.58c-0.39-0.39-1.03-0.39-1.41,0 c-0.39,0.39-0.39,1.03,0,1.41l1.06,1.06c0.39,0.39,1.03,0.39,1.41,0s0.39-1.03,0-1.41L5.99,4.58z M18.36,16.95 c-0.39-0.39-1.03-0.39-1.41,0c-0.39,0.39-0.39,1.03,0,1.41l1.06,1.06c0.39,0.39,1.03,0.39,1.41,0c0.39-0.39,0.39-1.03,0-1.41 L18.36,16.95z M19.42,5.99c0.39-0.39,0.39-1.03,0-1.41c-0.39-0.39-1.03-0.39-1.41,0l-1.06,1.06c-0.39,0.39-0.39,1.03,0,1.41 s1.03,0.39,1.41,0L19.42,5.99z M7.05,18.36c0.39-0.39,0.39-1.03,0-1.41c-0.39-0.39-1.03-0.39-1.41,0l-1.06,1.06 c-0.39,0.39-0.39,1.03,0,1.41s1.03,0.39,1.41,0L7.05,18.36z"></path></svg><svg viewBox="0 0 24 24" width="24" height="24" class="darkToggleIcon_wfgR"><path fill="currentColor" d="M9.37,5.51C9.19,6.15,9.1,6.82,9.1,7.5c0,4.08,3.32,7.4,7.4,7.4c0.68,0,1.35-0.09,1.99-0.27C17.45,17.19,14.93,19,12,19 c-3.86,0-7-3.14-7-7C5,9.07,6.81,6.55,9.37,5.51z M12,3c-4.97,0-9,4.03-9,9s4.03,9,9,9s9-4.03,9-9c0-0.46-0.04-0.92-0.1-1.36 c-0.98,1.37-2.58,2.26-4.4,2.26c-2.98,0-5.4-2.42-5.4-5.4c0-1.81,0.89-3.42,2.26-4.4C12.92,3.04,12.46,3,12,3L12,3z"></path></svg></button></div><div class="navbarSearchContainer_Bca1"><button type="button" class="DocSearch DocSearch-Button" aria-label="Search (Command+K)"><span class="DocSearch-Button-Container"><svg width="20" height="20" class="DocSearch-Search-Icon" viewBox="0 0 20 20" aria-hidden="true"><path d="M14.386 14.386l4.0877 4.0877-4.0877-4.0877c-2.9418 2.9419-7.7115 2.9419-10.6533 0-2.9419-2.9418-2.9419-7.7115 0-10.6533 2.9418-2.9419 7.7115-2.9419 10.6533 0 2.9419 2.9418 2.9419 7.7115 0 10.6533z" stroke="currentColor" fill="none" fill-rule="evenodd" stroke-linecap="round" stroke-linejoin="round"></path></svg><span class="DocSearch-Button-Placeholder">Search</span></span><span class="DocSearch-Button-Keys"></span></button></div></div></div><div role="presentation" class="navbar-sidebar__backdrop"></div></nav><div id="__docusaurus_skipToContent_fallback" class="main-wrapper mainWrapper_z2l0"><main class="container container--fluid margin-vert--lg"><div class="row mdxPageWrapper_j9I6"><div class="col col--8"><article><div id="left-content"><p class="intro"></p><p>Here we list errors and ambiguities in the 0-9-1 specification and provide our interpretations and corrections.</p><p></p><div class="docSection"><h2 class="anchor anchorWithStickyNavbar_LWe7" id="section_1">1 Use of &quot;consumer&quot;<a href="#section_1" class="hash-link" aria-label="Direct link to 1 Use of &quot;consumer&quot;" title="Direct link to 1 Use of &quot;consumer&quot;">​</a></h2></div><p></p><p>The word &quot;consumer&quot; is used fairly indiscriminately. In general, we&#x27;ve interpreted it to mean &quot;client&quot;, except in situations in which it clearly refers specifically to a triple
<span class="code">{connection, channel, consumer-tag}</span>.</p><p></p><p>An example of the first, generic meaning is in channel.flow: &quot;This method asks the peer to pause or restart the flow of content data sent by a consumer.&quot;</p><p>An example of the second, specific use is in basic.consume: &quot;Request exclusive consumer access, meaning only this consumer can access the queue.&quot;</p><p>(This should really be cleaned up in subsequent revisions of the specification.)</p><div class="docSection"><h2 class="anchor anchorWithStickyNavbar_LWe7" id="section_2">2 basic.recover with requeue=false<a href="#section_2" class="hash-link" aria-label="Direct link to 2 basic.recover with requeue=false" title="Direct link to 2 basic.recover with requeue=false">​</a></h2></div><p>The stanza for basic.recover says</p><p>&quot;This method asks the server to redeliver all unacknowledged messages on a specified channel. Zero or more messages may be redelivered.&quot;</p><p>and</p><p>&quot;If [requeue] is zero, the message will be redelivered to the original recipient. If this bit is 1, the server will attempt to requeue the message, potentially then delivering it to an alternative subscriber.&quot;</p><p>These don&#x27;t account for</p><ul class="plain"><li>Messages that were handed over as a result of basic.get; or,</li><li>Consumers that have since since cancelled.</li></ul><p>RabbitMQ doesn&#x27;t try to redeliver messages that were sent as a response to basic.get, and doesn&#x27;t attempt to find out if a consumer has been cancelled.</p><p>(Probably the best solution to this under-specification is to remove the requeue flag and just always requeue things.)</p><div class="docSection"><h2 class="anchor anchorWithStickyNavbar_LWe7" id="section_3">3 Field types<a href="#section_3" class="hash-link" aria-label="Direct link to 3 Field types" title="Direct link to 3 Field types">​</a></h2></div><p>Tony to the AMQ dev list:</p><pre><p>The changes from 0-9&#x27;s table field type definitions (S,I,D,T,F,V) to
0-9-1&#x27;s type definitions (t,b,B,U,u,I,i,L,l,f,d,D,s,S,A,T,F,V) are not,
as far as I can tell, the changes that were discussed in the 0-9-1 SIG.</p><p>The types mentioned in the final spec do not line up with any of the
variants discussed in the 0-9-1 SIG. In particular, they are
gratuitously <b></b>INCOMPATIBLE<b></b> with the Qpid-java 0-9 field type
extensions, which are also implemented by the RabbitMQ client libraries
and the RabbitMQ broker.</p><p>The final word I can find on the subject by trawling my archive is a
message from John O&#x27;Hara (attached). Unless there was subsequent
discussion that I&#x27;ve missed, I would have expected the final version of
the 0-9-1 spec to at least be based on the list John provided.</p><p>Here&#x27;s a tabular summary of the state of things:</p><h2 class="anchor anchorWithStickyNavbar_LWe7" id="0-9---0-9-1---qpidrabbit--type---------------remarks">0-9   0-9-1   Qpid/Rabbit  Type               Remarks<a href="#0-9---0-9-1---qpidrabbit--type---------------remarks" class="hash-link" aria-label="Direct link to 0-9   0-9-1   Qpid/Rabbit  Type               Remarks" title="Direct link to 0-9   0-9-1   Qpid/Rabbit  Type               Remarks">​</a></h2><p>t       t            Boolean
b       b            Signed 8-bit
B       B            Unsigned 8-bit
U       s            Signed 16-bit      (A1)
u       u            Unsigned 16-bit
I     I       I            Signed 32-bit
i       i            Unsigned 32-bit
L       l            Signed 64-bit      (B)
l                    Unsigned 64-bit
f       f            32-bit float
d       d            64-bit float
D     D       D            Decimal
s                    Short string       (A2)
S     S       S            Long string
A       A            Array              (C)
T     T       T            Timestamp (u64)
F     F       F            Nested Table
V     V       V            Void
x            Byte array         (D)</p><p>Remarks:</p><p>A1, A2: Notice how the types <b></b>CONFLICT<b></b> here. In Qpid and Rabbit,
&#x27;s&#x27; means a signed 16-bit integer; in 0-9-1, it means a
short string.</p><p>B: Notice how the signednesses <b></b>CONFLICT<b></b> here. In Qpid and Rabbit,
&#x27;l&#x27; means a signed 64-bit integer; in 0-9-1, it means an unsigned
64-bit integer.</p><p>C: I cannot find any discussion about the addition of this. Is my
archive missing a few messages?</p><p>D: John [O&#x27;Hara]objected to this when John proposed a list himself. I believe it to
be vital: byte arrays are not strings. Furthermore, Qpid and
Rabbit already have code deployed that uses this type specifier.</p></pre><p>RabbitMQ continues to use the tags in the third column.</p><p>Other notes:</p><ul class="plain"><li><p>Decimals encoding: &quot;They are encoded as an octet representing the number of places followed by a long signed integer&quot;, but the grammar contradicts that and says: &quot;decimal-value = scale long-uint&quot;. We treat the decimal value as
<b>signed</b> integer.</p></li></ul><div class="docSection"><h2 class="anchor anchorWithStickyNavbar_LWe7" id="section_4">4 field-array<a href="#section_4" class="hash-link" aria-label="Direct link to 4 field-array" title="Direct link to 4 field-array">​</a></h2></div><p>The protocol grammar has a production for <span class="code">field-array</span>, and it appears on the right-hand-side of a production for <span class="code">field-value</span>.</p><pre>field-array = long-int *field-value</pre><p></p><p>There is no explanation elsewhere for this, as there is for <span class="code">field-table</span>. In particular, there is nothing explaining what the long-int value represents. RabbitMQ uses the total length in bytes of the encoded
field-values, similarly to field-table; it also treats it as a long-uint, since that is what field-table uses (on the supposition that &quot;long-int&quot; is a typo).</p><p></p><div class="docSection"><h2 class="anchor anchorWithStickyNavbar_LWe7" id="section_5">5 Exclusive and auto-delete deletion<a href="#section_5" class="hash-link" aria-label="Direct link to 5 Exclusive and auto-delete deletion" title="Direct link to 5 Exclusive and auto-delete deletion">​</a></h2></div><p>AMQP 0-8 and 0-9-1 both have rules regarding deletion of exclusive and auto-delete queues. However, they do not specify whether this happens synchronously; i.e., before the broker responds to its peer.</p><p>(Actually 0-8 said that the server should wait a &quot;polite amount of time&quot;).</p><p>RabbitMQ now deletes auto-delete and queues synchronously with basic.cancel, channel close, and connection close, and exclusive queues synchronously with the latter two.</p><p>An auto-delete queue will not be deleted if:</p><ul class="plain"><li>it didn&#x27;t have a consumer - consuming with <span class="code">basic.get</span> does not count as having a consumer</li><li>the consumer failed to send <span class="code">basic.cancel</span> (e.g. consumer crashed)</li></ul><div class="docSection"><h2 class="anchor anchorWithStickyNavbar_LWe7" id="section_6">6 Queue and exchange &quot;equivalent&quot; and &quot;pre-existence&quot; rules<a href="#section_6" class="hash-link" aria-label="Direct link to 6 Queue and exchange &quot;equivalent&quot; and &quot;pre-existence&quot; rules" title="Direct link to 6 Queue and exchange &quot;equivalent&quot; and &quot;pre-existence&quot; rules">​</a></h2></div><p></p><p>&quot;If [passive] not set and the queue exists, the server MUST check that the existing queue has the same values for durable, exclusive, auto-delete, and arguments fields. The server MUST respond with Declare-Ok if the requested queue
matches these fields, and MUST raise a channel exception if not.&quot;</p><p></p><p>and similarly for exchange declaration.</p><p>The rules fail to specify the exact error code. RabbitMQ uses &#x27;precondition-failed&#x27;.</p><p></p><p>Furthermore, the exchange.declare specs contain a separate &quot;typed&quot; rule concerning the re-declaration with a different type. That rule is superfluous, since it subsumed by the equivalence rules, and specifies a
<b>connection</b> error of &#x27;not-allowed&#x27;. The rule should be removed.</p><p></p><div class="docSection"><h2 class="anchor anchorWithStickyNavbar_LWe7" id="section_7">7 Exclusive rule (amqp0-9-1.xml:1503)<a href="#section_7" class="hash-link" aria-label="Direct link to 7 Exclusive rule (amqp0-9-1.xml:1503)" title="Direct link to 7 Exclusive rule (amqp0-9-1.xml:1503)">​</a></h2></div><p>&quot;One client declares an exclusive queue. A second client on a different connection attempts to declare, bind, consume, purge, delete, or declare a queue of the same name.&quot;</p><p></p><p>&quot;declare&quot; appears twice, and basic.get and queue.unbind not at all (basic.cancel is local to a channel anyway). RabbitMQ extends the exclusivity to queue.declare (including passive declare), queue.bind, queue.unbind, queue.purge,
queue.delete, basic.consume, and basic.get.</p><p></p><div class="docSection"><h2 class="anchor anchorWithStickyNavbar_LWe7" id="section_8">8 Exclusive and other errors<a href="#section_8" class="hash-link" aria-label="Direct link to 8 Exclusive and other errors" title="Direct link to 8 Exclusive and other errors">​</a></h2></div><p>In general, RabbitMQ privileges exclusivity ahead of other things; i.e., it checks that first, and will send a resource-locked even if there are other problems, like non-equivalence.</p><div class="docSection"><h2 class="anchor anchorWithStickyNavbar_LWe7" id="section_9">9 Passive and no-wait (amqp0-9-1.xml:1214,1423)<a href="#section_9" class="hash-link" aria-label="Direct link to 9 Passive and no-wait (amqp0-9-1.xml:1214,1423)" title="Direct link to 9 Passive and no-wait (amqp0-9-1.xml:1214,1423)">​</a></h2></div><p>&quot;.. A declare with both passive and no-wait has no effect.&quot;</p><p></p><p>However, passively declaring a queue which exists and is exclusive to another connection is explicitly prohibited in the exclusive rule (amqp0-9-1.xml:1486), and passively declaring a queue or exchange that doesn&#x27;t exist should send
a channel exception. RabbitMQ ignores the sentence quoted above; i.e., it will send a channel exception if a queue exclusive to another connection, or a non-existent queue or exchange, is passively declared even with no-wait.</p><p></p><div class="docSection"><h2 class="anchor anchorWithStickyNavbar_LWe7" id="section_10">10 Special case value for channel-max and frame-max<a href="#section_10" class="hash-link" aria-label="Direct link to 10 Special case value for channel-max and frame-max" title="Direct link to 10 Special case value for channel-max and frame-max">​</a></h2></div><p></p><p>The spec for the channel-max field in connection.tune says &quot;Zero indicates no specified limit&quot; and there is a similar special case for frame-max; but, in tune-ok, the &quot;upper-limit&quot; rule says: &quot;If the client specifies a channel max
[/frame-max]that is higher than the value provided by the server, the server MUST close the connection without attempting a negotiated close&quot;.</p><p></p><p>This is ambiguous if the server sends zero in tune: if the rule is taken literally, the client is not allowed to send any value other than zero in tune-ok, so it can&#x27;t negotiate down the limit.</p><p>RabbitMQ doesn&#x27;t put a limit on channel-max, and treats any number in tune-ok as valid. It does put a limit on frame-max, and checks that the value sent in tune-ok is less than or equal.</p><div class="docSection"><h2 class="anchor anchorWithStickyNavbar_LWe7" id="section_11">11 frame-max, method and content header frames<a href="#section_11" class="hash-link" aria-label="Direct link to 11 frame-max, method and content header frames" title="Direct link to 11 frame-max, method and content header frames">​</a></h2></div><p></p><p>The specification states that frame-max (negotiated in connection.tune and connection.tune-ok) gives an upper limit to total frame size; that is, including the frame header and frame-end octet. However, there&#x27;s no way to split
methods or content headers across multiple frames. RabbitMQ currently ignores the frame-max for methods and content headers.</p><p></p><div class="docSection"><h2 class="anchor anchorWithStickyNavbar_LWe7" id="section_12">12 Heartbeat format<a href="#section_12" class="hash-link" aria-label="Direct link to 12 Heartbeat format" title="Direct link to 12 Heartbeat format">​</a></h2></div><p>The grammar has the production</p><p>heartbeat = %d8 %d0 %d0 frame-end</p><p>which doesn&#x27;t fit the frame format. RabbitMQ, Qpid and OpenAMQ all send eight bytes, following the frame format:</p><p>frame-type (octet) = %d8 channel (short) = %d0 %d0 payload (long) = %d0 %d0 %d0 %d0 frame-end (octet) = %xCE</p><div class="docSection"><h2 class="anchor anchorWithStickyNavbar_LWe7" id="section_13">13 Heartbeat monitoring<a href="#section_13" class="hash-link" aria-label="Direct link to 13 Heartbeat monitoring" title="Direct link to 13 Heartbeat monitoring">​</a></h2></div><p>The spec says:</p><pre><p>The client should start sending heartbeats after receiving a Connection.Tune
method, and start monitoring heartbeats after receiving Connection.Open.</p></pre><p>but of course, the client <b class="">sends</b> Connection.Open.</p><div class="docSection"><h2 class="anchor anchorWithStickyNavbar_LWe7" id="section_14">14 Default exchange<a href="#section_14" class="hash-link" aria-label="Direct link to 14 Default exchange" title="Direct link to 14 Default exchange">​</a></h2></div><p>The spec is a bit vague on the default exchange: it says</p><pre><p>The server MUST NOT allow clients to access the default exchange except
by specifying an empty exchange name in the Queue.Bind and content Publish
methods.</p></pre><p>However, 0-10 spec makes things a bit more rigid:</p><pre><p>The default exchange MUST NOT be accessible to the client except by
specifying an empty exchange name in a content publish command (such as
message.transfer). That is, the server must not let clients explicitly
bind, unbind, delete, or make any other reference to this exchange.</p></pre><p></p><p>RabbitMQ prevents all access to the default exchange other than publishing. This includes exchange redeclaration and queue.bind redeclarations to queues. For exchange-to-exchange bindings, neither the source or the destination are
permitted to be the default exchange.</p><p></p><div class="docSection"><h2 class="anchor anchorWithStickyNavbar_LWe7" id="section_15">15 EBNF Grammar<a href="#section_15" class="hash-link" aria-label="Direct link to 15 EBNF Grammar" title="Direct link to 15 EBNF Grammar">​</a></h2></div><p></p><p>The EBNF grammar (p. 32) is broken: <tt class="">8*OCTET</tt> should be <tt class="">8 OCTET</tt>, according to the syntax description <tt class="">8*OCTET</tt> means <b class="">AT LEAST</b> 8 octets (see bullet point &#x27;The Operator
&quot;*&quot; ...&#x27;).</p><p></p><div class="docSection"><h2 class="anchor anchorWithStickyNavbar_LWe7" id="section_16">16 Strings vs bytes<a href="#section_16" class="hash-link" aria-label="Direct link to 16 Strings vs bytes" title="Direct link to 16 Strings vs bytes">​</a></h2></div><p></p><p>The spec is confused about utf-8 strings vs. raw bytes. E.g. what&#x27;s a &quot;character&quot;? A valid code point? An octet? What does equality mean? Same bytes? Same in some normal form? How is mal-formed utf-8 handled? The grammar on p. 31
suggests strings are just raw bytes (i.e. can contain invalid utf-8), but other parts of the spec seem to contradict that (e.g. 4.2.5.3, p. 35)</p><p></p><div class="docSection"><h2 class="anchor anchorWithStickyNavbar_LWe7" id="section_17">17 Missing 312 (&quot;No route&quot;) channel exception<a href="#section_17" class="hash-link" aria-label="Direct link to 17 Missing 312 (&quot;No route&quot;) channel exception" title="Direct link to 17 Missing 312 (&quot;No route&quot;) channel exception">​</a></h2></div><p>Section 1.2 ought to define an exception 312 &quot;No route&quot;, which used to exist in 0-9 and is what RabbitMQ sends back with &#x27;basic.return&#x27; when a &#x27;mandatory&#x27; message cannot be delivered to any queue.</p><div class="docSection"><h2 class="anchor anchorWithStickyNavbar_LWe7" id="section_18">18 502 channel exception<a href="#section_18" class="hash-link" aria-label="Direct link to 18 502 channel exception" title="Direct link to 18 502 channel exception">​</a></h2></div><p>Section 1.1 under queue-name says &quot;If the client did not declare a queue, and the method needs a queue name, this will result in a 502 (syntax error) channel exception&quot;. This is in fact a connection exception.</p><div class="docSection"><h2 class="anchor anchorWithStickyNavbar_LWe7" id="section_19">19 auto-delete vs exclusive<a href="#section_19" class="hash-link" aria-label="Direct link to 19 auto-delete vs exclusive" title="Direct link to 19 auto-delete vs exclusive">​</a></h2></div><p>Section 4.5 says &quot;When the server closes a connection, it deletes any auto-delete owned by that connection.&quot; That&#x27;s not what auto-delete means - this should presumably say &quot;...deletes any exclusive queues owned...&quot;.</p><div class="docSection"><h2 class="anchor anchorWithStickyNavbar_LWe7" id="section_20">20 Durability of amq.* exchanges<a href="#section_20" class="hash-link" aria-label="Direct link to 20 Durability of amq.* exchanges" title="Direct link to 20 Durability of amq.* exchanges">​</a></h2></div><p></p><p>The spec doesn&#x27;t say if the standard exchanges should be durable or not. RabbitMQ declares them as durable. Unfortunately, the Qpid Java Client forcibly declares them as non durable (through N levels of abstractions), thus breaking
interoperability almost completely.</p><p></p><div class="docSection"><h2 class="anchor anchorWithStickyNavbar_LWe7" id="section_21">21 Rejecting messages with an unknown delivery tag<a href="#section_21" class="hash-link" aria-label="Direct link to 21 Rejecting messages with an unknown delivery tag" title="Direct link to 21 Rejecting messages with an unknown delivery tag">​</a></h2></div><p>The spec doesn&#x27;t say what should happen when a client sends a basic.reject with an unknown delivery tag. The server should probably handle this in the same way as for basic.ack, namely a raise a precondition_failed error.</p><div class="docSection"><h2 class="anchor anchorWithStickyNavbar_LWe7" id="section_22">22 Heartbeat errors<a href="#section_22" class="hash-link" aria-label="Direct link to 22 Heartbeat errors" title="Direct link to 22 Heartbeat errors">​</a></h2></div><p></p><p>In section 4.2.7 the spec says &quot;A peer that receives an invalid heartbeat frame MUST raise a connection exception with reply code 501 (frame error).&quot; It is unclear how a heartbeat frame can be identified as such and be invalid
simultaneously.</p><p></p><div class="docSection"><h2 class="anchor anchorWithStickyNavbar_LWe7" id="section_23">23 Required server-properties<a href="#section_23" class="hash-link" aria-label="Direct link to 23 Required server-properties" title="Direct link to 23 Required server-properties">​</a></h2></div><p></p><p>The xml spec for connection.start states that the server-properties field &quot;SHOULD contain at least these fields: &#x27;host&#x27;, specifying the server host name or address ...&quot;. The &#x27;host&#x27; field was added to this list in 0-9; it is not
present in 0-8. It is the only field whose value isn&#x27;t freely chosen by the implementation. Furthermore, it is not clear at all what information should be included here and what a client could learn from that. The hostname may not
identify a broker uniquely. And it may not be DNS resolvable. And the presence of firewalls and proxies makes the same true of the IP address. Additionally, including this information may reveal details of the brokers network
infrastructure to clients that ought to remain hidden.</p><p></p><p>Therefore this field should not be required. RabbitMQ does not supply it.</p><div class="docSection"><h2 class="anchor anchorWithStickyNavbar_LWe7" id="section_24">24 &#x27;nowait&#x27; on all synchronous commands<a href="#section_24" class="hash-link" aria-label="Direct link to 24 &#x27;nowait&#x27; on all synchronous commands" title="Direct link to 24 &#x27;nowait&#x27; on all synchronous commands">​</a></h2></div><p></p><p>All synchronous commands should have a &#x27;nowait&#x27; flag that makes them asynchronous, unless there are specific circumstances where that doesn&#x27;t make sense. Currently falling foul of this are: &#x27;queue.unbind&#x27;, &#x27;basic.qos&#x27;,
&#x27;basic.recover&#x27; (which instead has a sync and async variant), &#x27;tx.select&#x27;, &#x27;tx.commit&#x27;, &#x27;tx.rollback&#x27;. Of these, &#x27;queue.unbind&#x27; is the most glaring departure from the established pattern.</p><p></p><div class="docSection"><a name="section_25" class="anchor" id=""></a><h2 class="docHeading"><a class="anchor" href="#section_25"></a></h2><h2 class="anchor anchorWithStickyNavbar_LWe7" id="section_25">25 Deprecation of auto-delete exchanges<a href="#section_25" class="hash-link" aria-label="Direct link to 25 Deprecation of auto-delete exchanges" title="Direct link to 25 Deprecation of auto-delete exchanges">​</a></h2></div><p>The &#x27;auto-delete&#x27; flag on &#x27;exchange.declare&#x27; got deprecated in 0-9-1. Auto-delete exchanges are actually quite useful, so this flag should be restored.</p><p>Also note that the spec still refers to auto-delete exchanges: &quot;Exchanges may be durable, temporary, or auto-deleted.&quot; (p. 26).</p><p>RabbitMQ supports auto-delete exchanges.</p><div class="docSection"><h2 class="anchor anchorWithStickyNavbar_LWe7" id="section_26">26 Deprecation of internal exchanges<a href="#section_26" class="hash-link" aria-label="Direct link to 26 Deprecation of internal exchanges" title="Direct link to 26 Deprecation of internal exchanges">​</a></h2></div><p></p><p>The &#x27;internal&#x27; flag on &#x27;exchange.declare&#x27; got deprecated in 0-9-1. Internal exchanges (which 0-8 defines as exchanges used for internal wiring to which clients are not allowed to publish directly) are actually quite useful,
particular in combination with extensions such as exchange-to-exchange bindings. So this flag should be restored.</p><p></p><p>Also note that the basic publish rule (02) still makes reference to internal exchanges: &quot;If the exchange was declared as an internal exchange...&quot;</p><div class="docSection"><h2 class="anchor anchorWithStickyNavbar_LWe7" id="section_27">27 Basic content field explanation references queues<a href="#section_27" class="hash-link" aria-label="Direct link to 27 Basic content field explanation references queues" title="Direct link to 27 Basic content field explanation references queues">​</a></h2></div><p></p><p>The XML comments on the basic content fields state that &quot;delivery-mode&quot; is for &quot;for queues that implement persistence&quot;. That is misleading (in that it mentions queues) and circular. The delivery-mode controls whether messages
survive a broker restart.</p><p></p><p>Similarly, the comments state that &quot;priority&quot; is &quot;for queues that implement priorities&quot;. Priorities can be taken into account by a broker in all stages of message processing, not just when enqueuing.</p><p>And on a cosmetic note, the vertical alignment of the basic content definitions is slightly off.</p><div class="docSection"><h2 class="anchor anchorWithStickyNavbar_LWe7" id="section_28">28 basic.recover synchronicity<a href="#section_28" class="hash-link" aria-label="Direct link to 28 basic.recover synchronicity" title="Direct link to 28 basic.recover synchronicity">​</a></h2></div><p>Although basic.recover is introduced as a synchronous version of basic.recover-async, it is not marked as synchronous in the XML spec.</p><div class="docSection"><h2 class="anchor anchorWithStickyNavbar_LWe7" id="section_29">29 Heartbeat frametype inconsistency<a href="#section_29" class="hash-link" aria-label="Direct link to 29 Heartbeat frametype inconsistency" title="Direct link to 29 Heartbeat frametype inconsistency">​</a></h2></div><p>The PDF specifies the heartbeat frametype as 4. The XML specifies it as 8.</p><div class="docSection"><h2 class="anchor anchorWithStickyNavbar_LWe7" id="section_30">30 durable vs exclusive<a href="#section_30" class="hash-link" aria-label="Direct link to 30 durable vs exclusive" title="Direct link to 30 durable vs exclusive">​</a></h2></div><p>The spec does not define what happens if a client tries to declare a queue which is both durable and exclusive. RabbitMQ will treat a request to declare such a queue as a request for an exclusive transient queue.</p><div id="help-and-feedback"><h2>Getting Help and Providing Feedback</h2><p></p><p>If you have questions about the contents of this guide or any other topic related to RabbitMQ, don&#x27;t hesitate to ask them using <a href="https://github.com/rabbitmq/rabbitmq-server/discussions">GitHub Discussions</a> or our
community <a href="https://www.rabbitmq.com/discord">Discord server</a>.</p><p></p></div><div id="contribute"><h2>Help Us Improve the Docs &lt;3</h2><p>If you&#x27;d like to contribute an improvement to the site, its source is <a href="https://github.com/rabbitmq/rabbitmq-website">available on GitHub</a>. Simply fork the repository and submit a pull request. Thank you!</p></div></div></article></div><div class="col col--2"><div class="tableOfContents_bqdL thin-scrollbar"><ul class="table-of-contents table-of-contents__left-border"><li><a href="#section_1" class="table-of-contents__link toc-highlight">1 Use of &quot;consumer&quot;</a></li><li><a href="#section_2" class="table-of-contents__link toc-highlight">2 basic.recover with requeue=false</a></li><li><a href="#section_3" class="table-of-contents__link toc-highlight">3 Field types</a></li><li><a href="#0-9---0-9-1---qpidrabbit--type---------------remarks" class="table-of-contents__link toc-highlight">0-9   0-9-1   Qpid/Rabbit  Type               Remarks</a></li><li><a href="#section_4" class="table-of-contents__link toc-highlight">4 field-array</a></li><li><a href="#section_5" class="table-of-contents__link toc-highlight">5 Exclusive and auto-delete deletion</a></li><li><a href="#section_6" class="table-of-contents__link toc-highlight">6 Queue and exchange &quot;equivalent&quot; and &quot;pre-existence&quot; rules</a></li><li><a href="#section_7" class="table-of-contents__link toc-highlight">7 Exclusive rule (amqp0-9-1.xml:1503)</a></li><li><a href="#section_8" class="table-of-contents__link toc-highlight">8 Exclusive and other errors</a></li><li><a href="#section_9" class="table-of-contents__link toc-highlight">9 Passive and no-wait (amqp0-9-1.xml:1214,1423)</a></li><li><a href="#section_10" class="table-of-contents__link toc-highlight">10 Special case value for channel-max and frame-max</a></li><li><a href="#section_11" class="table-of-contents__link toc-highlight">11 frame-max, method and content header frames</a></li><li><a href="#section_12" class="table-of-contents__link toc-highlight">12 Heartbeat format</a></li><li><a href="#section_13" class="table-of-contents__link toc-highlight">13 Heartbeat monitoring</a></li><li><a href="#section_14" class="table-of-contents__link toc-highlight">14 Default exchange</a></li><li><a href="#section_15" class="table-of-contents__link toc-highlight">15 EBNF Grammar</a></li><li><a href="#section_16" class="table-of-contents__link toc-highlight">16 Strings vs bytes</a></li><li><a href="#section_17" class="table-of-contents__link toc-highlight">17 Missing 312 (&quot;No route&quot;) channel exception</a></li><li><a href="#section_18" class="table-of-contents__link toc-highlight">18 502 channel exception</a></li><li><a href="#section_19" class="table-of-contents__link toc-highlight">19 auto-delete vs exclusive</a></li><li><a href="#section_20" class="table-of-contents__link toc-highlight">20 Durability of amq.* exchanges</a></li><li><a href="#section_21" class="table-of-contents__link toc-highlight">21 Rejecting messages with an unknown delivery tag</a></li><li><a href="#section_22" class="table-of-contents__link toc-highlight">22 Heartbeat errors</a></li><li><a href="#section_23" class="table-of-contents__link toc-highlight">23 Required server-properties</a></li><li><a href="#section_24" class="table-of-contents__link toc-highlight">24 &#39;nowait&#39; on all synchronous commands</a></li><li><a href="#section_25" class="table-of-contents__link toc-highlight">25 Deprecation of auto-delete exchanges</a></li><li><a href="#section_26" class="table-of-contents__link toc-highlight">26 Deprecation of internal exchanges</a></li><li><a href="#section_27" class="table-of-contents__link toc-highlight">27 Basic content field explanation references queues</a></li><li><a href="#section_28" class="table-of-contents__link toc-highlight">28 basic.recover synchronicity</a></li><li><a href="#section_29" class="table-of-contents__link toc-highlight">29 Heartbeat frametype inconsistency</a></li><li><a href="#section_30" class="table-of-contents__link toc-highlight">30 durable vs exclusive</a></li></ul></div></div></div></main></div><footer class="footer footer--dark"><div class="container container-fluid"><div class="row footer__links"><div class="col footer__col"><div class="footer__title">Learn about RabbitMQ</div><ul class="footer__items clean-list"><li class="footer__item"><a class="footer__link-item" href="/rabbitmq-website/tutorials">Getting Started</a></li><li class="footer__item"><a class="footer__link-item" href="/rabbitmq-website/docs">Documentation</a></li><li class="footer__item"><a class="footer__link-item" href="/rabbitmq-website/blog">Blog</a></li></ul></div><div class="col footer__col"><div class="footer__title">Reach out to the RabbitMQ team</div><ul class="footer__items clean-list"><li class="footer__item"><a href="https://github.com/rabbitmq" target="_blank" rel="noopener noreferrer" class="footer__link-item">GitHub<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_nPIU"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a></li><li class="footer__item"><a href="https://github.com/rabbitmq/rabbitmq-server/discussions" target="_blank" rel="noopener noreferrer" class="footer__link-item">GitHub Discussions<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_nPIU"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a></li><li class="footer__item"><a class="footer__link-item" href="/rabbitmq-website/contact?utm_source=rmq_release-information_tableheader&amp;utm_medium=rmq_website&amp;utm_campaign=tanzu">Long Term Commercial Support</a></li><li class="footer__item"><a class="footer__link-item" href="/rabbitmq-website/contact">Contact Us</a></li><li class="footer__item"><a href="https://www.rabbitmq.com/discord" target="_blank" rel="noopener noreferrer" class="footer__link-item">Discord<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_nPIU"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a></li></ul></div><div class="col footer__col"><div class="footer__title">Broadcom</div><ul class="footer__items clean-list"><li class="footer__item"><a href="https://tanzu.vmware.com/" target="_blank" rel="noopener noreferrer" class="footer__link-item">VMware Tanzu<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_nPIU"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a></li><li class="footer__item"><a href="https://www.vmware.com/help/legal.html" target="_blank" rel="noopener noreferrer" class="footer__link-item">Terms of Use<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_nPIU"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a></li><li class="footer__item"><a href="https://www.vmware.com/help/privacy.html" target="_blank" rel="noopener noreferrer" class="footer__link-item">Privacy<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_nPIU"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a></li><li class="footer__item"><a class="footer__link-item" href="/rabbitmq-website/trademark-guidelines">Trademark Guidelines</a></li><li class="footer__item"><a href="https://www.vmware.com/help/privacy/california-privacy-rights.html" target="_blank" rel="noopener noreferrer" class="footer__link-item">Your California Privacy Rights<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_nPIU"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a></li><li class="footer__item"><a class="footer__link-item ot-sdk-show-settings">Cookie Settings</a></li></ul></div></div><div class="footer__bottom text--center"><div class="footer__copyright">Copyright © 2005-2025 Broadcom. All Rights Reserved. The term "Broadcom" refers to Broadcom Inc. and/or its subsidiaries.</div></div></div></footer></div>
</body>
</html>
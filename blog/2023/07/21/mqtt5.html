<!doctype html>
<html lang="en" dir="ltr" class="blog-wrapper blog-post-page plugin-blog plugin-id-default" data-has-hydrated="false">
<head>
<meta charset="UTF-8">
<meta name="generator" content="Docusaurus v3.7.0">
<title data-rh="true">MQTT 5.0 support is coming in RabbitMQ 3.13 | RabbitMQ</title><meta data-rh="true" name="viewport" content="width=device-width,initial-scale=1"><meta data-rh="true" name="twitter:card" content="summary_large_image"><meta data-rh="true" property="og:image" content="https://www.rabbitmq.com/rabbitmq-website/img/rabbitmq-social-media-card.svg"><meta data-rh="true" name="twitter:image" content="https://www.rabbitmq.com/rabbitmq-website/img/rabbitmq-social-media-card.svg"><meta data-rh="true" property="og:url" content="https://www.rabbitmq.com/rabbitmq-website/blog/2023/07/21/mqtt5"><meta data-rh="true" property="og:locale" content="en"><meta data-rh="true" name="docusaurus_locale" content="en"><meta data-rh="true" name="docusaurus_tag" content="default"><meta data-rh="true" name="docsearch:language" content="en"><meta data-rh="true" name="docsearch:docusaurus_tag" content="default"><meta data-rh="true" property="og:title" content="MQTT 5.0 support is coming in RabbitMQ 3.13 | RabbitMQ"><meta data-rh="true" name="description" content="Native MQTT released in RabbitMQ 3.12 has delivered substantial scalability and performance improvements for IoT use cases."><meta data-rh="true" property="og:description" content="Native MQTT released in RabbitMQ 3.12 has delivered substantial scalability and performance improvements for IoT use cases."><meta data-rh="true" property="og:type" content="article"><meta data-rh="true" property="article:published_time" content="2023-07-21T00:00:00.000Z"><meta data-rh="true" property="article:author" content="https://github.com/ansd"><meta data-rh="true" property="article:tag" content="New Features,Technical Deep Dive,MQTT,RabbitMQ 3.13.x"><link data-rh="true" rel="icon" href="/rabbitmq-website/img/rabbitmq-logo.svg"><link data-rh="true" rel="canonical" href="https://www.rabbitmq.com/rabbitmq-website/blog/2023/07/21/mqtt5"><link data-rh="true" rel="alternate" href="https://www.rabbitmq.com/rabbitmq-website/blog/2023/07/21/mqtt5" hreflang="en"><link data-rh="true" rel="alternate" href="https://www.rabbitmq.com/rabbitmq-website/blog/2023/07/21/mqtt5" hreflang="x-default"><link data-rh="true" rel="preconnect" href="https://H10VQIW16Y-dsn.algolia.net" crossorigin="anonymous"><script data-rh="true" type="application/ld+json">{"@context":"https://schema.org","@type":"BlogPosting","@id":"https://www.rabbitmq.com/rabbitmq-website/blog/2023/07/21/mqtt5","mainEntityOfPage":"https://www.rabbitmq.com/rabbitmq-website/blog/2023/07/21/mqtt5","url":"https://www.rabbitmq.com/rabbitmq-website/blog/2023/07/21/mqtt5","headline":"MQTT 5.0 support is coming in RabbitMQ 3.13","name":"MQTT 5.0 support is coming in RabbitMQ 3.13","description":"Native MQTT released in RabbitMQ 3.12 has delivered substantial scalability and performance improvements for IoT use cases.","datePublished":"2023-07-21T00:00:00.000Z","author":{"@type":"Person","name":"David Ansari","url":"https://github.com/ansd","image":"https://github.com/ansd.png"},"keywords":[],"isPartOf":{"@type":"Blog","@id":"https://www.rabbitmq.com/rabbitmq-website/blog","name":"Blog"}}</script><link rel="alternate" type="application/rss+xml" href="/rabbitmq-website/blog/rss.xml" title="RabbitMQ RSS Feed">
<link rel="alternate" type="application/atom+xml" href="/rabbitmq-website/blog/atom.xml" title="RabbitMQ Atom Feed">




<link rel="search" type="application/opensearchdescription+xml" title="RabbitMQ" href="/rabbitmq-website/opensearch.xml">







<link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Raleway:400,700">
<script src="https://cdn.cookielaw.org/scripttemplates/otSDKStub.js" data-domain-script="018ee308-473e-754f-b0c2-cbe82d25512f"></script>
<script>function OptanonWrapper(){}</script>
<script>function setGTM(e,t,o,n,r){e[n]=e[n]||[],e[n].push({"gtm.start":(new Date).getTime(),event:"gtm.js"});var i=t.getElementsByTagName(o)[0],a=t.createElement(o),s="dataLayer"!=n?"&l="+n:"";a.async=!0,a.src="https://www.googletagmanager.com/gtm.js?id="+r+s,i.parentNode.insertBefore(a,i)}var timer;function waitForOnetrustActiveGroups(){document.cookie.indexOf("OptanonConsent")>-1&&document.cookie.indexOf("groups=")>-1?(clearTimeout(timer),setGTM(window,document,"script","dataLayer","GTM-TT84L8K")):timer=setTimeout(waitForOnetrustActiveGroups,250)}document.cookie.indexOf("OptanonConsent")>-1&&document.cookie.indexOf("groups=")>-1?setGTM(window,document,"script","dataLayer","GTM-TT84L8K"):waitForOnetrustActiveGroups()</script><link rel="stylesheet" href="/rabbitmq-website/styles.css">
<script src="/rabbitmq-website/runtime~main.js" defer="defer"></script>
<script src="/rabbitmq-website/main.js" defer="defer"></script>
</head>
<body class="navigation-with-keyboard">
<script>!function(){function t(t){document.documentElement.setAttribute("data-theme",t)}var e=function(){try{return new URLSearchParams(window.location.search).get("docusaurus-theme")}catch(t){}}()||function(){try{return window.localStorage.getItem("theme")}catch(t){}}();null!==e?t(e):window.matchMedia("(prefers-color-scheme: dark)").matches?t("dark"):(window.matchMedia("(prefers-color-scheme: light)").matches,t("light"))}(),function(){try{const n=new URLSearchParams(window.location.search).entries();for(var[t,e]of n)if(t.startsWith("docusaurus-data-")){var a=t.replace("docusaurus-data-","data-");document.documentElement.setAttribute(a,e)}}catch(t){}}(),document.documentElement.setAttribute("data-announcement-bar-initially-dismissed",function(){try{return"true"===localStorage.getItem("docusaurus.announcement.dismiss")}catch(t){}return!1}())</script><div id="__docusaurus"><div role="region" aria-label="Skip to main content"><a class="skipToContent_fXgn" href="#__docusaurus_skipToContent_fallback">Skip to main content</a></div><div class="announcementBar_mb4j" style="background-color:var(--ifm-color-primary-contrast-background);color:var(--ifm-font-color-base)" role="banner"><div class="announcementBarPlaceholder_vyr4"></div><div class="content_knG7 announcementBarContent_xLdY"><strong style="font-size: var(--ifm-h4-font-size);"><a href="https://github.com/rabbitmq/rabbitmq-server/releases/tag/v4.1.0">RabbitMQ 4.1.0 is out</a></strong></div><button type="button" aria-label="Close" class="clean-btn close closeButton_CVFx announcementBarClose_gvF7"><svg viewBox="0 0 15 15" width="14" height="14"><g stroke="currentColor" stroke-width="3.1"><path d="M.75.75l13.5 13.5M14.25.75L.75 14.25"></path></g></svg></button></div><nav aria-label="Main" class="navbar navbar--fixed-top"><div class="navbar__inner"><div class="navbar__items"><button aria-label="Toggle navigation bar" aria-expanded="false" class="navbar__toggle clean-btn" type="button"><svg width="30" height="30" viewBox="0 0 30 30" aria-hidden="true"><path stroke="currentColor" stroke-linecap="round" stroke-miterlimit="10" stroke-width="2" d="M4 7h22M4 15h22M4 23h22"></path></svg></button><a class="navbar__brand" href="/rabbitmq-website/"><div class="navbar__logo"><img src="/rabbitmq-website/img/rabbitmq-logo-with-name.svg" alt="RabbitMQ" class="themedComponent_mlkZ themedComponent--light_NVdE"><img src="/rabbitmq-website/img/rabbitmq-logo-with-name.svg" alt="RabbitMQ" class="themedComponent_mlkZ themedComponent--dark_xIcU"></div></a><a class="navbar__item navbar__link" href="/rabbitmq-website/tutorials">Getting Started</a><a class="navbar__item navbar__link" href="/rabbitmq-website/docs">Docs</a><a aria-current="page" class="navbar__item navbar__link navbar__link--active" href="/rabbitmq-website/blog">Blog</a><a class="navbar__item navbar__link" href="/rabbitmq-website/contact">Support</a></div><div class="navbar__items navbar__items--right"><div class="navbar__item dropdown dropdown--hoverable dropdown--right"><a class="navbar__link" aria-haspopup="true" aria-expanded="false" role="button" href="/rabbitmq-website/docs">4.1</a><ul class="dropdown__menu"><li class=""><strong>Release series</strong></li><li><a class="dropdown__link" href="/rabbitmq-website/docs/next">Next</a></li><li><a class="dropdown__link" href="/rabbitmq-website/docs">4.1</a></li><li><a class="dropdown__link" href="/rabbitmq-website/docs/4.0">4.0</a></li><li><a class="dropdown__link" href="/rabbitmq-website/docs/3.13">3.13</a></li><li><a href="https://v3-12.rabbitmq.com/documentation.html" target="_blank" rel="noopener noreferrer" class="dropdown__link">3.12<svg width="12" height="12" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_nPIU"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a></li><li><a class="dropdown__link" href="/rabbitmq-website/release-information">Release Information</a></li></ul></div><a href="https://github.com/rabbitmq/rabbitmq-website" target="_blank" rel="noopener noreferrer" class="navbar__item navbar__link">GitHub<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_nPIU"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a><div class="toggle_vylO colorModeToggle_DEke"><button class="clean-btn toggleButton_gllP toggleButtonDisabled_aARS" type="button" disabled="" title="Switch between dark and light mode (currently light mode)" aria-label="Switch between dark and light mode (currently light mode)" aria-live="polite" aria-pressed="false"><svg viewBox="0 0 24 24" width="24" height="24" class="lightToggleIcon_pyhR"><path fill="currentColor" d="M12,9c1.65,0,3,1.35,3,3s-1.35,3-3,3s-3-1.35-3-3S10.35,9,12,9 M12,7c-2.76,0-5,2.24-5,5s2.24,5,5,5s5-2.24,5-5 S14.76,7,12,7L12,7z M2,13l2,0c0.55,0,1-0.45,1-1s-0.45-1-1-1l-2,0c-0.55,0-1,0.45-1,1S1.45,13,2,13z M20,13l2,0c0.55,0,1-0.45,1-1 s-0.45-1-1-1l-2,0c-0.55,0-1,0.45-1,1S19.45,13,20,13z M11,2v2c0,0.55,0.45,1,1,1s1-0.45,1-1V2c0-0.55-0.45-1-1-1S11,1.45,11,2z M11,20v2c0,0.55,0.45,1,1,1s1-0.45,1-1v-2c0-0.55-0.45-1-1-1C11.45,19,11,19.45,11,20z M5.99,4.58c-0.39-0.39-1.03-0.39-1.41,0 c-0.39,0.39-0.39,1.03,0,1.41l1.06,1.06c0.39,0.39,1.03,0.39,1.41,0s0.39-1.03,0-1.41L5.99,4.58z M18.36,16.95 c-0.39-0.39-1.03-0.39-1.41,0c-0.39,0.39-0.39,1.03,0,1.41l1.06,1.06c0.39,0.39,1.03,0.39,1.41,0c0.39-0.39,0.39-1.03,0-1.41 L18.36,16.95z M19.42,5.99c0.39-0.39,0.39-1.03,0-1.41c-0.39-0.39-1.03-0.39-1.41,0l-1.06,1.06c-0.39,0.39-0.39,1.03,0,1.41 s1.03,0.39,1.41,0L19.42,5.99z M7.05,18.36c0.39-0.39,0.39-1.03,0-1.41c-0.39-0.39-1.03-0.39-1.41,0l-1.06,1.06 c-0.39,0.39-0.39,1.03,0,1.41s1.03,0.39,1.41,0L7.05,18.36z"></path></svg><svg viewBox="0 0 24 24" width="24" height="24" class="darkToggleIcon_wfgR"><path fill="currentColor" d="M9.37,5.51C9.19,6.15,9.1,6.82,9.1,7.5c0,4.08,3.32,7.4,7.4,7.4c0.68,0,1.35-0.09,1.99-0.27C17.45,17.19,14.93,19,12,19 c-3.86,0-7-3.14-7-7C5,9.07,6.81,6.55,9.37,5.51z M12,3c-4.97,0-9,4.03-9,9s4.03,9,9,9s9-4.03,9-9c0-0.46-0.04-0.92-0.1-1.36 c-0.98,1.37-2.58,2.26-4.4,2.26c-2.98,0-5.4-2.42-5.4-5.4c0-1.81,0.89-3.42,2.26-4.4C12.92,3.04,12.46,3,12,3L12,3z"></path></svg></button></div><div class="navbarSearchContainer_Bca1"><button type="button" class="DocSearch DocSearch-Button" aria-label="Search (Command+K)"><span class="DocSearch-Button-Container"><svg width="20" height="20" class="DocSearch-Search-Icon" viewBox="0 0 20 20" aria-hidden="true"><path d="M14.386 14.386l4.0877 4.0877-4.0877-4.0877c-2.9418 2.9419-7.7115 2.9419-10.6533 0-2.9419-2.9418-2.9419-7.7115 0-10.6533 2.9418-2.9419 7.7115-2.9419 10.6533 0 2.9419 2.9418 2.9419 7.7115 0 10.6533z" stroke="currentColor" fill="none" fill-rule="evenodd" stroke-linecap="round" stroke-linejoin="round"></path></svg><span class="DocSearch-Button-Placeholder">Search</span></span><span class="DocSearch-Button-Keys"></span></button></div></div></div><div role="presentation" class="navbar-sidebar__backdrop"></div></nav><div id="__docusaurus_skipToContent_fallback" class="main-wrapper mainWrapper_z2l0"><div class="container margin-vert--lg"><div class="row"><main class="col col--9 col--offset-1"><article class=""><header><h1 class="title_f1Hy">MQTT 5.0 support is coming in RabbitMQ 3.13</h1><div class="container_mt6G margin-vert--md"><time datetime="2023-07-21T00:00:00.000Z">July 21, 2023</time> · <!-- -->27 min read</div><div class="margin-top--md margin-bottom--sm row"><div class="col col--12 authorCol_Hf19"><div class="avatar margin-bottom--sm"><a href="https://github.com/ansd" target="_blank" rel="noopener noreferrer" class="avatar__photo-link"><img class="avatar__photo authorImage_XqGP" src="https://github.com/ansd.png" alt="David Ansari"></a><div class="avatar__intro authorDetails_lV9A"><div class="avatar__name"><a href="https://github.com/ansd" target="_blank" rel="noopener noreferrer"><span class="authorName_yefp">David Ansari</span></a></div><div class="authorSocials_rSDt"><a href="https://github.com/ansd" target="_blank" rel="noopener noreferrer" class="authorSocialLink_owbf" title="GitHub"><svg xmlns="http://www.w3.org/2000/svg" width="1em" height="1em" viewBox="0 0 256 250" preserveAspectRatio="xMidYMid" style="--dark:#000;--light:#fff" class="authorSocialLink_owbf githubSvg_Uu4N"><path d="M128.001 0C57.317 0 0 57.307 0 128.001c0 56.554 36.676 104.535 87.535 121.46 6.397 1.185 8.746-2.777 8.746-6.158 0-3.052-.12-13.135-.174-23.83-35.61 7.742-43.124-15.103-43.124-15.103-5.823-14.795-14.213-18.73-14.213-18.73-11.613-7.944.876-7.78.876-7.78 12.853.902 19.621 13.19 19.621 13.19 11.417 19.568 29.945 13.911 37.249 10.64 1.149-8.272 4.466-13.92 8.127-17.116-28.431-3.236-58.318-14.212-58.318-63.258 0-13.975 5-25.394 13.188-34.358-1.329-3.224-5.71-16.242 1.24-33.874 0 0 10.749-3.44 35.21 13.121 10.21-2.836 21.16-4.258 32.038-4.307 10.878.049 21.837 1.47 32.066 4.307 24.431-16.56 35.165-13.12 35.165-13.12 6.967 17.63 2.584 30.65 1.255 33.873 8.207 8.964 13.173 20.383 13.173 34.358 0 49.163-29.944 59.988-58.447 63.157 4.591 3.972 8.682 11.762 8.682 23.704 0 17.126-.148 30.91-.148 35.126 0 3.407 2.304 7.398 8.792 6.14C219.37 232.5 256 184.537 256 128.002 256 57.307 198.691 0 128.001 0Zm-80.06 182.34c-.282.636-1.283.827-2.194.39-.929-.417-1.45-1.284-1.15-1.922.276-.655 1.279-.838 2.205-.399.93.418 1.46 1.293 1.139 1.931Zm6.296 5.618c-.61.566-1.804.303-2.614-.591-.837-.892-.994-2.086-.375-2.66.63-.566 1.787-.301 2.626.591.838.903 1 2.088.363 2.66Zm4.32 7.188c-.785.545-2.067.034-2.86-1.104-.784-1.138-.784-2.503.017-3.05.795-.547 2.058-.055 2.861 1.075.782 1.157.782 2.522-.019 3.08Zm7.304 8.325c-.701.774-2.196.566-3.29-.49-1.119-1.032-1.43-2.496-.726-3.27.71-.776 2.213-.558 3.315.49 1.11 1.03 1.45 2.505.701 3.27Zm9.442 2.81c-.31 1.003-1.75 1.459-3.199 1.033-1.448-.439-2.395-1.613-2.103-2.626.301-1.01 1.747-1.484 3.207-1.028 1.446.436 2.396 1.602 2.095 2.622Zm10.744 1.193c.036 1.055-1.193 1.93-2.715 1.95-1.53.034-2.769-.82-2.786-1.86 0-1.065 1.202-1.932 2.733-1.958 1.522-.03 2.768.818 2.768 1.868Zm10.555-.405c.182 1.03-.875 2.088-2.387 2.37-1.485.271-2.861-.365-3.05-1.386-.184-1.056.893-2.114 2.376-2.387 1.514-.263 2.868.356 3.061 1.403Z"></path></svg></a><a href="https://www.linkedin.com/in/ansd/" target="_blank" rel="noopener noreferrer" class="authorSocialLink_owbf" title="LinkedIn"><svg xmlns="http://www.w3.org/2000/svg" width="1em" height="1em" preserveAspectRatio="xMidYMid" viewBox="0 0 256 256" class="authorSocialLink_owbf"><path d="M218.123 218.127h-37.931v-59.403c0-14.165-.253-32.4-19.728-32.4-19.756 0-22.779 15.434-22.779 31.369v60.43h-37.93V95.967h36.413v16.694h.51a39.907 39.907 0 0 1 35.928-19.733c38.445 0 45.533 25.288 45.533 58.186l-.016 67.013ZM56.955 79.27c-12.157.002-22.014-9.852-22.016-22.009-.002-12.157 9.851-22.014 22.008-22.016 12.157-.003 22.014 9.851 22.016 22.008A22.013 22.013 0 0 1 56.955 79.27m18.966 138.858H37.95V95.967h37.97v122.16ZM237.033.018H18.89C8.58-.098.125 8.161-.001 18.471v219.053c.122 10.315 8.576 18.582 18.89 18.474h218.144c10.336.128 18.823-8.139 18.966-18.474V18.454c-.147-10.33-8.635-18.588-18.966-18.453" fill="#0A66C2"></path></svg></a><a href="https://m.ansd.xyz/@ansd" target="_blank" rel="noopener noreferrer" class="authorSocialLink_owbf" title="Mastodon"><svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 61 65" width="1em" height="1em" class="authorSocialLink_owbf"><path fill="url(#:Rfndbeh:)" d="M60.754 14.39C59.814 7.406 53.727 1.903 46.512.836 45.294.656 40.682 0 29.997 0h-.08C19.23 0 16.938.656 15.72.836 8.705 1.873 2.299 6.82.745 13.886c-.748 3.48-.828 7.338-.689 10.877.198 5.075.237 10.142.697 15.197a71.482 71.482 0 0 0 1.664 9.968c1.477 6.056 7.458 11.096 13.317 13.152a35.718 35.718 0 0 0 19.484 1.028 28.365 28.365 0 0 0 2.107-.576c1.572-.5 3.413-1.057 4.766-2.038a.154.154 0 0 0 .062-.118v-4.899a.146.146 0 0 0-.055-.111.145.145 0 0 0-.122-.028 54 54 0 0 1-12.644 1.478c-7.328 0-9.298-3.478-9.863-4.925a15.258 15.258 0 0 1-.857-3.882.142.142 0 0 1 .178-.145 52.976 52.976 0 0 0 12.437 1.477c1.007 0 2.012 0 3.02-.026 4.213-.119 8.654-.334 12.8-1.144.103-.02.206-.038.295-.065 6.539-1.255 12.762-5.196 13.394-15.176.024-.393.083-4.115.083-4.523.003-1.386.446-9.829-.065-15.017Z"></path><path fill="#fff" d="M50.394 22.237v17.35H43.52V22.749c0-3.545-1.478-5.353-4.483-5.353-3.303 0-4.958 2.139-4.958 6.364v9.217h-6.835V23.76c0-4.225-1.657-6.364-4.96-6.364-2.988 0-4.48 1.808-4.48 5.353v16.84H10.93V22.237c0-3.545.905-6.362 2.715-8.45 1.868-2.082 4.317-3.152 7.358-3.152 3.519 0 6.178 1.354 7.951 4.057l1.711 2.871 1.714-2.871c1.773-2.704 4.432-4.056 7.945-4.056 3.038 0 5.487 1.069 7.36 3.152 1.81 2.085 2.712 4.902 2.71 8.449Z"></path><defs><linearGradient id=":Rfndbeh:" x1="30.5" x2="30.5" y1="0" y2="65" gradientUnits="userSpaceOnUse"><stop stop-color="#6364FF"></stop><stop offset="1" stop-color="#563ACC"></stop></linearGradient></defs></svg></a><a href="https://bsky.app/profile/ansd.xyz" target="_blank" rel="noopener noreferrer" class="authorSocialLink_owbf" title="Bluesky"><svg xmlns="http://www.w3.org/2000/svg" width="1em" height="1em" preserveAspectRatio="xMidYMid" viewBox="0 0 256 226" class="authorSocialLink_owbf"><path fill="#1185FE" d="M55.491 15.172c29.35 22.035 60.917 66.712 72.509 90.686 11.592-23.974 43.159-68.651 72.509-90.686C221.686-.727 256-13.028 256 26.116c0 7.818-4.482 65.674-7.111 75.068-9.138 32.654-42.436 40.983-72.057 35.942 51.775 8.812 64.946 38 36.501 67.187-54.021 55.433-77.644-13.908-83.696-31.676-1.11-3.257-1.63-4.78-1.637-3.485-.008-1.296-.527.228-1.637 3.485-6.052 17.768-29.675 87.11-83.696 31.676-28.445-29.187-15.274-58.375 36.5-67.187-29.62 5.041-62.918-3.288-72.056-35.942C4.482 91.79 0 33.934 0 26.116 0-13.028 34.314-.727 55.491 15.172Z"></path></svg></a></div></div></div></div></div></header><div id="__blog-post-container" class="markdown"><p><a href="/rabbitmq-website/blog/2023/03/21/native-mqtt">Native MQTT</a> released in RabbitMQ 3.12 has delivered substantial scalability and performance improvements for IoT use cases.</p>
<p>RabbitMQ 3.13 will support <a href="https://docs.oasis-open.org/mqtt/mqtt/v5.0/os/mqtt-v5.0-os.html" target="_blank" rel="noopener noreferrer">MQTT 5.0</a> and will therefore be the next big step in our journey to make RabbitMQ one of the leading MQTT brokers.</p>
<p>This blog post explains how the new MQTT 5.0 features are used in RabbitMQ.</p>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="mqtt-overview">MQTT Overview<a href="#mqtt-overview" class="hash-link" aria-label="Direct link to MQTT Overview" title="Direct link to MQTT Overview">​</a></h2>
<p>MQTT is the standard protocol for the Internet of Things (IoT).</p>
<p>IoT remote devices can have a poor network quality when connecting to the broker.
Therefore, MQTT is lightweight: MQTT protocol headers are small to save network bandwidth.</p>
<p>Since IoT devices might often disconnect and reconnect - imagine a car driving through a tunnel - MQTT is also efficient: Clients are connected and authenticated with a handshake that is shorter compared to other messaging protocols.</p>
<p>The MQTT protocol has been around for many years.
As shown in the following table, the latest MQTT protocol version is 5.0.</p>
<table><thead><tr><th>MQTT version</th><th>Protocol version in CONNECT packet</th><th>MQTT spec release year</th><th>RabbitMQ support since year (version)</th></tr></thead><tbody><tr><td><a href="https://public.dhe.ibm.com/software/dw/webservices/ws-mqtt/mqtt-v3r1.html" target="_blank" rel="noopener noreferrer">3.1</a></td><td>3</td><td>2010</td><td>2012 (3.0)</td></tr><tr><td><a href="https://docs.oasis-open.org/mqtt/mqtt/v3.1.1/os/mqtt-v3.1.1-os.html" target="_blank" rel="noopener noreferrer">3.1.1</a></td><td>4</td><td>2014</td><td>2014 (3.3)</td></tr><tr><td><a href="https://docs.oasis-open.org/mqtt/mqtt/v5.0/os/mqtt-v5.0-os.html" target="_blank" rel="noopener noreferrer">5.0</a></td><td><a href="https://docs.oasis-open.org/mqtt/mqtt/v5.0/os/mqtt-v5.0-os.html#_Toc3901037" target="_blank" rel="noopener noreferrer">5</a></td><td>2019</td><td>2024 (3.13)</td></tr></tbody></table>
<p>It is worth mentioning that there is a difference between the user facing protocol version and the &quot;internal&quot; protocol version (also known as the protocol level).
The latter is sent from client to server in the <a href="https://docs.oasis-open.org/mqtt/mqtt/v5.0/os/mqtt-v5.0-os.html#_Toc3901033" target="_blank" rel="noopener noreferrer">CONNECT</a> packet.
Because user facing protocol version 3.1.1 maps to internal protocol version 4, to avoid further confusion, the MQTT committee decided to skip user facing version 4.0 such that user facing version 5.0 maps to internal protocol version 5.</p>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="mqtt-50-features">MQTT 5.0 Features<a href="#mqtt-50-features" class="hash-link" aria-label="Direct link to MQTT 5.0 Features" title="Direct link to MQTT 5.0 Features">​</a></h2>
<p><a href="https://docs.oasis-open.org/mqtt/mqtt/v5.0/os/mqtt-v5.0-os.html#_Toc3901293" target="_blank" rel="noopener noreferrer">Appendix C. Summary of new features in MQTT v5.0</a> provides a complete list of new MQTT 5.0 features.</p>
<p>Since you find great MQTT 5.0 resources including illustrative diagrams and usage patterns on the web, this blog post focuses solely on RabbitMQ specifics.
This section explains the most significant features implemented in PR <a href="https://github.com/rabbitmq/rabbitmq-server/pull/7263" target="_blank" rel="noopener noreferrer">#7263</a>.
For each feature, we provide an example how it is used with RabbitMQ or outline a high level description of how it is implemented in RabbitMQ.</p>
<p>To run the examples by yourself, start RabbitMQ server 3.13,
for example, using <a href="https://hub.docker.com/layers/library/rabbitmq/3.13.0-management/images/sha256-ba26f50715029bb709cbe8831cfd07a5473da00557a0720269fa69c1fb66c6d6?context=explore" target="_blank" rel="noopener noreferrer">this Docker image tag</a>:</p>
<div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token function" style="color:#d73a49">docker</span><span class="token plain"> run </span><span class="token parameter variable" style="color:#36acaa">-it</span><span class="token plain"> </span><span class="token parameter variable" style="color:#36acaa">--rm</span><span class="token plain"> </span><span class="token parameter variable" style="color:#36acaa">--name</span><span class="token plain"> rabbitmq </span><span class="token parameter variable" style="color:#36acaa">-p</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">1883</span><span class="token plain">:1883 </span><span class="token parameter variable" style="color:#36acaa">-p</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">15672</span><span class="token plain">:15672 </span><span class="token parameter variable" style="color:#36acaa">-p</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">15692</span><span class="token plain">:15692 rabbitmq:3.13.0-management</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>In another terminal window, enable the <a href="/rabbitmq-website/docs/mqtt">MQTT plugin</a>:</p>
<div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token function" style="color:#d73a49">docker</span><span class="token plain"> </span><span class="token builtin class-name">exec</span><span class="token plain"> rabbitmq rabbitmq-plugins </span><span class="token builtin class-name">enable</span><span class="token plain"> rabbitmq_mqtt</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>Since the MQTT plugin got enabled dynamically, <a href="/rabbitmq-website/docs/feature-flags#rabbitmq_mqtt-feature-flags">feature flags defined by the MQTT plugin</a> are disabled.
Enable all feature flags including feature flag <code>mqtt_v5</code>:</p>
<div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token function" style="color:#d73a49">docker</span><span class="token plain"> </span><span class="token builtin class-name">exec</span><span class="token plain"> rabbitmq rabbitmqctl enable_feature_flag all</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>Listing the feature flags should now show that all feature flags are enabled:</p>
<div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token function" style="color:#d73a49">docker</span><span class="token plain"> </span><span class="token builtin class-name">exec</span><span class="token plain"> rabbitmq rabbitmqctl list_feature_flags </span><span class="token parameter variable" style="color:#36acaa">--formatter</span><span class="token operator" style="color:#393A34">=</span><span class="token plain">pretty_table</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>Below examples use <a href="https://mqttx.app/cli" target="_blank" rel="noopener noreferrer">MQTTX CLI</a> version 1.9.4.
We use a CLI rather than a graphical UI so that you can easily run the examples by copy pasting the commands.</p>
<p>All new features also apply to the <a href="/rabbitmq-website/docs/web-mqtt">RabbitMQ Web MQTT Plugin</a>.</p>
<p>Here is the list of MQTT 5.0 features covered in this blog post:</p>
<ul>
<li><a href="#feature-1-message-expiry">Feature 1: Message Expiry</a></li>
<li><a href="#feature-2-subscription-identifier">Feature 2: Subscription Identifier</a></li>
<li><a href="#feature-3-subscription-options">Feature 3: Subscription Options</a></li>
<li><a href="#feature-4-reason-code-on-all-acks">Feature 4: Reason code on all ACKs</a></li>
<li><a href="#feature-5-user-properties">Feature 5: User properties</a></li>
<li><a href="#feature-6-payload-format-and-content-type">Feature 6: Payload Format and Content Type</a></li>
<li><a href="#feature-7-request--response">Feature 7: Request / Response</a></li>
<li><a href="#feature-8-assigned-client-identifier">Feature 8: Assigned Client Identifier</a></li>
<li><a href="#feature-9-topic-alias">Feature 9: Topic Alias</a></li>
<li><a href="#feature-10-flow-control">Feature 10: Flow control</a></li>
<li><a href="#feature-11-maximum-packet-size">Feature 11: Maximum Packet Size</a></li>
<li><a href="#feature-12-server-initiated-disconnect">Feature 12: Server initiated DISCONNECT</a></li>
<li><a href="#feature-13-session-expiry">Feature 13: Session Expiry</a></li>
<li><a href="#feature-14-will-delay">Feature 14: Will delay</a></li>
<li><a href="#feature-15-optional-server-feature-availability">Feature 15: Optional Server feature availability</a></li>
</ul>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="feature-1-message-expiry">Feature 1: <a href="https://docs.oasis-open.org/mqtt/mqtt/v5.0/os/mqtt-v5.0-os.html#_Toc3901112" target="_blank" rel="noopener noreferrer">Message Expiry</a><a href="#feature-1-message-expiry" class="hash-link" aria-label="Direct link to feature-1-message-expiry" title="Direct link to feature-1-message-expiry">​</a></h3>
<h4 class="anchor anchorWithStickyNavbar_LWe7" id="description">Description<a href="#description" class="hash-link" aria-label="Direct link to Description" title="Direct link to Description">​</a></h4>
<p>An expiry interval in seconds can be set for each message being published to the broker.
If the message is not consumed within that expiry interval, the message is discarded or dead lettered.</p>
<h4 class="anchor anchorWithStickyNavbar_LWe7" id="example">Example<a href="#example" class="hash-link" aria-label="Direct link to Example" title="Direct link to Example">​</a></h4>
<p>Create a subscription for topic <code>t/1</code>.
This creates a queue in RabbitMQ.
Disconnect the client by typing <code>Ctrl+C</code> in the terminal.
Since we use a <a href="https://docs.oasis-open.org/mqtt/mqtt/v5.0/os/mqtt-v5.0-os.html#_Toc3901048" target="_blank" rel="noopener noreferrer">Session Expiry Interval</a> of 600 seconds, this queue will exist for 10 more minutes.</p>
<div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">mqttx sub --client-id sub-1 </span><span class="token parameter variable" style="color:#36acaa">--topic</span><span class="token plain"> t/1 --session-expiry-interval </span><span class="token number" style="color:#36acaa">600</span><span class="token plain"> </span><span class="token parameter variable" style="color:#36acaa">--qos</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">1</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">…  Connecting</span><span class="token punctuation" style="color:#393A34">..</span><span class="token plain">.</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">✔  Connected</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">…  Subscribing to t/1</span><span class="token punctuation" style="color:#393A34">..</span><span class="token plain">.</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">✔  Subscribed to t/1</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">^C</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>Publish a message to the same topic with a message expiry interval of 30 seconds:</p>
<div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">mqttx pub </span><span class="token parameter variable" style="color:#36acaa">--topic</span><span class="token plain"> t/1 </span><span class="token parameter variable" style="color:#36acaa">--message</span><span class="token plain"> m1 --message-expiry-interval </span><span class="token number" style="color:#36acaa">30</span><span class="token plain"> </span><span class="token parameter variable" style="color:#36acaa">--qos</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">1</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">…  Connecting</span><span class="token punctuation" style="color:#393A34">..</span><span class="token plain">.</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">✔  Connected</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">…  Message publishing</span><span class="token punctuation" style="color:#393A34">..</span><span class="token plain">.</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">✔  Message published</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>Within the next 30 seconds, list the queues:</p>
<div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token function" style="color:#d73a49">docker</span><span class="token plain"> </span><span class="token builtin class-name">exec</span><span class="token plain"> rabbitmq rabbitmqctl </span><span class="token parameter variable" style="color:#36acaa">--quiet</span><span class="token plain"> </span><span class="token parameter variable" style="color:#36acaa">--formatter</span><span class="token operator" style="color:#393A34">=</span><span class="token plain">pretty_table list_queues name </span><span class="token builtin class-name">type</span><span class="token plain"> messages</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">┌─────────────────────────────┬─────────┬──────────┐</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">│ name                        │ </span><span class="token builtin class-name">type</span><span class="token plain">    │ messages │</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">├─────────────────────────────┼─────────┼──────────┤</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">│ mqtt-subscription-sub-1qos1 │ classic │ </span><span class="token number" style="color:#36acaa">1</span><span class="token plain">        │</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">└─────────────────────────────┴─────────┴──────────┘</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>Wait for 30 seconds, and list the queues again:</p>
<div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token function" style="color:#d73a49">docker</span><span class="token plain"> </span><span class="token builtin class-name">exec</span><span class="token plain"> rabbitmq rabbitmqctl </span><span class="token parameter variable" style="color:#36acaa">--quiet</span><span class="token plain"> </span><span class="token parameter variable" style="color:#36acaa">--formatter</span><span class="token operator" style="color:#393A34">=</span><span class="token plain">pretty_table list_queues</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">┌─────────────────────────────┬─────────┬──────────┐</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">│ name                        │ </span><span class="token builtin class-name">type</span><span class="token plain">    │ messages │</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">├─────────────────────────────┼─────────┼──────────┤</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">│ mqtt-subscription-sub-1qos1 │ classic │ </span><span class="token number" style="color:#36acaa">0</span><span class="token plain">        │</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">└─────────────────────────────┴─────────┴──────────┘</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>The message expired since client <code>sub-1</code> has not connected to the broker to consume the message.
If a <a href="/rabbitmq-website/docs/dlx">dead lettering</a> policy is set up, the message will be dead lettered to an exchange.
In our case, dead lettering is disabled.
Querying the Prometheus endpoint proves that 1 message expired from a classic queue.</p>
<div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token function" style="color:#d73a49">curl</span><span class="token plain"> </span><span class="token parameter variable" style="color:#36acaa">--silent</span><span class="token plain"> localhost:15692/metrics </span><span class="token operator" style="color:#393A34">|</span><span class="token plain"> </span><span class="token function" style="color:#d73a49">grep</span><span class="token plain"> rabbitmq_global_messages_dead_lettered_expired_total</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token comment" style="color:#999988;font-style:italic"># TYPE rabbitmq_global_messages_dead_lettered_expired_total counter</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token comment" style="color:#999988;font-style:italic"># HELP rabbitmq_global_messages_dead_lettered_expired_total Total number of messages dead-lettered due to message TTL exceeded</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">rabbitmq_global_messages_dead_lettered_expired_total</span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain">queue_type</span><span class="token operator" style="color:#393A34">=</span><span class="token string" style="color:#e3116c">&quot;rabbit_classic_queue&quot;</span><span class="token plain">,dead_letter_strategy</span><span class="token operator" style="color:#393A34">=</span><span class="token string" style="color:#e3116c">&quot;at_most_once&quot;</span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">0</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">rabbitmq_global_messages_dead_lettered_expired_total</span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain">queue_type</span><span class="token operator" style="color:#393A34">=</span><span class="token string" style="color:#e3116c">&quot;rabbit_classic_queue&quot;</span><span class="token plain">,dead_letter_strategy</span><span class="token operator" style="color:#393A34">=</span><span class="token string" style="color:#e3116c">&quot;disabled&quot;</span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">1</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">rabbitmq_global_messages_dead_lettered_expired_total</span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain">queue_type</span><span class="token operator" style="color:#393A34">=</span><span class="token string" style="color:#e3116c">&quot;rabbit_quorum_queue&quot;</span><span class="token plain">,dead_letter_strategy</span><span class="token operator" style="color:#393A34">=</span><span class="token string" style="color:#e3116c">&quot;at_least_once&quot;</span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">0</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">rabbitmq_global_messages_dead_lettered_expired_total</span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain">queue_type</span><span class="token operator" style="color:#393A34">=</span><span class="token string" style="color:#e3116c">&quot;rabbit_quorum_queue&quot;</span><span class="token plain">,dead_letter_strategy</span><span class="token operator" style="color:#393A34">=</span><span class="token string" style="color:#e3116c">&quot;at_most_once&quot;</span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">0</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">rabbitmq_global_messages_dead_lettered_expired_total</span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain">queue_type</span><span class="token operator" style="color:#393A34">=</span><span class="token string" style="color:#e3116c">&quot;rabbit_quorum_queue&quot;</span><span class="token plain">,dead_letter_strategy</span><span class="token operator" style="color:#393A34">=</span><span class="token string" style="color:#e3116c">&quot;disabled&quot;</span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">0</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>Another interesting feature is the following requirement:</p>
<blockquote>
<p>The PUBLISH packet sent to a Client by the Server MUST contain a Message Expiry Interval set to the received value minus the time that the Application Message has been waiting in the Server.</p>
</blockquote>
<p>Send a second message to the broker with a Message Expiry Interval of 60 seconds:</p>
<div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">mqttx pub </span><span class="token parameter variable" style="color:#36acaa">--topic</span><span class="token plain"> t/1 </span><span class="token parameter variable" style="color:#36acaa">--message</span><span class="token plain"> m2 --message-expiry-interval </span><span class="token number" style="color:#36acaa">60</span><span class="token plain"> </span><span class="token parameter variable" style="color:#36acaa">--qos</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">1</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>Wait for 20 seconds before reconnecting the subscribing client:</p>
<div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">mqttx sub --client-id sub-1 </span><span class="token parameter variable" style="color:#36acaa">--topic</span><span class="token plain"> t/1 --no-clean --session-expiry-interval </span><span class="token number" style="color:#36acaa">0</span><span class="token plain">  </span><span class="token parameter variable" style="color:#36acaa">--qos</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">1</span><span class="token plain"> --output-mode clean</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token string" style="color:#e3116c">&quot;topic&quot;</span><span class="token builtin class-name">:</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;t/1&quot;</span><span class="token plain">,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token string" style="color:#e3116c">&quot;payload&quot;</span><span class="token builtin class-name">:</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;m2&quot;</span><span class="token plain">,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token string" style="color:#e3116c">&quot;packet&quot;</span><span class="token builtin class-name">:</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token punctuation" style="color:#393A34">..</span><span class="token plain">.</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token string" style="color:#e3116c">&quot;properties&quot;</span><span class="token builtin class-name">:</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token string" style="color:#e3116c">&quot;messageExpiryInterval&quot;</span><span class="token builtin class-name">:</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">40</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">}</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>As mandated by the MQTT 5.0 protocol specification, the client receives the second message with a Message Expiry Interval set to 40 seconds:
60 seconds as received by the broker minus the 20 seconds the message has been waiting in the broker.</p>
<h4 class="anchor anchorWithStickyNavbar_LWe7" id="implementation">Implementation<a href="#implementation" class="hash-link" aria-label="Direct link to Implementation" title="Direct link to Implementation">​</a></h4>
<p>MQTT 5.0 Message Expiry is implemented in RabbitMQ using <a href="/rabbitmq-website/docs/ttl#per-message-ttl-in-publishers">per-message TTL</a> similar to the <code>expiration</code> field in AMQP 0.9.1 publishers.</p>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="feature-2-subscription-identifier">Feature 2: <a href="https://docs.oasis-open.org/mqtt/mqtt/v5.0/os/mqtt-v5.0-os.html#_Toc3901166" target="_blank" rel="noopener noreferrer">Subscription Identifier</a><a href="#feature-2-subscription-identifier" class="hash-link" aria-label="Direct link to feature-2-subscription-identifier" title="Direct link to feature-2-subscription-identifier">​</a></h3>
<h4 class="anchor anchorWithStickyNavbar_LWe7" id="description-1">Description<a href="#description-1" class="hash-link" aria-label="Direct link to Description" title="Direct link to Description">​</a></h4>
<p>A client can set a subscription identifier in a <a href="https://docs.oasis-open.org/mqtt/mqtt/v5.0/os/mqtt-v5.0-os.html#_Toc3901161" target="_blank" rel="noopener noreferrer">SUBSCRIBE</a> packet.
If the client is being sent a message due to that subscription, the broker will include that subscription identifier into the <a href="https://docs.oasis-open.org/mqtt/mqtt/v5.0/os/mqtt-v5.0-os.html#_Toc3901100" target="_blank" rel="noopener noreferrer">PUBLISH</a> packet.</p>
<p>Use cases for subscription identifiers are listed in section <a href="https://docs.oasis-open.org/mqtt/mqtt/v5.0/os/mqtt-v5.0-os.html#_Toc3901170" target="_blank" rel="noopener noreferrer">SUBSCRIBE Actions</a>.</p>
<h4 class="anchor anchorWithStickyNavbar_LWe7" id="example-1">Example<a href="#example-1" class="hash-link" aria-label="Direct link to Example" title="Direct link to Example">​</a></h4>
<p>Send 3 separate SUBSCRIBE packets from the same client to the server, each with a different topic filter and different subscription identifier:</p>
<div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">mqttx sub --client-id sub-2 </span><span class="token parameter variable" style="color:#36acaa">--topic</span><span class="token plain"> t/1 --subscription-identifier </span><span class="token number" style="color:#36acaa">1</span><span class="token plain"> --session-expiry-interval </span><span class="token number" style="color:#36acaa">600</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">^C</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">mqttx sub --client-id sub-2 </span><span class="token parameter variable" style="color:#36acaa">--topic</span><span class="token plain"> t/2 --subscription-identifier </span><span class="token number" style="color:#36acaa">2</span><span class="token plain"> --session-expiry-interval </span><span class="token number" style="color:#36acaa">600</span><span class="token plain"> --no-clean</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">^C</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">mqttx sub --client-id sub-2 </span><span class="token parameter variable" style="color:#36acaa">--topic</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;t/#&quot;</span><span class="token plain"> --subscription-identifier </span><span class="token number" style="color:#36acaa">3</span><span class="token plain"> --session-expiry-interval </span><span class="token number" style="color:#36acaa">0</span><span class="token plain"> --no-clean --output-mode clean</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>In a 2nd terminal window, we see 3 bindings from the same queue to the same topic exchange, each with a different routing key:</p>
<div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token function" style="color:#d73a49">docker</span><span class="token plain"> </span><span class="token builtin class-name">exec</span><span class="token plain"> rabbitmq rabbitmqctl </span><span class="token parameter variable" style="color:#36acaa">--quiet</span><span class="token plain"> </span><span class="token parameter variable" style="color:#36acaa">--formatter</span><span class="token operator" style="color:#393A34">=</span><span class="token plain">pretty_table list_bindings </span><span class="token punctuation" style="color:#393A34">\</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    source_name source_kind destination_name destination_kind routing_key</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">┌─────────────┬─────────────┬─────────────────────────────┬──────────────────┬─────────────────────────────┐</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">│ source_name │ source_kind │ destination_name            │ destination_kind │ routing_key                 │</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">├─────────────┼─────────────┼──────────────── ─────────────┼──────────────────┼─────────────────────────────┤</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">│             │ exchange    │ mqtt-subscription-sub-2qos0 │ queue            │ mqtt-subscription-sub-2qos0 │</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">├─────────────┼─────────────┼─────────────────────────────┼──────────────────┼─────────────────────────────┤</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">│ amq.topic   │ exchange    │ mqtt-subscription-sub-2qos0 │ queue            │ t.</span><span class="token comment" style="color:#999988;font-style:italic">#                         │</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">├─────────────┼─────────────┼─────────────────────────────┼──────────────────┼─────────────────────────────┤</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">│ amq.topic   │ exchange    │ mqtt-subscription-sub-2qos0 │ queue            │ t.1                         │</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">├─────────────┼─────────────┼─────────────────────────────┼────  ──────────────┼─────────────────────────────┤</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">│ amq.topic   │ exchange    │ mqtt-subscription-sub-2qos0 │ queue            │ t.2                         │</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">└─────────────┴─────────────┴─────────────────────────────┴──────────────────┴─────────────────────────────┘</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>The first entry is the implicit binding to the default exchange.</p>
<p>Each MQTT subscription with its MQTT topic filter corresponds to one AMQP 0.9.1 binding with a binding key.
To be precise, table column <code>routing_key</code> is misnamed: It should be called <code>binding_key</code> instead.
The topic level separator in MQTT is the &quot;<code>/</code>&quot; character whereas the topic level separator in AMQP 0.9.1 topic exchanges is the &quot;<code>.</code>&quot; character.</p>
<p>Again in the 2nd terminal window, send a message to topic <code>t/1</code>:</p>
<div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">mqttx pub </span><span class="token parameter variable" style="color:#36acaa">--topic</span><span class="token plain"> t/1 </span><span class="token parameter variable" style="color:#36acaa">--message</span><span class="token plain"> m1</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>The 1st terminal window (of the subscribing client) receives the following PUBLISH packet:</p>
<div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token string" style="color:#e3116c">&quot;topic&quot;</span><span class="token builtin class-name">:</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;t/1&quot;</span><span class="token plain">,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token string" style="color:#e3116c">&quot;payload&quot;</span><span class="token builtin class-name">:</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;m1&quot;</span><span class="token plain">,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token string" style="color:#e3116c">&quot;packet&quot;</span><span class="token builtin class-name">:</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token punctuation" style="color:#393A34">..</span><span class="token plain">.</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token string" style="color:#e3116c">&quot;properties&quot;</span><span class="token builtin class-name">:</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token string" style="color:#e3116c">&quot;subscriptionIdentifier&quot;</span><span class="token builtin class-name">:</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">[</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token number" style="color:#36acaa">1</span><span class="token plain">,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token number" style="color:#36acaa">3</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token punctuation" style="color:#393A34">]</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">}</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>It contains subscription identifiers 1 and 3 because both topic filters <code>t/1</code> and <code>t/#</code> match topic <code>t/1</code>.</p>
<p>Likewise, if you send a 2nd message to topic <code>t/2</code>, the subscribing client will receive a PUBLISH packet containing subscription identifiers 2 and 3.</p>
<h4 class="anchor anchorWithStickyNavbar_LWe7" id="implementation-1">Implementation<a href="#implementation-1" class="hash-link" aria-label="Direct link to Implementation" title="Direct link to Implementation">​</a></h4>
<p>Subscription identifiers are part of the MQTT session state.
Therefore, subscription identifiers must be persisted in the server&#x27;s database while the client is disconnected and until the MQTT session ends.
RabbitMQ stores the subscription identifiers in the binding arguments:</p>
<div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token function" style="color:#d73a49">docker</span><span class="token plain"> </span><span class="token builtin class-name">exec</span><span class="token plain"> rabbitmq rabbitmqctl </span><span class="token parameter variable" style="color:#36acaa">--quiet</span><span class="token plain"> </span><span class="token parameter variable" style="color:#36acaa">--formatter</span><span class="token operator" style="color:#393A34">=</span><span class="token plain">pretty_table list_bindings routing_key arguments</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">┌─────────────────────────────┬───────────────────────────────────────────────────────────────────────────────────┐</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">│ routing_key                 │ arguments                                                                         │</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">├─────────────────────────────┼──────────────────────────────────────────────────────────────────────── ───────────┤</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">│ mqtt-subscription-sub-2qos0 │                                                                                   │</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">├─────────────────────────────┼───────────────────────────────────────────────────────────────────────────────────┤</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">│ t.</span><span class="token comment" style="color:#999988;font-style:italic">#                         │ {mqtt_subscription_opts,0,false,false,0,3}{&lt;&lt;&quot;x-binding-key&quot;&gt;&gt;,longstr,&lt;&lt;&quot;t.#&quot;&gt;&gt;} │</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">├─────────────────────────────┼───────────────────────────────────────────────────────────────────────────────────┤</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">│ t.1                         │ </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain">mqtt_subscription_opts,0,false,false,0,1</span><span class="token punctuation" style="color:#393A34">}</span><span class="token punctuation" style="color:#393A34">{</span><span class="token operator" style="color:#393A34">&lt;&lt;</span><span class="token string" style="color:#e3116c">&quot;x-binding-key&quot;</span><span class="token operator" style="color:#393A34">&gt;&gt;</span><span class="token plain">,longstr,</span><span class="token operator" style="color:#393A34">&lt;&lt;</span><span class="token string" style="color:#e3116c">&quot;t.1&quot;</span><span class="token operator" style="color:#393A34">&gt;&gt;</span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"> │</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">├─────────────────────────────┼───────────────────────────────────────────────────────────────────────────────────┤</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">│ t.2                         │ </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain">mqtt_subscription_opts,0,false,false,0,2</span><span class="token punctuation" style="color:#393A34">}</span><span class="token punctuation" style="color:#393A34">{</span><span class="token operator" style="color:#393A34">&lt;&lt;</span><span class="token string" style="color:#e3116c">&quot;x-binding-key&quot;</span><span class="token operator" style="color:#393A34">&gt;&gt;</span><span class="token plain">,longstr,</span><span class="token operator" style="color:#393A34">&lt;&lt;</span><span class="token string" style="color:#e3116c">&quot;t.2&quot;</span><span class="token operator" style="color:#393A34">&gt;&gt;</span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"> │</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">└─────────────────────────────┴────────────────────────────────  ───────────────────────────────────────────────────┘</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>The exact structure of the binding arguments is not important and will likely change in a future RabbitMQ version.
However, you can see integers 1, 2, and 3 in the binding arguments which correspond to the subscription identifiers.</p>
<p>When the topic exchange routes a message, the publishing Erlang process will include all matched binding keys into the message.
The Erlang process of the subscribing MQTT client compares the matched binding keys with the MQTT topic filters it knows about and includes the subscription identifiers into the PUBLISH packet sent to the MQTT client.</p>
<p>The publishing Erlang process can be an MQTT connection process or a AMQP 0.9.1 channel process.
As always, RabbitMQ excels in cross protocol interoperability: When an AMQP 0.9.1 (or STOMP or AMQP 1.0) client sends a message to the topic exchange,
the correct subscription identifier will be included in the PUBLISH packet sent to the MQTT client.</p>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="feature-3-subscription-options">Feature 3: <a href="https://docs.oasis-open.org/mqtt/mqtt/v5.0/os/mqtt-v5.0-os.html#_Toc3901169" target="_blank" rel="noopener noreferrer">Subscription Options</a><a href="#feature-3-subscription-options" class="hash-link" aria-label="Direct link to feature-3-subscription-options" title="Direct link to feature-3-subscription-options">​</a></h3>
<h4 class="anchor anchorWithStickyNavbar_LWe7" id="description-2">Description<a href="#description-2" class="hash-link" aria-label="Direct link to Description" title="Direct link to Description">​</a></h4>
<p>MQTT 5.0 comes with 3 new subscription options:</p>
<ol>
<li>No Local</li>
<li>Retain as Published</li>
<li>Retain Handling</li>
</ol>
<p>All subscription options are implemented by RabbitMQ.
Here, we focus only on the Retain Handling option:</p>
<blockquote>
<p>This option specifies whether retained messages are sent when the subscription is established.<br>
<!-- -->The values are:<br>
<!-- -->0 = Send retained messages at the time of the subscribe<br>
<!-- -->1 = Send retained messages at subscribe only if the subscription does not currently exist<br>
<!-- -->2 = Do not send retained messages at the time of the subscribe</p>
</blockquote>
<h4 class="anchor anchorWithStickyNavbar_LWe7" id="example-2">Example<a href="#example-2" class="hash-link" aria-label="Direct link to Example" title="Direct link to Example">​</a></h4>
<p>Send a retained message:</p>
<div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">mqttx pub </span><span class="token parameter variable" style="color:#36acaa">--topic</span><span class="token plain"> mytopic </span><span class="token parameter variable" style="color:#36acaa">--message</span><span class="token plain"> m </span><span class="token parameter variable" style="color:#36acaa">--retain</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>Retain Handling value 0 will receive the retained message while value 2 will not:</p>
<div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">mqttx sub </span><span class="token parameter variable" style="color:#36acaa">--topic</span><span class="token plain"> mytopic --retain-handling </span><span class="token number" style="color:#36acaa">0</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">…  Connecting</span><span class="token punctuation" style="color:#393A34">..</span><span class="token plain">.</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">✔  Connected</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">…  Subscribing to mytopic</span><span class="token punctuation" style="color:#393A34">..</span><span class="token plain">.</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">✔  Subscribed to mytopic</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">payload: m</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">retain: </span><span class="token boolean" style="color:#36acaa">true</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">^C</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">mqttx sub </span><span class="token parameter variable" style="color:#36acaa">--topic</span><span class="token plain"> mytopic --retain-handling </span><span class="token number" style="color:#36acaa">2</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">…  Connecting</span><span class="token punctuation" style="color:#393A34">..</span><span class="token plain">.</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">✔  Connected</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">…  Subscribing to mytopic</span><span class="token punctuation" style="color:#393A34">..</span><span class="token plain">.</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">✔  Subscribed to mytopic</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="feature-4-reason-code-on-all-acks">Feature 4: Reason code on all ACKs<a href="#feature-4-reason-code-on-all-acks" class="hash-link" aria-label="Direct link to Feature 4: Reason code on all ACKs" title="Direct link to Feature 4: Reason code on all ACKs">​</a></h3>
<h4 class="anchor anchorWithStickyNavbar_LWe7" id="description-3">Description<a href="#description-3" class="hash-link" aria-label="Direct link to Description" title="Direct link to Description">​</a></h4>
<p>Packets CONNACK, PUBACK, SUBACK, UNSUBACK, and DISCONNECT contain a reason code.</p>
<h4 class="anchor anchorWithStickyNavbar_LWe7" id="implementation-2">Implementation<a href="#implementation-2" class="hash-link" aria-label="Direct link to Implementation" title="Direct link to Implementation">​</a></h4>
<p>One implementation example is that RabbitMQ will reply with a reason code <code>No matching subscribers</code> in the PUBACK packet if the message is not routed to any queues.
MQTT 5.0 reason code <code>No matching subscribers</code> corresponds conceptually to the <a href="/rabbitmq-website/docs/publishers#unroutable">mandatory</a> message property and <code>BasicReturn</code> handler in AMQP 0.9.1.</p>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="feature-5-user-properties">Feature 5: User properties<a href="#feature-5-user-properties" class="hash-link" aria-label="Direct link to Feature 5: User properties" title="Direct link to Feature 5: User properties">​</a></h3>
<h4 class="anchor anchorWithStickyNavbar_LWe7" id="description-4">Description<a href="#description-4" class="hash-link" aria-label="Direct link to Description" title="Direct link to Description">​</a></h4>
<p>Most MQTT packets can contain user properties.
The meaning of user properties is not defined by the MQTT specification.</p>
<h4 class="anchor anchorWithStickyNavbar_LWe7" id="example-publish-packet">Example PUBLISH packet<a href="#example-publish-packet" class="hash-link" aria-label="Direct link to Example PUBLISH packet" title="Direct link to Example PUBLISH packet">​</a></h4>
<p>User properties in the PUBLISH packet are defined by client applications and forwarded unaltered by the server.</p>
<p>Subscribe in the 1st terminal window:</p>
<div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">mqttx sub </span><span class="token parameter variable" style="color:#36acaa">--topic</span><span class="token plain"> t/5</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>Publish a message with user properties in the 2nd terminal window:</p>
<div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">mqttx pub </span><span class="token parameter variable" style="color:#36acaa">--topic</span><span class="token plain"> t/5 </span><span class="token parameter variable" style="color:#36acaa">--message</span><span class="token plain"> m --user-properties </span><span class="token string" style="color:#e3116c">&quot;key1: value1&quot;</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>The 1st terminal window will receive the user properties unaltered:</p>
<div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">payload: m</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">userProperties: </span><span class="token punctuation" style="color:#393A34">[</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"> key: </span><span class="token string" style="color:#e3116c">&#x27;key1&#x27;</span><span class="token plain">, value: </span><span class="token string" style="color:#e3116c">&#x27;value1&#x27;</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">]</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>User properties in an MQTT 5.0 PUBLISH packet are similar to the <code>headers</code> message property in AMQP 0.9.1.</p>
<h4 class="anchor anchorWithStickyNavbar_LWe7" id="example-connect-packet">Example CONNECT packet<a href="#example-connect-packet" class="hash-link" aria-label="Direct link to Example CONNECT packet" title="Direct link to Example CONNECT packet">​</a></h4>
<p>Connect with a user property:</p>
<div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">mqttx conn --client-id myclient --user-properties </span><span class="token string" style="color:#e3116c">&quot;connecting-from: London&quot;</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>Open the Management UI <a href="http://localhost:15672/#/connections" target="_blank" rel="noopener noreferrer">http://localhost:15672/#/connections</a> in your browser (both username and password is <code>guest</code>) and click on the MQTT connection:</p>
<p></p><figure><img decoding="async" loading="lazy" alt="Figure 1: User Property in the CONNECT packet" src="/rabbitmq-website/assets/images/user-property-f80dc42ffff478805a03c7dc9b23f99e.png" width="1378" height="912" class="img_ev3q"><figcaption>Figure 1: User Property in the CONNECT packet</figcaption></figure><p></p>
<p>RabbitMQ will display the user property from the CONNECT packet in the Management UI.</p>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="feature-6-payload-format-and-content-type">Feature 6: <a href="https://docs.oasis-open.org/mqtt/mqtt/v5.0/os/mqtt-v5.0-os.html#_Toc3901111" target="_blank" rel="noopener noreferrer">Payload Format</a> and <a href="https://docs.oasis-open.org/mqtt/mqtt/v5.0/os/mqtt-v5.0-os.html#_Toc3901118" target="_blank" rel="noopener noreferrer">Content Type</a><a href="#feature-6-payload-format-and-content-type" class="hash-link" aria-label="Direct link to feature-6-payload-format-and-content-type" title="Direct link to feature-6-payload-format-and-content-type">​</a></h3>
<h4 class="anchor anchorWithStickyNavbar_LWe7" id="description-5">Description<a href="#description-5" class="hash-link" aria-label="Direct link to Description" title="Direct link to Description">​</a></h4>
<p>The publisher can specify a MIME content type.
It can also set a payload format indicator indicating whether the payload consists of UTF-8 encoded character data or unspecified binary data.</p>
<h4 class="anchor anchorWithStickyNavbar_LWe7" id="example-3">Example<a href="#example-3" class="hash-link" aria-label="Direct link to Example" title="Direct link to Example">​</a></h4>
<p>In the 1st terminal window, subscribe to a topic:</p>
<div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">mqttx sub </span><span class="token parameter variable" style="color:#36acaa">--topic</span><span class="token plain"> t/6 --output-mode clean</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>In the 2nd terminal window, send a message with a content type and payload format indicator:</p>
<div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">mqttx pub </span><span class="token parameter variable" style="color:#36acaa">--topic</span><span class="token plain"> t/6 </span><span class="token parameter variable" style="color:#36acaa">--message</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;my UTF-8 encoded data 🙂&quot;</span><span class="token plain"> --content-type text/plain --payload-format-indicator</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>The 1st terminal window will receive the content type and payload format indicator unaltered:</p>
<div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token string" style="color:#e3116c">&quot;topic&quot;</span><span class="token builtin class-name">:</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;t/6&quot;</span><span class="token plain">,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token string" style="color:#e3116c">&quot;payload&quot;</span><span class="token builtin class-name">:</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;my UTF-8 encoded data 🙂&quot;</span><span class="token plain">,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token string" style="color:#e3116c">&quot;packet&quot;</span><span class="token builtin class-name">:</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token punctuation" style="color:#393A34">..</span><span class="token plain">.</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token string" style="color:#e3116c">&quot;properties&quot;</span><span class="token builtin class-name">:</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token string" style="color:#e3116c">&quot;payloadFormatIndicator&quot;</span><span class="token builtin class-name">:</span><span class="token plain"> true,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token string" style="color:#e3116c">&quot;contentType&quot;</span><span class="token builtin class-name">:</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;text/plain&quot;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">}</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="feature-7-request--response">Feature 7: <a href="https://docs.oasis-open.org/mqtt/mqtt/v5.0/os/mqtt-v5.0-os.html#_Toc3901253" target="_blank" rel="noopener noreferrer">Request / Response</a><a href="#feature-7-request--response" class="hash-link" aria-label="Direct link to feature-7-request--response" title="Direct link to feature-7-request--response">​</a></h3>
<h4 class="anchor anchorWithStickyNavbar_LWe7" id="description-6">Description<a href="#description-6" class="hash-link" aria-label="Direct link to Description" title="Direct link to Description">​</a></h4>
<p>MQTT 5.0 formalizes the Request / Response pattern.</p>
<p>Before publishing a message, an MQTT client (the requester) subscribes to a response topic.
The requester includes the response topic and some correlation data into the request message.</p>
<p>Another MQTT client (the responder) receives the request message, takes some action, and publishes a response message with the same correlation data to the response topic.</p>
<p>The MQTT 5.0 Request / Response feature corresponds to <a href="/rabbitmq-website/tutorials/tutorial-six-go">Remote Procedure Calls in AMQP 0.9.1</a>.
However, in AMQP 0.9.1 the requester will include the name of a callback queue in the AMQP 0.9.1 message property <code>reply_to</code>.
The MQTT protocol does not define the concept of queues. Therefore, in MQTT the &quot;address&quot; being replied to is a topic name.</p>
<p>Despite the incompatibilities between the protocol specifications, RabbitMQ shines at protocol interoperability:
Request / Response interactions are therefore supported by RabbitMQ across protocols.</p>
<p>For example an MQTT client can include a response topic and correlation data in the request message.
If an AMQP 0.9.1 client created a queue bound to the topic exchange <code>amq.topic</code> with a binding key matching the topic of the request message, it will receive an AMQP 0.9.1 message with property <code>correlation_id</code> set to the
correlation data sent by the MQTT client and a header called <code>x-opt-reply-to-topic</code>.
The AMQP 0.9.1 client can then respond to the MQTT 5.0 client by using the same <code>correlation_id</code> and publishing the response message to the topic exchange <code>amq.topic</code> with the topic that was present in the <code>x-opt-reply-to-topic</code> header.</p>
<h4 class="anchor anchorWithStickyNavbar_LWe7" id="example-4">Example<a href="#example-4" class="hash-link" aria-label="Direct link to Example" title="Direct link to Example">​</a></h4>
<p>This example focuses solely on MQTT clients.</p>
<p>In the 1st terminal window, the responding MQTT client subscribes to topic <code>t/7</code>;</p>
<div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">mqttx sub --client-id responder </span><span class="token parameter variable" style="color:#36acaa">--topic</span><span class="token plain"> t/7 --session-expiry-interval </span><span class="token number" style="color:#36acaa">600</span><span class="token plain"> --output-mode clean </span><span class="token parameter variable" style="color:#36acaa">--qos</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">1</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>In the 2nd terminal window, the requesting MQTT client subscribes to a topic called <code>my/response/topic</code>:</p>
<div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">mqttx sub --client-id requester </span><span class="token parameter variable" style="color:#36acaa">--topic</span><span class="token plain"> my/response/topic --session-expiry-interval </span><span class="token number" style="color:#36acaa">600</span><span class="token plain"> </span><span class="token parameter variable" style="color:#36acaa">--qos</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">1</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">…  Connecting</span><span class="token punctuation" style="color:#393A34">..</span><span class="token plain">.</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">✔  Connected</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">…  Subscribing to my/response/topic</span><span class="token punctuation" style="color:#393A34">..</span><span class="token plain">.</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">✔  Subscribed to my/response/topic</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">^C</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>In the 2nd terminal window, the requester then publishes a request message:</p>
<div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">mqttx pub --client-id requester </span><span class="token parameter variable" style="color:#36acaa">--topic</span><span class="token plain"> t/7 </span><span class="token parameter variable" style="color:#36acaa">--message</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;my request&quot;</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">\</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    --correlation-data abc-123 --response-topic my/response/topic </span><span class="token punctuation" style="color:#393A34">\</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    --session-expiry-interval </span><span class="token number" style="color:#36acaa">600</span><span class="token plain"> --no-clean</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>In the 1st terminal window, the responder receives the request message:</p>
<div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token string" style="color:#e3116c">&quot;topic&quot;</span><span class="token builtin class-name">:</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;t/7&quot;</span><span class="token plain">,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token string" style="color:#e3116c">&quot;payload&quot;</span><span class="token builtin class-name">:</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;my request&quot;</span><span class="token plain">,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token string" style="color:#e3116c">&quot;packet&quot;</span><span class="token builtin class-name">:</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token punctuation" style="color:#393A34">..</span><span class="token plain">.</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token string" style="color:#e3116c">&quot;properties&quot;</span><span class="token builtin class-name">:</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token string" style="color:#e3116c">&quot;responseTopic&quot;</span><span class="token builtin class-name">:</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;my/response/topic&quot;</span><span class="token plain">,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token string" style="color:#e3116c">&quot;correlationData&quot;</span><span class="token builtin class-name">:</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token string" style="color:#e3116c">&quot;type&quot;</span><span class="token builtin class-name">:</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;Buffer&quot;</span><span class="token plain">,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token string" style="color:#e3116c">&quot;data&quot;</span><span class="token builtin class-name">:</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">[</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">          </span><span class="token number" style="color:#36acaa">97</span><span class="token plain">,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">          </span><span class="token number" style="color:#36acaa">98</span><span class="token plain">,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">          </span><span class="token number" style="color:#36acaa">99</span><span class="token plain">,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">          </span><span class="token number" style="color:#36acaa">45</span><span class="token plain">,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">          </span><span class="token number" style="color:#36acaa">49</span><span class="token plain">,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">          </span><span class="token number" style="color:#36acaa">50</span><span class="token plain">,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">          </span><span class="token number" style="color:#36acaa">51</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token punctuation" style="color:#393A34">]</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">^C</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>In the 1st terminal window, the responder responds to the requester by copying the correlation data and publishing to the response topic:</p>
<div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">mqttx pub --client-id responder </span><span class="token parameter variable" style="color:#36acaa">--topic</span><span class="token plain"> my/response/topic </span><span class="token parameter variable" style="color:#36acaa">--message</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;my response&quot;</span><span class="token plain"> --correlation-data abc-123</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>In the 2nd terminal window, the requester receives the response.</p>
<div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">mqttx sub --client-id requester </span><span class="token parameter variable" style="color:#36acaa">--topic</span><span class="token plain"> my/response/topic --no-clean </span><span class="token parameter variable" style="color:#36acaa">--qos</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">1</span><span class="token plain"> --output-mode clean</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token string" style="color:#e3116c">&quot;topic&quot;</span><span class="token builtin class-name">:</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;my/response/topic&quot;</span><span class="token plain">,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token string" style="color:#e3116c">&quot;payload&quot;</span><span class="token builtin class-name">:</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;my response&quot;</span><span class="token plain">,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token string" style="color:#e3116c">&quot;packet&quot;</span><span class="token builtin class-name">:</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token punctuation" style="color:#393A34">..</span><span class="token plain">.</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token string" style="color:#e3116c">&quot;properties&quot;</span><span class="token builtin class-name">:</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token string" style="color:#e3116c">&quot;correlationData&quot;</span><span class="token builtin class-name">:</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token string" style="color:#e3116c">&quot;type&quot;</span><span class="token builtin class-name">:</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;Buffer&quot;</span><span class="token plain">,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token string" style="color:#e3116c">&quot;data&quot;</span><span class="token builtin class-name">:</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">[</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">          </span><span class="token number" style="color:#36acaa">97</span><span class="token plain">,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">          </span><span class="token number" style="color:#36acaa">98</span><span class="token plain">,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">          </span><span class="token number" style="color:#36acaa">99</span><span class="token plain">,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">          </span><span class="token number" style="color:#36acaa">45</span><span class="token plain">,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">          </span><span class="token number" style="color:#36acaa">49</span><span class="token plain">,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">          </span><span class="token number" style="color:#36acaa">50</span><span class="token plain">,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">          </span><span class="token number" style="color:#36acaa">51</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token punctuation" style="color:#393A34">]</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">}</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>The correlation data is useful to correlate the response to the request.
The requester usually picks unique correlation data per request it publishes.</p>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="feature-8-assigned-client-identifier">Feature 8: <a href="https://docs.oasis-open.org/mqtt/mqtt/v5.0/os/mqtt-v5.0-os.html#_Toc3901087" target="_blank" rel="noopener noreferrer">Assigned Client Identifier</a><a href="#feature-8-assigned-client-identifier" class="hash-link" aria-label="Direct link to feature-8-assigned-client-identifier" title="Direct link to feature-8-assigned-client-identifier">​</a></h3>
<h4 class="anchor anchorWithStickyNavbar_LWe7" id="description-7">Description<a href="#description-7" class="hash-link" aria-label="Direct link to Description" title="Direct link to Description"> ​</a></h4>
<blockquote>
<p>If the Client connects using a zero length Client Identifier, the Server MUST respond with a CONNACK containing an Assigned Client Identifier.</p>
</blockquote>
<p>Compared to MQTT 3.1.1 this lifts the restriction that server assigned client IDs can only be used with <code>Clean Session = 1</code> connections.</p>
<h4 class="anchor anchorWithStickyNavbar_LWe7" id="implementation-3">Implementation<a href="#implementation-3" class="hash-link" aria-label="Direct link to Implementation" title="Direct link to Implementation">​</a></h4>
<p>RabbitMQ will generate some random client ID (for example <code>dcGB2kSwS0JlXnaBa1A6QA</code>) and return it in the CONNACK packet.</p>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="feature-9-topic-alias">Feature 9: <a href="https://docs.oasis-open.org/mqtt/mqtt/v5.0/os/mqtt-v5.0-os.html#_Toc3901113" target="_blank" rel="noopener noreferrer">Topic Alias</a><a href="#feature-9-topic-alias" class="hash-link" aria-label="Direct link to feature-9-topic-alias" title="Direct link to feature-9-topic-alias">​</a></h3>
<h4 class="anchor anchorWithStickyNavbar_LWe7" id="description-8">Description<a href="#description-8" class="hash-link" aria-label="Direct link to Description" title="Direct link to Description">​</a></h4>
<blockquote>
<p>A Topic Alias is an integer value that is used to identify the Topic instead of using the Topic Name.
This reduces the size of the PUBLISH packet, and is useful when the Topic Names are long and the same Topic Names are used repetitively within a Network Connection.</p>
</blockquote>
<h4 class="anchor anchorWithStickyNavbar_LWe7" id="implementation-4">Implementation<a href="#implementation-4" class="hash-link" aria-label="Direct link to Implementation" title="Direct link to Implementation">​</a></h4>
<p>The default <a href="https://docs.oasis-open.org/mqtt/mqtt/v5.0/os/mqtt-v5.0-os.html#_Toc3901088" target="_blank" rel="noopener noreferrer">Topic Alias Maximum</a> in RabbitMQ is 16.
You can configure this value in <code>rabbitmq.conf</code>, for example:</p>
<div class="language-ini codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-ini codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">mqtt.topic_alias_maximum = 32</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>This configured value maps to the Topic Alias Maximum in the CONNACK packet sent from RabbitMQ to the client.
It limits the number of topic aliases in either direction, that is from client to RabbitMQ and RabbitMQ to client.
Setting a higher value will require more memory usage in RabbitMQ if clients send to or receive from many different topics.</p>
<p>A RabbitMQ operator can disallow the usage of Topic Aliases by setting:</p>
<div class="language-ini codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-ini codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">mqtt.topic_alias_maximum = 0</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="feature-10-flow-control">Feature 10: <a href="https://docs.oasis-open.org/mqtt/mqtt/v5.0/os/mqtt-v5.0-os.html#_Toc3901251" target="_blank" rel="noopener noreferrer">Flow control</a><a href="#feature-10-flow-control" class="hash-link" aria-label="Direct link to feature-10-flow-control" title="Direct link to feature-10-flow-control">​</a></h3>
<h4 class="anchor anchorWithStickyNavbar_LWe7" id="description-9">Description<a href="#description-9" class="hash-link" aria-label="Direct link to Description" title="Direct link to Description">​</a></h4>
<p>The MQTT 5.0 property Receive Maximum defines an upper limit of unacknowledged QoS 1 PUBLISH packets.</p>
<h4 class="anchor anchorWithStickyNavbar_LWe7" id="implementation-5">Implementation<a href="#implementation-5" class="hash-link" aria-label="Direct link to Implementation" title="Direct link to Implementation">​</a></h4>
<p>The maximum number of unacknowledged QoS 1 PUBLISH packets sent from RabbitMQ to the client is determined by the minimum value of
the Receive Maximum sent from client to RabbitMQ in the CONNECT packet and the configured <code>mqtt.prefetch</code> value:</p>
<div class="language-ini codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-ini codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">mqtt.prefetch = 10</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>The default value of <code>mqtt.prefetch</code> is 10.</p>
<p>The <code>mqtt.prefetch</code> value has already existed before RabbitMQ 3.13 for MQTT 3.1 and 3.1.1.
It maps to <a href="/rabbitmq-website/docs/consumer-prefetch">consumer prefetch</a> in RabbitMQ.
In other words, it defines how many in-flight messages the queue sends to its MQTT connection process.</p>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="feature-11-maximum-packet-size">Feature 11: Maximum Packet Size<a href="#feature-11-maximum-packet-size" class="hash-link" aria-label="Direct link to Feature 11: Maximum Packet Size" title="Direct link to Feature 11: Maximum Packet Size">​</a></h3>
<h4 class="anchor anchorWithStickyNavbar_LWe7" id="description-10">Description<a href="#description-10" class="hash-link" aria-label="Direct link to Description" title="Direct link to Description">​</a></h4>
<p>Client and server can independently specify the maximum packet size they support.</p>
<h4 class="anchor anchorWithStickyNavbar_LWe7" id="example-5">Example<a href="#example-5" class="hash-link" aria-label="Direct link to Example" title="Direct link to Example">​</a></h4>
<p>This example demonstrates how to limit the maximum MQTT packet size sent from a client to RabbitMQ.</p>
<p>Let&#x27;s assume that after successful authentication a RabbitMQ operator does not want RabbitMQ to accept any MQTT packets larger than 1 KiB.
Write the following configuration to <a href="/rabbitmq-website/docs/configure#config-file">rabbitmq.conf</a> (in your current working directory):</p>
<div class="language-ini codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-ini codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">mqtt.max_packet_size_authenticated = 1024</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>After stopping RabbitMQ server, start RabbitMQ server with the new configuration being applied:</p>
<div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token function" style="color:#d73a49">docker</span><span class="token plain"> run </span><span class="token parameter variable" style="color:#36acaa">-it</span><span class="token plain"> </span><span class="token parameter variable" style="color:#36acaa">--rm</span><span class="token plain"> </span><span class="token parameter variable" style="color:#36acaa">--name</span><span class="token plain"> rabbitmq </span><span class="token parameter variable" style="color:#36acaa">-p</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">1883</span><span class="token plain">:1883 </span><span class="token parameter variable" style="color:#36acaa">-p</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">15672</span><span class="token plain">:15672 </span><span class="token parameter variable" style="color:#36acaa">-p</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">15692</span><span class="token plain">:15692 </span><span class="token punctuation" style="color:#393A34">\</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token parameter variable" style="color:#36acaa">--mount</span><span class="token plain"> </span><span class="token assign-left variable" style="color:#36acaa">type</span><span class="token operator" style="color:#393A34">=</span><span class="token plain">bind,source</span><span class="token operator" style="color:#393A34">=</span><span class="token string" style="color:#e3116c">&quot;</span><span class="token string variable" style="color:#36acaa">$(</span><span class="token string variable builtin class-name" style="color:#36acaa">pwd</span><span class="token string variable" style="color:#36acaa">)</span><span class="token string" style="color:#e3116c">&quot;</span><span class="token plain">/rabbitmq.conf,target</span><span class="token operator" style="color:#393A34">=</span><span class="token plain">/etc/rabbitmq/conf.d/11-blog-post.conf </span><span class="token punctuation" style="color:#393A34">\</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    rabbitmq:3.13.0-beta.2-management</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token function" style="color:#d73a49">docker</span><span class="token plain"> </span><span class="token builtin class-name">exec</span><span class="token plain"> rabbitmq rabbitmq-plugins </span><span class="token builtin class-name">enable</span><span class="token plain"> rabbitmq_mqtt</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token function" style="color:#d73a49">docker</span><span class="token plain"> </span><span class="token builtin class-name">exec</span><span class="token plain"> rabbitmq rabbitmqctl enable_feature_flag all</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>In the 1st terminal window, subscribe to a topic:</p>
<div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">mqttx sub </span><span class="token parameter variable" style="color:#36acaa">--topic</span><span class="token plain"> t/11</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>In the 2nd terminal window, send a message with a payload of 3 bytes to that topic:</p>
<div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token assign-left variable" style="color:#36acaa">payload</span><span class="token operator" style="color:#393A34">=</span><span class="token variable" style="color:#36acaa">$(</span><span class="token variable function" style="color:#d73a49">head</span><span class="token variable" style="color:#36acaa"> </span><span class="token variable parameter variable" style="color:#36acaa">--bytes</span><span class="token variable" style="color:#36acaa"> </span><span class="token variable number" style="color:#36acaa">3</span><span class="token variable" style="color:#36acaa"> </span><span class="token variable operator" style="color:#393A34">&lt;</span><span class="token variable" style="color:#36acaa"> /dev/zero </span><span class="token variable operator" style="color:#393A34">|</span><span class="token variable" style="color:#36acaa"> </span><span class="token variable function" style="color:#d73a49">tr</span><span class="token variable" style="color:#36acaa"> </span><span class="token variable string" style="color:#e3116c">&#x27;\0&#x27;</span><span class="token variable" style="color:#36acaa"> x</span><span class="token variable" style="color:#36acaa">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">mqttx pub </span><span class="token parameter variable" style="color:#36acaa">--topic</span><span class="token plain"> t/11 </span><span class="token parameter variable" style="color:#36acaa">-m</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;</span><span class="token string variable" style="color:#36acaa">$payload</span><span class="token string" style="color:#e3116c">&quot;</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>The first line reads 3 bytes (3 null characters) from the special file <code>/dev/zero</code>, translates each null character to ASCII character <code>x</code> and saves the result <code>xxx</code> in the variable <code>payload</code>.</p>
<p>The 1st terminal window will receive that message:</p>
<div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">payload: xxx</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>Next, in the 2nd terminal window, send a message with a payload of 2,000 bytes:</p>
<div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token assign-left variable" style="color:#36acaa">payload</span><span class="token operator" style="color:#393A34">=</span><span class="token variable" style="color:#36acaa">$(</span><span class="token variable function" style="color:#d73a49">head</span><span class="token variable" style="color:#36acaa"> </span><span class="token variable parameter variable" style="color:#36acaa">--bytes</span><span class="token variable" style="color:#36acaa"> </span><span class="token variable number" style="color:#36acaa">2000</span><span class="token variable" style="color:#36acaa"> </span><span class="token variable operator" style="color:#393A34">&lt;</span><span class="token variable" style="color:#36acaa"> /dev/zero </span><span class="token variable operator" style="color:#393A34">|</span><span class="token variable" style="color:#36acaa"> </span><span class="token variable function" style="color:#d73a49">tr</span><span class="token variable" style="color:#36acaa"> </span><span class="token variable string" style="color:#e3116c">&#x27;\0&#x27;</span><span class="token variable" style="color:#36acaa"> x</span><span class="token variable" style="color:#36acaa">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">mqttx pub </span><span class="token parameter variable" style="color:#36acaa">--topic</span><span class="token plain"> t/11 </span><span class="token parameter variable" style="color:#36acaa">-m</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;</span><span class="token string variable" style="color:#36acaa">$payload</span><span class="token string" style="color:#e3116c">&quot;</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>This time, the 1st terminal window does not receive the message because the PUBLISH packet sent from client to RabbitMQ is larger than the configured maximum packet size of 1024 bytes.</p>
<p>Instead, RabbitMQ logs a descriptive error message:</p>
<div class="codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">[error] &lt;0.836.0&gt; MQTT packet size (2007 bytes, type 3) exceeds mqtt.max_packet_size_authenticated (1024 bytes)</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>The log message states 2,007 bytes because 7 bytes are needed for the fixed and variable headers of the PUBLISH packet (out of which 4 bytes are needed for the topic name <code>t/11</code>).</p>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="feature-12-server-initiated-disconnect">Feature 12: Server initiated <a href="https://docs.oasis-open.org/mqtt/mqtt/v5.0/os/mqtt-v5.0-os.html#_Toc3901205" target="_blank" rel="noopener noreferrer">DISCONNECT</a><a href="#feature-12-server-initiated-disconnect" class="hash-link" aria-label="Direct link to feature-12-server-initiated-disconnect" title="Direct link to feature-12-server-initiated-disconnect">​</a></h3>
<h4 class="anchor anchorWithStickyNavbar_LWe7" id="description-11">Description<a href="#description-11" class="hash-link" aria-label="Direct link to Description" title="Direct link to Description">​</a></h4>
<p>In MQTT 5.0, the DISCONNECT packet can not only be sent from client to server, but also from server to client.</p>
<h4 class="anchor anchorWithStickyNavbar_LWe7" id="implementation-6">Implementation<a href="#implementation-6" class="hash-link" aria-label="Direct link to Implementation" title="Direct link to Implementation">​</a></h4>
<p>Prior to terminating the connection, RabbitMQ will send a DISCONNECT packet to the client in the following situations:</p>
<table><thead><tr><th>DISCONNECT Reason Code Name</th><th>Situation</th></tr></thead><tbody><tr><td>Session taken over</td><td>Another client connected with the same client ID.</td></tr><tr><td>Server shutting down</td><td>RabbitMQ enters <a href="/rabbitmq-website/docs/upgrade#maintenance-mode">maintenance mode</a>.</td></tr><tr><td>Keep Alive timeout</td><td>The Client fails to communicate within the <a href="https://docs.oasis-open.org/mqtt/mqtt/v5.0/os/mqtt-v5.0-os.html#_Toc3901045" target="_blank" rel="noopener noreferrer">Keep Alive</a> time.</td></tr><tr><td>Packet too large</td><td>RabbitMQ receives a packet whose size exceeds <code>mqtt.max_packet_size_authenticated</code></td></tr></tbody></table>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="feature-13-session-expiry">Feature 13: <a href="https://docs.oasis-open.org/mqtt/mqtt/v5.0/os/mqtt-v5.0-os.html#_Toc3901048" target="_blank" rel="noopener noreferrer">Session Expiry</a><a href="#feature-13-session-expiry" class="hash-link" aria-label="Direct link to feature-13-session-expiry" title="Direct link to feature-13-session-expiry">​</a></h3>
<h4 class="anchor anchorWithStickyNavbar_LWe7" id="description-12">Description<a href="#description-12" class="hash-link" aria-label="Direct link to Description" title="Direct link to Description">​</a></h4>
<p>In MQTT 5.0, the client can suggest a Session Expiry Interval to the server in the CONNECT packet.
The server can accept the proposed Session Expiry Interval or mandate a different one in the CONNACK packet.</p>
<blockquote>
<p>The session can continue across a sequence of Network Connections. It lasts as long as the latest Network Connection plus the Session Expiry Interval.</p>
</blockquote>
<p>When the Session Expiry Interval expires, both client and server will delete any session state.</p>
<h4 class="anchor anchorWithStickyNavbar_LWe7" id="implementation-7">Implementation<a href="#implementation-7" class="hash-link" aria-label="Direct link to Implementation" title="Direct link to Implementation">​</a></h4>
<p>Client and server keep session state for as long as the session lasts.</p>
<p>Session state in the server includes messages that have been sent to the client but not yet acknowledged, messages that are pending to be sent to the client, and a client&#x27;s subscriptions.
RabbitMQ models this MQTT session state in the form of queues and bindings.</p>
<p>Therefore, Session Expiry Interval maps to <a href="/rabbitmq-website/docs/ttl#queue-ttl">queue TTL</a> in RabbitMQ.
When an MQTT session expires, the queue and therefore its messages and bindings will be deleted.</p>
<h4 class="anchor anchorWithStickyNavbar_LWe7" id="example-6">Example<a href="#example-6" class="hash-link" aria-label="Direct link to Example" title="Direct link to Example">​</a></h4>
<p>By default the maximum session expiry interval allowed by the server is 1 day.
If an MQTT client does not reconnect within 1 day, its session state will be deleted in RabbitMQ.</p>
<p>This value is configurable.
For the purpose of this example, let&#x27;s set a very low Session Expiry Interval of 1 minute in <code>rabbitmq.conf</code>:</p>
<div class="language-ini codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-ini codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">mqtt.max_session_expiry_interval_seconds = 60</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>The setting name contains the prefix <code>max</code> because an MQTT 5.0 client can choose a lower value by sending a Session Expiry Interval in the CONNECT packet.
As done in the <a href="#example-5">example of Maximum Packet Size</a> restart the RabbitMQ node such that the new setting gets applied.</p>
<p>Connect to RabbitMQ with a Session Expiry Interval of 20 seconds and create a subscription:</p>
<div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">mqttx sub --client-id sub-13 </span><span class="token parameter variable" style="color:#36acaa">--topic</span><span class="token plain"> t/13 --session-expiry-interval </span><span class="token number" style="color:#36acaa">20</span><span class="token plain"> </span><span class="token parameter variable" style="color:#36acaa">--qos</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">1</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">…  Connecting</span><span class="token punctuation" style="color:#393A34">..</span><span class="token plain">.</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">✔  Connected</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">…  Subscribing to t/13</span><span class="token punctuation" style="color:#393A34">..</span><span class="token plain">.</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">✔  Subscribed to t/13</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">^C</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>Type <code>Ctrl+C</code> into the terminal to disconnect the client.</p>
<p>Within the next 20 seconds, list queues and bindings:</p>
<div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token function" style="color:#d73a49">docker</span><span class="token plain"> </span><span class="token builtin class-name">exec</span><span class="token plain"> rabbitmq rabbitmqctl list_queues name</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">Timeout: </span><span class="token number" style="color:#36acaa">60.0</span><span class="token plain"> seconds </span><span class="token punctuation" style="color:#393A34">..</span><span class="token plain">.</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">Listing queues </span><span class="token keyword" style="color:#00009f">for</span><span class="token plain"> vhost / </span><span class="token punctuation" style="color:#393A34">..</span><span class="token plain">.</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">name</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">mqtt-subscription-sub-13qos1</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token function" style="color:#d73a49">docker</span><span class="token plain"> </span><span class="token builtin class-name">exec</span><span class="token plain"> rabbitmq rabbitmqctl list_bindings source_name destination_name routing_key </span><span class="token parameter variable" style="color:#36acaa">--formatter</span><span class="token operator" style="color:#393A34">=</span><span class="token plain">pretty_table</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">Listing bindings </span><span class="token keyword" style="color:#00009f">for</span><span class="token plain"> vhost /</span><span class="token punctuation" style="color:#393A34">..</span><span class="token plain">.</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">┌─────────────┬──────────────────────────────┬──────────────────────────────┐</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">│ source_name │ destination_name             │ routing_key                  │</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">├─────────────┼──────────────────────────────┼──────────────────────────────┤</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">│             │ mqtt-subscription-sub-13qos1 │ mqtt-subscription-sub-13qos1 │</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">├─────────────┼──────────────────────────────┼──────────────────────────────┤</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">│ amq.topic   │ mqtt-subscription-sub-13qos1 │ t.13                         │</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">└─────────────┴──────────────────────────────┴──────────────────────────────┘</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>After 20 seconds, list queues and bindings again:</p>
<div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token function" style="color:#d73a49">docker</span><span class="token plain"> </span><span class="token builtin class-name">exec</span><span class="token plain"> rabbitmq rabbitmqctl list_queues name</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">Timeout: </span><span class="token number" style="color:#36acaa">60.0</span><span class="token plain"> seconds </span><span class="token punctuation" style="color:#393A34">..</span><span class="token plain">.</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">Listing queues </span><span class="token keyword" style="color:#00009f">for</span><span class="token plain"> vhost / </span><span class="token punctuation" style="color:#393A34">..</span><span class="token plain">.</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token function" style="color:#d73a49">docker</span><span class="token plain"> </span><span class="token builtin class-name">exec</span><span class="token plain"> rabbitmq rabbitmqctl list_bindings source_name destination_name routing_key </span><span class="token parameter variable" style="color:#36acaa">--formatter</span><span class="token operator" style="color:#393A34">=</span><span class="token plain">pretty_table</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">Listing bindings </span><span class="token keyword" style="color:#00009f">for</span><span class="token plain"> vhost /</span><span class="token punctuation" style="color:#393A34">..</span><span class="token plain">.</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>The queue and its bindings were deleted by RabbitMQ because our client did not connect to RabbitMQ with <code>Clean Session = 0</code> within the Session Expiry Interval of 20 seconds.</p>
<p>Next, do the same test, but with a high Session Expiry Interval, e.g. 1 hour:</p>
<div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">mqttx sub --client-id sub-13 </span><span class="token parameter variable" style="color:#36acaa">--topic</span><span class="token plain"> t/13 --session-expiry-interval </span><span class="token number" style="color:#36acaa">3600</span><span class="token plain"> </span><span class="token parameter variable" style="color:#36acaa">--qos</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">1</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">…  Connecting</span><span class="token punctuation" style="color:#393A34">..</span><span class="token plain">.</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">✔  Connected</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">…  Subscribing to t/13</span><span class="token punctuation" style="color:#393A34">..</span><span class="token plain">.</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">✔  Subscribed to t/13</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">^C</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>You should observe that the queue and its bindings will be deleted after 1 minute because the effective Session Expiry Interval
is the minimum of what the client requested (1 hour) and the value of <code>mqtt.max_session_expiry_interval_seconds</code> configured in RabbitMQ (1 minute).</p>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="feature-14-will-delay">Feature 14: <a href="https://docs.oasis-open.org/mqtt/mqtt/v5.0/os/mqtt-v5.0-os.html#_Toc3901062" target="_blank" rel="noopener noreferrer">Will delay</a><a href="#feature-14-will-delay" class="hash-link" aria-label="Direct link to feature-14-will-delay" title="Direct link to feature-14-will-delay">​</a></h3>
<h4 class="anchor anchorWithStickyNavbar_LWe7" id="description-13">Description<a href="#description-13" class="hash-link" aria-label="Direct link to Description" title="Direct link to Description">​</a></h4>
<p>The client can define a Will Delay Interval in the CONNECT packet.</p>
<blockquote>
<p>The Server delays publishing the Client’s Will Message until the Will Delay Interval has passed or the Session ends, whichever happens first.
If a new Network Connection to this Session is made before the Will Delay Interval has passed, the Server MUST NOT send the Will Message.
One use of this is to avoid publishing Will Messages if there is a temporary network disconnection and the Client succeeds in reconnecting and continuing its Session before the Will Message is published.</p>
</blockquote>
<p>Another use case of Will Delay Interval is to notify about session expiry:</p>
<blockquote>
<p>The Client can arrange for the Will Message to notify that Session Expiry has occurred by setting the Will Delay Interval to be longer than the Session Expiry Interval and sending DISCONNECT with Reason Code 0x04 (Disconnect with Will Message).</p>
</blockquote>
<h4 class="anchor anchorWithStickyNavbar_LWe7" id="implementation-8">Implementation<a href="#implementation-8" class="hash-link" aria-label="Direct link to Implementation" title="Direct link to Implementation">​</a></h4>
<p>Although the will message payload is usually small, the MQTT specification allows a will message payload size of up to 64 KiB.</p>
<p>To avoid storing large binary data in <a href="//rabbitmq.github.io/khepri/" target="_blank" rel="noopener noreferrer">Khepri</a> (RabbitMQ&#x27;s future meta data store), RabbitMQ creates a classic queue containing this single will message.
We call this queue the Will queue.
This message has a <a href="/rabbitmq-website/docs/ttl#per-message-ttl-in-publishers">per-message TTL</a> set which is defined in milliseconds and corresponds to the Will Delay Interval in seconds.
Additionally, the Will queue has a <a href="/rabbitmq-website/docs/ttl#queue-ttl">queue TTL</a> set which is defined in milliseconds and corresponds to the Session Expiry Interval in seconds.
The effective per-message TTL is at least a few milliseconds lower than the queue TTL such that the message will be published shortly before the queue (session) expires.</p>
<p>The Will queue also defines <code>amq.topic</code> (the default topic exchange used by the MQTT plugin) to be the <a href="/rabbitmq-website/docs/dlx">dead letter exchange</a> and the <a href="https://docs.oasis-open.org/mqtt/mqtt/v5.0/os/mqtt-v5.0-os.html#_Toc3901069" target="_blank" rel="noopener noreferrer">will topic</a>
to be the <a href="/rabbitmq-website/docs/dlx#routing">dead letter routing key</a>.</p>
<p>If the MQTT client does not reconnect within its Will Delay Interval, the message in the Will queue will be dead lettered to the topic exchange.</p>
<p>Let&#x27;s illustrate this with an example.</p>
<h4 class="anchor anchorWithStickyNavbar_LWe7" id="example-7">Example<a href="#example-7" class="hash-link" aria-label="Direct link to Example" title="Direct link to Example">​</a></h4>
<p>In the 1st terminal window, create a subscription that will consume the will message:</p>
<div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">mqttx sub --client-id sub-14 </span><span class="token parameter variable" style="color:#36acaa">--topic</span><span class="token plain"> t/14</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>In the 2nd terminal window, create a connection with a Will Delay Interval of 20 seconds:</p>
<div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">mqttx conn --client-id conn-14 --will-topic t/14 --will-message my-will-message --will-delay-interval </span><span class="token number" style="color:#36acaa">20</span><span class="token plain"> --session-expiry-interval </span><span class="token number" style="color:#36acaa">40</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>In the 3rd terminal window, we see that so far a single queue got created by the subscribing MQTT client:</p>
<div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token function" style="color:#d73a49">docker</span><span class="token plain"> </span><span class="token builtin class-name">exec</span><span class="token plain"> rabbitmq rabbitmqctl </span><span class="token parameter variable" style="color:#36acaa">--quiet</span><span class="token plain"> </span><span class="token parameter variable" style="color:#36acaa">--formatter</span><span class="token operator" style="color:#393A34">=</span><span class="token plain">pretty_table list_queues name </span><span class="token builtin class-name">type</span><span class="token plain"> messages arguments</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">┌──────────────────────────────┬────────────┬──────────┬───────────┐</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">│ name                         │ </span><span class="token builtin class-name">type</span><span class="token plain">       │ messages │ arguments │</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">├──────────────────────────────┼────────────┼──────────┼───────────┤</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">│ mqtt-subscription-sub-14qos0 │ MQTT QoS </span><span class="token number" style="color:#36acaa">0</span><span class="token plain"> │ </span><span class="token number" style="color:#36acaa">0</span><span class="token plain">        │           │</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">└──────────────────────────────┴────────────┴──────────┴───────────┘</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>In the 2nd terminal window, type <code>Ctrl+C</code> to disconnect the MQTT connection with client ID <code>conn-14</code>.</p>
<p>This time, listing the queues shows that the Will queue got created:</p>
<div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token function" style="color:#d73a49">docker</span><span class="token plain"> </span><span class="token builtin class-name">exec</span><span class="token plain"> rabbitmq rabbitmqctl </span><span class="token parameter variable" style="color:#36acaa">--quiet</span><span class="token plain"> </span><span class="token parameter variable" style="color:#36acaa">--formatter</span><span class="token operator" style="color:#393A34">=</span><span class="token plain">pretty_table list_queues name </span><span class="token builtin class-name">type</span><span class="token plain"> messages arguments</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">┌──────────────────────────────┬────────────┬──────────┬────────────────────────────────────────────────────────────┐</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">│ name                         │ </span><span class="token builtin class-name">type</span><span class="token plain">       │ messages │ arguments                                                  │</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">├──────────────────────────────┼────────────┼──────────┼────────────────────────────────────────────────────────────┤</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">│ mqtt-subscription-sub-14qos0 │ MQTT QoS </span><span class="token number" style="color:#36acaa">0</span><span class="token plain"> │ </span><span class="token number" style="color:#36acaa">0</span><span class="token plain">        │                                                            │</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">├──────────────────────────────┼────────────┼──────────┼────────────────────────────────────────────────────────────┤</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">│ mqtt-will-conn-14            │ classic    │ </span><span class="token number" style="color:#36acaa">1</span><span class="token plain">        │ </span><span class="token punctuation" style="color:#393A34">{</span><span class="token operator" style="color:#393A34">&lt;&lt;</span><span class="token string" style="color:#e3116c">&quot;x-expires&quot;</span><span class="token operator" style="color:#393A34">&gt;&gt;</span><span class="token plain">,long,40000</span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain">                               │</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">│                              │            │          │ </span><span class="token punctuation" style="color:#393A34">{</span><span class="token operator" style="color:#393A34">&lt;&lt;</span><span class="token string" style="color:#e3116c">&quot;x-dead-letter-exchange&quot;</span><span class="token operator" style="color:#393A34">&gt;&gt;</span><span class="token plain">,longstr,</span><span class="token operator" style="color:#393A34">&lt;&lt;</span><span class="token string" style="color:#e3116c">&quot;amq.topic&quot;</span><span class="token operator" style="color:#393A34">&gt;&gt;</span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain">     │</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">│                              │            │          │ </span><span class="token punctuation" style="color:#393A34">{</span><span class="token operator" style="color:#393A34">&lt;&lt;</span><span class="token string" style="color:#e3116c">&quot;x-dead-letter-routing-key&quot;</span><span class="token operator" style="color:#393A34">&gt;&gt;</span><span class="token plain">,longstr,</span><span class="token operator" style="color:#393A34">&lt;&lt;</span><span class="token string" style="color:#e3116c">&quot;t.14&quot;</span><span class="token operator" style="color:#393A34">&gt;&gt;</span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain">       │</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">└──────────────────────────────┴────────────┴──────────┴────────────────────────────────────────────────────────────┘</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>The Will queue has the naming pattern <code>mqtt-will-&lt;MQTT Client ID&gt;</code>.
It contains a single message: the will message.</p>
<p>As explained in the previous section, the queue TTL (<code>x-expires</code>) is 40,000 ms and therefore matches the 40 seconds Session Expiry Interval from our command above.
If you wait for 20 seconds, your 1st terminal window should receive the will message because our client did not reconnect within the Will Delay Interval:</p>
<div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">› payload: my-will-message</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="feature-15-optional-server-feature-availability">Feature 15: Optional Server feature availability<a href="#feature-15-optional-server-feature-availability" class="hash-link" aria-label="Direct link to Feature 15: Optional Server feature availability" title="Direct link to Feature 15: Optional Server feature availability">​</a></h3>
<h4 class="anchor anchorWithStickyNavbar_LWe7" id="description-14">Description<a href="#description-14" class="hash-link" aria-label="Direct link to Description" title="Direct link to Description">​</a></h4>
<blockquote>
<p>Define a set of features which the Server does not allow and provide a mechanism for the Server to specify this to the Client.
The features which can be specified in this way are:</p>
</blockquote>
<ul>
<li>Maximum QoS</li>
<li>Retain Available</li>
<li>Wildcard Subscription Available</li>
<li>Subscription Identifier Available</li>
<li>Shared Subscription Available</li>
</ul>
<blockquote>
<p>It is an error for the Client to use features that the Server has declared are not available.</p>
</blockquote>
<h4 class="anchor anchorWithStickyNavbar_LWe7" id="implementation-9">Implementation<a href="#implementation-9" class="hash-link" aria-label="Direct link to Implementation" title="Direct link to Implementation">​</a></h4>
<p>RabbitMQ 3.13 includes <a href="https://docs.oasis-open.org/mqtt/mqtt/v5.0/os/mqtt-v5.0-os.html#_Toc3901084" target="_blank" rel="noopener noreferrer">Maximum QoS</a> = 1 and <a href="https://docs.oasis-open.org/mqtt/mqtt/v5.0/os/mqtt-v5.0-os.html#_Toc3901093" target="_blank" rel="noopener noreferrer">Shared Subscription Available</a> = 0 in the <a href="https://docs.oasis-open.org/mqtt/mqtt/v5.0/os/mqtt-v5.0-os.html#_Toc3901080" target="_blank" rel="noopener noreferrer">CONNACK properties</a>.</p>
<p><a href="https://docs.oasis-open.org/mqtt/mqtt/v5.0/os/mqtt-v5.0-os.html#_Toc3901237" target="_blank" rel="noopener noreferrer">QoS 2</a> has not been supported by RabbitMQ.</p>
<p>As described in the next section, <a href="https://docs.oasis-open.org/mqtt/mqtt/v5.0/os/mqtt-v5.0-os.html#_Toc3901250" target="_blank" rel="noopener noreferrer">shared subscriptions</a> will be supported in a future RabbitMQ release.</p>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="limitations">Limitations<a href="#limitations" class="hash-link" aria-label="Direct link to Limitations" title="Direct link to Limitations">​</a></h2>
<p>This section lists limitations of the RabbitMQ MQTT implementation.</p>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="mqtt-50-specific-limitations">MQTT 5.0 specific limitations<a href="#mqtt-50-specific-limitations" class="hash-link" aria-label="Direct link to MQTT 5.0 specific limitations" title="Direct link to MQTT 5.0 specific limitations">​</a></h3>
<h4 class="anchor anchorWithStickyNavbar_LWe7" id="shared-subscriptions">Shared Subscriptions<a href="#shared-subscriptions" class="hash-link" aria-label="Direct link to Shared Subscriptions" title="Direct link to Shared Subscriptions">​</a></h4>
<p><a href="https://docs.oasis-open.org/mqtt/mqtt/v5.0/os/mqtt-v5.0-os.html#_Toc3901250" target="_blank" rel="noopener noreferrer">Shared subscriptions</a> will be added in a future RabbitMQ release.
Although this feature maps nicely to a queue in RabbitMQ, shared subscriptions are part of the session state and some RabbitMQ database migrations are necessary to efficiently query shared subscriptions for a given MQTT client ID.</p>
<h4 class="anchor anchorWithStickyNavbar_LWe7" id="delayed-and-retained-will-message">Delayed and retained Will Message<a href="#delayed-and-retained-will-message" class="hash-link" aria-label="Direct link to Delayed and retained Will Message" title="Direct link to Delayed and retained Will Message">​</a></h4>
<p>A Will Message that is both <a href="https://docs.oasis-open.org/mqtt/mqtt/v5.0/os/mqtt-v5.0-os.html#_Toc3901062" target="_blank" rel="noopener noreferrer">delayed</a> and <a href="https://docs.oasis-open.org/mqtt/mqtt/v5.0/os/mqtt-v5.0-os.html#_Toc3901042" target="_blank" rel="noopener noreferrer">retained</a> will not be retained.
This is because the delayed will message will be dead lettered to the topic exchange, but the retainer process does currently not consume from a queue.
This limitation can be resolved in the future with a new store for retained messages.</p>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="non-mqtt-50-specific-limitations">Non-MQTT 5.0 specific limitations<a href="#non-mqtt-50-specific-limitations" class="hash-link" aria-label="Direct link to Non-MQTT 5.0 specific limitations" title="Direct link to Non-MQTT 5.0 specific limitations">​</a></h3>
<p>For completeness, this section lists limitations that have existed before supporting MQTT 5.0 in RabbitMQ 3.13 and before Native MQTT shipped in RabbitMQ 3.12.</p>
<h4 class="anchor anchorWithStickyNavbar_LWe7" id="retained-messages">Retained messages<a href="#retained-messages" class="hash-link" aria-label="Direct link to Retained messages" title="Direct link to Retained messages">​</a></h4>
<p>The feature of retained messages is <a href="/rabbitmq-website/docs/mqtt#retained">limited</a> in RabbitMQ.</p>
<p>Retained messages are stored and queried only node local.</p>
<p>An example that works is the following:
An MQTT Client publishes a retained message to node A with topic <code>topic/1</code>. Thereafter another client subscribes with topic filter <code>topic/1</code> on node A. The new subscriber will receive the retained message.</p>
<p>However, if the topic filter contains wildcards (the multi-level wildcard character &quot;<code>#</code>&quot; or the single-level wildcard character &quot;<code>+</code>&quot;), no retained messages are sent (issue <a href="https://github.com/rabbitmq/rabbitmq-server/issues/8824" target="_blank" rel="noopener noreferrer">#8824</a>).</p>
<p>Furthermore, if a client publishes a retained message on node A and another client subsequently subscribes on node B, that subscribing client will not receive any retained message stored on node A (issue <a href="https://github.com/rabbitmq/rabbitmq-server/issues/8096" target="_blank" rel="noopener noreferrer">#8096</a>).</p>
<p>A future RabbitMQ release will replicate retained messages in the cluster and also send retained messages matching topic filters containing wildcards.</p>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="wrapping-up">Wrapping Up<a href="#wrapping-up" class="hash-link" aria-label="Direct link to Wrapping Up" title="Direct link to Wrapping Up">​</a></h2>
<p>To sum up, RabbitMQ</p>
<ul>
<li>is the leading AMQP 0.9.1 broker</li>
<li>is a <a href="/rabbitmq-website/docs/streams">streaming</a> broker</li>
<li>excels in cross-protocol interoperability</li>
<li>is becoming one of the leading MQTT brokers thanks to support for MQTT 5.0 released in 3.13 and <a href="/rabbitmq-website/blog/2023/03/21/native-mqtt">Native MQTT</a> released in 3.12</li>
</ul>
<p>Our journey to turn RabbitMQ into a full-fledged IoT broker is not yet finished and more development efforts are planned to be done in the upcoming months and years.
Stay tuned!</p></div><footer class="docusaurus-mt-lg"><div class="row margin-top--sm theme-blog-footer-edit-meta-row"><div class="col"><b>Tags:</b><ul class="tags_jXut padding--none margin-left--sm"><li class="tag_QGVx"><a class="tag_zVej tagRegular_sFm0" href="/rabbitmq-website/blog/tags/new-features">New Features</a></li><li class="tag_QGVx"><a class="tag_zVej tagRegular_sFm0" href="/rabbitmq-website/blog/tags/technical-deep-dive">Technical Deep Dive</a></li><li class="tag_QGVx"><a class="tag_zVej tagRegular_sFm0" href="/rabbitmq-website/blog/tags/mqtt">MQTT</a></li><li class="tag_QGVx"><a class="tag_zVej tagRegular_sFm0" href="/rabbitmq-website/blog/tags/rabbit-mq-3-13-x">RabbitMQ 3.13.x</a></li></ul></div></div><div class="row margin-top--sm theme-blog-footer-edit-meta-row"><div class="col"><a href="https://github.com/rabbitmq/rabbitmq-website/tree/main/blog/2023-07-21-mqtt5/index.md" target="_blank" rel="noopener noreferrer" class="theme-edit-this-page"><svg fill="currentColor" height="20" width="20" viewBox="0 0 40 40" class="iconEdit_Z9Sw" aria-hidden="true"><g><path d="m34.5 11.7l-3 3.1-6.3-6.3 3.1-3q0.5-0.5 1.2-0.5t1.1 0.5l3.9 3.9q0.5 0.4 0.5 1.1t-0.5 1.2z m-29.5 17.1l18.4-18.5 6.3 6.3-18.4 18.4h-6.3v-6.2z"></path></g></svg>Edit this page</a></div><div class="col lastUpdated_JAkA"></div></div></footer></article><nav class="pagination-nav docusaurus-mt-lg" aria-label="Blog post page navigation"><a class="pagination-nav__link pagination-nav__link--prev" href="/rabbitmq-website/blog/2023/10/16/stream-filtering"><div class="pagination-nav__sublabel">Newer post</div><div class="pagination-nav__label">Stream Filtering</div></a><a class="pagination-nav__link pagination-nav__link--next" href="/rabbitmq-website/blog/2023/05/17/rabbitmq-3.12-performance-improvements"><div class="pagination-nav__sublabel">Older post</div><div class="pagination-nav__label">RabbitMQ 3.12 Performance Improvements</div></a></nav></main><div class="col col--2"><div class="tableOfContents_bqdL thin-scrollbar"><ul class="table-of-contents table-of-contents__left-border"><li><a href="#mqtt-overview" class="table-of-contents__link toc-highlight">MQTT Overview</a></li><li><a href="#mqtt-50-features" class="table-of-contents__link toc-highlight">MQTT 5.0 Features</a><ul><li><a href="#feature-1-message-expiry" class="table-of-contents__link toc-highlight">Feature 1: Message Expiry</a></li><li><a href="#feature-2-subscription-identifier" class="table-of-contents__link toc-highlight">Feature 2: Subscription Identifier</a></li><li><a href="#feature-3-subscription-options" class="table-of-contents__link toc-highlight">Feature 3: Subscription Options</a></li><li><a href="#feature-4-reason-code-on-all-acks" class="table-of-contents__link toc-highlight">Feature 4: Reason code on all ACKs</a></li><li><a href="#feature-5-user-properties" class="table-of-contents__link toc-highlight">Feature 5: User properties</a></li><li><a href="#feature-6-payload-format-and-content-type" class="table-of-contents__link toc-highlight">Feature 6: Payload Format and Content Type</a></li><li><a href="#feature-7-request--response" class="table-of-contents__link toc-highlight">Feature 7: Request / Response</a></li><li><a href="#feature-8-assigned-client-identifier" class="table-of-contents__link toc-highlight">Feature 8: Assigned Client Identifier</a></li><li><a href="#feature-9-topic-alias" class="table-of-contents__link toc-highlight">Feature 9: Topic Alias</a></li><li><a href="#feature-10-flow-control" class="table-of-contents__link toc-highlight">Feature 10: Flow control</a></li><li><a href="#feature-11-maximum-packet-size" class="table-of-contents__link toc-highlight">Feature 11: Maximum Packet Size</a></li><li><a href="#feature-12-server-initiated-disconnect" class="table-of-contents__link toc-highlight">Feature 12: Server initiated DISCONNECT</a></li><li><a href="#feature-13-session-expiry" class="table-of-contents__link toc-highlight">Feature 13: Session Expiry</a></li><li><a href="#feature-14-will-delay" class="table-of-contents__link toc-highlight">Feature 14: Will delay</a></li><li><a href="#feature-15-optional-server-feature-availability" class="table-of-contents__link toc-highlight">Feature 15: Optional Server feature availability</a></li></ul></li><li><a href="#limitations" class="table-of-contents__link toc-highlight">Limitations</a><ul><li><a href="#mqtt-50-specific-limitations" class="table-of-contents__link toc-highlight">MQTT 5.0 specific limitations</a></li><li><a href="#non-mqtt-50-specific-limitations" class="table-of-contents__link toc-highlight">Non-MQTT 5.0 specific limitations</a></li></ul></li><li><a href="#wrapping-up" class="table-of-contents__link toc-highlight">Wrapping Up</a></li></ul></div></div></div></div></div><footer class="footer footer--dark"><div class="container container-fluid"><div class="row footer__links"><div class="col footer__col"><div class="footer__title">Learn about RabbitMQ</div><ul class="footer__items clean-list"><li class="footer__item"><a class="footer__link-item" href="/rabbitmq-website/tutorials">Getting Started</a></li><li class="footer__item"><a class="footer__link-item" href="/rabbitmq-website/docs">Documentation</a></li><li class="footer__item"><a class="footer__link-item" href="/rabbitmq-website/blog">Blog</a></li></ul></div><div class="col footer__col"><div class="footer__title">Reach out to the RabbitMQ team</div><ul class="footer__items clean-list"><li class="footer__item"><a href="https://github.com/rabbitmq" target="_blank" rel="noopener noreferrer" class="footer__link-item">GitHub<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_nPIU"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a></li><li class="footer__item"><a href="https://github.com/rabbitmq/rabbitmq-server/discussions" target="_blank" rel="noopener noreferrer" class="footer__link-item">GitHub Discussions<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_nPIU"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a></li><li class="footer__item"><a class="footer__link-item" href="/rabbitmq-website/contact?utm_source=rmq_release-information_tableheader&amp;utm_medium=rmq_website&amp;utm_campaign=tanzu">Long Term Commercial Support</a></li><li class="footer__item"><a class="footer__link-item" href="/rabbitmq-website/contact">Contact Us</a></li><li class="footer__item"><a href="https://www.rabbitmq.com/discord" target="_blank" rel="noopener noreferrer" class="footer__link-item">Discord<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_nPIU"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a></li></ul></div><div class="col footer__col"><div class="footer__title">Broadcom</div><ul class="footer__items clean-list"><li class="footer__item"><a href="https://tanzu.vmware.com/" target="_blank" rel="noopener noreferrer" class="footer__link-item">VMware Tanzu<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_nPIU"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a></li><li class="footer__item"><a href="https://www.vmware.com/help/legal.html" target="_blank" rel="noopener noreferrer" class="footer__link-item">Terms of Use<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_nPIU"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a></li><li class="footer__item"><a href="https://www.vmware.com/help/privacy.html" target="_blank" rel="noopener noreferrer" class="footer__link-item">Privacy<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_nPIU"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a></li><li class="footer__item"><a class="footer__link-item" href="/rabbitmq-website/trademark-guidelines">Trademark Guidelines</a></li><li class="footer__item"><a href="https://www.vmware.com/help/privacy/california-privacy-rights.html" target="_blank" rel="noopener noreferrer" class="footer__link-item">Your California Privacy Rights<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_nPIU"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a></li><li class="footer__item"><a class="footer__link-item ot-sdk-show-settings">Cookie Settings</a></li></ul></div></div><div class="footer__bottom text--center"><div class="footer__copyright">Copyright © 2005-2025 Broadcom. All Rights Reserved. The term "Broadcom" refers to Broadcom Inc. and/or its subsidiaries.</div></div></div></footer></div>
</body>
</html>
<!doctype html>
<html lang="en" dir="ltr" class="blog-wrapper blog-post-page plugin-blog plugin-id-default" data-has-hydrated="false">
<head>
<meta charset="UTF-8">
<meta name="generator" content="Docusaurus v3.7.0">
<title data-rh="true">Connecting to Streams | RabbitMQ</title><meta data-rh="true" name="viewport" content="width=device-width,initial-scale=1"><meta data-rh="true" name="twitter:card" content="summary_large_image"><meta data-rh="true" property="og:image" content="https://www.rabbitmq.com/rabbitmq-website/img/rabbitmq-social-media-card.svg"><meta data-rh="true" name="twitter:image" content="https://www.rabbitmq.com/rabbitmq-website/img/rabbitmq-social-media-card.svg"><meta data-rh="true" property="og:url" content="https://www.rabbitmq.com/rabbitmq-website/blog/2021/07/23/connecting-to-streams"><meta data-rh="true" property="og:locale" content="en"><meta data-rh="true" name="docusaurus_locale" content="en"><meta data-rh="true" name="docusaurus_tag" content="default"><meta data-rh="true" name="docsearch:language" content="en"><meta data-rh="true" name="docsearch:docusaurus_tag" content="default"><meta data-rh="true" property="og:title" content="Connecting to Streams | RabbitMQ"><meta data-rh="true" name="description" content="RabbitMQ Streams Overview introduced streams, a new feature in RabbitMQ 3.9."><meta data-rh="true" property="og:description" content="RabbitMQ Streams Overview introduced streams, a new feature in RabbitMQ 3.9."><meta data-rh="true" property="og:type" content="article"><meta data-rh="true" property="article:published_time" content="2021-07-23T00:00:00.000Z"><meta data-rh="true" property="article:author" content="https://github.com/acogoluegnes"><meta data-rh="true" property="article:tag" content="Streams,Programming Languages,New Features"><link data-rh="true" rel="icon" href="/rabbitmq-website/img/rabbitmq-logo.svg"><link data-rh="true" rel="canonical" href="https://www.rabbitmq.com/rabbitmq-website/blog/2021/07/23/connecting-to-streams"><link data-rh="true" rel="alternate" href="https://www.rabbitmq.com/rabbitmq-website/blog/2021/07/23/connecting-to-streams" hreflang="en"><link data-rh="true" rel="alternate" href="https://www.rabbitmq.com/rabbitmq-website/blog/2021/07/23/connecting-to-streams" hreflang="x-default"><link data-rh="true" rel="preconnect" href="https://H10VQIW16Y-dsn.algolia.net" crossorigin="anonymous"><script data-rh="true" type="application/ld+json">{"@context":"https://schema.org","@type":"BlogPosting","@id":"https://www.rabbitmq.com/rabbitmq-website/blog/2021/07/23/connecting-to-streams","mainEntityOfPage":"https://www.rabbitmq.com/rabbitmq-website/blog/2021/07/23/connecting-to-streams","url":"https://www.rabbitmq.com/rabbitmq-website/blog/2021/07/23/connecting-to-streams","headline":"Connecting to Streams","name":"Connecting to Streams","description":"RabbitMQ Streams Overview introduced streams, a new feature in RabbitMQ 3.9.","datePublished":"2021-07-23T00:00:00.000Z","author":{"@type":"Person","name":"Arnaud Cogoluègnes","url":"https://github.com/acogoluegnes","image":"https://github.com/acogoluegnes.png"},"keywords":[],"isPartOf":{"@type":"Blog","@id":"https://www.rabbitmq.com/rabbitmq-website/blog","name":"Blog"}}</script><link rel="alternate" type="application/rss+xml" href="/rabbitmq-website/blog/rss.xml" title="RabbitMQ RSS Feed">
<link rel="alternate" type="application/atom+xml" href="/rabbitmq-website/blog/atom.xml" title="RabbitMQ Atom Feed">




<link rel="search" type="application/opensearchdescription+xml" title="RabbitMQ" href="/rabbitmq-website/opensearch.xml">







<link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Raleway:400,700">
<script src="https://cdn.cookielaw.org/scripttemplates/otSDKStub.js" data-domain-script="018ee308-473e-754f-b0c2-cbe82d25512f"></script>
<script>function OptanonWrapper(){}</script>
<script>function setGTM(e,t,o,n,r){e[n]=e[n]||[],e[n].push({"gtm.start":(new Date).getTime(),event:"gtm.js"});var i=t.getElementsByTagName(o)[0],a=t.createElement(o),s="dataLayer"!=n?"&l="+n:"";a.async=!0,a.src="https://www.googletagmanager.com/gtm.js?id="+r+s,i.parentNode.insertBefore(a,i)}var timer;function waitForOnetrustActiveGroups(){document.cookie.indexOf("OptanonConsent")>-1&&document.cookie.indexOf("groups=")>-1?(clearTimeout(timer),setGTM(window,document,"script","dataLayer","GTM-TT84L8K")):timer=setTimeout(waitForOnetrustActiveGroups,250)}document.cookie.indexOf("OptanonConsent")>-1&&document.cookie.indexOf("groups=")>-1?setGTM(window,document,"script","dataLayer","GTM-TT84L8K"):waitForOnetrustActiveGroups()</script><link rel="stylesheet" href="/rabbitmq-website/styles.css">
<script src="/rabbitmq-website/runtime~main.js" defer="defer"></script>
<script src="/rabbitmq-website/main.js" defer="defer"></script>
</head>
<body class="navigation-with-keyboard">
<script>!function(){function t(t){document.documentElement.setAttribute("data-theme",t)}var e=function(){try{return new URLSearchParams(window.location.search).get("docusaurus-theme")}catch(t){}}()||function(){try{return window.localStorage.getItem("theme")}catch(t){}}();null!==e?t(e):window.matchMedia("(prefers-color-scheme: dark)").matches?t("dark"):(window.matchMedia("(prefers-color-scheme: light)").matches,t("light"))}(),function(){try{const n=new URLSearchParams(window.location.search).entries();for(var[t,e]of n)if(t.startsWith("docusaurus-data-")){var a=t.replace("docusaurus-data-","data-");document.documentElement.setAttribute(a,e)}}catch(t){}}(),document.documentElement.setAttribute("data-announcement-bar-initially-dismissed",function(){try{return"true"===localStorage.getItem("docusaurus.announcement.dismiss")}catch(t){}return!1}())</script><div id="__docusaurus"><div role="region" aria-label="Skip to main content"><a class="skipToContent_fXgn" href="#__docusaurus_skipToContent_fallback">Skip to main content</a></div><div class="announcementBar_mb4j" style="background-color:var(--ifm-color-primary-contrast-background);color:var(--ifm-font-color-base)" role="banner"><div class="announcementBarPlaceholder_vyr4"></div><div class="content_knG7 announcementBarContent_xLdY"><strong style="font-size: var(--ifm-h4-font-size);"><a href="https://github.com/rabbitmq/rabbitmq-server/releases/tag/v4.1.0">RabbitMQ 4.1.0 is out</a></strong></div><button type="button" aria-label="Close" class="clean-btn close closeButton_CVFx announcementBarClose_gvF7"><svg viewBox="0 0 15 15" width="14" height="14"><g stroke="currentColor" stroke-width="3.1"><path d="M.75.75l13.5 13.5M14.25.75L.75 14.25"></path></g></svg></button></div><nav aria-label="Main" class="navbar navbar--fixed-top"><div class="navbar__inner"><div class="navbar__items"><button aria-label="Toggle navigation bar" aria-expanded="false" class="navbar__toggle clean-btn" type="button"><svg width="30" height="30" viewBox="0 0 30 30" aria-hidden="true"><path stroke="currentColor" stroke-linecap="round" stroke-miterlimit="10" stroke-width="2" d="M4 7h22M4 15h22M4 23h22"></path></svg></button><a class="navbar__brand" href="/rabbitmq-website/"><div class="navbar__logo"><img src="/rabbitmq-website/img/rabbitmq-logo-with-name.svg" alt="RabbitMQ" class="themedComponent_mlkZ themedComponent--light_NVdE"><img src="/rabbitmq-website/img/rabbitmq-logo-with-name.svg" alt="RabbitMQ" class="themedComponent_mlkZ themedComponent--dark_xIcU"></div></a><a class="navbar__item navbar__link" href="/rabbitmq-website/tutorials">Getting Started</a><a class="navbar__item navbar__link" href="/rabbitmq-website/docs">Docs</a><a aria-current="page" class="navbar__item navbar__link navbar__link--active" href="/rabbitmq-website/blog">Blog</a><a class="navbar__item navbar__link" href="/rabbitmq-website/contact">Support</a></div><div class="navbar__items navbar__items--right"><div class="navbar__item dropdown dropdown--hoverable dropdown--right"><a class="navbar__link" aria-haspopup="true" aria-expanded="false" role="button" href="/rabbitmq-website/docs">4.1</a><ul class="dropdown__menu"><li class=""><strong>Release series</strong></li><li><a class="dropdown__link" href="/rabbitmq-website/docs/next">Next</a></li><li><a class="dropdown__link" href="/rabbitmq-website/docs">4.1</a></li><li><a class="dropdown__link" href="/rabbitmq-website/docs/4.0">4.0</a></li><li><a class="dropdown__link" href="/rabbitmq-website/docs/3.13">3.13</a></li><li><a href="https://v3-12.rabbitmq.com/documentation.html" target="_blank" rel="noopener noreferrer" class="dropdown__link">3.12<svg width="12" height="12" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_nPIU"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a></li><li><a class="dropdown__link" href="/rabbitmq-website/release-information">Release Information</a></li></ul></div><a href="https://github.com/rabbitmq/rabbitmq-website" target="_blank" rel="noopener noreferrer" class="navbar__item navbar__link">GitHub<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_nPIU"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a><div class="toggle_vylO colorModeToggle_DEke"><button class="clean-btn toggleButton_gllP toggleButtonDisabled_aARS" type="button" disabled="" title="Switch between dark and light mode (currently light mode)" aria-label="Switch between dark and light mode (currently light mode)" aria-live="polite" aria-pressed="false"><svg viewBox="0 0 24 24" width="24" height="24" class="lightToggleIcon_pyhR"><path fill="currentColor" d="M12,9c1.65,0,3,1.35,3,3s-1.35,3-3,3s-3-1.35-3-3S10.35,9,12,9 M12,7c-2.76,0-5,2.24-5,5s2.24,5,5,5s5-2.24,5-5 S14.76,7,12,7L12,7z M2,13l2,0c0.55,0,1-0.45,1-1s-0.45-1-1-1l-2,0c-0.55,0-1,0.45-1,1S1.45,13,2,13z M20,13l2,0c0.55,0,1-0.45,1-1 s-0.45-1-1-1l-2,0c-0.55,0-1,0.45-1,1S19.45,13,20,13z M11,2v2c0,0.55,0.45,1,1,1s1-0.45,1-1V2c0-0.55-0.45-1-1-1S11,1.45,11,2z M11,20v2c0,0.55,0.45,1,1,1s1-0.45,1-1v-2c0-0.55-0.45-1-1-1C11.45,19,11,19.45,11,20z M5.99,4.58c-0.39-0.39-1.03-0.39-1.41,0 c-0.39,0.39-0.39,1.03,0,1.41l1.06,1.06c0.39,0.39,1.03,0.39,1.41,0s0.39-1.03,0-1.41L5.99,4.58z M18.36,16.95 c-0.39-0.39-1.03-0.39-1.41,0c-0.39,0.39-0.39,1.03,0,1.41l1.06,1.06c0.39,0.39,1.03,0.39,1.41,0c0.39-0.39,0.39-1.03,0-1.41 L18.36,16.95z M19.42,5.99c0.39-0.39,0.39-1.03,0-1.41c-0.39-0.39-1.03-0.39-1.41,0l-1.06,1.06c-0.39,0.39-0.39,1.03,0,1.41 s1.03,0.39,1.41,0L19.42,5.99z M7.05,18.36c0.39-0.39,0.39-1.03,0-1.41c-0.39-0.39-1.03-0.39-1.41,0l-1.06,1.06 c-0.39,0.39-0.39,1.03,0,1.41s1.03,0.39,1.41,0L7.05,18.36z"></path></svg><svg viewBox="0 0 24 24" width="24" height="24" class="darkToggleIcon_wfgR"><path fill="currentColor" d="M9.37,5.51C9.19,6.15,9.1,6.82,9.1,7.5c0,4.08,3.32,7.4,7.4,7.4c0.68,0,1.35-0.09,1.99-0.27C17.45,17.19,14.93,19,12,19 c-3.86,0-7-3.14-7-7C5,9.07,6.81,6.55,9.37,5.51z M12,3c-4.97,0-9,4.03-9,9s4.03,9,9,9s9-4.03,9-9c0-0.46-0.04-0.92-0.1-1.36 c-0.98,1.37-2.58,2.26-4.4,2.26c-2.98,0-5.4-2.42-5.4-5.4c0-1.81,0.89-3.42,2.26-4.4C12.92,3.04,12.46,3,12,3L12,3z"></path></svg></button></div><div class="navbarSearchContainer_Bca1"><button type="button" class="DocSearch DocSearch-Button" aria-label="Search (Command+K)"><span class="DocSearch-Button-Container"><svg width="20" height="20" class="DocSearch-Search-Icon" viewBox="0 0 20 20" aria-hidden="true"><path d="M14.386 14.386l4.0877 4.0877-4.0877-4.0877c-2.9418 2.9419-7.7115 2.9419-10.6533 0-2.9419-2.9418-2.9419-7.7115 0-10.6533 2.9418-2.9419 7.7115-2.9419 10.6533 0 2.9419 2.9418 2.9419 7.7115 0 10.6533z" stroke="currentColor" fill="none" fill-rule="evenodd" stroke-linecap="round" stroke-linejoin="round"></path></svg><span class="DocSearch-Button-Placeholder">Search</span></span><span class="DocSearch-Button-Keys"></span></button></div></div></div><div role="presentation" class="navbar-sidebar__backdrop"></div></nav><div id="__docusaurus_skipToContent_fallback" class="main-wrapper mainWrapper_z2l0"><div class="container margin-vert--lg"><div class="row"><main class="col col--9 col--offset-1"><article class=""><header><h1 class="title_f1Hy">Connecting to Streams</h1><div class="container_mt6G margin-vert--md"><time datetime="2021-07-23T00:00:00.000Z">July 23, 2021</time> · <!-- -->13 min read</div><div class="margin-top--md margin-bottom--sm row"><div class="col col--12 authorCol_Hf19"><div class="avatar margin-bottom--sm"><a href="https://github.com/acogoluegnes" target="_blank" rel="noopener noreferrer" class="avatar__photo-link"><img class="avatar__photo authorImage_XqGP" src="https://github.com/acogoluegnes.png" alt="Arnaud Cogoluègnes"></a><div class="avatar__intro authorDetails_lV9A"><div class="avatar__name"><a href="https://github.com/acogoluegnes" target="_blank" rel="noopener noreferrer"><span class="authorName_yefp">Arnaud Cogoluègnes</span></a></div><div class="authorSocials_rSDt"><a href="https://github.com/acogoluegnes" target="_blank" rel="noopener noreferrer" class="authorSocialLink_owbf" title="GitHub"><svg xmlns="http://www.w3.org/2000/svg" width="1em" height="1em" viewBox="0 0 256 250" preserveAspectRatio="xMidYMid" style="--dark:#000;--light:#fff" class="authorSocialLink_owbf githubSvg_Uu4N"><path d="M128.001 0C57.317 0 0 57.307 0 128.001c0 56.554 36.676 104.535 87.535 121.46 6.397 1.185 8.746-2.777 8.746-6.158 0-3.052-.12-13.135-.174-23.83-35.61 7.742-43.124-15.103-43.124-15.103-5.823-14.795-14.213-18.73-14.213-18.73-11.613-7.944.876-7.78.876-7.78 12.853.902 19.621 13.19 19.621 13.19 11.417 19.568 29.945 13.911 37.249 10.64 1.149-8.272 4.466-13.92 8.127-17.116-28.431-3.236-58.318-14.212-58.318-63.258 0-13.975 5-25.394 13.188-34.358-1.329-3.224-5.71-16.242 1.24-33.874 0 0 10.749-3.44 35.21 13.121 10.21-2.836 21.16-4.258 32.038-4.307 10.878.049 21.837 1.47 32.066 4.307 24.431-16.56 35.165-13.12 35.165-13.12 6.967 17.63 2.584 30.65 1.255 33.873 8.207 8.964 13.173 20.383 13.173 34.358 0 49.163-29.944 59.988-58.447 63.157 4.591 3.972 8.682 11.762 8.682 23.704 0 17.126-.148 30.91-.148 35.126 0 3.407 2.304 7.398 8.792 6.14C219.37 232.5 256 184.537 256 128.002 256 57.307 198.691 0 128.001 0Zm-80.06 182.34c-.282.636-1.283.827-2.194.39-.929-.417-1.45-1.284-1.15-1.922.276-.655 1.279-.838 2.205-.399.93.418 1.46 1.293 1.139 1.931Zm6.296 5.618c-.61.566-1.804.303-2.614-.591-.837-.892-.994-2.086-.375-2.66.63-.566 1.787-.301 2.626.591.838.903 1 2.088.363 2.66Zm4.32 7.188c-.785.545-2.067.034-2.86-1.104-.784-1.138-.784-2.503.017-3.05.795-.547 2.058-.055 2.861 1.075.782 1.157.782 2.522-.019 3.08Zm7.304 8.325c-.701.774-2.196.566-3.29-.49-1.119-1.032-1.43-2.496-.726-3.27.71-.776 2.213-.558 3.315.49 1.11 1.03 1.45 2.505.701 3.27Zm9.442 2.81c-.31 1.003-1.75 1.459-3.199 1.033-1.448-.439-2.395-1.613-2.103-2.626.301-1.01 1.747-1.484 3.207-1.028 1.446.436 2.396 1.602 2.095 2.622Zm10.744 1.193c.036 1.055-1.193 1.93-2.715 1.95-1.53.034-2.769-.82-2.786-1.86 0-1.065 1.202-1.932 2.733-1.958 1.522-.03 2.768.818 2.768 1.868Zm10.555-.405c.182 1.03-.875 2.088-2.387 2.37-1.485.271-2.861-.365-3.05-1.386-.184-1.056.893-2.114 2.376-2.387 1.514-.263 2.868.356 3.061 1.403Z"></path></svg></a><a href="https://www.linkedin.com/in/arnaudcogoluegnes/" target="_blank" rel="noopener noreferrer" class="authorSocialLink_owbf" title="LinkedIn"><svg xmlns="http://www.w3.org/2000/svg" width="1em" height="1em" preserveAspectRatio="xMidYMid" viewBox="0 0 256 256" class="authorSocialLink_owbf"><path d="M218.123 218.127h-37.931v-59.403c0-14.165-.253-32.4-19.728-32.4-19.756 0-22.779 15.434-22.779 31.369v60.43h-37.93V95.967h36.413v16.694h.51a39.907 39.907 0 0 1 35.928-19.733c38.445 0 45.533 25.288 45.533 58.186l-.016 67.013ZM56.955 79.27c-12.157.002-22.014-9.852-22.016-22.009-.002-12.157 9.851-22.014 22.008-22.016 12.157-.003 22.014 9.851 22.016 22.008A22.013 22.013 0 0 1 56.955 79.27m18.966 138.858H37.95V95.967h37.97v122.16ZM237.033.018H18.89C8.58-.098.125 8.161-.001 18.471v219.053c.122 10.315 8.576 18.582 18.89 18.474h218.144c10.336.128 18.823-8.139 18.966-18.474V18.454c-.147-10.33-8.635-18.588-18.966-18.453" fill="#0A66C2"></path></svg></a><a href="https://bsky.app/profile/acogoluegnes.bsky.social" target="_blank" rel="noopener noreferrer" class="authorSocialLink_owbf" title="Bluesky"><svg xmlns="http://www.w3.org/2000/svg" width="1em" height="1em" preserveAspectRatio="xMidYMid" viewBox="0 0 256 226" class="authorSocialLink_owbf"><path fill="#1185FE" d="M55.491 15.172c29.35 22.035 60.917 66.712 72.509 90.686 11.592-23.974 43.159-68.651 72.509-90.686C221.686-.727 256-13.028 256 26.116c0 7.818-4.482 65.674-7.111 75.068-9.138 32.654-42.436 40.983-72.057 35.942 51.775 8.812 64.946 38 36.501 67.187-54.021 55.433-77.644-13.908-83.696-31.676-1.11-3.257-1.63-4.78-1.637-3.485-.008-1.296-.527.228-1.637 3.485-6.052 17.768-29.675 87.11-83.696 31.676-28.445-29.187-15.274-58.375 36.5-67.187-29.62 5.041-62.918-3.288-72.056-35.942C4.482 91.79 0 33.934 0 26.116 0-13.028 34.314-.727 55.491 15.172Z"></path></svg></a></div></div></div></div></div></header><div id="__blog-post-container" class="markdown"><p><a href="/rabbitmq-website/blog/2021/07/13/rabbitmq-streams-overview">RabbitMQ Streams Overview</a> introduced streams, a new feature in RabbitMQ 3.9.
This post covers how client applications should connect to RabbitMQ nodes to get the most benefit from streams when the <a href="https://github.com/rabbitmq/rabbitmq-server/blob/v3.9.x/deps/rabbitmq_stream/docs/PROTOCOL.adoc" target="_blank" rel="noopener noreferrer">stream protocol</a> is in use.</p>
<p>Streams are optimized for high throughput scenarios, that&#x27;s why technical details like data locality are critical to get the best out of your RabbitMQ cluster.
Client libraries can handle most of the details, but a basic understanding of how things work under the hood is essential when a setup involves extra layers like containers and load balancers. Keep reading if you want to learn more about streams and avoid some headaches when deploying your first stream applications!</p>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="topology-of-a-stream">Topology of a Stream<a href="#topology-of-a-stream" class="hash-link" aria-label="Direct link to Topology of a Stream" title="Direct link to Topology of a Stream">​</a></h2>
<p>A stream is replicated and persistent, it is composed of a <em>leader</em> Erlang process and <em>replica</em> Erlang processes. These processes are spread across the nodes of a RabbitMQ cluster, as shown in the following diagram:</p>
<p></p><figure><img decoding="async" loading="lazy" alt="A stream is a replicated and persistent data structure. It has a leader process which accepts write operations and replicas which can dispatch messages to applications." src="/rabbitmq-website/assets/images/stream-topology-4c19caa1a3dc590aeb99e653fb2221e6.svg" width="1090" height="206" class="img_ev3q"><figcaption>A stream is a replicated and persistent data structure. It has a leader process which accepts write operations and replicas which can dispatch messages to applications.</figcaption></figure><p></p>
<p>Only the leader process handles write operations like inbound messages. Any <em>member</em> of the stream – leader and replicas – can dispatch messages to client applications.</p>
<p>An application that publishes to a stream using the <a href="https://github.com/rabbitmq/rabbitmq-server/blob/v3.9.x/deps/rabbitmq_stream/docs/PROTOCOL.adoc" target="_blank" rel="noopener noreferrer">stream protocol</a> can connect to any node in the cluster: messages will automatically go from the connection node to the node that hosts the leader process.
It does not require a PhD to understand that the operation is not optimal if the connection and the stream leader are not on the same node.
<em>An application that publishes to a stream should connect to the node that hosts the leader of the stream, to avoid an extra network hop</em>.</p>
<p>The story is a bit different for consuming applications.
With the stream protocol, messages are dispatched to applications using <a href="https://man7.org/linux/man-pages/man2/sendfile.2.html" target="_blank" rel="noopener noreferrer"><code>sendfile</code></a>: file chunks that contain messages are sent directly from the node file system to the network socket, without going through user space.
This optimization requires that <em>the node the consuming application is connected to hosts a member of the stream</em>.
Whether this member is the leader or a replica does not matter, as long the data is on the file system, ready to go through the network socket with <code>sendfile</code>.</p>
<p>This constraint for consuming applications does not seem too harsh: in the diagram above, each node has a member of the stream, so an application can connect to any node to consume.
But imagine a 5-node cluster with streams using a replication factor of 2: each stream will have members only on 3 nodes out of the 5 nodes.
In this case, consuming applications have to pick their node appropriately.</p>
<p>With this knowledge in mind, let&#x27;s try now to come up with some best practices.</p>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="well-behaved-clients">Well-behaved Clients<a href="#well-behaved-clients" class="hash-link" aria-label="Direct link to Well-behaved Clients" title="Direct link to Well-behaved Clients">​</a></h2>
<p>So a publishing application can connect to any node of a cluster, it will always reach the leader process.
A consuming application must connect to a node that hosts a member of the target stream, and this member can be the leader or a replica.
Client applications can stick to these rules, but the following best practices should be enforced whenever possible:</p>
<ul>
<li><strong>a publishing application should always connect to the node that hosts the leader process of the target stream</strong>.</li>
<li><strong>a consuming application should always connect to a node that hosts a replica of the target stream</strong>.</li>
</ul>
<p>The following diagram illustrates these best practices:</p>
<p></p><figure><img decoding="async" loading="lazy" alt="Client applications that publish to a stream should connect to the node that hosts the stream leader, clients applications that consume from a stream should connect to a node that hosts a replica of this stream." src="/rabbitmq-website/assets/images/well-behaved-clients-2cb798de6212bd9ba9a37810ad929a77.svg" width="1105" height="434" class="img_ev3q"><figcaption>Client applications that publish to a stream should connect to the node that hosts the stream leader, clients applications that consume from a stream should connect to a node that hosts a replica of this stream.</figcaption></figure><p></p>
<p>As stated previously, connecting directly to the node of the stream leader avoids a network hop, as messages have to go the leader process anyway.
What about always using a replica for consuming? Well, it just offloads the leader process, which is already busy dealing with all the write operations.</p>
<p>These best practices should be enforced ideally by client libraries, all these technical details should not leak into the application code.
We&#x27;ll see next how the stream protocol allows client applications to find out about the topology of a given stream.</p>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="streams-across-a-cluster">Streams Across a Cluster<a href="#streams-across-a-cluster" class="hash-link" aria-label="Direct link to Streams Across a Cluster" title="Direct link to Streams Across a Cluster">​</a></h2>
<p>Before moving on to the <code>metadata</code> command of the stream protocol, let&#x27;s clarify how streams (plural) spread across the nodes of a RabbitMQ cluster.
We mentioned that a stream has a leader Erlang process located on a node and replica Erlang processes located on other nodes.
With several streams, all these Erlang processes (think &quot;very lightweight thread&quot; for an Erlang process) spread across the cluster nodes, and at no point a given RabbitMQ node is supposed to host all the stream leaders.</p>
<p>Think of a stream as a small cluster in the RabbitMQ cluster, as illustrated with several streams in the next diagram:</p>
<p></p><figure><img decoding="async" loading="lazy" alt="Stream leaders spread across the nodes of a cluster. This means that a given node does not have to contain all the leaders at some point." src="/rabbitmq-website/assets/images/stream-spread-cd9eff9b53ca90a91b1ee67adc6cb3b3.svg" width="1076" height="279" class="img_ev3q"><figcaption>Stream leaders spread across the nodes of a cluster. This means that a given node does not have to contain all the leaders at some point.</figcaption></figure><p></p>
<p>The way leaders are spread across the cluster depends on the &quot;leader locator strategy&quot; when a stream is created.
The default strategy is &quot;least leaders&quot;, which means picking the node with least number of stream leaders for the leader of the new stream.
There are other strategies, but covering them is out of the scope of this post.</p>
<p>With this clarification in mind, let&#x27;s move on to the way to find out about the topology of streams.</p>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="the-metadata-command">The <code>metadata</code> command<a href="#the-metadata-command" class="hash-link" aria-label="Direct link to the-metadata-command" title="Direct link to the-metadata-command">​</a></h2>
<p>The stream protocol provides a <a href="https://github.com/rabbitmq/rabbitmq-server/blob/v3.9.x/deps/rabbitmq_stream/docs/PROTOCOL.adoc#metadata" target="_blank" rel="noopener noreferrer"><code>metadata</code> command</a> to query the topology of one or several streams.
For each queried stream, the response contains the hostname and port of the nodes that host the leader and replicas.</p>
<p>The following diagram illustrates how a client application already connected to one of the nodes can find out about the topology of a given stream:</p>
<p></p><figure><img decoding="async" loading="lazy" alt="A client can find out about the topology of a stream by using the metadata command." src="/rabbitmq-website/assets/images/metadata-command-0e46d66450897d6cdbcf45997f2bd124.svg" width="1105" height="434" class="img_ev3q"><figcaption>A client can find out about the topology of a stream by using the metadata command.</figcaption></figure><p></p>
<p><em>So a common pattern is to provide one or several entry points to a client library, use the <code>metadata</code> command once connected to learn the topology of a target stream, and then connect to the appropriate nodes depending on the operations (publishing or consuming)</em>:</p>
<p></p><figure><img decoding="async" loading="lazy" alt="Once a client application knows about the topology of a stream, it can connect to the appropriate nodes to work with it: the node that hosts the stream leader to publish and nodes that host the stream replicas to consume." src="/rabbitmq-website/assets/images/use-connection-hints-e4243348430033e5244ae5db8475ea3c.svg" width="1105" height="434" class="img_ev3q"><figcaption>Once a client application knows about the topology of a stream, it can connect to the appropriate nodes to work with it: the node that hosts the stream leader to publish and nodes that host the stream replicas to consume.</figcaption></figure><p></p>
<p>The <code>metadata</code> command is key for client libraries to enforce the best practices mentioned above.</p>
<p>Unfortunately, the metadata returned by default are not always accurate, or at least accurate enough for the client application to connect. Let&#x27;s see an example.</p>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="limitations-of-default-metadata">Limitations of Default Metadata<a href="#limitations-of-default-metadata" class="hash-link" aria-label="Direct link to Limitations of Default Metadata" title="Direct link to Limitations of Default Metadata">​</a></h2>
<p>The stream plugin returns the hostname of each node for the host metadata (this is the host part of the Erlang node name to be more accurate, but this does not matter much here).
This is fine... as long as the client can resolve the hostname to connect to the node!</p>
<p>In these times of containers, the hostname can be a blurry concept, which does not make much sense as soon as you are out of the container.
The following diagram illustrates a 3-node RabbitMQ cluster where the nodes are containers running on different VMs.
A client application can connect to the nodes if the ports are mapped correctly, but there&#x27;s no way it can do it by using the hostname of the containers.</p>
<p></p><figure><img decoding="async" loading="lazy" alt="Using the hostname in metadata will not work when the nodes run in containers, as it is very unlikely the client and the nodes can see each other directly." src="/rabbitmq-website/assets/images/use-connection-hints-with-docker-c4d7411314f6ffe6d10e7d57afe33486.svg" width="1156" height="535" class="img_ev3q"><figcaption>Using the hostname in metadata will not work when the nodes run in containers, as it is very unlikely the client and the nodes can see each other directly.</figcaption></figure><p></p>
<p>The stream plugin does its best, but it cannot do miracles here.
Fortunately, it is possible to configure what a node returns when it is asked its &quot;coordinates&quot; for the <code>metadata</code> command.</p>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="advertised-host-and-port">Advertised Host and Port<a href="#advertised-host-and-port" class="hash-link" aria-label="Direct link to Advertised Host and Port" title="Direct link to Advertised Host and Port">​</a></h2>
<p>The <a href="/rabbitmq-website/docs/stream#advertised-host-port"><code>advertised_host</code> and <code>advertised_port</code> configuration entries</a> of the stream plugin can be set to tell a node what to return when asked how to be contacted.
There is no trick here: the plugin will just trust the operator that did the configuration and will blindly return these values.
This means a client application must be able to connect to the node using this information.</p>
<p></p><figure><img decoding="async" loading="lazy" alt="It is possible to configure advertised host and port if the default values are not appropriate." src="/rabbitmq-website/assets/images/metadata-hints-b023812c1bf1ecdd8ac8e37b634b02a5.svg" width="1108" height="569" class="img_ev3q"><figcaption>It is possible to configure advertised host and port if the default values are not appropriate.</figcaption></figure><p></p>
<p>The <code>advertised_host</code> and <code>advertised_port</code> settings should help solve all the headaches with client applications not able to connect to nodes because of incorrect stream metadata.
Always keep them in mind if you deploy a RabbitMQ cluster with containerized nodes and if you use streams.</p>
<p>There is still one common use case where this discovery mechanism can be problematic: when a load balancer sits between client applications and the cluster nodes.</p>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="with-a-load-balancer">With a Load Balancer<a href="#with-a-load-balancer" class="hash-link" aria-label="Direct link to With a Load Balancer" title="Direct link to With a Load Balancer">​</a></h2>
<p>Having a load balancer in front of a RabbitMQ cluster is a common scenario.
This may cause some problems because of the way streams work, but there are always solutions.
If we come back to the metadata command but with a load balancer, things will go wrong: the client will receive the nodes information and will use it to connect <em>directly</em> to the nodes, bypassing the load balancer.
The following diagram illustrates this unfortunate situation:</p>
<p></p><figure><img decoding="async" loading="lazy" alt="Metadata hints are less useful when a load balancer sits between the client and the nodes. The client application will skip the load balancer and try to connect directly to the nodes. This can be impossible or a security concern." src="/rabbitmq-website/assets/images/load-balancer-18cf63114d0716feefd56d3f2fba497a.svg" width="1089" height="531" class="img_ev3q"><figcaption>Metadata hints are less useful when a load balancer sits between the client and the nodes. The client application will skip the load balancer and try to connect directly to the nodes. This can be impossible or a security concern.</figcaption></figure><p></p>
<p>This is probably not what you want.</p>
<p>What about setting the <code>advertised_host</code> and <code>advertised_port</code> configuration entries to use the load balancer information?
This way client applications will always connect to the load balancer!
This is not such a great idea, because we won&#x27;t be able to enforce the best practices (publishing to leader, consuming from replica) and in a deployment where streams are not on all nodes, consuming will fail if the application ends up being connected to a node without a stream member.</p>
<p>OK, this is a bit depressing, but cheer up, as client libraries can implement a workaround to solve this problem.</p>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="client-workaround-with-a-load-balancer">Client Workaround With a Load Balancer<a href="#client-workaround-with-a-load-balancer" class="hash-link" aria-label="Direct link to Client Workaround With a Load Balancer" title="Direct link to Client Workaround With a Load Balancer">​</a></h2>
<p>A client application can still always connect to the load balancer and end up connected to the appropriate node.
How can it do it?
Two steps:</p>
<ul>
<li>use the <code>metadata</code> command but <em>ignore</em> the information and always connect to the load balancer</li>
<li>retry connecting until it gets connected to the appropriate node</li>
</ul>
<p>You may wonder how to find out about the node once a connection is established?
The &quot;coordinates&quot; of the node (hostname and port, or <code>advertised_host</code> and <code>advertised_port</code> if configured) are available in a stream protocol connection.
So a client application can know to which node it is connected to.</p>
<p><strong>This means <code>advertised_host</code> and <code>advertised_port</code> should not be configured when a load balancer is in use.</strong>
The &quot;coordinates&quot; of a node that the <code>metadata</code> command returns are not used to connect in this case, as the client always connects to the load balancer.
They are used to <em>correlate</em> the connection the load balancer provides with the node the client expects, and the hostname is perfect for this.</p>
<p>Let&#x27;s take an example:</p>
<ul>
<li>a publishing application knows the leader of its targeted stream is on <code>node-1</code> thanks to the response of a <code>metadata</code> request</li>
<li>it creates a new connection using the load balancer address</li>
<li>the load balancer chooses to connect to <code>node-3</code></li>
<li>the connection is properly established but the client application finds out it is connected to <code>node-3</code>, it immediately closes the connection, and retries</li>
<li>this time the load balancer chooses <code>node-1</code></li>
<li>the application is happy about the node it&#x27;s connected to, it moves on to publishing using this connection</li>
</ul>
<p>The following diagram illustrates this process:</p>
<p></p><figure><img decoding="async" loading="lazy" alt="A client can choose to ignore the metadata hints and always use the load balancer. As stream connections convey the node hostname they originate from, the client can know whether it is connected to the right node or not, and keep the connection or close it and retry." src="/rabbitmq-website/assets/images/load-balancer-ignore-metadata-9c9147b8395a556ba8c7859e6b8d407e.svg" width="1102" height="598" class="img_ev3q"><figcaption>A client can choose to ignore the metadata hints and always use the load balancer. As stream connections convey the node hostname they originate from, the client can know whether it is connected to the right node or not, and keep the connection or close it and retry.</figcaption></figure><p></p>
<p>As stream connections are long-lived and a stream application is not supposed to have a lot of connection churn, retrying to connect is not a concern here.</p>
<p>This solution also assumes that the load balancer will not always connect to the same backend server. Round-robin is an appropriate balancing strategy for this case.</p>
<p>It should also be clear now that setting <code>advertised_host</code> and <code>advertised_port</code> is not necessary when using this technics and setting them to the load balancer coordinates for all nodes is a bad idea.
Letting each node returns its hostname is fine here, as the hostname is supposed to be unique in a network.</p>
<p>So the onus is on the client library. Let&#x27;s see now how this is implemented with the stream Java client.</p>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="using-the-stream-java-client-with-a-load-balancer">Using the Stream Java Client With a Load Balancer<a href="#using-the-stream-java-client-with-a-load-balancer" class="hash-link" aria-label="Direct link to Using the Stream Java Client With a Load Balancer" title="Direct link to Using the Stream Java Client With a Load Balancer">​</a></h2>
<p>The <a href="https://github.com/rabbitmq/rabbitmq-stream-java-client" target="_blank" rel="noopener noreferrer">stream Java client</a> provides <a href="https://github.com/rabbitmq/rabbitmq-stream-java-client/blob/main/src/main/java/com/rabbitmq/stream/AddressResolver.java" target="_blank" rel="noopener noreferrer">an <code>AddressResolver</code> extension point</a>.
It is used whenever a new connection is created: from the passed-in <code>Address</code> (the node to connect to based on the <code>metadata</code> query), the address resolver can provide some logic to compute the actual address to use.
The default implementation just returns the given address.
If you want to implement the workaround presented above when a load balancer is in use, always return the address of the load balancer, as shown in the following code snippet:</p>
<div class="language-java codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-java codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token class-name">Address</span><span class="token plain"> entryPoint </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">new</span><span class="token plain"> </span><span class="token class-name">Address</span><span class="token punctuation" style="color:#393A34">(</span><span class="token string" style="color:#e3116c">&quot;my-load-balancer&quot;</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">5552</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token class-name">Environment</span><span class="token plain"> environment </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token class-name">Environment</span><span class="token punctuation" style="color:#393A34">.</span><span class="token function" style="color:#d73a49">builder</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token punctuation" style="color:#393A34">.</span><span class="token function" style="color:#d73a49">host</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">entryPoint</span><span class="token punctuation" style="color:#393A34">.</span><span class="token function" style="color:#d73a49">host</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token punctuation" style="color:#393A34">.</span><span class="token function" style="color:#d73a49">port</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">entryPoint</span><span class="token punctuation" style="color:#393A34">.</span><span class="token function" style="color:#d73a49">port</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token punctuation" style="color:#393A34">.</span><span class="token function" style="color:#d73a49">addressResolver</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">address </span><span class="token operator" style="color:#393A34">-&gt;</span><span class="token plain"> entryPoint</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token punctuation" style="color:#393A34">.</span><span class="token function" style="color:#d73a49">build</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>The <a href="https://rabbitmq.github.io/rabbitmq-stream-java-client/stable/htmlsingle/#the-performance-tool" target="_blank" rel="noopener noreferrer">stream PerfTest tool</a> also supports this mode when the <code>--load-balancer</code> option is enabled.
Here is how to tell the tool to always use the same entry point for publishers and consumers connections:</p>
<div class="language-shell codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-shell codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token comment" style="color:#999988;font-style:italic"># with the Java binary</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token function" style="color:#d73a49">java</span><span class="token plain"> </span><span class="token parameter variable" style="color:#36acaa">-jar</span><span class="token plain"> stream-perf-test.jar </span><span class="token parameter variable" style="color:#36acaa">--uris</span><span class="token plain"> rabbitmq-stream://my-load-balancer:5552 --load-balancer</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token comment" style="color:#999988;font-style:italic"># with Docker</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token function" style="color:#d73a49">docker</span><span class="token plain"> run </span><span class="token parameter variable" style="color:#36acaa">-it</span><span class="token plain"> </span><span class="token parameter variable" style="color:#36acaa">--rm</span><span class="token plain"> pivotalrabbitmq/stream-perf-test </span><span class="token parameter variable" style="color:#36acaa">--uris</span><span class="token plain"> rabbitmq-stream://my-load-balancer:5552 --load-balancer</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="wrapping-up">Wrapping Up<a href="#wrapping-up" class="hash-link" aria-label="Direct link to Wrapping Up" title="Direct link to Wrapping Up">​</a></h2>
<p>This post covered how client applications should connect when using the stream protocol.
Here is the gist:</p>
<ul>
<li>publishing applications should connect to the node that hosts the leader of the target stream</li>
<li>consuming applications should connect to a node that hosts of replica of the target stream</li>
<li>client applications must use the <a href="https://github.com/rabbitmq/rabbitmq-server/blob/v3.9.x/deps/rabbitmq_stream/docs/PROTOCOL.adoc#metadata" target="_blank" rel="noopener noreferrer"><code>metadata</code> stream protocol command</a> to learn about the topology of the streams they want to interact with</li>
<li>the stream <a href="https://github.com/rabbitmq/rabbitmq-stream-java-client" target="_blank" rel="noopener noreferrer">Java</a> and <a href="https://github.com/rabbitmq/rabbitmq-stream-go-client" target="_blank" rel="noopener noreferrer">Go</a> clients enforce these best practices</li>
<li>the <code>metadata</code> command returns by default the nodes hostname and listener port, which can be problematic e.g. when containers are in use</li>
<li>the <a href="/rabbitmq-website/docs/stream#advertised-host-port"><code>advertised_host</code> and <code>advertised_port</code> configuration entries</a> allow to specify what values a node should return for the <code>metadata</code> command</li>
<li>a load balancer can confuse a client library that will try to bypass it to connect directly to the nodes</li>
<li>client libraries can provide a workaround to work properly with a load balancer</li>
<li>the stream <a href="https://github.com/rabbitmq/rabbitmq-stream-java-client" target="_blank" rel="noopener noreferrer">Java</a> and <a href="https://github.com/rabbitmq/rabbitmq-stream-go-client" target="_blank" rel="noopener noreferrer">Go</a> clients implement such a workaround</li>
</ul></div><footer class="docusaurus-mt-lg"><div class="row margin-top--sm theme-blog-footer-edit-meta-row"><div class="col"><b>Tags:</b><ul class="tags_jXut padding--none margin-left--sm"><li class="tag_QGVx"><a class="tag_zVej tagRegular_sFm0" href="/rabbitmq-website/blog/tags/streams">Streams</a></li><li class="tag_QGVx"><a class="tag_zVej tagRegular_sFm0" href="/rabbitmq-website/blog/tags/programming-languages">Programming Languages</a></li><li class="tag_QGVx"><a class="tag_zVej tagRegular_sFm0" href="/rabbitmq-website/blog/tags/new-features">New Features</a></li></ul></div></div><div class="row margin-top--sm theme-blog-footer-edit-meta-row"><div class="col"><a href="https://github.com/rabbitmq/rabbitmq-website/tree/main/blog/2021-07-23-connecting-to-streams/index.md" target="_blank" rel="noopener noreferrer" class="theme-edit-this-page"><svg fill="currentColor" height="20" width="20" viewBox="0 0 40 40" class="iconEdit_Z9Sw" aria-hidden="true"><g><path d="m34.5 11.7l-3 3.1-6.3-6.3 3.1-3q0.5-0.5 1.2-0.5t1.1 0.5l3.9 3.9q0.5 0.4 0.5 1.1t-0.5 1.2z m-29.5 17.1l18.4-18.5 6.3 6.3-18.4 18.4h-6.3v-6.2z"></path></g></svg>Edit this page</a></div><div class="col lastUpdated_JAkA"></div></div></footer></article><nav class="pagination-nav docusaurus-mt-lg" aria-label="Blog post page navigation"><a class="pagination-nav__link pagination-nav__link--prev" href="/rabbitmq-website/blog/2021/07/28/rabbitmq-streams-message-deduplication"><div class="pagination-nav__sublabel">Newer post</div><div class="pagination-nav__label">Message Deduplication with RabbitMQ Streams</div></a><a class="pagination-nav__link pagination-nav__link--next" href="/rabbitmq-website/blog/2021/07/19/rabbitmq-streams-first-application"><div class="pagination-nav__sublabel">Older post</div><div class="pagination-nav__label">First Application With RabbitMQ Streams</div></a></nav></main><div class="col col--2"><div class="tableOfContents_bqdL thin-scrollbar"><ul class="table-of-contents table-of-contents__left-border"><li><a href="#topology-of-a-stream" class="table-of-contents__link toc-highlight">Topology of a Stream</a></li><li><a href="#well-behaved-clients" class="table-of-contents__link toc-highlight">Well-behaved Clients</a></li><li><a href="#streams-across-a-cluster" class="table-of-contents__link toc-highlight">Streams Across a Cluster</a></li><li><a href="#the-metadata-command" class="table-of-contents__link toc-highlight">The <code>metadata</code> command</a></li><li><a href="#limitations-of-default-metadata" class="table-of-contents__link toc-highlight">Limitations of Default Metadata</a></li><li><a href="#advertised-host-and-port" class="table-of-contents__link toc-highlight">Advertised Host and Port</a></li><li><a href="#with-a-load-balancer" class="table-of-contents__link toc-highlight">With a Load Balancer</a></li><li><a href="#client-workaround-with-a-load-balancer" class="table-of-contents__link toc-highlight">Client Workaround With a Load Balancer</a></li><li><a href="#using-the-stream-java-client-with-a-load-balancer" class="table-of-contents__link toc-highlight">Using the Stream Java Client With a Load Balancer</a></li><li><a href="#wrapping-up" class="table-of-contents__link toc-highlight">Wrapping Up</a></li></ul></div></div></div></div></div><footer class="footer footer--dark"><div class="container container-fluid"><div class="row footer__links"><div class="col footer__col"><div class="footer__title">Learn about RabbitMQ</div><ul class="footer__items clean-list"><li class="footer__item"><a class="footer__link-item" href="/rabbitmq-website/tutorials">Getting Started</a></li><li class="footer__item"><a class="footer__link-item" href="/rabbitmq-website/docs">Documentation</a></li><li class="footer__item"><a class="footer__link-item" href="/rabbitmq-website/blog">Blog</a></li></ul></div><div class="col footer__col"><div class="footer__title">Reach out to the RabbitMQ team</div><ul class="footer__items clean-list"><li class="footer__item"><a href="https://github.com/rabbitmq" target="_blank" rel="noopener noreferrer" class="footer__link-item">GitHub<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_nPIU"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a></li><li class="footer__item"><a href="https://github.com/rabbitmq/rabbitmq-server/discussions" target="_blank" rel="noopener noreferrer" class="footer__link-item">GitHub Discussions<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_nPIU"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a></li><li class="footer__item"><a class="footer__link-item" href="/rabbitmq-website/contact?utm_source=rmq_release-information_tableheader&amp;utm_medium=rmq_website&amp;utm_campaign=tanzu">Long Term Commercial Support</a></li><li class="footer__item"><a class="footer__link-item" href="/rabbitmq-website/contact">Contact Us</a></li><li class="footer__item"><a href="https://www.rabbitmq.com/discord" target="_blank" rel="noopener noreferrer" class="footer__link-item">Discord<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_nPIU"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a></li></ul></div><div class="col footer__col"><div class="footer__title">Broadcom</div><ul class="footer__items clean-list"><li class="footer__item"><a href="https://tanzu.vmware.com/" target="_blank" rel="noopener noreferrer" class="footer__link-item">VMware Tanzu<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_nPIU"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a></li><li class="footer__item"><a href="https://www.vmware.com/help/legal.html" target="_blank" rel="noopener noreferrer" class="footer__link-item">Terms of Use<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_nPIU"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a></li><li class="footer__item"><a href="https://www.vmware.com/help/privacy.html" target="_blank" rel="noopener noreferrer" class="footer__link-item">Privacy<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_nPIU"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a></li><li class="footer__item"><a class="footer__link-item" href="/rabbitmq-website/trademark-guidelines">Trademark Guidelines</a></li><li class="footer__item"><a href="https://www.vmware.com/help/privacy/california-privacy-rights.html" target="_blank" rel="noopener noreferrer" class="footer__link-item">Your California Privacy Rights<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_nPIU"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a></li><li class="footer__item"><a class="footer__link-item ot-sdk-show-settings">Cookie Settings</a></li></ul></div></div><div class="footer__bottom text--center"><div class="footer__copyright">Copyright © 2005-2025 Broadcom. All Rights Reserved. The term "Broadcom" refers to Broadcom Inc. and/or its subsidiaries.</div></div></div></footer></div>
</body>
</html>
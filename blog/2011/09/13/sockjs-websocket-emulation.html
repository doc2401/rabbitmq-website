<!doctype html>
<html lang="en" dir="ltr" class="blog-wrapper blog-post-page plugin-blog plugin-id-default" data-has-hydrated="false">
<head>
<meta charset="UTF-8">
<meta name="generator" content="Docusaurus v3.7.0">
<title data-rh="true">SockJS - WebSocket emulation | RabbitMQ</title><meta data-rh="true" name="viewport" content="width=device-width,initial-scale=1"><meta data-rh="true" name="twitter:card" content="summary_large_image"><meta data-rh="true" property="og:image" content="https://www.rabbitmq.com/rabbitmq-website/img/rabbitmq-social-media-card.svg"><meta data-rh="true" name="twitter:image" content="https://www.rabbitmq.com/rabbitmq-website/img/rabbitmq-social-media-card.svg"><meta data-rh="true" property="og:url" content="https://www.rabbitmq.com/rabbitmq-website/blog/2011/09/13/sockjs-websocket-emulation"><meta data-rh="true" property="og:locale" content="en"><meta data-rh="true" name="docusaurus_locale" content="en"><meta data-rh="true" name="docusaurus_tag" content="default"><meta data-rh="true" name="docsearch:language" content="en"><meta data-rh="true" name="docsearch:docusaurus_tag" content="default"><meta data-rh="true" property="og:title" content="SockJS - WebSocket emulation | RabbitMQ"><meta data-rh="true" name="description" content="WebSocket technology is catching up, but it will take a while before"><meta data-rh="true" property="og:description" content="WebSocket technology is catching up, but it will take a while before"><meta data-rh="true" property="og:type" content="article"><meta data-rh="true" property="article:published_time" content="2011-09-13T00:00:00.000Z"><meta data-rh="true" property="article:tag" content="Web Messaging"><link data-rh="true" rel="icon" href="/rabbitmq-website/img/rabbitmq-logo.svg"><link data-rh="true" rel="canonical" href="https://www.rabbitmq.com/rabbitmq-website/blog/2011/09/13/sockjs-websocket-emulation"><link data-rh="true" rel="alternate" href="https://www.rabbitmq.com/rabbitmq-website/blog/2011/09/13/sockjs-websocket-emulation" hreflang="en"><link data-rh="true" rel="alternate" href="https://www.rabbitmq.com/rabbitmq-website/blog/2011/09/13/sockjs-websocket-emulation" hreflang="x-default"><link data-rh="true" rel="preconnect" href="https://H10VQIW16Y-dsn.algolia.net" crossorigin="anonymous"><script data-rh="true" type="application/ld+json">{"@context":"https://schema.org","@type":"BlogPosting","@id":"https://www.rabbitmq.com/rabbitmq-website/blog/2011/09/13/sockjs-websocket-emulation","mainEntityOfPage":"https://www.rabbitmq.com/rabbitmq-website/blog/2011/09/13/sockjs-websocket-emulation","url":"https://www.rabbitmq.com/rabbitmq-website/blog/2011/09/13/sockjs-websocket-emulation","headline":"SockJS - WebSocket emulation","name":"SockJS - WebSocket emulation","description":"WebSocket technology is catching up, but it will take a while before","datePublished":"2011-09-13T00:00:00.000Z","author":{"@type":"Person","name":"Marek Majkowski"},"keywords":[],"isPartOf":{"@type":"Blog","@id":"https://www.rabbitmq.com/rabbitmq-website/blog","name":"Blog"}}</script><link rel="alternate" type="application/rss+xml" href="/rabbitmq-website/blog/rss.xml" title="RabbitMQ RSS Feed">
<link rel="alternate" type="application/atom+xml" href="/rabbitmq-website/blog/atom.xml" title="RabbitMQ Atom Feed">




<link rel="search" type="application/opensearchdescription+xml" title="RabbitMQ" href="/rabbitmq-website/opensearch.xml">







<link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Raleway:400,700">
<script src="https://cdn.cookielaw.org/scripttemplates/otSDKStub.js" data-domain-script="018ee308-473e-754f-b0c2-cbe82d25512f"></script>
<script>function OptanonWrapper(){}</script>
<script>function setGTM(e,t,o,n,r){e[n]=e[n]||[],e[n].push({"gtm.start":(new Date).getTime(),event:"gtm.js"});var i=t.getElementsByTagName(o)[0],a=t.createElement(o),s="dataLayer"!=n?"&l="+n:"";a.async=!0,a.src="https://www.googletagmanager.com/gtm.js?id="+r+s,i.parentNode.insertBefore(a,i)}var timer;function waitForOnetrustActiveGroups(){document.cookie.indexOf("OptanonConsent")>-1&&document.cookie.indexOf("groups=")>-1?(clearTimeout(timer),setGTM(window,document,"script","dataLayer","GTM-TT84L8K")):timer=setTimeout(waitForOnetrustActiveGroups,250)}document.cookie.indexOf("OptanonConsent")>-1&&document.cookie.indexOf("groups=")>-1?setGTM(window,document,"script","dataLayer","GTM-TT84L8K"):waitForOnetrustActiveGroups()</script><link rel="stylesheet" href="/rabbitmq-website/styles.css">
<script src="/rabbitmq-website/runtime~main.js" defer="defer"></script>
<script src="/rabbitmq-website/main.js" defer="defer"></script>
</head>
<body class="navigation-with-keyboard">
<script>!function(){function t(t){document.documentElement.setAttribute("data-theme",t)}var e=function(){try{return new URLSearchParams(window.location.search).get("docusaurus-theme")}catch(t){}}()||function(){try{return window.localStorage.getItem("theme")}catch(t){}}();null!==e?t(e):window.matchMedia("(prefers-color-scheme: dark)").matches?t("dark"):(window.matchMedia("(prefers-color-scheme: light)").matches,t("light"))}(),function(){try{const n=new URLSearchParams(window.location.search).entries();for(var[t,e]of n)if(t.startsWith("docusaurus-data-")){var a=t.replace("docusaurus-data-","data-");document.documentElement.setAttribute(a,e)}}catch(t){}}(),document.documentElement.setAttribute("data-announcement-bar-initially-dismissed",function(){try{return"true"===localStorage.getItem("docusaurus.announcement.dismiss")}catch(t){}return!1}())</script><div id="__docusaurus"><div role="region" aria-label="Skip to main content"><a class="skipToContent_fXgn" href="#__docusaurus_skipToContent_fallback">Skip to main content</a></div><div class="announcementBar_mb4j" style="background-color:var(--ifm-color-primary-contrast-background);color:var(--ifm-font-color-base)" role="banner"><div class="announcementBarPlaceholder_vyr4"></div><div class="content_knG7 announcementBarContent_xLdY"><strong style="font-size: var(--ifm-h4-font-size);"><a href="https://github.com/rabbitmq/rabbitmq-server/releases/tag/v4.1.0">RabbitMQ 4.1.0 is out</a></strong></div><button type="button" aria-label="Close" class="clean-btn close closeButton_CVFx announcementBarClose_gvF7"><svg viewBox="0 0 15 15" width="14" height="14"><g stroke="currentColor" stroke-width="3.1"><path d="M.75.75l13.5 13.5M14.25.75L.75 14.25"></path></g></svg></button></div><nav aria-label="Main" class="navbar navbar--fixed-top"><div class="navbar__inner"><div class="navbar__items"><button aria-label="Toggle navigation bar" aria-expanded="false" class="navbar__toggle clean-btn" type="button"><svg width="30" height="30" viewBox="0 0 30 30" aria-hidden="true"><path stroke="currentColor" stroke-linecap="round" stroke-miterlimit="10" stroke-width="2" d="M4 7h22M4 15h22M4 23h22"></path></svg></button><a class="navbar__brand" href="/rabbitmq-website/"><div class="navbar__logo"><img src="/rabbitmq-website/img/rabbitmq-logo-with-name.svg" alt="RabbitMQ" class="themedComponent_mlkZ themedComponent--light_NVdE"><img src="/rabbitmq-website/img/rabbitmq-logo-with-name.svg" alt="RabbitMQ" class="themedComponent_mlkZ themedComponent--dark_xIcU"></div></a><a class="navbar__item navbar__link" href="/rabbitmq-website/tutorials">Getting Started</a><a class="navbar__item navbar__link" href="/rabbitmq-website/docs">Docs</a><a aria-current="page" class="navbar__item navbar__link navbar__link--active" href="/rabbitmq-website/blog">Blog</a><a class="navbar__item navbar__link" href="/rabbitmq-website/contact">Support</a></div><div class="navbar__items navbar__items--right"><div class="navbar__item dropdown dropdown--hoverable dropdown--right"><a class="navbar__link" aria-haspopup="true" aria-expanded="false" role="button" href="/rabbitmq-website/docs">4.1</a><ul class="dropdown__menu"><li class=""><strong>Release series</strong></li><li><a class="dropdown__link" href="/rabbitmq-website/docs/next">Next</a></li><li><a class="dropdown__link" href="/rabbitmq-website/docs">4.1</a></li><li><a class="dropdown__link" href="/rabbitmq-website/docs/4.0">4.0</a></li><li><a class="dropdown__link" href="/rabbitmq-website/docs/3.13">3.13</a></li><li><a href="https://v3-12.rabbitmq.com/documentation.html" target="_blank" rel="noopener noreferrer" class="dropdown__link">3.12<svg width="12" height="12" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_nPIU"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a></li><li><a class="dropdown__link" href="/rabbitmq-website/release-information">Release Information</a></li></ul></div><a href="https://github.com/rabbitmq/rabbitmq-website" target="_blank" rel="noopener noreferrer" class="navbar__item navbar__link">GitHub<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_nPIU"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a><div class="toggle_vylO colorModeToggle_DEke"><button class="clean-btn toggleButton_gllP toggleButtonDisabled_aARS" type="button" disabled="" title="Switch between dark and light mode (currently light mode)" aria-label="Switch between dark and light mode (currently light mode)" aria-live="polite" aria-pressed="false"><svg viewBox="0 0 24 24" width="24" height="24" class="lightToggleIcon_pyhR"><path fill="currentColor" d="M12,9c1.65,0,3,1.35,3,3s-1.35,3-3,3s-3-1.35-3-3S10.35,9,12,9 M12,7c-2.76,0-5,2.24-5,5s2.24,5,5,5s5-2.24,5-5 S14.76,7,12,7L12,7z M2,13l2,0c0.55,0,1-0.45,1-1s-0.45-1-1-1l-2,0c-0.55,0-1,0.45-1,1S1.45,13,2,13z M20,13l2,0c0.55,0,1-0.45,1-1 s-0.45-1-1-1l-2,0c-0.55,0-1,0.45-1,1S19.45,13,20,13z M11,2v2c0,0.55,0.45,1,1,1s1-0.45,1-1V2c0-0.55-0.45-1-1-1S11,1.45,11,2z M11,20v2c0,0.55,0.45,1,1,1s1-0.45,1-1v-2c0-0.55-0.45-1-1-1C11.45,19,11,19.45,11,20z M5.99,4.58c-0.39-0.39-1.03-0.39-1.41,0 c-0.39,0.39-0.39,1.03,0,1.41l1.06,1.06c0.39,0.39,1.03,0.39,1.41,0s0.39-1.03,0-1.41L5.99,4.58z M18.36,16.95 c-0.39-0.39-1.03-0.39-1.41,0c-0.39,0.39-0.39,1.03,0,1.41l1.06,1.06c0.39,0.39,1.03,0.39,1.41,0c0.39-0.39,0.39-1.03,0-1.41 L18.36,16.95z M19.42,5.99c0.39-0.39,0.39-1.03,0-1.41c-0.39-0.39-1.03-0.39-1.41,0l-1.06,1.06c-0.39,0.39-0.39,1.03,0,1.41 s1.03,0.39,1.41,0L19.42,5.99z M7.05,18.36c0.39-0.39,0.39-1.03,0-1.41c-0.39-0.39-1.03-0.39-1.41,0l-1.06,1.06 c-0.39,0.39-0.39,1.03,0,1.41s1.03,0.39,1.41,0L7.05,18.36z"></path></svg><svg viewBox="0 0 24 24" width="24" height="24" class="darkToggleIcon_wfgR"><path fill="currentColor" d="M9.37,5.51C9.19,6.15,9.1,6.82,9.1,7.5c0,4.08,3.32,7.4,7.4,7.4c0.68,0,1.35-0.09,1.99-0.27C17.45,17.19,14.93,19,12,19 c-3.86,0-7-3.14-7-7C5,9.07,6.81,6.55,9.37,5.51z M12,3c-4.97,0-9,4.03-9,9s4.03,9,9,9s9-4.03,9-9c0-0.46-0.04-0.92-0.1-1.36 c-0.98,1.37-2.58,2.26-4.4,2.26c-2.98,0-5.4-2.42-5.4-5.4c0-1.81,0.89-3.42,2.26-4.4C12.92,3.04,12.46,3,12,3L12,3z"></path></svg></button></div><div class="navbarSearchContainer_Bca1"><button type="button" class="DocSearch DocSearch-Button" aria-label="Search (Command+K)"><span class="DocSearch-Button-Container"><svg width="20" height="20" class="DocSearch-Search-Icon" viewBox="0 0 20 20" aria-hidden="true"><path d="M14.386 14.386l4.0877 4.0877-4.0877-4.0877c-2.9418 2.9419-7.7115 2.9419-10.6533 0-2.9419-2.9418-2.9419-7.7115 0-10.6533 2.9418-2.9419 7.7115-2.9419 10.6533 0 2.9419 2.9418 2.9419 7.7115 0 10.6533z" stroke="currentColor" fill="none" fill-rule="evenodd" stroke-linecap="round" stroke-linejoin="round"></path></svg><span class="DocSearch-Button-Placeholder">Search</span></span><span class="DocSearch-Button-Keys"></span></button></div></div></div><div role="presentation" class="navbar-sidebar__backdrop"></div></nav><div id="__docusaurus_skipToContent_fallback" class="main-wrapper mainWrapper_z2l0"><div class="container margin-vert--lg"><div class="row"><main class="col col--9 col--offset-1"><article class=""><header><h1 class="title_f1Hy">SockJS - WebSocket emulation</h1><div class="container_mt6G margin-vert--md"><time datetime="2011-09-13T00:00:00.000Z">September 13, 2011</time> · <!-- -->7 min read</div><div class="margin-top--md margin-bottom--sm row"><div class="col col--12 authorCol_Hf19"><div class="avatar margin-bottom--sm"><div class="avatar__intro authorDetails_lV9A"><div class="avatar__name"><span class="authorName_yefp">Marek Majkowski</span></div><div class="authorSocials_rSDt"></div></div></div></div></div></header><div id="__blog-post-container" class="markdown"><p>WebSocket technology is catching up, but it will take a while before
all browsers support it.
In the meantime there are loads of projects that aim to substitute for
WebSockets and enable &#x27;realtime&#x27; capabilities for web apps. But all
attempts solve only a part of the general problem, and there isn&#x27;t any
single solution that works, is scalable and doesn&#x27;t require special
deployment tricks.</p>
<p><img decoding="async" loading="lazy" src="data:image/png;base64,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" width="128" height="128" class="img_ev3q"></p>
<p>That&#x27;s why a new project
<a href="https://github.com/sockjs/sockjs-client/wiki/%5BBlog%5D-SockJS:-web-messaging-ain%E2%80%99t-easy" target="_blank" rel="noopener noreferrer">was born</a>:
<a href="https://github.com/sockjs/sockjs-client" target="_blank" rel="noopener noreferrer">SockJS</a> - yet another
WebSocket emulation library, but this time done right.
SockJS has ambitious goals:</p>
<ul>
<li>Simple browser-side and server-side APIs, as close to WebSocket API
as possible.</li>
<li>Well documented scaling and load balancing techniques.</li>
<li>Transports must fully support cross-domain communication.</li>
<li>Transports must fall back gracefully in case of restrictive proxies.</li>
<li>Connection establishment should be fast.</li>
<li>No Flash on the client side, Javascript only.</li>
<li>Client-side Javascript must be reasonably well tested.</li>
<li>Additionally the server side code should be simple, in order to
lower the cost of writing servers for different languages.</li>
</ul>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="simple-apis">Simple APIs<a href="#simple-apis" class="hash-link" aria-label="Direct link to Simple APIs" title="Direct link to Simple APIs">​</a></h2>
<p>It may sound obvious, but the
<a href="http://dev.w3.org/html5/websockets/" target="_blank" rel="noopener noreferrer">WebSocket API</a> is actually quite
good. It&#x27;s an effect of a tremendous effort led by Ian Hickson and
others. It&#x27;s shouldn&#x27;t be forgotten that there were earlier, less
successful attempts to
<a href="http://dev.w3.org/html5/eventsource/" target="_blank" rel="noopener noreferrer">achieve a similar thing</a> -
the WebSockets API wasn&#x27;t developed in the void.</p>
<p>Yet, I haven&#x27;t seen any Javascript library that tries to emulate this
API closely. Early
<a href="https://github.com/learnboost/socket.io" target="_blank" rel="noopener noreferrer">Socket.io</a> attempted that,
but it has evolved quite far away by now.</p>
<p>WebSocket doesn&#x27;t define a server side API, but it&#x27;s easy to come up
with a scheme with similar ideology and abstractions as the client
side.</p>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="deployment-story">Deployment story<a href="#deployment-story" class="hash-link" aria-label="Direct link to Deployment story" title="Direct link to Deployment story">​</a></h2>
<p>SockJS does support cross-domain communication out of the box. You
can, and should, isolate SockJS server and host it on a different
domain than your main web site. There are multiple advantages of this
approach and, frankly speaking, it&#x27;s just the only sane deployment
strategy.</p>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="load-balancing-story">Load balancing story<a href="#load-balancing-story" class="hash-link" aria-label="Direct link to Load balancing story" title="Direct link to Load balancing story">​</a></h2>
<p>Single SockJS server capacity is finite. If you are anticipating that
a single server will not be enough for your needs - take a look at the
scaling scenarios below.</p>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="use-multiple-domains-for-sockjs-servers">Use multiple domains for SockJS servers<a href="#use-multiple-domains-for-sockjs-servers" class="hash-link" aria-label="Direct link to Use multiple domains for SockJS servers" title="Direct link to Use multiple domains for SockJS servers">​</a></h3>
<p>The simplest solution is just to put every SockJS server under a
different domain name, for example <code>sockjs1.example.com</code> and
<code>sockjs2.example.com</code>, and allow clients to pick a server randomly.</p>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="use-a-websocket-capable-load-balancer">Use a WebSocket-capable load balancer<a href="#use-a-websocket-capable-load-balancer" class="hash-link" aria-label="Direct link to Use a WebSocket-capable load balancer" title="Direct link to Use a WebSocket-capable load balancer">​</a></h3>
<p>You can choose to host all the SockJS traffic under one domain and use
a decent WebSocket-capable load balancer to split the traffic. There
is
<a href="https://github.com/sockjs/sockjs-node/blob/master/examples/haproxy.cfg" target="_blank" rel="noopener noreferrer">a sample HAProxy configuration file</a>
which can be a good starting point.</p>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="use-almost-any-load-balancer">Use almost any load balancer<a href="#use-almost-any-load-balancer" class="hash-link" aria-label="Direct link to Use almost any load balancer" title="Direct link to Use almost any load balancer">​</a></h3>
<p>This is not a preferred solution, but it&#x27;s possible to run scalable
SockJS even in environments where the load balancer doesn&#x27;t support
WebSockets. Shared hosting providers are like that - for example
<a href="http://cloudfoundry.com" target="_blank" rel="noopener noreferrer">CloudFoundry</a>. In order to make connection
establishment faster you can disable WebSocket protocol both on the
client and server side.
In such an environment load balancer must forward all requests for a
single SockJS session to a single SockJS server - the load balancer
must support sticky sessions (session affinity) in one of two
variants:</p>
<ul>
<li>Prefix-based sticky sessions. All requests to SockJS are prefixed
with a session id. Good loadbalancers may use that as a clue for
session-affinity algorithms (for example HAProxy can do it).</li>
<li><code>JSESSIONID</code> cookie sticky sessions. By default SockJS server sets
this cookie. Some load balancers understand that cookie and
enable session stickyness (for example this is the case for
CloudFoundry).</li>
</ul>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="robust-transport-protocols">Robust transport protocols<a href="#robust-transport-protocols" class="hash-link" aria-label="Direct link to Robust transport protocols" title="Direct link to Robust transport protocols">​</a></h2>
<p><img decoding="async" loading="lazy" src="/rabbitmq-website/assets/images/sockjs-transport-b2d00c606d22e2a230bd6799f4867cc7.png" width="512" height="350" class="img_ev3q"></p>
<p>Apart from native WebSockets, SockJS comes with the support for few
carefully chosen transport protocols, and all of them support
cross-domain communication.
The basic idea is that there should be a decent streaming and polling
protocol for every browser. The polling ones must work work in
environments with restrictive proxies and support old browsers. There
are three ways every browser can establish connection:</p>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="native-websocket">Native WebSocket<a href="#native-websocket" class="hash-link" aria-label="Direct link to Native WebSocket" title="Direct link to Native WebSocket">​</a></h3>
<p>WebSocket is the fastest and best transport protocol, it supports
cross-domain connections out of the box. Unfortunately it is not yet
widely supported by browsers. Also, some browsers may have problems
with proxies (for example, Firefox WebSocket implementation won&#x27;t work
through the majority of the proxies). It&#x27;s going to take some time
before the browser vendors agree on the protocol and proxy handling.</p>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="streaming-protocol">Streaming protocol<a href="#streaming-protocol" class="hash-link" aria-label="Direct link to Streaming protocol" title="Direct link to Streaming protocol">​</a></h3>
<p>Streaming protocols supported by SockJS are based on http 1.1 chunking - it
allows browser to receive a single http response in many parts.
A great example of streaming protocol is
<a href="http://dev.w3.org/html5/eventsource/" target="_blank" rel="noopener noreferrer">EventSource</a> or streaming over
XHR (ajax). Messages sent from the browser are posted using another
XHR request.</p>
<p>Every browser supports a different set of streaming protocols and they
usually can&#x27;t do cross-domain communication. Fortunately SockJS is
able to work around that limitation by using an Iframe and
communicating with it using an Html5 PostMessage API. This is quite
complex, but fortunately it is supported by the majority of the
browsers (with the exception of IE7).</p>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="polling-transport">Polling transport<a href="#polling-transport" class="hash-link" aria-label="Direct link to Polling transport" title="Direct link to Polling transport">​</a></h3>
<p>SockJS supports few good-old polling protocols for ancient browsers
(including IE7). Unfortunately these techniques are quite slow, but
there is not much that can done about it.</p>
<p>Polling transports can also be used in situations where proxy on the
client side doesn&#x27;t support WebSockets nor http chunking- it is required for the streaming protocols.</p>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="connection-establishment-should-be-fast">Connection establishment should be fast<a href="#connection-establishment-should-be-fast" class="hash-link" aria-label="Direct link to Connection establishment should be fast" title="Direct link to Connection establishment should be fast">​</a></h2>
<p>Opening SockJS connection should be fast, in some deployments it may
be necessary to establish a SockJS connection on every http page the
user visits.</p>
<p>If the browser supports it SockJS first tries to open a native WebSocket
connection. Depending on a network and server setup it may work or
fail. The failure should happen quite fast, unless the client is
behind a badly misbehaving proxy - in such case it can take up to 5
seconds to timeout.</p>
<p>After WebSocket transport is ruled out, SockJS opens XHR request that
intends to check if chunking is supported by the proxy. It&#x27;s not that
unusual to meet proxies that don&#x27;t support http chunking. Running
streaming protocol in such environment will fail with a timeout.
If chunking is working fine, SockJS chooses the best streaming
protocol supported by the browser. In the other case, polling
transports are used.</p>
<p>All that, depending on the browser, can take between 3 or 4 round trip
times from the browser to the server, plus a DNS request. Unless
you&#x27;re behind a broken proxy or live in Antarctica it should be quite
fast.</p>
<p>This is one of the reasons why SockJS avoids using Flash transports -
Flash connection can take
<a href="http://www.adobe.com/devnet/flashplayer/articles/fplayer9_security.html" target="_blank" rel="noopener noreferrer">at least to 3 seconds</a>
if port 843 is blocked.</p>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="client-side-javascript-must-be-reasonably-tested">Client-side Javascript must be reasonably tested<a href="#client-side-javascript-must-be-reasonably-tested" class="hash-link" aria-label="Direct link to Client-side Javascript must be reasonably tested" title="Direct link to Client-side Javascript must be reasonably tested">​</a></h2>
<p>SockJS is quite young and testing is not yet done properly. That said,
we have multiple end-to-end QUnit tests. At the moment are deployed in
few places:</p>
<ul>
<li><a href="http://sockjs.popcnt.org/" target="_blank" rel="noopener noreferrer">http://sockjs.popcnt.org/</a> (hosted in Europe)</li>
<li><a href="http://sockjs.cloudfoundry.com/" target="_blank" rel="noopener noreferrer">http://sockjs.cloudfoundry.com/</a> (CloudFoundry, websockets disabled, loadbalanced)</li>
<li><a href="http://sockjs.cloudfoundry.com/" target="_blank" rel="noopener noreferrer">https://sockjs.cloudfoundry.com/</a> (CloudFoundry SSL, websockets disabled, loadbalanced)</li>
<li><a href="http://sockjs.herokuapp.com/" target="_blank" rel="noopener noreferrer">http://sockjs.herokuapp.com/</a> (Heroku, websockets disabled)</li>
</ul>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="server-side-code-should-be-simple">Server side code should be simple<a href="#server-side-code-should-be-simple" class="hash-link" aria-label="Direct link to Server side code should be simple" title="Direct link to Server side code should be simple">​</a></h2>
<p>At that point SockJS-node implementation is using about 1200 lines of
code in CoffeeScript. About 340 are used by WebSocket protocol, 220 by
a simple http abstractions and only around 230 are used by core SockJS
logic.</p>
<p>The SockJS protocol used between the browser and the server is already
quite simple and we&#x27;re working on making it even more obvious.</p>
<p>We do intend to support at least Node and Erlang servers and we would
be pleased to see Python and Ruby implementations as well. SockJS is
intended to be polyglot.</p>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="summary">Summary<a href="#summary" class="hash-link" aria-label="Direct link to Summary" title="Direct link to Summary">​</a></h2>
<p>SockJS is quite young and there is loads of work remaining to be done,
but we believe it is stable enough for real applications. If you&#x27;re
planning on doing realtime web apps, give it a try!
(Article also published on <a href="https://github.com/sockjs/sockjs-client/wiki/%5BArticle%5D-SockJS:-WebSocket-emulation-done-right" target="_blank" rel="noopener noreferrer">github pages</a>)</p></div><footer class="docusaurus-mt-lg"><div class="row margin-top--sm theme-blog-footer-edit-meta-row"><div class="col"><b>Tags:</b><ul class="tags_jXut padding--none margin-left--sm"><li class="tag_QGVx"><a class="tag_zVej tagRegular_sFm0" href="/rabbitmq-website/blog/tags/web-messaging">Web Messaging</a></li></ul></div></div><div class="row margin-top--sm theme-blog-footer-edit-meta-row"><div class="col"><a href="https://github.com/rabbitmq/rabbitmq-website/tree/main/blog/2011-09-13-sockjs-websocket-emulation/index.md" target="_blank" rel="noopener noreferrer" class="theme-edit-this-page"><svg fill="currentColor" height="20" width="20" viewBox="0 0 40 40" class="iconEdit_Z9Sw" aria-hidden="true"><g><path d="m34.5 11.7l-3 3.1-6.3-6.3 3.1-3q0.5-0.5 1.2-0.5t1.1 0.5l3.9 3.9q0.5 0.4 0.5 1.1t-0.5 1.2z m-29.5 17.1l18.4-18.5 6.3 6.3-18.4 18.4h-6.3v-6.2z"></path></g></svg>Edit this page</a></div><div class="col lastUpdated_JAkA"></div></div></footer></article><nav class="pagination-nav docusaurus-mt-lg" aria-label="Blog post page navigation"><a class="pagination-nav__link pagination-nav__link--prev" href="/rabbitmq-website/blog/2011/09/16/pubsub-huddle"><div class="pagination-nav__sublabel">Newer post</div><div class="pagination-nav__label">PubSub huddle</div></a><a class="pagination-nav__link pagination-nav__link--next" href="/rabbitmq-website/blog/2011/09/09/rabbitmq-tracing-a-ui-for-the-firehose"><div class="pagination-nav__sublabel">Older post</div><div class="pagination-nav__label">rabbitmq-tracing - a UI for the firehose</div></a></nav></main><div class="col col--2"><div class="tableOfContents_bqdL thin-scrollbar"><ul class="table-of-contents table-of-contents__left-border"><li><a href="#simple-apis" class="table-of-contents__link toc-highlight">Simple APIs</a></li><li><a href="#deployment-story" class="table-of-contents__link toc-highlight">Deployment story</a></li><li><a href="#load-balancing-story" class="table-of-contents__link toc-highlight">Load balancing story</a><ul><li><a href="#use-multiple-domains-for-sockjs-servers" class="table-of-contents__link toc-highlight">Use multiple domains for SockJS servers</a></li><li><a href="#use-a-websocket-capable-load-balancer" class="table-of-contents__link toc-highlight">Use a WebSocket-capable load balancer</a></li><li><a href="#use-almost-any-load-balancer" class="table-of-contents__link toc-highlight">Use almost any load balancer</a></li></ul></li><li><a href="#robust-transport-protocols" class="table-of-contents__link toc-highlight">Robust transport protocols</a><ul><li><a href="#native-websocket" class="table-of-contents__link toc-highlight">Native WebSocket</a></li><li><a href="#streaming-protocol" class="table-of-contents__link toc-highlight">Streaming protocol</a></li><li><a href="#polling-transport" class="table-of-contents__link toc-highlight">Polling transport</a></li></ul></li><li><a href="#connection-establishment-should-be-fast" class="table-of-contents__link toc-highlight">Connection establishment should be fast</a></li><li><a href="#client-side-javascript-must-be-reasonably-tested" class="table-of-contents__link toc-highlight">Client-side Javascript must be reasonably tested</a></li><li><a href="#server-side-code-should-be-simple" class="table-of-contents__link toc-highlight">Server side code should be simple</a></li><li><a href="#summary" class="table-of-contents__link toc-highlight">Summary</a></li></ul></div></div></div></div></div><footer class="footer footer--dark"><div class="container container-fluid"><div class="row footer__links"><div class="col footer__col"><div class="footer__title">Learn about RabbitMQ</div><ul class="footer__items clean-list"><li class="footer__item"><a class="footer__link-item" href="/rabbitmq-website/tutorials">Getting Started</a></li><li class="footer__item"><a class="footer__link-item" href="/rabbitmq-website/docs">Documentation</a></li><li class="footer__item"><a class="footer__link-item" href="/rabbitmq-website/blog">Blog</a></li></ul></div><div class="col footer__col"><div class="footer__title">Reach out to the RabbitMQ team</div><ul class="footer__items clean-list"><li class="footer__item"><a href="https://github.com/rabbitmq" target="_blank" rel="noopener noreferrer" class="footer__link-item">GitHub<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_nPIU"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a></li><li class="footer__item"><a href="https://github.com/rabbitmq/rabbitmq-server/discussions" target="_blank" rel="noopener noreferrer" class="footer__link-item">GitHub Discussions<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_nPIU"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a></li><li class="footer__item"><a class="footer__link-item" href="/rabbitmq-website/contact?utm_source=rmq_release-information_tableheader&amp;utm_medium=rmq_website&amp;utm_campaign=tanzu">Long Term Commercial Support</a></li><li class="footer__item"><a class="footer__link-item" href="/rabbitmq-website/contact">Contact Us</a></li><li class="footer__item"><a href="https://www.rabbitmq.com/discord" target="_blank" rel="noopener noreferrer" class="footer__link-item">Discord<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_nPIU"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a></li></ul></div><div class="col footer__col"><div class="footer__title">Broadcom</div><ul class="footer__items clean-list"><li class="footer__item"><a href="https://tanzu.vmware.com/" target="_blank" rel="noopener noreferrer" class="footer__link-item">VMware Tanzu<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_nPIU"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a></li><li class="footer__item"><a href="https://www.vmware.com/help/legal.html" target="_blank" rel="noopener noreferrer" class="footer__link-item">Terms of Use<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_nPIU"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a></li><li class="footer__item"><a href="https://www.vmware.com/help/privacy.html" target="_blank" rel="noopener noreferrer" class="footer__link-item">Privacy<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_nPIU"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a></li><li class="footer__item"><a class="footer__link-item" href="/rabbitmq-website/trademark-guidelines">Trademark Guidelines</a></li><li class="footer__item"><a href="https://www.vmware.com/help/privacy/california-privacy-rights.html" target="_blank" rel="noopener noreferrer" class="footer__link-item">Your California Privacy Rights<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_nPIU"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a></li><li class="footer__item"><a class="footer__link-item ot-sdk-show-settings">Cookie Settings</a></li></ul></div></div><div class="footer__bottom text--center"><div class="footer__copyright">Copyright © 2005-2025 Broadcom. All Rights Reserved. The term "Broadcom" refers to Broadcom Inc. and/or its subsidiaries.</div></div></div></footer></div>
</body>
</html>
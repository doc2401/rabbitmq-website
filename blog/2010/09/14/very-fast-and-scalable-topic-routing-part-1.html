<!doctype html>
<html lang="en" dir="ltr" class="blog-wrapper blog-post-page plugin-blog plugin-id-default" data-has-hydrated="false">
<head>
<meta charset="UTF-8">
<meta name="generator" content="Docusaurus v3.7.0">
<title data-rh="true">Very fast and scalable topic routing - part 1 | RabbitMQ</title><meta data-rh="true" name="viewport" content="width=device-width,initial-scale=1"><meta data-rh="true" name="twitter:card" content="summary_large_image"><meta data-rh="true" property="og:image" content="https://www.rabbitmq.com/rabbitmq-website/img/rabbitmq-social-media-card.svg"><meta data-rh="true" name="twitter:image" content="https://www.rabbitmq.com/rabbitmq-website/img/rabbitmq-social-media-card.svg"><meta data-rh="true" property="og:url" content="https://www.rabbitmq.com/rabbitmq-website/blog/2010/09/14/very-fast-and-scalable-topic-routing-part-1"><meta data-rh="true" property="og:locale" content="en"><meta data-rh="true" name="docusaurus_locale" content="en"><meta data-rh="true" name="docusaurus_tag" content="default"><meta data-rh="true" name="docsearch:language" content="en"><meta data-rh="true" name="docsearch:docusaurus_tag" content="default"><meta data-rh="true" property="og:title" content="Very fast and scalable topic routing - part 1 | RabbitMQ"><meta data-rh="true" name="description" content="Among other things, lately we have been preoccupied with improving RabbitMQ&#x27;s routing performance. In particular we have looked into speeding up topic exchanges by using a few well-known algorithms as well as some other tricks. We were able to reach solutions many times faster than our current implementation."><meta data-rh="true" property="og:description" content="Among other things, lately we have been preoccupied with improving RabbitMQ&#x27;s routing performance. In particular we have looked into speeding up topic exchanges by using a few well-known algorithms as well as some other tricks. We were able to reach solutions many times faster than our current implementation."><meta data-rh="true" property="og:type" content="article"><meta data-rh="true" property="article:published_time" content="2010-09-14T00:00:00.000Z"><link data-rh="true" rel="icon" href="/rabbitmq-website/img/rabbitmq-logo.svg"><link data-rh="true" rel="canonical" href="https://www.rabbitmq.com/rabbitmq-website/blog/2010/09/14/very-fast-and-scalable-topic-routing-part-1"><link data-rh="true" rel="alternate" href="https://www.rabbitmq.com/rabbitmq-website/blog/2010/09/14/very-fast-and-scalable-topic-routing-part-1" hreflang="en"><link data-rh="true" rel="alternate" href="https://www.rabbitmq.com/rabbitmq-website/blog/2010/09/14/very-fast-and-scalable-topic-routing-part-1" hreflang="x-default"><link data-rh="true" rel="preconnect" href="https://H10VQIW16Y-dsn.algolia.net" crossorigin="anonymous"><script data-rh="true" type="application/ld+json">{"@context":"https://schema.org","@type":"BlogPosting","@id":"https://www.rabbitmq.com/rabbitmq-website/blog/2010/09/14/very-fast-and-scalable-topic-routing-part-1","mainEntityOfPage":"https://www.rabbitmq.com/rabbitmq-website/blog/2010/09/14/very-fast-and-scalable-topic-routing-part-1","url":"https://www.rabbitmq.com/rabbitmq-website/blog/2010/09/14/very-fast-and-scalable-topic-routing-part-1","headline":"Very fast and scalable topic routing - part 1","name":"Very fast and scalable topic routing - part 1","description":"Among other things, lately we have been preoccupied with improving RabbitMQ's routing performance. In particular we have looked into speeding up topic exchanges by using a few well-known algorithms as well as some other tricks. We were able to reach solutions many times faster than our current implementation.","datePublished":"2010-09-14T00:00:00.000Z","author":{"@type":"Person","name":"Vlad Alexandru Ionescu"},"keywords":[],"isPartOf":{"@type":"Blog","@id":"https://www.rabbitmq.com/rabbitmq-website/blog","name":"Blog"}}</script><link rel="alternate" type="application/rss+xml" href="/rabbitmq-website/blog/rss.xml" title="RabbitMQ RSS Feed">
<link rel="alternate" type="application/atom+xml" href="/rabbitmq-website/blog/atom.xml" title="RabbitMQ Atom Feed">




<link rel="search" type="application/opensearchdescription+xml" title="RabbitMQ" href="/rabbitmq-website/opensearch.xml">







<link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Raleway:400,700">
<script src="https://cdn.cookielaw.org/scripttemplates/otSDKStub.js" data-domain-script="018ee308-473e-754f-b0c2-cbe82d25512f"></script>
<script>function OptanonWrapper(){}</script>
<script>function setGTM(e,t,o,n,r){e[n]=e[n]||[],e[n].push({"gtm.start":(new Date).getTime(),event:"gtm.js"});var i=t.getElementsByTagName(o)[0],a=t.createElement(o),s="dataLayer"!=n?"&l="+n:"";a.async=!0,a.src="https://www.googletagmanager.com/gtm.js?id="+r+s,i.parentNode.insertBefore(a,i)}var timer;function waitForOnetrustActiveGroups(){document.cookie.indexOf("OptanonConsent")>-1&&document.cookie.indexOf("groups=")>-1?(clearTimeout(timer),setGTM(window,document,"script","dataLayer","GTM-TT84L8K")):timer=setTimeout(waitForOnetrustActiveGroups,250)}document.cookie.indexOf("OptanonConsent")>-1&&document.cookie.indexOf("groups=")>-1?setGTM(window,document,"script","dataLayer","GTM-TT84L8K"):waitForOnetrustActiveGroups()</script><link rel="stylesheet" href="/rabbitmq-website/styles.css">
<script src="/rabbitmq-website/runtime~main.js" defer="defer"></script>
<script src="/rabbitmq-website/main.js" defer="defer"></script>
</head>
<body class="navigation-with-keyboard">
<script>!function(){function t(t){document.documentElement.setAttribute("data-theme",t)}var e=function(){try{return new URLSearchParams(window.location.search).get("docusaurus-theme")}catch(t){}}()||function(){try{return window.localStorage.getItem("theme")}catch(t){}}();null!==e?t(e):window.matchMedia("(prefers-color-scheme: dark)").matches?t("dark"):(window.matchMedia("(prefers-color-scheme: light)").matches,t("light"))}(),function(){try{const n=new URLSearchParams(window.location.search).entries();for(var[t,e]of n)if(t.startsWith("docusaurus-data-")){var a=t.replace("docusaurus-data-","data-");document.documentElement.setAttribute(a,e)}}catch(t){}}(),document.documentElement.setAttribute("data-announcement-bar-initially-dismissed",function(){try{return"true"===localStorage.getItem("docusaurus.announcement.dismiss")}catch(t){}return!1}())</script><div id="__docusaurus"><div role="region" aria-label="Skip to main content"><a class="skipToContent_fXgn" href="#__docusaurus_skipToContent_fallback">Skip to main content</a></div><div class="announcementBar_mb4j" style="background-color:var(--ifm-color-primary-contrast-background);color:var(--ifm-font-color-base)" role="banner"><div class="announcementBarPlaceholder_vyr4"></div><div class="content_knG7 announcementBarContent_xLdY"><strong style="font-size: var(--ifm-h4-font-size);"><a href="https://github.com/rabbitmq/rabbitmq-server/releases/tag/v4.1.0">RabbitMQ 4.1.0 is out</a></strong></div><button type="button" aria-label="Close" class="clean-btn close closeButton_CVFx announcementBarClose_gvF7"><svg viewBox="0 0 15 15" width="14" height="14"><g stroke="currentColor" stroke-width="3.1"><path d="M.75.75l13.5 13.5M14.25.75L.75 14.25"></path></g></svg></button></div><nav aria-label="Main" class="navbar navbar--fixed-top"><div class="navbar__inner"><div class="navbar__items"><button aria-label="Toggle navigation bar" aria-expanded="false" class="navbar__toggle clean-btn" type="button"><svg width="30" height="30" viewBox="0 0 30 30" aria-hidden="true"><path stroke="currentColor" stroke-linecap="round" stroke-miterlimit="10" stroke-width="2" d="M4 7h22M4 15h22M4 23h22"></path></svg></button><a class="navbar__brand" href="/rabbitmq-website/"><div class="navbar__logo"><img src="/rabbitmq-website/img/rabbitmq-logo-with-name.svg" alt="RabbitMQ" class="themedComponent_mlkZ themedComponent--light_NVdE"><img src="/rabbitmq-website/img/rabbitmq-logo-with-name.svg" alt="RabbitMQ" class="themedComponent_mlkZ themedComponent--dark_xIcU"></div></a><a class="navbar__item navbar__link" href="/rabbitmq-website/tutorials">Getting Started</a><a class="navbar__item navbar__link" href="/rabbitmq-website/docs">Docs</a><a aria-current="page" class="navbar__item navbar__link navbar__link--active" href="/rabbitmq-website/blog">Blog</a><a class="navbar__item navbar__link" href="/rabbitmq-website/contact">Support</a></div><div class="navbar__items navbar__items--right"><div class="navbar__item dropdown dropdown--hoverable dropdown--right"><a class="navbar__link" aria-haspopup="true" aria-expanded="false" role="button" href="/rabbitmq-website/docs">4.1</a><ul class="dropdown__menu"><li class=""><strong>Release series</strong></li><li><a class="dropdown__link" href="/rabbitmq-website/docs/next">Next</a></li><li><a class="dropdown__link" href="/rabbitmq-website/docs">4.1</a></li><li><a class="dropdown__link" href="/rabbitmq-website/docs/4.0">4.0</a></li><li><a class="dropdown__link" href="/rabbitmq-website/docs/3.13">3.13</a></li><li><a href="https://v3-12.rabbitmq.com/documentation.html" target="_blank" rel="noopener noreferrer" class="dropdown__link">3.12<svg width="12" height="12" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_nPIU"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a></li><li><a class="dropdown__link" href="/rabbitmq-website/release-information">Release Information</a></li></ul></div><a href="https://github.com/rabbitmq/rabbitmq-website" target="_blank" rel="noopener noreferrer" class="navbar__item navbar__link">GitHub<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_nPIU"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a><div class="toggle_vylO colorModeToggle_DEke"><button class="clean-btn toggleButton_gllP toggleButtonDisabled_aARS" type="button" disabled="" title="Switch between dark and light mode (currently light mode)" aria-label="Switch between dark and light mode (currently light mode)" aria-live="polite" aria-pressed="false"><svg viewBox="0 0 24 24" width="24" height="24" class="lightToggleIcon_pyhR"><path fill="currentColor" d="M12,9c1.65,0,3,1.35,3,3s-1.35,3-3,3s-3-1.35-3-3S10.35,9,12,9 M12,7c-2.76,0-5,2.24-5,5s2.24,5,5,5s5-2.24,5-5 S14.76,7,12,7L12,7z M2,13l2,0c0.55,0,1-0.45,1-1s-0.45-1-1-1l-2,0c-0.55,0-1,0.45-1,1S1.45,13,2,13z M20,13l2,0c0.55,0,1-0.45,1-1 s-0.45-1-1-1l-2,0c-0.55,0-1,0.45-1,1S19.45,13,20,13z M11,2v2c0,0.55,0.45,1,1,1s1-0.45,1-1V2c0-0.55-0.45-1-1-1S11,1.45,11,2z M11,20v2c0,0.55,0.45,1,1,1s1-0.45,1-1v-2c0-0.55-0.45-1-1-1C11.45,19,11,19.45,11,20z M5.99,4.58c-0.39-0.39-1.03-0.39-1.41,0 c-0.39,0.39-0.39,1.03,0,1.41l1.06,1.06c0.39,0.39,1.03,0.39,1.41,0s0.39-1.03,0-1.41L5.99,4.58z M18.36,16.95 c-0.39-0.39-1.03-0.39-1.41,0c-0.39,0.39-0.39,1.03,0,1.41l1.06,1.06c0.39,0.39,1.03,0.39,1.41,0c0.39-0.39,0.39-1.03,0-1.41 L18.36,16.95z M19.42,5.99c0.39-0.39,0.39-1.03,0-1.41c-0.39-0.39-1.03-0.39-1.41,0l-1.06,1.06c-0.39,0.39-0.39,1.03,0,1.41 s1.03,0.39,1.41,0L19.42,5.99z M7.05,18.36c0.39-0.39,0.39-1.03,0-1.41c-0.39-0.39-1.03-0.39-1.41,0l-1.06,1.06 c-0.39,0.39-0.39,1.03,0,1.41s1.03,0.39,1.41,0L7.05,18.36z"></path></svg><svg viewBox="0 0 24 24" width="24" height="24" class="darkToggleIcon_wfgR"><path fill="currentColor" d="M9.37,5.51C9.19,6.15,9.1,6.82,9.1,7.5c0,4.08,3.32,7.4,7.4,7.4c0.68,0,1.35-0.09,1.99-0.27C17.45,17.19,14.93,19,12,19 c-3.86,0-7-3.14-7-7C5,9.07,6.81,6.55,9.37,5.51z M12,3c-4.97,0-9,4.03-9,9s4.03,9,9,9s9-4.03,9-9c0-0.46-0.04-0.92-0.1-1.36 c-0.98,1.37-2.58,2.26-4.4,2.26c-2.98,0-5.4-2.42-5.4-5.4c0-1.81,0.89-3.42,2.26-4.4C12.92,3.04,12.46,3,12,3L12,3z"></path></svg></button></div><div class="navbarSearchContainer_Bca1"><button type="button" class="DocSearch DocSearch-Button" aria-label="Search (Command+K)"><span class="DocSearch-Button-Container"><svg width="20" height="20" class="DocSearch-Search-Icon" viewBox="0 0 20 20" aria-hidden="true"><path d="M14.386 14.386l4.0877 4.0877-4.0877-4.0877c-2.9418 2.9419-7.7115 2.9419-10.6533 0-2.9419-2.9418-2.9419-7.7115 0-10.6533 2.9418-2.9419 7.7115-2.9419 10.6533 0 2.9419 2.9418 2.9419 7.7115 0 10.6533z" stroke="currentColor" fill="none" fill-rule="evenodd" stroke-linecap="round" stroke-linejoin="round"></path></svg><span class="DocSearch-Button-Placeholder">Search</span></span><span class="DocSearch-Button-Keys"></span></button></div></div></div><div role="presentation" class="navbar-sidebar__backdrop"></div></nav><div id="__docusaurus_skipToContent_fallback" class="main-wrapper mainWrapper_z2l0"><div class="container margin-vert--lg"><div class="row"><main class="col col--9 col--offset-1"><article class=""><header><h1 class="title_f1Hy">Very fast and scalable topic routing - part 1</h1><div class="container_mt6G margin-vert--md"><time datetime="2010-09-14T00:00:00.000Z">September 14, 2010</time> · <!-- -->5 min read</div><div class="margin-top--md margin-bottom--sm row"><div class="col col--12 authorCol_Hf19"><div class="avatar margin-bottom--sm"><div class="avatar__intro authorDetails_lV9A"><div class="avatar__name"><span class="authorName_yefp">Vlad Alexandru Ionescu</span></div><div class="authorSocials_rSDt"></div></div></div></div></div></header><div id="__blog-post-container" class="markdown"><p>Among other things, lately we have been preoccupied with improving RabbitMQ&#x27;s routing performance. In particular we have looked into speeding up topic exchanges by using a few well-known algorithms as well as some other tricks. We were able to reach solutions many times faster than our current implementation.</p>
<p>First, a little about the problem we are trying to solve. Here is a quote from the AMQP 0-9-1 spec:</p>
<p>The topic exchange type works as follows:</p>
<ol>
<li>A message queue binds to the exchange using a routing pattern, P.</li>
<li>A publisher sends the exchange a message with the routing key R.</li>
<li>The message is passed to the message queue if R matches P.</li>
</ol>
<p><em>The routing key used for a topic exchange MUST consist of zero or more words delimited by dots. Each word may contain the letters A-Z and a-z and digits 0-9.</em></p>
<p>*The routing pattern follows the same rules as the routing key with the addition that * matches a single word, and # matches zero or more words. Thus the routing pattern <em>.stock.# matches the routing keys usd.stock and eur.stock.db but not stock.nasdaq.</em>
Our goal is to match messages (routing keys) against bindings (patterns) in a fast and scalable manner.</p>
<p>Here is a list of approaches that we tried out:</p>
<ol>
<li><strong>Caching messages&#x27; topics on a per-word basis</strong>. This is what the AMQP spec suggests and there are some studies on this already.</li>
<li><strong>Indexing patterns on a per-word basis</strong>. This is similar with 1, except we prepare the patterns beforehand, rather than preparing for topic keys that have been previously sent.</li>
<li><strong>Trie implementation</strong>. Arrange the words in the patterns in a trie structure and follow a route down the trie to see if a particular topic matches.</li>
<li><strong>A deterministic finite automate (DFA) implementation</strong>. This is a well-known approach for string matching, in general.</li>
</ol>
<p>Each of these approaches have pros and cons. We generally aimed for:</p>
<ul>
<li>good complexity in both space and time, to make it scalable</li>
<li>ease of implementation</li>
<li>good performance for the commonly used situations</li>
<li>good worst-case performance</li>
<li>making it quick in the simple cases (where scalability in number of bindings is not a concern)</li>
</ul>
<p>From the start, we were able to beat the current implementation by a factor of 3 times (in all cases) just by being more careful when splitting the keys into words (not repeating splitting both the pattern and the topic for each pattern, every time).</p>
<p>We found approaches 1 and 2 to be particularly unfit for the needs. They were the slowest, they do not have a good complexity, because they involve intersecting sets for each level, and they can not be adapted to include functionality for &quot;#&quot;. Thus, we concentrated our attention on approaches 3 and 4.</p>
<p><strong>The trie</strong></p>
<p>Here is an example of a trie structure, if we were to add patterns &quot;a.b.c&quot;, &quot;a.*.b.c&quot;, &quot;a.#.c&quot;, &quot;b.b.c&quot;:</p>
<p><img decoding="async" loading="lazy" src="data:image/png;base64,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" width="242" height="327" class="img_ev3q"></p>
<p>In order to match a pattern (say for example &quot;a.d.d.d.c&quot;), we start at root and follow the topic string down the tree word by word. We can go deeper either through an exact match, a &quot;*&quot; or a &quot;#&quot;. In the case of the &quot;#&quot; we can go deeper with all the versions of the tail of the topic. For our example, we would go through &quot;#&quot; with &quot;d.d.d.c&quot;, &quot;d.d.c&quot;, &quot;d.c&quot;, &quot;c&quot; and &quot;&quot;.</p>
<p>The trie implementation has a number of advantages: good size complexity; adding a new binding is cheap; and it is the easiest to implement; but, also the disadvantage that it backtracks for &quot;*&quot; and &quot;#&quot;, in order to find all possible matches.</p>
<p><strong>The DFA</strong></p>
<p>This approach is based on constructing an NFA that accepts the patterns of the bindings, and from it constructing the equivalent DFA and using it instead. Since we are also interested in which pattern matches and not only if it matches or not, we cannot merge the tails of the patterns in the NFA.</p>
<p>To construct the DFA, we modeled the behaviour of &quot;#&quot; like this:</p>
<p><img decoding="async" loading="lazy" src="data:image/png;base64,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" width="166" height="104" class="img_ev3q"></p>
<p>For example, the patterns &quot;a.b.c&quot;, &quot;a.*.b.c&quot;, &quot;a.#.c&quot;, &quot;b.b.c&quot; would be represented in an NFA like this:</p>
<p><img decoding="async" loading="lazy" src="/rabbitmq-website/assets/images/nfa-example-7183080b3e67a391cf2029c86aada801.png" width="438" height="312" class="img_ev3q"></p>
<p>The nodes 11, 4, 6 and 8 would have information attached to them which would point to the respective bindings.</p>
<p>In order to convert the NFA to a DFA, we tried various approaches and went as far as generating source code for the structures behind the graphs, to make it as fast as possible. The best solution we ended up with was building the DFA on the fly, the same way it is built in good regular expressions compilers (see for example <a href="http://swtch.com/~rsc/regexp/regexp3.html" target="_blank" rel="noopener noreferrer">this article</a>).</p>
<p>The advantage of the DFA approach is that there is no need to backtrack, once the DFA has been built. On the other hand, there are quite a number of disadvantages: it occupies significantly more memory than the trie; there is a significant cost for adding new bindings, since the entire DFA has to be dropped and rebuilt; and it is more complex and therefore harder to implement and maintain.</p>
<p>In the following articles we will present more details about the two structures, how they performed in benchmarks, their space and time complexities and the details behind the DFA optimizations that we have tried.</p>
<p>To be continued.</p></div><footer class="docusaurus-mt-lg"><div class="row margin-top--sm theme-blog-footer-edit-meta-row"><div class="col"><a href="https://github.com/rabbitmq/rabbitmq-website/tree/main/blog/2010-09-14-very-fast-and-scalable-topic-routing-part-1/index.md" target="_blank" rel="noopener noreferrer" class="theme-edit-this-page"><svg fill="currentColor" height="20" width="20" viewBox="0 0 40 40" class="iconEdit_Z9Sw" aria-hidden="true"><g><path d="m34.5 11.7l-3 3.1-6.3-6.3 3.1-3q0.5-0.5 1.2-0.5t1.1 0.5l3.9 3.9q0.5 0.4 0.5 1.1t-0.5 1.2z m-29.5 17.1l18.4-18.5 6.3 6.3-18.4 18.4h-6.3v-6.2z"></path></g></svg>Edit this page</a></div><div class="col lastUpdated_JAkA"></div></div></footer></article><nav class="pagination-nav docusaurus-mt-lg" aria-label="Blog post page navigation"><a class="pagination-nav__link pagination-nav__link--prev" href="/rabbitmq-website/blog/2010/09/20/rabbitmq-on-github"><div class="pagination-nav__sublabel">Newer post</div><div class="pagination-nav__label">RabbitMQ on github</div></a><a class="pagination-nav__link pagination-nav__link--next" href="/rabbitmq-website/blog/2010/09/07/management-plugin-preview-release"><div class="pagination-nav__sublabel">Older post</div><div class="pagination-nav__label">Management plugin - preview release</div></a></nav></main></div></div></div><footer class="footer footer--dark"><div class="container container-fluid"><div class="row footer__links"><div class="col footer__col"><div class="footer__title">Learn about RabbitMQ</div><ul class="footer__items clean-list"><li class="footer__item"><a class="footer__link-item" href="/rabbitmq-website/tutorials">Getting Started</a></li><li class="footer__item"><a class="footer__link-item" href="/rabbitmq-website/docs">Documentation</a></li><li class="footer__item"><a class="footer__link-item" href="/rabbitmq-website/blog">Blog</a></li></ul></div><div class="col footer__col"><div class="footer__title">Reach out to the RabbitMQ team</div><ul class="footer__items clean-list"><li class="footer__item"><a href="https://github.com/rabbitmq" target="_blank" rel="noopener noreferrer" class="footer__link-item">GitHub<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_nPIU"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a></li><li class="footer__item"><a href="https://github.com/rabbitmq/rabbitmq-server/discussions" target="_blank" rel="noopener noreferrer" class="footer__link-item">GitHub Discussions<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_nPIU"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a></li><li class="footer__item"><a class="footer__link-item" href="/rabbitmq-website/contact?utm_source=rmq_release-information_tableheader&amp;utm_medium=rmq_website&amp;utm_campaign=tanzu">Long Term Commercial Support</a></li><li class="footer__item"><a class="footer__link-item" href="/rabbitmq-website/contact">Contact Us</a></li><li class="footer__item"><a href="https://www.rabbitmq.com/discord" target="_blank" rel="noopener noreferrer" class="footer__link-item">Discord<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_nPIU"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a></li></ul></div><div class="col footer__col"><div class="footer__title">Broadcom</div><ul class="footer__items clean-list"><li class="footer__item"><a href="https://tanzu.vmware.com/" target="_blank" rel="noopener noreferrer" class="footer__link-item">VMware Tanzu<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_nPIU"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a></li><li class="footer__item"><a href="https://www.vmware.com/help/legal.html" target="_blank" rel="noopener noreferrer" class="footer__link-item">Terms of Use<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_nPIU"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a></li><li class="footer__item"><a href="https://www.vmware.com/help/privacy.html" target="_blank" rel="noopener noreferrer" class="footer__link-item">Privacy<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_nPIU"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a></li><li class="footer__item"><a class="footer__link-item" href="/rabbitmq-website/trademark-guidelines">Trademark Guidelines</a></li><li class="footer__item"><a href="https://www.vmware.com/help/privacy/california-privacy-rights.html" target="_blank" rel="noopener noreferrer" class="footer__link-item">Your California Privacy Rights<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_nPIU"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a></li><li class="footer__item"><a class="footer__link-item ot-sdk-show-settings">Cookie Settings</a></li></ul></div></div><div class="footer__bottom text--center"><div class="footer__copyright">Copyright © 2005-2025 Broadcom. All Rights Reserved. The term "Broadcom" refers to Broadcom Inc. and/or its subsidiaries.</div></div></div></footer></div>
</body>
</html>
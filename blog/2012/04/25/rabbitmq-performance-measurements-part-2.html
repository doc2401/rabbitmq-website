<!doctype html>
<html lang="en" dir="ltr" class="blog-wrapper blog-post-page plugin-blog plugin-id-default" data-has-hydrated="false">
<head>
<meta charset="UTF-8">
<meta name="generator" content="Docusaurus v3.7.0">
<title data-rh="true">RabbitMQ Performance Measurements, part 2 | RabbitMQ</title><meta data-rh="true" name="viewport" content="width=device-width,initial-scale=1"><meta data-rh="true" name="twitter:card" content="summary_large_image"><meta data-rh="true" property="og:image" content="https://www.rabbitmq.com/rabbitmq-website/img/rabbitmq-social-media-card.svg"><meta data-rh="true" name="twitter:image" content="https://www.rabbitmq.com/rabbitmq-website/img/rabbitmq-social-media-card.svg"><meta data-rh="true" property="og:url" content="https://www.rabbitmq.com/rabbitmq-website/blog/2012/04/25/rabbitmq-performance-measurements-part-2"><meta data-rh="true" property="og:locale" content="en"><meta data-rh="true" name="docusaurus_locale" content="en"><meta data-rh="true" name="docusaurus_tag" content="default"><meta data-rh="true" name="docsearch:language" content="en"><meta data-rh="true" name="docsearch:docusaurus_tag" content="default"><meta data-rh="true" property="og:title" content="RabbitMQ Performance Measurements, part 2 | RabbitMQ"><meta data-rh="true" name="description" content="Welcome back! Last time we talked about flow control and"><meta data-rh="true" property="og:description" content="Welcome back! Last time we talked about flow control and"><meta data-rh="true" property="og:type" content="article"><meta data-rh="true" property="article:published_time" content="2012-04-25T00:00:00.000Z"><meta data-rh="true" property="article:tag" content="Performance"><link data-rh="true" rel="icon" href="/rabbitmq-website/img/rabbitmq-logo.svg"><link data-rh="true" rel="canonical" href="https://www.rabbitmq.com/rabbitmq-website/blog/2012/04/25/rabbitmq-performance-measurements-part-2"><link data-rh="true" rel="alternate" href="https://www.rabbitmq.com/rabbitmq-website/blog/2012/04/25/rabbitmq-performance-measurements-part-2" hreflang="en"><link data-rh="true" rel="alternate" href="https://www.rabbitmq.com/rabbitmq-website/blog/2012/04/25/rabbitmq-performance-measurements-part-2" hreflang="x-default"><link data-rh="true" rel="preconnect" href="https://H10VQIW16Y-dsn.algolia.net" crossorigin="anonymous"><script data-rh="true" type="application/ld+json">{"@context":"https://schema.org","@type":"BlogPosting","@id":"https://www.rabbitmq.com/rabbitmq-website/blog/2012/04/25/rabbitmq-performance-measurements-part-2","mainEntityOfPage":"https://www.rabbitmq.com/rabbitmq-website/blog/2012/04/25/rabbitmq-performance-measurements-part-2","url":"https://www.rabbitmq.com/rabbitmq-website/blog/2012/04/25/rabbitmq-performance-measurements-part-2","headline":"RabbitMQ Performance Measurements, part 2","name":"RabbitMQ Performance Measurements, part 2","description":"Welcome back! Last time we talked about flow control and","datePublished":"2012-04-25T00:00:00.000Z","author":{"@type":"Person","name":"Simon MacMullen"},"keywords":[],"isPartOf":{"@type":"Blog","@id":"https://www.rabbitmq.com/rabbitmq-website/blog","name":"Blog"}}</script><link rel="alternate" type="application/rss+xml" href="/rabbitmq-website/blog/rss.xml" title="RabbitMQ RSS Feed">
<link rel="alternate" type="application/atom+xml" href="/rabbitmq-website/blog/atom.xml" title="RabbitMQ Atom Feed">




<link rel="search" type="application/opensearchdescription+xml" title="RabbitMQ" href="/rabbitmq-website/opensearch.xml">







<link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Raleway:400,700">
<script src="https://cdn.cookielaw.org/scripttemplates/otSDKStub.js" data-domain-script="018ee308-473e-754f-b0c2-cbe82d25512f"></script>
<script>function OptanonWrapper(){}</script>
<script>function setGTM(e,t,o,n,r){e[n]=e[n]||[],e[n].push({"gtm.start":(new Date).getTime(),event:"gtm.js"});var i=t.getElementsByTagName(o)[0],a=t.createElement(o),s="dataLayer"!=n?"&l="+n:"";a.async=!0,a.src="https://www.googletagmanager.com/gtm.js?id="+r+s,i.parentNode.insertBefore(a,i)}var timer;function waitForOnetrustActiveGroups(){document.cookie.indexOf("OptanonConsent")>-1&&document.cookie.indexOf("groups=")>-1?(clearTimeout(timer),setGTM(window,document,"script","dataLayer","GTM-TT84L8K")):timer=setTimeout(waitForOnetrustActiveGroups,250)}document.cookie.indexOf("OptanonConsent")>-1&&document.cookie.indexOf("groups=")>-1?setGTM(window,document,"script","dataLayer","GTM-TT84L8K"):waitForOnetrustActiveGroups()</script><link rel="stylesheet" href="/rabbitmq-website/styles.css">
<script src="/rabbitmq-website/runtime~main.js" defer="defer"></script>
<script src="/rabbitmq-website/main.js" defer="defer"></script>
</head>
<body class="navigation-with-keyboard">
<script>!function(){function t(t){document.documentElement.setAttribute("data-theme",t)}var e=function(){try{return new URLSearchParams(window.location.search).get("docusaurus-theme")}catch(t){}}()||function(){try{return window.localStorage.getItem("theme")}catch(t){}}();null!==e?t(e):window.matchMedia("(prefers-color-scheme: dark)").matches?t("dark"):(window.matchMedia("(prefers-color-scheme: light)").matches,t("light"))}(),function(){try{const n=new URLSearchParams(window.location.search).entries();for(var[t,e]of n)if(t.startsWith("docusaurus-data-")){var a=t.replace("docusaurus-data-","data-");document.documentElement.setAttribute(a,e)}}catch(t){}}(),document.documentElement.setAttribute("data-announcement-bar-initially-dismissed",function(){try{return"true"===localStorage.getItem("docusaurus.announcement.dismiss")}catch(t){}return!1}())</script><div id="__docusaurus"><div role="region" aria-label="Skip to main content"><a class="skipToContent_fXgn" href="#__docusaurus_skipToContent_fallback">Skip to main content</a></div><div class="announcementBar_mb4j" style="background-color:var(--ifm-color-primary-contrast-background);color:var(--ifm-font-color-base)" role="banner"><div class="announcementBarPlaceholder_vyr4"></div><div class="content_knG7 announcementBarContent_xLdY"><strong style="font-size: var(--ifm-h4-font-size);"><a href="https://github.com/rabbitmq/rabbitmq-server/releases/tag/v4.1.0">RabbitMQ 4.1.0 is out</a></strong></div><button type="button" aria-label="Close" class="clean-btn close closeButton_CVFx announcementBarClose_gvF7"><svg viewBox="0 0 15 15" width="14" height="14"><g stroke="currentColor" stroke-width="3.1"><path d="M.75.75l13.5 13.5M14.25.75L.75 14.25"></path></g></svg></button></div><nav aria-label="Main" class="navbar navbar--fixed-top"><div class="navbar__inner"><div class="navbar__items"><button aria-label="Toggle navigation bar" aria-expanded="false" class="navbar__toggle clean-btn" type="button"><svg width="30" height="30" viewBox="0 0 30 30" aria-hidden="true"><path stroke="currentColor" stroke-linecap="round" stroke-miterlimit="10" stroke-width="2" d="M4 7h22M4 15h22M4 23h22"></path></svg></button><a class="navbar__brand" href="/rabbitmq-website/"><div class="navbar__logo"><img src="/rabbitmq-website/img/rabbitmq-logo-with-name.svg" alt="RabbitMQ" class="themedComponent_mlkZ themedComponent--light_NVdE"><img src="/rabbitmq-website/img/rabbitmq-logo-with-name.svg" alt="RabbitMQ" class="themedComponent_mlkZ themedComponent--dark_xIcU"></div></a><a class="navbar__item navbar__link" href="/rabbitmq-website/tutorials">Getting Started</a><a class="navbar__item navbar__link" href="/rabbitmq-website/docs">Docs</a><a aria-current="page" class="navbar__item navbar__link navbar__link--active" href="/rabbitmq-website/blog">Blog</a><a class="navbar__item navbar__link" href="/rabbitmq-website/contact">Support</a></div><div class="navbar__items navbar__items--right"><div class="navbar__item dropdown dropdown--hoverable dropdown--right"><a class="navbar__link" aria-haspopup="true" aria-expanded="false" role="button" href="/rabbitmq-website/docs">4.1</a><ul class="dropdown__menu"><li class=""><strong>Release series</strong></li><li><a class="dropdown__link" href="/rabbitmq-website/docs/next">Next</a></li><li><a class="dropdown__link" href="/rabbitmq-website/docs">4.1</a></li><li><a class="dropdown__link" href="/rabbitmq-website/docs/4.0">4.0</a></li><li><a class="dropdown__link" href="/rabbitmq-website/docs/3.13">3.13</a></li><li><a href="https://v3-12.rabbitmq.com/documentation.html" target="_blank" rel="noopener noreferrer" class="dropdown__link">3.12<svg width="12" height="12" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_nPIU"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a></li><li><a class="dropdown__link" href="/rabbitmq-website/release-information">Release Information</a></li></ul></div><a href="https://github.com/rabbitmq/rabbitmq-website" target="_blank" rel="noopener noreferrer" class="navbar__item navbar__link">GitHub<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_nPIU"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a><div class="toggle_vylO colorModeToggle_DEke"><button class="clean-btn toggleButton_gllP toggleButtonDisabled_aARS" type="button" disabled="" title="Switch between dark and light mode (currently light mode)" aria-label="Switch between dark and light mode (currently light mode)" aria-live="polite" aria-pressed="false"><svg viewBox="0 0 24 24" width="24" height="24" class="lightToggleIcon_pyhR"><path fill="currentColor" d="M12,9c1.65,0,3,1.35,3,3s-1.35,3-3,3s-3-1.35-3-3S10.35,9,12,9 M12,7c-2.76,0-5,2.24-5,5s2.24,5,5,5s5-2.24,5-5 S14.76,7,12,7L12,7z M2,13l2,0c0.55,0,1-0.45,1-1s-0.45-1-1-1l-2,0c-0.55,0-1,0.45-1,1S1.45,13,2,13z M20,13l2,0c0.55,0,1-0.45,1-1 s-0.45-1-1-1l-2,0c-0.55,0-1,0.45-1,1S19.45,13,20,13z M11,2v2c0,0.55,0.45,1,1,1s1-0.45,1-1V2c0-0.55-0.45-1-1-1S11,1.45,11,2z M11,20v2c0,0.55,0.45,1,1,1s1-0.45,1-1v-2c0-0.55-0.45-1-1-1C11.45,19,11,19.45,11,20z M5.99,4.58c-0.39-0.39-1.03-0.39-1.41,0 c-0.39,0.39-0.39,1.03,0,1.41l1.06,1.06c0.39,0.39,1.03,0.39,1.41,0s0.39-1.03,0-1.41L5.99,4.58z M18.36,16.95 c-0.39-0.39-1.03-0.39-1.41,0c-0.39,0.39-0.39,1.03,0,1.41l1.06,1.06c0.39,0.39,1.03,0.39,1.41,0c0.39-0.39,0.39-1.03,0-1.41 L18.36,16.95z M19.42,5.99c0.39-0.39,0.39-1.03,0-1.41c-0.39-0.39-1.03-0.39-1.41,0l-1.06,1.06c-0.39,0.39-0.39,1.03,0,1.41 s1.03,0.39,1.41,0L19.42,5.99z M7.05,18.36c0.39-0.39,0.39-1.03,0-1.41c-0.39-0.39-1.03-0.39-1.41,0l-1.06,1.06 c-0.39,0.39-0.39,1.03,0,1.41s1.03,0.39,1.41,0L7.05,18.36z"></path></svg><svg viewBox="0 0 24 24" width="24" height="24" class="darkToggleIcon_wfgR"><path fill="currentColor" d="M9.37,5.51C9.19,6.15,9.1,6.82,9.1,7.5c0,4.08,3.32,7.4,7.4,7.4c0.68,0,1.35-0.09,1.99-0.27C17.45,17.19,14.93,19,12,19 c-3.86,0-7-3.14-7-7C5,9.07,6.81,6.55,9.37,5.51z M12,3c-4.97,0-9,4.03-9,9s4.03,9,9,9s9-4.03,9-9c0-0.46-0.04-0.92-0.1-1.36 c-0.98,1.37-2.58,2.26-4.4,2.26c-2.98,0-5.4-2.42-5.4-5.4c0-1.81,0.89-3.42,2.26-4.4C12.92,3.04,12.46,3,12,3L12,3z"></path></svg></button></div><div class="navbarSearchContainer_Bca1"><button type="button" class="DocSearch DocSearch-Button" aria-label="Search (Command+K)"><span class="DocSearch-Button-Container"><svg width="20" height="20" class="DocSearch-Search-Icon" viewBox="0 0 20 20" aria-hidden="true"><path d="M14.386 14.386l4.0877 4.0877-4.0877-4.0877c-2.9418 2.9419-7.7115 2.9419-10.6533 0-2.9419-2.9418-2.9419-7.7115 0-10.6533 2.9418-2.9419 7.7115-2.9419 10.6533 0 2.9419 2.9418 2.9419 7.7115 0 10.6533z" stroke="currentColor" fill="none" fill-rule="evenodd" stroke-linecap="round" stroke-linejoin="round"></path></svg><span class="DocSearch-Button-Placeholder">Search</span></span><span class="DocSearch-Button-Keys"></span></button></div></div></div><div role="presentation" class="navbar-sidebar__backdrop"></div></nav><div id="__docusaurus_skipToContent_fallback" class="main-wrapper mainWrapper_z2l0"><div class="container margin-vert--lg"><div class="row"><main class="col col--9 col--offset-1"><article class=""><header><h1 class="title_f1Hy">RabbitMQ Performance Measurements, part 2</h1><div class="container_mt6G margin-vert--md"><time datetime="2012-04-25T00:00:00.000Z">April 25, 2012</time> · <!-- -->7 min read</div><div class="margin-top--md margin-bottom--sm row"><div class="col col--12 authorCol_Hf19"><div class="avatar margin-bottom--sm"><div class="avatar__intro authorDetails_lV9A"><div class="avatar__name"><span class="authorName_yefp">Simon MacMullen</span></div><div class="authorSocials_rSDt"></div></div></div></div></div></header><div id="__blog-post-container" class="markdown"><p>Welcome back! <a href="/rabbitmq-website/blog/2012/04/16/rabbitmq-performance-measurements-part-1">Last time</a> we talked about flow control and
latency; today let&#x27;s talk about how different features affect
the performance we see. Here are some simple scenarios. As
before, they&#x27;re all variations on the theme of one publisher and
one consumer publishing as fast as they can.</p>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="some-simple-scenarios">Some Simple Scenarios<a href="#some-simple-scenarios" class="hash-link" aria-label="Direct link to Some Simple Scenarios" title="Direct link to Some Simple Scenarios">​</a></h2>
<p><img decoding="async" loading="lazy" src="/rabbitmq-website/assets/images/performance-01-53e4b7f8479b6d209098da2993a696b8.png" width="415" height="142" class="img_ev3q"></p>
<p>This first scenario is the simplest - just one producer and
one consumer. So we have a baseline.</p>
<p><img decoding="async" loading="lazy" src="/rabbitmq-website/assets/images/performance-02-482b0e11f1d846aea783163a1aae5682.png" width="408" height="145" class="img_ev3q"></p>
<p>Of course we want to produce impressive figures. So we can go
a bit faster than that - if we don&#x27;t consume anything then we
can publish faster.</p>
<p><img decoding="async" loading="lazy" src="/rabbitmq-website/assets/images/performance-03-c0437f57dca2256d5cef354b08ca9e81.png" width="410" height="143" class="img_ev3q"></p>
<p>This uses a couple of the cores on our server - but not all of
them. So for the best headline-grabbing rate, we start a
number of parallel producers, all publishing into nothing.</p>
<p><img decoding="async" loading="lazy" src="/rabbitmq-website/assets/images/performance-04-be367a387efb33ba2862444654259159.png" width="408" height="143" class="img_ev3q"></p>
<p>Of course, consuming is rather important! So for the headline
consuming rate, we publish to a large number of consumers in
parallel.</p>
<p>Of course to some extent this quest for large numbers is a bit
silly, we&#x27;re more interested in relative performance. So let&#x27;s
revert to one producer and one consumer.</p>
<p><img decoding="async" loading="lazy" src="/rabbitmq-website/assets/images/performance-05-5379baad074750e08a2310d058dd76ee.png" width="410" height="136" class="img_ev3q"></p>
<p>Now let&#x27;s try publishing with the mandatory flag set. We drop
to about 40% of the non-mandatory rate. The reason for this is
that the channel we&#x27;re publishing to can&#x27;t just asynchronously
stream messages at queues any more; it synchronously checks
with the queues to make sure they&#x27;re still there. (Yes, we
could probably make mandatory publishing faster, but it&#x27;s not
very heavily used.)</p>
<p><img decoding="async" loading="lazy" src="/rabbitmq-website/assets/images/performance-06-6d211bb97d15f77782754bc587237624.png" width="400" height="139" class="img_ev3q"></p>
<p>The immediate flag gives us almost exactly the same drop in
performance. This isn&#x27;t hugely surprising - it has to make the
same synchronous check with the queue.</p>
<p><img decoding="async" loading="lazy" src="/rabbitmq-website/assets/images/performance-07-1dfce12b11895830f5736b73bafb6be5.png" width="400" height="140" class="img_ev3q"></p>
<p>Scrapping the rarely-used mandatory and immediate flags, let&#x27;s
try turning on acknowledgements for delivered messages. We still
see a performance drop compared to delivering without
acknowledgements (the server has to do more bookkeeping after
all) but it&#x27;s less noticeable.</p>
<p><img decoding="async" loading="lazy" src="/rabbitmq-website/assets/images/performance-08-5588a9e86dcb353e3fa0d24ddbea1afe.png" width="403" height="135" class="img_ev3q"></p>
<p>Now we turn on publish confirms as well. Performance drops a
little more but we&#x27;re still at over 60% the speed of neither
acks nor confirms.</p>
<p><img decoding="async" loading="lazy" src="/rabbitmq-website/assets/images/performance-09-184a1e18a0b660da058a98fdd7736e68.png" width="402" height="139" class="img_ev3q"></p>
<p>Finally, we enable message persistence. The rate becomes much
lower, since we&#x27;re throwing all those messages at the disk as
well.</p>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="message-sizes">Message Sizes<a href="#message-sizes" class="hash-link" aria-label="Direct link to Message Sizes" title="Direct link to Message Sizes">​</a></h2>
<p>Notably, all the messages we&#x27;ve been sending until now have only
been a few bytes long. There are a couple of reasons for this:</p>
<ul>
<li>Quite a lot of the work done by RabbitMQ is per-message, not
per-byte-of-message.</li>
<li>It&#x27;s always nice to look at big numbers.</li>
</ul>
<p>But in the real world we will often want to send bigger
messages. So let&#x27;s look at the next chart:</p>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="1---1-sending-rate-message-sizes">1 -&gt; 1 sending rate message sizes<a href="#1---1-sending-rate-message-sizes" class="hash-link" aria-label="Direct link to 1 -&gt; 1 sending rate message sizes" title="Direct link to 1 -&gt; 1 sending rate message sizes">​</a></h3>
<p><img decoding="async" loading="lazy" src="/rabbitmq-website/assets/images/performance-10-ac43101451b729984424e08171c63af5.png" width="832" height="354" class="img_ev3q"></p>
<p>Here (again) we&#x27;re sending unacked / unconfirmed messages as
fast as possible, but this time we vary the message size. We
can see that (of course) the message rate drops further as the
size increases, but the actual number of bytes sent increases as
we have less and less routing overhead.</p>
<p>So how does the message size affect horizontal scaling? Let&#x27;s
vary the number of producers with different message sizes. Just
for a change, in this test we&#x27;re not going to have any consumers
ar all.</p>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="n---0-sending-msg-rate-vs-number-of-producers-for-various-message-sizes">n -&gt; 0 sending msg rate vs number of producers, for various message sizes<a href="#n---0-sending-msg-rate-vs-number-of-producers-for-various-message-sizes" class="hash-link" aria-label="Direct link to n -&gt; 0 sending msg rate vs number of producers, for various message sizes" title="Direct link to n -&gt; 0 sending msg rate vs number of producers, for various message sizes">​</a></h3>
<p><img decoding="async" loading="lazy" src="/rabbitmq-website/assets/images/performance-11-cbd67ffebbbf90366d94e113bf5db09c.png" width="731" height="345" class="img_ev3q"></p>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="n---0-sending-bytes-rate-vs-number-of-producers-for-various-message-sizes">n -&gt; 0 sending bytes rate vs number of producers, for various message sizes<a href="#n---0-sending-bytes-rate-vs-number-of-producers-for-various-message-sizes" class="hash-link" aria-label="Direct link to n -&gt; 0 sending bytes rate vs number of producers, for various message sizes" title="Direct link to n -&gt; 0 sending bytes rate vs number of producers, for various message sizes">​</a></h3>
<p><img decoding="async" loading="lazy" src="/rabbitmq-website/assets/images/performance-12-d5c8a7ec98f67a502b2aa7e1bc9e403f.png" width="727" height="342" class="img_ev3q"></p>
<p>In these tests we can see that for small messages it only takes
a couple of producers to reach an upper bound on how many
messages we can publish, but that for larger messages we need
more producers to use the available bandwidth.</p>
<p>Another frequently confusing issue is performance around
consumers with a prefetch count. RabbitMQ (well, AMQP) defaults
to sending all the messages it can to any consumer that looks
ready to accept them. The maximum number of these unacknowledged
messages per channel can be limited by setting the prefetch
count. However, small prefetch counts can hurt performance
(since we can be waiting for acks to arrive before sending out
more messages).</p>
<p>So let&#x27;s have a look at prefetch count and, while we&#x27;re there,
also consider the number of consumers consuming from a single
queue. This chart contains some deliberately absurd extremes.</p>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="1---n-receiving-rate-vs-consumer-count--prefetch-count">1 -&gt; n receiving rate vs consumer count / prefetch count<a href="#1---n-receiving-rate-vs-consumer-count--prefetch-count" class="hash-link" aria-label="Direct link to 1 -&gt; n receiving rate vs consumer count / prefetch count" title="Direct link to 1 -&gt; n receiving rate vs consumer count / prefetch count">​</a></h3>
<p><img decoding="async" loading="lazy" src="/rabbitmq-website/assets/images/performance-13-d2660027218e3060b1600026ce809a07.png" width="738" height="350" class="img_ev3q"></p>
<p>The first thing to notice is that tiny prefetch counts really
hurt performance. Note the large difference in performance
between prefetch = 1 and prefetch = 2! But we also get into
diminishing returns - notice that the difference between
prefetch = 20 and prefetch = 50 is hard to see, and the
difference between prefetch = 50 and prefetch = 10000 is almost
invisible. Of course, this is because for our particular network
link prefetch = 50 already ensures that we never starve the
consumer while waiting for acks. Of course, this test was run
over a low latency link - more latent links will benefit from a
higher prefetch count.</p>
<p>The second thing to notice is that when we have a small number
of consumers, adding one more will increase performance (we get
more parallellism). And with a tiny prefetch count, increasing
consumers even up to a large number has benefits (since each
individual consumer spends much of its time starved). But when
we have a larger prefetch count, increasing the number of
consumers is not so helpful, since even a small number can kept
busy enough to max out our queue, but the more consumers we have
the more work RabbitMQ has to do to keep track of all of them.</p>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="large-queues">Large queues<a href="#large-queues" class="hash-link" aria-label="Direct link to Large queues" title="Direct link to Large queues">​</a></h2>
<p>All the examples we&#x27;ve looked at so far have one thing in
common: very few messages actually get queued. In general we&#x27;ve
looked at scenarios where messages get consumed as quickly as
they get produced, and thus each queue has an average length of
0.</p>
<p>So what happens whe queues get big? When queues are small(ish)
they will reside entirely within memory. Persistent messages
will also get written to disc, but they will only get read again
if the broker restarts.</p>
<p>But when queues get larger, they will get paged to disc,
persistent or not. In this case performance can take a hit as
suddenly we need to access the disc to send messages to
consumers. So let&#x27;s run a test: publish a lot of non-persistent
messages to a queue, and then consume them all.</p>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="queue-load--drain-500k-messages">Queue load / drain 500k messages<a href="#queue-load--drain-500k-messages" class="hash-link" aria-label="Direct link to Queue load / drain 500k messages" title="Direct link to Queue load / drain 500k messages">​</a></h3>
<p><img decoding="async" loading="lazy" src="/rabbitmq-website/assets/images/performance-14-d0e62e3609a920eb9a95fa2b78c4291a.png" width="724" height="340" class="img_ev3q"></p>
<p>In this small case we can see fairly consistent performance:
the messages go into the queue fairly quickly and then come out
even more quickly.</p>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="queue-load--drain-10m-messages">Queue load / drain 10M messages<a href="#queue-load--drain-10m-messages" class="hash-link" aria-label="Direct link to Queue load / drain 10M messages" title="Direct link to Queue load / drain 10M messages">​</a></h3>
<p><img decoding="async" loading="lazy" src="/rabbitmq-website/assets/images/performance-15-68dd5922019e7bd8231b40234c7efc41.png" width="725" height="339" class="img_ev3q"></p>
<p>But when we have a larger queue we see that the performance
varies a lot more. We see that when loading the queue we
initially get a very high throughput, then a pause while some of
the queue is paged out to disc, then a more consistent lower
throughput. Similarly when draining the queue we see a much
lower rate when pulling the messages from disc.</p>
<p>Performance of disc-bound queues is a complex topic -
see <a href="/rabbitmq-website/blog/2011/10/27/performance-of-queues-when-less-is-more">Matthew&#x27;s
blog post on the subject</a> for some more talk on the subject.</p>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="learn-more">Learn More<a href="#learn-more" class="hash-link" aria-label="Direct link to Learn More" title="Direct link to Learn More">​</a></h2>
<ul>
<li>Webinar: <a href="https://content.pivotal.io/webinars/may-23-what-s-new-in-rabbitmq-3-8-webinar?utm_campaign=rabbitmq-blog-3.8-webinar-q319&amp;utm_source=rabbitmq&amp;utm_medium=website" target="_blank" rel="noopener noreferrer">What&#x27;s new in RabbitMQ 3.8?</a></li>
<li>Webinar: <a href="https://content.pivotal.io/webinars/dec-12-10-things-every-developer-using-rabbitmq-should-know-webinar?utm_campaign=rabbitmq-blog-10-things-q319&amp;utm_source=rabbitmq&amp;utm_medium=website" target="_blank" rel="noopener noreferrer">10 Things Every Developer Using RabbitMQ Should Know</a></li>
</ul></div><footer class="docusaurus-mt-lg"><div class="row margin-top--sm theme-blog-footer-edit-meta-row"><div class="col"><b>Tags:</b><ul class="tags_jXut padding--none margin-left--sm"><li class="tag_QGVx"><a class="tag_zVej tagRegular_sFm0" href="/rabbitmq-website/blog/tags/performance">Performance</a></li></ul></div></div><div class="row margin-top--sm theme-blog-footer-edit-meta-row"><div class="col"><a href="https://github.com/rabbitmq/rabbitmq-website/tree/main/blog/2012-04-25-rabbitmq-performance-measurements-part-2/index.md" target="_blank" rel="noopener noreferrer" class="theme-edit-this-page"><svg fill="currentColor" height="20" width="20" viewBox="0 0 40 40" class="iconEdit_Z9Sw" aria-hidden="true"><g><path d="m34.5 11.7l-3 3.1-6.3-6.3 3.1-3q0.5-0.5 1.2-0.5t1.1 0.5l3.9 3.9q0.5 0.4 0.5 1.1t-0.5 1.2z m-29.5 17.1l18.4-18.5 6.3 6.3-18.4 18.4h-6.3v-6.2z"></path></g></svg>Edit this page</a></div><div class="col lastUpdated_JAkA"></div></div></footer></article><nav class="pagination-nav docusaurus-mt-lg" aria-label="Blog post page navigation"><a class="pagination-nav__link pagination-nav__link--prev" href="/rabbitmq-website/blog/2012/05/11/some-queuing-theory-throughput-latency-and-bandwidth"><div class="pagination-nav__sublabel">Newer post</div><div class="pagination-nav__label">Some queuing theory: throughput, latency and bandwidth</div></a><a class="pagination-nav__link pagination-nav__link--next" href="/rabbitmq-website/blog/2012/04/17/london-realtime-hackweekend"><div class="pagination-nav__sublabel">Older post</div><div class="pagination-nav__label">London Realtime hackweekend</div></a></nav></main><div class="col col--2"><div class="tableOfContents_bqdL thin-scrollbar"><ul class="table-of-contents table-of-contents__left-border"><li><a href="#some-simple-scenarios" class="table-of-contents__link toc-highlight">Some Simple Scenarios</a></li><li><a href="#message-sizes" class="table-of-contents__link toc-highlight">Message Sizes</a><ul><li><a href="#1---1-sending-rate-message-sizes" class="table-of-contents__link toc-highlight">1 -&gt; 1 sending rate message sizes</a></li><li><a href="#n---0-sending-msg-rate-vs-number-of-producers-for-various-message-sizes" class="table-of-contents__link toc-highlight">n -&gt; 0 sending msg rate vs number of producers, for various message sizes</a></li><li><a href="#n---0-sending-bytes-rate-vs-number-of-producers-for-various-message-sizes" class="table-of-contents__link toc-highlight">n -&gt; 0 sending bytes rate vs number of producers, for various message sizes</a></li><li><a href="#1---n-receiving-rate-vs-consumer-count--prefetch-count" class="table-of-contents__link toc-highlight">1 -&gt; n receiving rate vs consumer count / prefetch count</a></li></ul></li><li><a href="#large-queues" class="table-of-contents__link toc-highlight">Large queues</a><ul><li><a href="#queue-load--drain-500k-messages" class="table-of-contents__link toc-highlight">Queue load / drain 500k messages</a></li><li><a href="#queue-load--drain-10m-messages" class="table-of-contents__link toc-highlight">Queue load / drain 10M messages</a></li></ul></li><li><a href="#learn-more" class="table-of-contents__link toc-highlight">Learn More</a></li></ul></div></div></div></div></div><footer class="footer footer--dark"><div class="container container-fluid"><div class="row footer__links"><div class="col footer__col"><div class="footer__title">Learn about RabbitMQ</div><ul class="footer__items clean-list"><li class="footer__item"><a class="footer__link-item" href="/rabbitmq-website/tutorials">Getting Started</a></li><li class="footer__item"><a class="footer__link-item" href="/rabbitmq-website/docs">Documentation</a></li><li class="footer__item"><a class="footer__link-item" href="/rabbitmq-website/blog">Blog</a></li></ul></div><div class="col footer__col"><div class="footer__title">Reach out to the RabbitMQ team</div><ul class="footer__items clean-list"><li class="footer__item"><a href="https://github.com/rabbitmq" target="_blank" rel="noopener noreferrer" class="footer__link-item">GitHub<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_nPIU"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a></li><li class="footer__item"><a href="https://github.com/rabbitmq/rabbitmq-server/discussions" target="_blank" rel="noopener noreferrer" class="footer__link-item">GitHub Discussions<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_nPIU"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a></li><li class="footer__item"><a class="footer__link-item" href="/rabbitmq-website/contact?utm_source=rmq_release-information_tableheader&amp;utm_medium=rmq_website&amp;utm_campaign=tanzu">Long Term Commercial Support</a></li><li class="footer__item"><a class="footer__link-item" href="/rabbitmq-website/contact">Contact Us</a></li><li class="footer__item"><a href="https://www.rabbitmq.com/discord" target="_blank" rel="noopener noreferrer" class="footer__link-item">Discord<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_nPIU"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a></li></ul></div><div class="col footer__col"><div class="footer__title">Broadcom</div><ul class="footer__items clean-list"><li class="footer__item"><a href="https://tanzu.vmware.com/" target="_blank" rel="noopener noreferrer" class="footer__link-item">VMware Tanzu<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_nPIU"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a></li><li class="footer__item"><a href="https://www.vmware.com/help/legal.html" target="_blank" rel="noopener noreferrer" class="footer__link-item">Terms of Use<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_nPIU"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a></li><li class="footer__item"><a href="https://www.vmware.com/help/privacy.html" target="_blank" rel="noopener noreferrer" class="footer__link-item">Privacy<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_nPIU"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a></li><li class="footer__item"><a class="footer__link-item" href="/rabbitmq-website/trademark-guidelines">Trademark Guidelines</a></li><li class="footer__item"><a href="https://www.vmware.com/help/privacy/california-privacy-rights.html" target="_blank" rel="noopener noreferrer" class="footer__link-item">Your California Privacy Rights<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_nPIU"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a></li><li class="footer__item"><a class="footer__link-item ot-sdk-show-settings">Cookie Settings</a></li></ul></div></div><div class="footer__bottom text--center"><div class="footer__copyright">Copyright © 2005-2025 Broadcom. All Rights Reserved. The term "Broadcom" refers to Broadcom Inc. and/or its subsidiaries.</div></div></div></footer></div>
</body>
</html>
<!doctype html>
<html lang="en" dir="ltr" class="docs-wrapper plugin-docs plugin-id-default docs-version-4.0 docs-doc-page docs-doc-id-oauth2" data-has-hydrated="false">
<head>
<meta charset="UTF-8">
<meta name="generator" content="Docusaurus v3.7.0">
<title data-rh="true">OAuth 2.0 Authentication Backend | RabbitMQ</title><meta data-rh="true" name="viewport" content="width=device-width,initial-scale=1"><meta data-rh="true" name="twitter:card" content="summary_large_image"><meta data-rh="true" property="og:image" content="https://www.rabbitmq.com/rabbitmq-website/img/rabbitmq-social-media-card.svg"><meta data-rh="true" name="twitter:image" content="https://www.rabbitmq.com/rabbitmq-website/img/rabbitmq-social-media-card.svg"><meta data-rh="true" property="og:url" content="https://www.rabbitmq.com/rabbitmq-website/docs/4.0/oauth2"><meta data-rh="true" property="og:locale" content="en"><meta data-rh="true" name="docusaurus_locale" content="en"><meta data-rh="true" name="docsearch:language" content="en"><meta data-rh="true" name="docusaurus_version" content="4.0"><meta data-rh="true" name="docusaurus_tag" content="docs-default-4.0"><meta data-rh="true" name="docsearch:version" content="4.0"><meta data-rh="true" name="docsearch:docusaurus_tag" content="docs-default-4.0"><meta data-rh="true" property="og:title" content="OAuth 2.0 Authentication Backend | RabbitMQ"><meta data-rh="true" name="description" content="&lt;!--"><meta data-rh="true" property="og:description" content="&lt;!--"><link data-rh="true" rel="icon" href="/rabbitmq-website/img/rabbitmq-logo.svg"><link data-rh="true" rel="canonical" href="https://www.rabbitmq.com/rabbitmq-website/docs/4.0/oauth2"><link data-rh="true" rel="alternate" href="https://www.rabbitmq.com/rabbitmq-website/docs/4.0/oauth2" hreflang="en"><link data-rh="true" rel="alternate" href="https://www.rabbitmq.com/rabbitmq-website/docs/4.0/oauth2" hreflang="x-default"><link data-rh="true" rel="preconnect" href="https://H10VQIW16Y-dsn.algolia.net" crossorigin="anonymous"><link rel="alternate" type="application/rss+xml" href="/rabbitmq-website/blog/rss.xml" title="RabbitMQ RSS Feed">
<link rel="alternate" type="application/atom+xml" href="/rabbitmq-website/blog/atom.xml" title="RabbitMQ Atom Feed">




<link rel="search" type="application/opensearchdescription+xml" title="RabbitMQ" href="/rabbitmq-website/opensearch.xml">







<link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Raleway:400,700">
<script src="https://cdn.cookielaw.org/scripttemplates/otSDKStub.js" data-domain-script="018ee308-473e-754f-b0c2-cbe82d25512f"></script>
<script>function OptanonWrapper(){}</script>
<script>function setGTM(e,t,o,n,r){e[n]=e[n]||[],e[n].push({"gtm.start":(new Date).getTime(),event:"gtm.js"});var i=t.getElementsByTagName(o)[0],a=t.createElement(o),s="dataLayer"!=n?"&l="+n:"";a.async=!0,a.src="https://www.googletagmanager.com/gtm.js?id="+r+s,i.parentNode.insertBefore(a,i)}var timer;function waitForOnetrustActiveGroups(){document.cookie.indexOf("OptanonConsent")>-1&&document.cookie.indexOf("groups=")>-1?(clearTimeout(timer),setGTM(window,document,"script","dataLayer","GTM-TT84L8K")):timer=setTimeout(waitForOnetrustActiveGroups,250)}document.cookie.indexOf("OptanonConsent")>-1&&document.cookie.indexOf("groups=")>-1?setGTM(window,document,"script","dataLayer","GTM-TT84L8K"):waitForOnetrustActiveGroups()</script><link rel="stylesheet" href="/rabbitmq-website/styles.css">
<script src="/rabbitmq-website/runtime~main.js" defer="defer"></script>
<script src="/rabbitmq-website/main.js" defer="defer"></script>
</head>
<body class="navigation-with-keyboard">
<script>!function(){function t(t){document.documentElement.setAttribute("data-theme",t)}var e=function(){try{return new URLSearchParams(window.location.search).get("docusaurus-theme")}catch(t){}}()||function(){try{return window.localStorage.getItem("theme")}catch(t){}}();null!==e?t(e):window.matchMedia("(prefers-color-scheme: dark)").matches?t("dark"):(window.matchMedia("(prefers-color-scheme: light)").matches,t("light"))}(),function(){try{const n=new URLSearchParams(window.location.search).entries();for(var[t,e]of n)if(t.startsWith("docusaurus-data-")){var a=t.replace("docusaurus-data-","data-");document.documentElement.setAttribute(a,e)}}catch(t){}}(),document.documentElement.setAttribute("data-announcement-bar-initially-dismissed",function(){try{return"true"===localStorage.getItem("docusaurus.announcement.dismiss")}catch(t){}return!1}())</script><div id="__docusaurus"><div role="region" aria-label="Skip to main content"><a class="skipToContent_fXgn" href="#__docusaurus_skipToContent_fallback">Skip to main content</a></div><div class="announcementBar_mb4j" style="background-color:var(--ifm-color-primary-contrast-background);color:var(--ifm-font-color-base)" role="banner"><div class="announcementBarPlaceholder_vyr4"></div><div class="content_knG7 announcementBarContent_xLdY"><strong style="font-size: var(--ifm-h4-font-size);"><a href="https://github.com/rabbitmq/rabbitmq-server/releases/tag/v4.1.0">RabbitMQ 4.1.0 is out</a></strong></div><button type="button" aria-label="Close" class="clean-btn close closeButton_CVFx announcementBarClose_gvF7"><svg viewBox="0 0 15 15" width="14" height="14"><g stroke="currentColor" stroke-width="3.1"><path d="M.75.75l13.5 13.5M14.25.75L.75 14.25"></path></g></svg></button></div><nav aria-label="Main" class="navbar navbar--fixed-top"><div class="navbar__inner"><div class="navbar__items"><button aria-label="Toggle navigation bar" aria-expanded="false" class="navbar__toggle clean-btn" type="button"><svg width="30" height="30" viewBox="0 0 30 30" aria-hidden="true"><path stroke="currentColor" stroke-linecap="round" stroke-miterlimit="10" stroke-width="2" d="M4 7h22M4 15h22M4 23h22"></path></svg></button><a class="navbar__brand" href="/rabbitmq-website/"><div class="navbar__logo"><img src="/rabbitmq-website/img/rabbitmq-logo-with-name.svg" alt="RabbitMQ" class="themedComponent_mlkZ themedComponent--light_NVdE"><img src="/rabbitmq-website/img/rabbitmq-logo-with-name.svg" alt="RabbitMQ" class="themedComponent_mlkZ themedComponent--dark_xIcU"></div></a><a class="navbar__item navbar__link" href="/rabbitmq-website/tutorials">Getting Started</a><a aria-current="page" class="navbar__item navbar__link navbar__link--active" href="/rabbitmq-website/docs/4.0">Docs</a><a class="navbar__item navbar__link" href="/rabbitmq-website/blog">Blog</a><a class="navbar__item navbar__link" href="/rabbitmq-website/contact">Support</a></div><div class="navbar__items navbar__items--right"><div class="navbar__item dropdown dropdown--hoverable dropdown--right"><a aria-current="page" class="navbar__link active" aria-haspopup="true" aria-expanded="false" role="button" href="/rabbitmq-website/docs/4.0/oauth2">4.0</a><ul class="dropdown__menu"><li class=""><strong>Release series</strong></li><li><a class="dropdown__link" href="/rabbitmq-website/docs/next/oauth2">Next</a></li><li><a class="dropdown__link" href="/rabbitmq-website/docs/oauth2">4.1</a></li><li><a aria-current="page" class="dropdown__link dropdown__link--active" href="/rabbitmq-website/docs/4.0/oauth2">4.0</a></li><li><a class="dropdown__link" href="/rabbitmq-website/docs/3.13/oauth2">3.13</a></li><li><a href="https://v3-12.rabbitmq.com/documentation.html" target="_blank" rel="noopener noreferrer" class="dropdown__link">3.12<svg width="12" height="12" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_nPIU"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a></li><li><a class="dropdown__link" href="/rabbitmq-website/release-information">Release Information</a></li></ul></div><a href="https://github.com/rabbitmq/rabbitmq-website" target="_blank" rel="noopener noreferrer" class="navbar__item navbar__link">GitHub<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_nPIU"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a><div class="toggle_vylO colorModeToggle_DEke"><button class="clean-btn toggleButton_gllP toggleButtonDisabled_aARS" type="button" disabled="" title="Switch between dark and light mode (currently light mode)" aria-label="Switch between dark and light mode (currently light mode)" aria-live="polite" aria-pressed="false"><svg viewBox="0 0 24 24" width="24" height="24" class="lightToggleIcon_pyhR"><path fill="currentColor" d="M12,9c1.65,0,3,1.35,3,3s-1.35,3-3,3s-3-1.35-3-3S10.35,9,12,9 M12,7c-2.76,0-5,2.24-5,5s2.24,5,5,5s5-2.24,5-5 S14.76,7,12,7L12,7z M2,13l2,0c0.55,0,1-0.45,1-1s-0.45-1-1-1l-2,0c-0.55,0-1,0.45-1,1S1.45,13,2,13z M20,13l2,0c0.55,0,1-0.45,1-1 s-0.45-1-1-1l-2,0c-0.55,0-1,0.45-1,1S19.45,13,20,13z M11,2v2c0,0.55,0.45,1,1,1s1-0.45,1-1V2c0-0.55-0.45-1-1-1S11,1.45,11,2z M11,20v2c0,0.55,0.45,1,1,1s1-0.45,1-1v-2c0-0.55-0.45-1-1-1C11.45,19,11,19.45,11,20z M5.99,4.58c-0.39-0.39-1.03-0.39-1.41,0 c-0.39,0.39-0.39,1.03,0,1.41l1.06,1.06c0.39,0.39,1.03,0.39,1.41,0s0.39-1.03,0-1.41L5.99,4.58z M18.36,16.95 c-0.39-0.39-1.03-0.39-1.41,0c-0.39,0.39-0.39,1.03,0,1.41l1.06,1.06c0.39,0.39,1.03,0.39,1.41,0c0.39-0.39,0.39-1.03,0-1.41 L18.36,16.95z M19.42,5.99c0.39-0.39,0.39-1.03,0-1.41c-0.39-0.39-1.03-0.39-1.41,0l-1.06,1.06c-0.39,0.39-0.39,1.03,0,1.41 s1.03,0.39,1.41,0L19.42,5.99z M7.05,18.36c0.39-0.39,0.39-1.03,0-1.41c-0.39-0.39-1.03-0.39-1.41,0l-1.06,1.06 c-0.39,0.39-0.39,1.03,0,1.41s1.03,0.39,1.41,0L7.05,18.36z"></path></svg><svg viewBox="0 0 24 24" width="24" height="24" class="darkToggleIcon_wfgR"><path fill="currentColor" d="M9.37,5.51C9.19,6.15,9.1,6.82,9.1,7.5c0,4.08,3.32,7.4,7.4,7.4c0.68,0,1.35-0.09,1.99-0.27C17.45,17.19,14.93,19,12,19 c-3.86,0-7-3.14-7-7C5,9.07,6.81,6.55,9.37,5.51z M12,3c-4.97,0-9,4.03-9,9s4.03,9,9,9s9-4.03,9-9c0-0.46-0.04-0.92-0.1-1.36 c-0.98,1.37-2.58,2.26-4.4,2.26c-2.98,0-5.4-2.42-5.4-5.4c0-1.81,0.89-3.42,2.26-4.4C12.92,3.04,12.46,3,12,3L12,3z"></path></svg></button></div><div class="navbarSearchContainer_Bca1"><button type="button" class="DocSearch DocSearch-Button" aria-label="Search (Command+K)"><span class="DocSearch-Button-Container"><svg width="20" height="20" class="DocSearch-Search-Icon" viewBox="0 0 20 20" aria-hidden="true"><path d="M14.386 14.386l4.0877 4.0877-4.0877-4.0877c-2.9418 2.9419-7.7115 2.9419-10.6533 0-2.9419-2.9418-2.9419-7.7115 0-10.6533 2.9418-2.9419 7.7115-2.9419 10.6533 0 2.9419 2.9418 2.9419 7.7115 0 10.6533z" stroke="currentColor" fill="none" fill-rule="evenodd" stroke-linecap="round" stroke-linejoin="round"></path></svg><span class="DocSearch-Button-Placeholder">Search</span></span><span class="DocSearch-Button-Keys"></span></button></div></div></div><div role="presentation" class="navbar-sidebar__backdrop"></div></nav><div id="__docusaurus_skipToContent_fallback" class="main-wrapper mainWrapper_z2l0"><div class="docsWrapper_hBAB"><button aria-label="Scroll back to top" class="clean-btn theme-back-to-top-button backToTopButton_sjWU" type="button"></button><div class="docRoot_UBD9"><aside class="theme-doc-sidebar-container docSidebarContainer_YfHR"><div class="sidebarViewport_aRkj"><div class="sidebar_njMd"><nav aria-label="Docs sidebar" class="menu thin-scrollbar menu_SIkG menuWithAnnouncementBar_GW3s"><ul class="theme-doc-sidebar-menu menu__list"><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/rabbitmq-website/docs/4.0">Introduction</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/rabbitmq-website/release-information">Release Information</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/rabbitmq-website/tutorials">Getting Started</a></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist" href="/rabbitmq-website/docs/4.0/download">Install and Upgrade</a><button aria-label="Expand sidebar category &#x27;Install and Upgrade&#x27;" aria-expanded="false" type="button" class="clean-btn menu__caret"></button></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist" href="/rabbitmq-website/docs/4.0/use-rabbitmq">How to Use RabbitMQ</a><button aria-label="Expand sidebar category &#x27;How to Use RabbitMQ&#x27;" aria-expanded="false" type="button" class="clean-btn menu__caret"></button></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--active" href="/rabbitmq-website/docs/4.0/manage-rabbitmq">How to Manage RabbitMQ</a><button aria-label="Collapse sidebar category &#x27;How to Manage RabbitMQ&#x27;" aria-expanded="true" type="button" class="clean-btn menu__caret"></button></div><ul style="display:block;overflow:visible;height:auto" class="menu__list"><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/rabbitmq-website/docs/4.0/cli">CLI</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/rabbitmq-website/docs/4.0/configure">Configuration</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/rabbitmq-website/docs/4.0/relocate">File and Directory Locations</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/rabbitmq-website/docs/4.0/logging">Logging</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/rabbitmq-website/docs/4.0/vhosts">Virtual Hosts</a></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-2 menu__list-item"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--active" tabindex="0" href="/rabbitmq-website/docs/4.0/access-control"> Authentication and Authorization</a><button aria-label="Collapse sidebar category &#x27; Authentication and Authorization&#x27;" aria-expanded="true" type="button" class="clean-btn menu__caret"></button></div><ul style="display:block;overflow:visible;height:auto" class="menu__list"><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class="menu__link" tabindex="0" href="/rabbitmq-website/docs/4.0/authentication">AMQP 0-9-1 Authentication Mechanisms</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class="menu__link" tabindex="0" href="/rabbitmq-website/docs/4.0/passwords">Credentials and Passwords</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class="menu__link menu__link--active" aria-current="page" tabindex="0" href="/rabbitmq-website/docs/4.0/oauth2">OAuth 2</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class="menu__link" tabindex="0" href="/rabbitmq-website/docs/4.0/ldap">LDAP</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class="menu__link" tabindex="0" href="/rabbitmq-website/docs/4.0/auth-cache-backend">Cache</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class="menu__link" tabindex="0" href="/rabbitmq-website/docs/4.0/auth-notification">Authentication Failure Notifications</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class="menu__link" tabindex="0" href="/rabbitmq-website/docs/4.0/user-limits">Per User Resource Limits</a></li></ul></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/rabbitmq-website/docs/4.0/parameters">Policies and Runtime Parameters</a></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-2 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist" tabindex="0" href="/rabbitmq-website/docs/4.0/metadata-store">Metadata store</a><button aria-label="Expand sidebar category &#x27;Metadata store&#x27;" aria-expanded="false" type="button" class="clean-btn menu__caret"></button></div></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/rabbitmq-website/docs/4.0/definitions">Schema Definitions</a></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-2 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist" tabindex="0" href="/rabbitmq-website/docs/4.0/networking">Networking</a><button aria-label="Expand sidebar category &#x27;Networking&#x27;" aria-expanded="false" type="button" class="clean-btn menu__caret"></button></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-2 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist" tabindex="0" href="/rabbitmq-website/docs/4.0/clustering">Clustering</a><button aria-label="Expand sidebar category &#x27;Clustering&#x27;" aria-expanded="false" type="button" class="clean-btn menu__caret"></button></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-2 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret" role="button" aria-expanded="false" tabindex="0" href="/rabbitmq-website/docs/4.0/memory-use">Resource Management</a></div></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/rabbitmq-website/docs/4.0/backup">Backup and Restore</a></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-2 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret" role="button" aria-expanded="false" tabindex="0" href="/rabbitmq-website/docs/4.0/runtime">Tuning</a></div></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/rabbitmq-website/docs/4.0/production-checklist">Deployment Guidelines</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/rabbitmq-website/kubernetes/operator/operator-overview">RabbitMQ on Kubernetes</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/rabbitmq-website/docs/4.0/troubleshooting">Troubleshooting RabbitMQ</a></li></ul></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist" href="/rabbitmq-website/docs/4.0/monitoring">How to Monitor RabbitMQ</a><button aria-label="Expand sidebar category &#x27;How to Monitor RabbitMQ&#x27;" aria-expanded="false" type="button" class="clean-btn menu__caret"></button></div></li></ul></nav></div></div></aside><main class="docMainContainer_TBSr"><div class="container padding-top--md padding-bottom--lg"><div class="row"><div class="col docItemCol_VOVn"><div class="theme-doc-version-banner alert alert--warning margin-bottom--md" role="alert"><div>This is documentation for <!-- -->RabbitMQ<!-- --> <b>4.0</b>, which is no longer actively maintained.</div><div class="margin-top--md">For up-to-date documentation, see the <b><a href="/rabbitmq-website/docs/oauth2">latest version</a></b> (<!-- -->4.1<!-- -->).</div></div><div class="docItemContainer_Djhp"><article><nav class="theme-doc-breadcrumbs breadcrumbsContainer_Z_bl" aria-label="Breadcrumbs"><ul class="breadcrumbs" itemscope="" itemtype="https://schema.org/BreadcrumbList"><li class="breadcrumbs__item"><a aria-label="Home page" class="breadcrumbs__link" href="/rabbitmq-website/"><svg viewBox="0 0 24 24" class="breadcrumbHomeIcon_YNFT"><path d="M10 19v-5h4v5c0 .55.45 1 1 1h3c.55 0 1-.45 1-1v-7h1.7c.46 0 .68-.57.33-.87L12.67 3.6c-.38-.34-.96-.34-1.34 0l-8.36 7.53c-.34.3-.13.87.33.87H5v7c0 .55.45 1 1 1h3c.55 0 1-.45 1-1z" fill="currentColor"></path></svg></a></li><li itemscope="" itemprop="itemListElement" itemtype="https://schema.org/ListItem" class="breadcrumbs__item"><a class="breadcrumbs__link" itemprop="item" href="/rabbitmq-website/docs/4.0/manage-rabbitmq"><span itemprop="name">How to Manage RabbitMQ</span></a><meta itemprop="position" content="1"></li><li itemscope="" itemprop="itemListElement" itemtype="https://schema.org/ListItem" class="breadcrumbs__item"><a class="breadcrumbs__link" itemprop="item" href="/rabbitmq-website/docs/4.0/access-control"><span itemprop="name"> Authentication and Authorization</span></a><meta itemprop="position" content="2"></li><li itemscope="" itemprop="itemListElement" itemtype="https://schema.org/ListItem" class="breadcrumbs__item breadcrumbs__item--active"><span class="breadcrumbs__link" itemprop="name">OAuth 2</span><meta itemprop="position" content="3"></li></ul></nav><span class="theme-doc-version-badge badge badge--secondary">Version: 4.0</span><div class="tocCollapsible_ETCw theme-doc-toc-mobile tocMobile_ITEo"><button type="button" class="clean-btn tocCollapsibleButton_TO0P">On this page</button></div><div class="theme-doc-markdown markdown"><header><h1>OAuth 2.0 Authentication Backend</h1></header>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="overview">Overview<a href="#overview" class="hash-link" aria-label="Direct link to Overview" title="Direct link to Overview">​</a></h2>
<p>This <a href="/rabbitmq-website/docs/4.0/access-control">RabbitMQ authentication/authorisation backend</a> plugin lets applications
(clients) and users authenticate and authorize using JWT-encoded OAuth 2.0 access tokens.</p>
<p>There&#x27;s also a companion <a href="/rabbitmq-website/docs/4.0/troubleshooting-oauth2">troubleshooting guide for OAuth 2-specific problems</a>.</p>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="table-of-contents">Table of Contents<a href="#table-of-contents" class="hash-link" aria-label="Direct link to Table of Contents" title="Direct link to Table of Contents">​</a></h2>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="how-to-configure-it"><a href="#how-to-configure-it">How to configure it</a><a href="#how-to-configure-it" class="hash-link" aria-label="Direct link to how-to-configure-it" title="Direct link to how-to-configure-it">​</a></h3>
<ul>
<li><a href="#prerequisites">Prerequisites</a></li>
<li><a href="#configure-for-openid-connect">Configure OAuth 2.0 for identity providers compliant with OpenId Connect</a></li>
</ul>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="how-it-works"><a href="#how-it-works">How it works</a><a href="#how-it-works" class="hash-link" aria-label="Direct link to how-it-works" title="Direct link to how-it-works">​</a></h3>
<ul>
<li><a href="#authorization-flow">Authorization Flow</a></li>
<li><a href="#variables-configurable">Variables configurable in rabbitmq.conf</a></li>
<li><a href="#token-validation">Token validation</a></li>
<li><a href="#token-expiration">Token expiration and refresh</a></li>
<li><a href="#scope-translation">Scope-to-Permission translation</a></li>
<li><a href="#topic-exchange-scopes">Topic Exchange scopes</a></li>
<li><a href="#scope-and-tags">Scope and tags</a></li>
</ul>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="basic-usage"><a href="#basic-usage">Basic usage</a><a href="#basic-usage" class="hash-link" aria-label="Direct link to basic-usage" title="Direct link to basic-usage">​</a></h3>
<ul>
<li><a href="#configure-issuer">Configure OAuth 2.0 provider&#x27;s issuer</a></li>
<li><a href="#configure-signing-keys">Configure signing keys</a></li>
<li><a href="#use-different-token-field">Use a different token field for the scope</a></li>
<li><a href="#preferred-username-claims">Preferred username claims</a></li>
<li><a href="#rich-authorization-request">Rich Authorization Request</a></li>
</ul>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="advanced-usage"><a href="#advanced-usage">Advanced usage</a><a href="#advanced-usage" class="hash-link" aria-label="Direct link to advanced-usage" title="Direct link to advanced-usage">​</a></h3>
<ul>
<li><a href="#use-oauth-provider">Use default OAuth 2.0 provider</a></li>
<li><a href="#configure-end-session-endpoint">Configure OAuth 2.0 provider&#x27;s end_session_endpoint</a></li>
<li><a href="#multiple-resource-servers">Configure multiple resource servers</a></li>
<li><a href="#multiple-oauth-providers">Configure multiple OAuth 2.0 providers</a></li>
</ul>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="examples-for-specific-identity-providers">Examples for Specific Identity Providers<a href="#examples-for-specific-identity-providers" class="hash-link" aria-label="Direct link to Examples for Specific Identity Providers" title="Direct link to Examples for Specific Identity Providers">​</a></h3>
<ul>
<li>How to <a href="#examples">set up RabbitMQ with OAuth 2: examples</a></li>
</ul>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="how-to-configure-it">How to configure it<a href="#how-to-configure-it" class="hash-link" aria-label="Direct link to How to configure it" title="Direct link to How to configure it">​</a></h2>
<p>This is a step-by-step guide for how to configure OAuth 2.0 authentication for the majority of
use-cases, such as when:</p>
<ul>
<li>You are using an identity provider that is compliant with OpenId Connect</li>
<li>You want RabbitMQ to trigger OAuth 2.0 authentication in the management UI. This is known as
<em>Service Provider initiated logon</em>. As opposed to, users must come to RabbitMQ already with a
token obtained by other means.</li>
</ul>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="prerequisites">Prerequisites<a href="#prerequisites" class="hash-link" aria-label="Direct link to Prerequisites" title="Direct link to Prerequisites">​</a></h3>
<h4 class="anchor anchorWithStickyNavbar_LWe7" id="step-1-enable-the-plugin">Step 1: Enable the plugin<a href="#step-1-enable-the-plugin" class="hash-link" aria-label="Direct link to Step 1: Enable the plugin" title="Direct link to Step 1: Enable the plugin">​</a></h4>
<p>The OAuth 2 plugin must be activated (or <a href="/rabbitmq-website/docs/4.0/plugins#enabled-plugins-file">pre-configured</a>) before it
can be used, like all other plugins. There is a file commonly found at
<code>/etc/rabbitmq/enabled_plugins</code>. Add the OAuth 2 plugin as follows:</p>
<div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token punctuation" style="color:#393A34">[</span><span class="token plain">rabbitmq_management,rabbitmq_shovel,rabbitmq_auth_backend_oauth2</span><span class="token punctuation" style="color:#393A34">]</span><span class="token plain">.</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<h4 class="anchor anchorWithStickyNavbar_LWe7" id="step-2-configure-oauth-20-as-one-of-the-authentication-backends">Step 2: Configure OAuth 2.0 as one of the authentication backends<a href="#step-2-configure-oauth-20-as-one-of-the-authentication-backends" class="hash-link" aria-label="Direct link to Step 2: Configure OAuth 2.0 as one of the authentication backends" title="Direct link to Step 2: Configure OAuth 2.0 as one of the authentication backends">​</a></h4>
<p>Edit your <code>rabbitmq.conf</code> file, commonly found at <code>/etc/rabbitmq</code> and add OAuth 2.0 backend. For
example, the following configuration adds OAuth 2.0 as the only authentication backend:</p>
<div class="language-ini codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-ini codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">auth_backends.1 = rabbit_auth_backend_oauth2</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="configure-for-openid-connect">Configure OAuth 2.0 for identity providers compliant with OpenId Connect<a href="#configure-for-openid-connect" class="hash-link" aria-label="Direct link to Configure OAuth 2.0 for identity providers compliant with OpenId Connect" title="Direct link to Configure OAuth 2.0 for identity providers compliant with OpenId Connect">​</a></h3>
<p>Nowadays, the majority of the identity providers are compliant with OpenId Connect. At minimum, this
means that they expose an HTTP endpoint called <em>Discovery endpoint</em> mounted at
<code>/.well-known/openid-configuration</code>. Through this endpoint, RabbitMQ discovers all the necessary
endpoints for a successful OAuth 2.0 authentication. The following identity providers are compliant
with OpenId Connect:</p>
<ul>
<li>UAA</li>
<li>Keycloak</li>
<li>Auth0</li>
<li>Entra ID (a.k.a Azure)</li>
<li>Okta</li>
</ul>
<h4 class="anchor anchorWithStickyNavbar_LWe7" id="step1">Step 1: Configure the OAuth 2.0 resource name associated to RabbitMQ<a href="#step1" class="hash-link" aria-label="Direct link to Step 1: Configure the OAuth 2.0 resource name associated to RabbitMQ" title="Direct link to Step 1: Configure the OAuth 2.0 resource name associated to RabbitMQ">​</a></h4>
<div class="language-ìni codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-ìni codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">auth_oauth2.resource_server_id = rabbitmq</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<div class="theme-admonition theme-admonition-warning admonition_xJq3 alert alert--warning"><div class="admonitionHeading_Gvgb"><span class="admonitionIcon_Rf37"><svg viewBox="0 0 16 16"><path fill-rule="evenodd" d="M8.893 1.5c-.183-.31-.52-.5-.887-.5s-.703.19-.886.5L.138 13.499a.98.98 0 0 0 0 1.001c.193.31.53.501.886.501h13.964c.367 0 .704-.19.877-.5a1.03 1.03 0 0 0 .01-1.002L8.893 1.5zm.133 11.497H6.987v-2.003h2.039v2.003zm0-3.004H6.987V5.987h2.039v4.006z"></path></svg></span>warning</div><div class="admonitionContent_BuS1"><p>OAuth 2.0 tokens have an attribute called <code>audience</code>. This attribute lists all the OAuth 2.0
resources the token is meant for. RabbitMQ expects to find its <code>resource_server_id</code> in one of the
<code>audience</code> values. If it is not found, the token is rejected and the authentication fails.</p><p>Although it is not recommended, you can disable audience validation by adding the following
configuration.</p><div class="language-ini codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-ini codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">auth_oauth2.verify_aud = false</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div></div></div>
<h4 class="anchor anchorWithStickyNavbar_LWe7" id="step2">Step 2: Configure root URL of the Identity Provider<a href="#step2" class="hash-link" aria-label="Direct link to Step 2: Configure root URL of the Identity Provider" title="Direct link to Step 2: Configure root URL of the Identity Provider">​</a></h4>
<div class="language-ini codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-ini codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">auth_oauth2.issuer = https://keycloak:8443/realms/test</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<div class="theme-admonition theme-admonition-info admonition_xJq3 alert alert--info"><div class="admonitionHeading_Gvgb"><span class="admonitionIcon_Rf37"><svg viewBox="0 0 14 16"><path fill-rule="evenodd" d="M7 2.3c3.14 0 5.7 2.56 5.7 5.7s-2.56 5.7-5.7 5.7A5.71 5.71 0 0 1 1.3 8c0-3.14 2.56-5.7 5.7-5.7zM7 1C3.14 1 0 4.14 0 8s3.14 7 7 7 7-3.14 7-7-3.14-7-7-7zm1 3H6v5h2V4zm0 6H6v2h2v-2z"></path></svg></span>info</div><div class="admonitionContent_BuS1"><p>It must be an HTTPS URL. If your identity provider uses a certificate signed by a self-signed CA
certificate, you can configure the CA certificate by adding the following line to your configuration:</p><div class="language-ini codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-ini codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">auth_oauth2.https.cacertfile = &lt;path_to_your_ca_cert&gt;</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div></div></div>
<h4 class="anchor anchorWithStickyNavbar_LWe7" id="step3">Step 3: Configure which token&#x27;s attributes contain the user name<a href="#step3" class="hash-link" aria-label="Direct link to Step 3: Configure which token&#x27;s attributes contain the user name" title="Direct link to Step 3: Configure which token&#x27;s attributes contain the user name">​</a></h4>
<p>RabbitMQ needs to know the user name for logging purposes and also to display it in the management
UI. By default, RabbitMQ looks up the user name in the token&#x27;s attribute <code>sub</code>, and if not found it
uses <code>client_id</code>.</p>
<p>Here you are configuring RabbitMQ to use <code>user_name</code> first and, if not found, <code>preferred_username</code>
instead.</p>
<div class="language-ini codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-ini codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">auth_oauth2.preferred_username_claims.1 = user_name</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">auth_oauth2.preferred_username_claims.2 = preferred_username</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<h4 class="anchor anchorWithStickyNavbar_LWe7" id="step4">Step 4: Configure which token&#x27;s attribute contains the scopes (a.k.a. permissions)<a href="#step4" class="hash-link" aria-label="Direct link to Step 4: Configure which token&#x27;s attribute contains the scopes (a.k.a. permissions)" title="Direct link to Step 4: Configure which token&#x27;s attribute contains the scopes (a.k.a. permissions)">​</a></h4>
<p>By default, RabbitMQ always looks for scopes in the token&#x27;s attribute <code>scope</code>. If your scopes are in
a different attribute you can configure the name of that attribute.</p>
<p>Given the following configuration, RabbitMQ looks for scopes in the attributes <code>scope</code> and
<code>extra_scope</code>. The attribute&#x27;s value can be a string of space-separated scopes or a JSON list of
scopes.</p>
<div class="language-ini codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-ini codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">auth_oauth2.additional_scopes_key = extra_scope</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<div class="theme-admonition theme-admonition-info admonition_xJq3 alert alert--info"><div class="admonitionHeading_Gvgb"><span class="admonitionIcon_Rf37"><svg viewBox="0 0 14 16"><path fill-rule="evenodd" d="M7 2.3c3.14 0 5.7 2.56 5.7 5.7s-2.56 5.7-5.7 5.7A5.71 5.71 0 0 1 1.3 8c0-3.14 2.56-5.7 5.7-5.7zM7 1C3.14 1 0 4.14 0 8s3.14 7 7 7 7-3.14 7-7-3.14-7-7-7zm1 3H6v5h2V4zm0 6H6v2h2v-2z"></path></svg></span>info</div><div class="admonitionContent_BuS1"><p>If you need to specify more than one attribute or the scopes are under a nested structure like shown
below, you need to upgrade to <a href="/rabbitmq-website/docs/oauth2#step4">RabbitMQ 4.1</a>.</p><div class="language-json codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-json codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"> ...</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"> </span><span class="token property" style="color:#36acaa">&quot;resource_access&quot;</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token property" style="color:#36acaa">&quot;account&quot;</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token property" style="color:#36acaa">&quot;roles&quot;</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">[</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token string" style="color:#e3116c">&quot;manage-account&quot;</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token string" style="color:#e3116c">&quot;manage-account-links&quot;</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token string" style="color:#e3116c">&quot;view-profile&quot;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token punctuation" style="color:#393A34">]</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  ...</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">}</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div></div></div>
<h4 class="anchor anchorWithStickyNavbar_LWe7" id="step5">Step 5: Ensure your scopes are recognized RabbitMQ scopes<a href="#step5" class="hash-link" aria-label="Direct link to Step 5: Ensure your scopes are recognized RabbitMQ scopes" title="Direct link to Step 5: Ensure your scopes are recognized RabbitMQ scopes">​</a></h4>
<p>Ensure that the scopes contained in the token are recognized RabbitMQ scopes. Here are examples of
recognized RabbitMQ scopes:</p>
<ul>
<li><code>rabbitmq.tag:administrator</code> Here <code>rabbitmq</code> is the name of the <code>resource_server_id</code> you configured
in the first step. <code>tag:administrator</code> grants the administrator role to the management UI.</li>
<li><code>rabbitmq.configure:*/*</code> This scope grants the <code>configure</code> permission. The first wildcard
corresponds to the vhost and the second wildcard to the queue/exchange.</li>
</ul>
<p>They all start with a prefix that, by default, must match the name of the resource you configured
in <a href="#step1">step 1)</a>.</p>
<p>If your scopes are recognized RabbitMQ scopes, however, they start with a different prefix. You can
configure your custom prefix as follows:</p>
<div class="language-ini codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-ini codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">auth_oauth2.scope_prefix = api://</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>In the above example, you are saying that your scopes are like <code>api://tag:administrator</code>.</p>
<div class="theme-admonition theme-admonition-info admonition_xJq3 alert alert--info"><div class="admonitionHeading_Gvgb"><span class="admonitionIcon_Rf37"><svg viewBox="0 0 14 16"><path fill-rule="evenodd" d="M7 2.3c3.14 0 5.7 2.56 5.7 5.7s-2.56 5.7-5.7 5.7A5.71 5.71 0 0 1 1.3 8c0-3.14 2.56-5.7 5.7-5.7zM7 1C3.14 1 0 4.14 0 8s3.14 7 7 7 7-3.14 7-7-3.14-7-7-7zm1 3H6v5h2V4zm0 6H6v2h2v-2z"></path></svg></span>info</div><div class="admonitionContent_BuS1"><p>More information about scope prefix, check out <a href="#scope-prefix">Scope Prefix</a>.</p></div></div>
<h4 class="anchor anchorWithStickyNavbar_LWe7" id="step6">Step 6: Map custom permissions/scopes onto RabbitMQ scopes<a href="#step6" class="hash-link" aria-label="Direct link to Step 6: Map custom permissions/scopes onto RabbitMQ scopes" title="Direct link to Step 6: Map custom permissions/scopes onto RabbitMQ scopes">​</a></h4>
<p>This step is mandatory if the scopes in the token are not recognized RabbitMQ scopes. In the
previous step you saw what recognized RabbitMQ scopes look like.</p>
<p>Here you are configuring two custom scopes, <code>admin</code> and <code>developer</code>, on to RabbitMQ scopes:</p>
<div class="language-ini codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-ini codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">auth_oauth2.scope_aliases.admin = rabbitmq.tag:administrator rabbitmq.read:*/</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">auth_oauth2.scope_aliases.developer = rabbitmq.tag:management rabbitmq.read:*/* rabbitmq.write:*/* rabbitmq.configure:*/*</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<div class="theme-admonition theme-admonition-info admonition_xJq3 alert alert--info"><div class="admonitionHeading_Gvgb"><span class="admonitionIcon_Rf37"><svg viewBox="0 0 14 16"><path fill-rule="evenodd" d="M7 2.3c3.14 0 5.7 2.56 5.7 5.7s-2.56 5.7-5.7 5.7A5.71 5.71 0 0 1 1.3 8c0-3.14 2.56-5.7 5.7-5.7zM7 1C3.14 1 0 4.14 0 8s3.14 7 7 7 7-3.14 7-7-3.14-7-7-7zm1 3H6v5h2V4zm0 6H6v2h2v-2z"></path></svg></span>info</div><div class="admonitionContent_BuS1"><p>For more information about mapping scopes see <a href="/rabbitmq-website/docs/4.0/oauth2-examples#using-scope-aliases">Scope Aliases</a>.</p></div></div>
<h4 class="anchor anchorWithStickyNavbar_LWe7" id="step7">Step 7: OAuth 2.0 authentication completed for messaging protocols<a href="#step7" class="hash-link" aria-label="Direct link to Step 7: OAuth 2.0 authentication completed for messaging protocols" title="Direct link to Step 7: OAuth 2.0 authentication completed for messaging protocols">​</a></h4>
<p>RabbitMQ is ready to authenticate applications connecting through one of the supported messaging
protocols. If you additionally want to enable OAuth 2.0 in the management UI carry on with following
steps.</p>
<h4 class="anchor anchorWithStickyNavbar_LWe7" id="step8">Step 8: Enable OAuth 2.0 on the management UI<a href="#step8" class="hash-link" aria-label="Direct link to Step 8: Enable OAuth 2.0 on the management UI" title="Direct link to Step 8: Enable OAuth 2.0 on the management UI">​</a></h4>
<p>The following steps configure RabbitMQ to use OAuth 2.0 to authenticate users with their identity
provider and get a token. This is known as
<a href="/rabbitmq-website/docs/4.0/oauth2-examples#service-provider-initiated-logon">service-provider initiated logon</a>.</p>
<div class="language-ini codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-ini codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">management.oauth_enabled = true</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<div class="theme-admonition theme-admonition-info admonition_xJq3 alert alert--info"><div class="admonitionHeading_Gvgb"><span class="admonitionIcon_Rf37"><svg viewBox="0 0 14 16"><path fill-rule="evenodd" d="M7 2.3c3.14 0 5.7 2.56 5.7 5.7s-2.56 5.7-5.7 5.7A5.71 5.71 0 0 1 1.3 8c0-3.14 2.56-5.7 5.7-5.7zM7 1C3.14 1 0 4.14 0 8s3.14 7 7 7 7-3.14 7-7-3.14-7-7-7zm1 3H6v5h2V4zm0 6H6v2h2v-2z"></path></svg></span>info</div><div class="admonitionContent_BuS1"><p>After you enable OAuth 2.0 in the management UI, basic authentication is disabled unless you add the
following configuration.</p><div class="language-ini codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-ini codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">management.oauth_disable_basic_auth = false</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>For more information, check out <a href="/rabbitmq-website/docs/4.0/management#allow-basic-auth-for-mgt-ui">Allow Basic and OAuth 2 authentication for management UI</a>.</p></div></div>
<h4 class="anchor anchorWithStickyNavbar_LWe7" id="step9">Step 9: Configure OAuth client_id<a href="#step9" class="hash-link" aria-label="Direct link to Step 9: Configure OAuth client_id" title="Direct link to Step 9: Configure OAuth client_id">​</a></h4>
<div class="language-ini codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-ini codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">management.oauth_client_id = &lt;Your_Client_Id_from_your_identity_provider&gt;</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<div class="theme-admonition theme-admonition-warning admonition_xJq3 alert alert--warning"><div class="admonitionHeading_Gvgb"><span class="admonitionIcon_Rf37"><svg viewBox="0 0 16 16"><path fill-rule="evenodd" d="M8.893 1.5c-.183-.31-.52-.5-.887-.5s-.703.19-.886.5L.138 13.499a.98.98 0 0 0 0 1.001c.193.31.53.501.886.501h13.964c.367 0 .704-.19.877-.5a1.03 1.03 0 0 0 .01-1.002L8.893 1.5zm.133 11.497H6.987v-2.003h2.039v2.003zm0-3.004H6.987V5.987h2.039v4.006z"></path></svg></span>warning</div><div class="admonitionContent_BuS1"><p>The identity provider <code>UAA</code> requires a <code>client_secret</code> in addition to a <code>client_id</code>.
This is not necessary in the rest of the identity providers. The OAuth Client configured for
RabbitMQ in your identity provider should be of type <code>public web application</code> and not <code>confidential</code>.
The latter requires <code>client_secret</code>.</p></div></div>
<h4 class="anchor anchorWithStickyNavbar_LWe7" id="step10">Step 10: Configure which scopes the management UI requests from your identity provider<a href="#step10" class="hash-link" aria-label="Direct link to Step 10: Configure which scopes the management UI requests from your identity provider" title="Direct link to Step 10: Configure which scopes the management UI requests from your identity provider">​</a></h4>
<p>When RabbitMQ requests a token from the identity provider, it has to specify which scopes should
contain the token. Through the configuration variable <code>management.oauth_scopes</code> you provide a
space-separated list of scopes.</p>
<p>You always include the first two scopes <code>openid</code> and <code>profile</code> followed by any RabbitMQ scope.</p>
<div class="language-ini codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-ini codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">management.oauth_scopes = openid profile rabbitmq.tag:management</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<div class="theme-admonition theme-admonition-info admonition_xJq3 alert alert--info"><div class="admonitionHeading_Gvgb"><span class="admonitionIcon_Rf37"><svg viewBox="0 0 14 16"><path fill-rule="evenodd" d="M7 2.3c3.14 0 5.7 2.56 5.7 5.7s-2.56 5.7-5.7 5.7A5.71 5.71 0 0 1 1.3 8c0-3.14 2.56-5.7 5.7-5.7zM7 1C3.14 1 0 4.14 0 8s3.14 7 7 7 7-3.14 7-7-3.14-7-7-7zm1 3H6v5h2V4zm0 6H6v2h2v-2z"></path></svg></span>info</div><div class="admonitionContent_BuS1"><p>Some identity providers can include more scopes than the requested scopes. It depends on the actual
identity provider implementation.</p></div></div>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="how-it-works">How it works<a href="#how-it-works" class="hash-link" aria-label="Direct link to How it works" title="Direct link to How it works">​</a></h2>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="prerequisites">Prerequisites<a href="#prerequisites" class="hash-link" aria-label="Direct link to Prerequisites" title="Direct link to Prerequisites">​</a></h2>
<p>To use the OAuth 2 plugin, all RabbitMQ nodes must be</p>
<ol>
<li><a href="/rabbitmq-website/docs/4.0/access-control">Configured to use the rabbit_auth_backend_oauth2 backend</a>.</li>
<li><a href="#resource-server-id">Configured with the resource service ID</a> (<code>resource_server_id</code>). The
RabbitMQ cluster becomes an OAuth 2.0 resource and this is its identifier.</li>
<li><a href="#configure-issuer">Configured with issuer URL</a> of the OAuth 2.0 provider, or the JWKS URL, or
directly with the signing keys that the OAuth 2.0 provider uses to sign tokens.</li>
</ol>
<p>Here is the minimal configuration to support OAuth 2.0 authentication:</p>
<div class="theme-admonition theme-admonition-info admonition_xJq3 alert alert--info"><div class="admonitionHeading_Gvgb"><span class="admonitionIcon_Rf37"><svg viewBox="0 0 14 16"><path fill-rule="evenodd" d="M7 2.3c3.14 0 5.7 2.56 5.7 5.7s-2.56 5.7-5.7 5.7A5.71 5.71 0 0 1 1.3 8c0-3.14 2.56-5.7 5.7-5.7zM7 1C3.14 1 0 4.14 0 8s3.14 7 7 7 7-3.14 7-7-3.14-7-7-7zm1 3H6v5h2V4zm0 6H6v2h2v-2z"></path></svg></span>info</div><div class="admonitionContent_BuS1"><p>To activate it in the Management plugin you need <a href="/rabbitmq-website/docs/4.0/management#minimum-configuration">additional configuration</a>.</p></div></div>
<div class="language-ini codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-ini codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">auth_oauth2.resource_server_id = new_resource_server_id</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">auth_oauth2.issuer = https://my-oauth2-provider.com/realm/rabbitmq</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>Based on the previous configuration, JWT Tokens presented to RabbitMQ for authentication must:</p>
<ul>
<li>Be digitally signed.</li>
<li>Have a value in the <code>aud</code> field that matches the <code>resource_server_id</code> value.</li>
<li>Have scopes that must match the <code>resource_server_id</code> value. For example,
<code>new_resource_server_id.read:*/*</code>.</li>
</ul>
<p>Also, the <code>https://my-oauth2-provider.com/realm/rabbitmq/.well-known/openid-configuration</code> endpoint
must return the OpenID Provider Configuration which includes the JKWS URL to download the signing
keys.</p>
<div class="theme-admonition theme-admonition-info admonition_xJq3 alert alert--info"><div class="admonitionHeading_Gvgb"><span class="admonitionIcon_Rf37"><svg viewBox="0 0 14 16"><path fill-rule="evenodd" d="M7 2.3c3.14 0 5.7 2.56 5.7 5.7s-2.56 5.7-5.7 5.7A5.71 5.71 0 0 1 1.3 8c0-3.14 2.56-5.7 5.7-5.7zM7 1C3.14 1 0 4.14 0 8s3.14 7 7 7 7-3.14 7-7-3.14-7-7-7zm1 3H6v5h2V4zm0 6H6v2h2v-2z"></path></svg></span>info</div><div class="admonitionContent_BuS1"><p><em>.well-known/openid-configuration</em> is the OpenID standard path for the OpenID Provider Configuration
endpoint</p></div></div>
<p>More detail is included in the next section about what happens during the authentication and how to
configure OAuth 2.0 beyond the basic configuration shown previously.</p>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="authorization-flow">Authorization Flow<a href="#authorization-flow" class="hash-link" aria-label="Direct link to Authorization Flow" title="Direct link to Authorization Flow">​</a></h2>
<p>This plugin does not communicate with any OAuth 2.0 provider in order to authenticate the user and
grant access. Instead, it decodes an access token provided by the client and authorizes a user based
on the scopes found in the token.</p>
<p>Tokens must be digitally signed otherwise they are not accepted. RabbitMQ must have the signing key
to validate the signature. You can either configure the signing keys the OAuth 2.0 provider will
use, or configure RabbitMQ with one of the following two endpoints:</p>
<ul>
<li><strong>JWKS endpoint</strong>: This is the HTTP endpoint that returns the signing keys used to digitally sign
the tokens.</li>
<li><strong>OpenID Provider Configuration endpoint</strong>: This endpoint returns the provider&#x27;s configuration
including all of its endpoints, most importantly the <strong>JWKS endpoint</strong>.</li>
</ul>
<p>When you configure RabbitMQ with one of two previous endpoints, RabbitMQ must make a HTTP request
(or two, if we specify the latter endpoint) to download the signing keys. This is an operation that
occurs once for any signing key not downloaded yet.</p>
<p>When the OAuth 2.0 provider rotates the signing keys, newer tokens refer to a new signing key which
RabbitMQ does not have yet which triggers another download of the newer signing keys.</p>
<p>The token can be any <a href="https://jwt.io/introduction/" target="_blank" rel="noopener noreferrer">JWT token</a> which contains the <code>scope</code> and <code>aud</code>
fields.</p>
<p>In chronological order, here is the sequence of events that occur when a client application wants to
connect to one of the RabbitMQ&#x27;s messaging protocols, such as AMQP:</p>
<ol>
<li>The Client application requests an <strong>access_token</strong> from the OAuth 2.0 provider.</li>
<li>The <strong>access token</strong> must include <strong>scopes</strong> supported by RabbitMQ in the <code>scope</code> field (it is
possible to use a different field for the <strong>scopes</strong> by setting the name of the new field in
<code>auth_oauth2.additional_scopes_key</code>).</li>
<li>The Client application passes the token as password when connecting to RabbitMQ&#x27;s messaging
protocol. <strong>The username field is ignored</strong>.</li>
<li>RabbitMQ validates the token&#x27;s signature. To validate it, RabbitMQ must have the signing keys or
download them from the JWKS endpoint as explained in earlier sections.</li>
<li>RabbitMQ validates that the token has the <strong>audience</strong> claim and whose value matches the
<code>resource_server_id</code> (this operation can be deactivated by setting <code>auth_oauth2.verify_aud</code> to
<code>false</code>).</li>
<li>RabbitMQ translates the <strong>scopes</strong> found in the token into RabbitMQ <strong>permissions</strong> (the same
permissions used in the RabbitMQ&#x27;s internal database).</li>
</ol>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="variables-configurable">Variables configurable in rabbitmq.conf<a href="#variables-configurable" class="hash-link" aria-label="Direct link to Variables configurable in rabbitmq.conf" title="Direct link to Variables configurable in rabbitmq.conf">​</a></h2>
<table><thead><tr><th>Key</th><th>Documentation</th></tr></thead><tbody><tr><td><code>auth_oauth2.resource_server_id</code></td><td>The <a href="#resource-server-id">Resource Server ID</a></td></tr><tr><td><code>auth_oauth2.resource_server_type</code></td><td>The Resource Server Type required when using <a href="#rich-authorization-request">Rich Authorization Request</a> token format</td></tr><tr><td><code>auth_oauth2.additional_scopes_key</code></td><td>Configure the plugin to look for scopes in other fields (maps to <code>additional_rabbitmq_scopes</code> in the old format).</td></tr><tr><td><code>auth_oauth2.scope_prefix</code></td><td><a href="#scope-prefix">Configure the prefix for all scopes</a>. The default value is <code>auth_oauth2.resource_server_id</code> followed by the dot <code>.</code> character.</td></tr><tr><td><code>auth_oauth2.preferred_username_claims</code></td><td><a href="#preferred-username-claims">List of the JWT claims</a> to look for the username associated with the token.</td></tr><tr><td><code>auth_oauth2.default_key</code></td><td>ID of the default signing key.</td></tr><tr><td><code>auth_oauth2.signing_keys</code></td><td>Paths to the <a href="#signing-key-files">signing key files</a>.</td></tr><tr><td><code>auth_oauth2.issuer</code></td><td>The <a href="#configure-issuer">issuer URL</a> of the authorization server that is used to discover endpoints such as <code>jwks_uri</code> and others (<a href="https://openid.net/specs/openid-connect-discovery-1_0.html#ProviderMetadata" target="_blank" rel="noopener noreferrer">https://openid.net/specs/openid-connect-discovery-1_0.html#ProviderMetadata</a>).</td></tr><tr><td><code>auth_oauth2.jwks_url</code></td><td>The URL of the <a href="#jwks-endpoint">JWKS endpoint</a>. According to the <a href="https://datatracker.ietf.org/doc/html/rfc7515#section-4.1.2" target="_blank" rel="noopener noreferrer">JWT Specification</a>, the endpoint URL must be https.</td></tr><tr><td><code>auth_oauth2.token_endpoint</code></td><td>The URL of the OAuth 2.0 token endpoint.</td></tr><tr><td><code>auth_oauth2.https.cacertfile</code></td><td>Path to a file containing PEM-encoded CA certificates. The CA certificates are used to connect to any of these endpoints: <code>jwks_url</code>, <code>token_endpoint</code>, or the <code>issuer</code>.</td></tr><tr><td><code>auth_oauth2.https.depth</code></td><td>The maximum number of non-self-issued intermediate certificates that may follow the peer certificate in a valid <a href="/rabbitmq-website/docs/4.0/ssl#peer-verification-depth">certification path</a>. The default value is 10.</td></tr><tr><td><code>auth_oauth2.https.peer_verification</code></td><td>Configures <a href="/rabbitmq-website/docs/4.0/ssl#peer-verification">peer verification</a>. Available values: <code>verify_none</code>, <code>verify_peer</code>. The default value is <code>verify_peer</code> if there are trusted CA installed in the OS or <code>auth_oauth2.https.cacertfile</code> is set. <p></p> <strong>Deprecated</strong>: This variable will be soon replaced by <code>auth_oauth2.https.verify</code>. Users should stop using this variable.</td></tr><tr><td><code>auth_oauth2.https.fail_if_no_peer_cert</code></td><td>Used together with <code>auth_oauth2.https.peer_verification = verify_peer</code>. When set to <code>true</code>, TLS connection will be rejected if the client fails to provide a certificate. The default value is <code>false</code>.</td></tr><tr><td><code>auth_oauth2.https.hostname_verification</code></td><td>Enable wildcard-aware hostname verification for key server. Available values: <code>wildcard</code>, <code>none</code>. The default value is <code>none</code>.</td></tr><tr><td><code>auth_oauth2.https.crl_check</code></td><td><a href="https://www.erlang.org/doc/man/ssl#type-crl_check" target="_blank" rel="noopener noreferrer">Perform CRL verification</a> (Certificate Revocation List) verification. Default value is false.</td></tr><tr><td><code>auth_oauth2.algorithms</code></td><td>Restrict <a href="https://github.com/potatosalad/erlang-jose#algorithm-support" target="_blank" rel="noopener noreferrer">the usable algorithms</a>.</td></tr><tr><td><code>auth_oauth2.verify_aud</code></td><td>Whether to verify the <a href="#token-validation">token&#x27;s <code>aud</code></a> field or not. The default value is <code>true</code>.</td></tr><tr><td><code>auth_oauth2.resource_servers</code></td><td><a href="#multiple-resource-servers-configuration">Multiple OAuth 2.0 resources configuration</a>.</td></tr><tr><td><code>auth_oauth2.oauth_providers</code></td><td><a href="#multiple-oauth-providers-configuration">Multiple OAuth 2.0 providers configuration</a>.</td></tr><tr><td><code>auth_oauth2.default_oauth_provider</code></td><td>ID of the OAuth 2.0 provider used for the <code>auth_oauth2.resource_servers</code>, that did not specify any (via the variable <code>oauth_provider_id</code>) or when <code>auth_oauth2.jwks_url</code> and <code>auth_oauth2.issuer</code> are both missing.</td></tr></tbody></table>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="resource-server-id">Resource Server ID<a href="#resource-server-id" class="hash-link" aria-label="Direct link to Resource Server ID" title="Direct link to Resource Server ID">​</a></h2>
<p>A RabbitMQ cluster must have at least one resource server identifier configured. If it has just one
resource, this is configured in the <code>auth_oauth2.resource_server_id</code> variable and it is
<strong>mandatory</strong>. If the RabbitMQ cluster has more than one OAuth resource then they are configured
under <code>auth_oauth2.resource_servers.&lt;index&gt;</code> and in this case <code>auth_oauth2.resource_server_id</code>
variable is not mandatory.</p>
<p>RabbitMQ uses the resource server identity for these two purposes:</p>
<ul>
<li>To validate the token&#x27;s audience (<code>aud</code>) whose value must contain the resource server identifier.
This validation can be disabled though.</li>
<li>To initiate the OAuth 2.0 Authorization Code flow in the Management UI. This is the flow used to
authenticate a user and to get its access token. RabbitMQ must include the resource server
identifier in the request&#x27;s attribute called <code>resource</code>.</li>
</ul>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="scope-prefix">Scope Prefix<a href="#scope-prefix" class="hash-link" aria-label="Direct link to Scope Prefix" title="Direct link to Scope Prefix">​</a></h2>
<p>OAuth 2.0 tokens use scopes to communicate what set of permissions particular client are granted.
The scopes are free form strings.</p>
<p>By default, <code>resource_server_id</code> followed by the dot (<code>.</code>) character is the prefix used for scopes
to avoid scope collisions (or unintended overlap). However, in some environments, it is not possible
to use <code>resource_server_id</code> as the prefix for all scopes. For these environments, there is a new
variable called <code>scope_prefix</code> which overrides the default scope prefix.</p>
<p>Given the below configuration, the scope associated with the permission <code>read:*/*</code> is
<code>api://read:*/*</code>:</p>
<div class="language-ini codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-ini codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">...</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">auth_oauth2.scope_prefix = api://</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">...</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>To use an empty string as prefix, use this configuration:</p>
<div class="language-ini codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-ini codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">...</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">auth_oauth2.scope_prefix = &#x27;&#x27;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">...</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="signing-key-files">Signing keys files<a href="#signing-key-files" class="hash-link" aria-label="Direct link to Signing keys files" title="Direct link to Signing keys files">​</a></h2>
<p>The following configuration declares two signing keys and configures the kid of the default signing
key. For more information check the section <a href="#configure-signing-keys">Configure Signing keys</a>.</p>
<div class="language-ini codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-ini codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">auth_oauth2.resource_server_id = new_resource_server_id</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">auth_oauth2.additional_scopes_key = my_custom_scope_key</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">auth_oauth2.preferred_username_claims.1 = username</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">auth_oauth2.preferred_username_claims.2 = user_name</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">auth_oauth2.default_key = id1</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">auth_oauth2.signing_keys.id1 = test/config_schema_SUITE_data/certs/key.pem</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">auth_oauth2.signing_keys.id2 = test/config_schema_SUITE_data/certs/cert.pem</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">auth_oauth2.algorithms.1 = HS256</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">auth_oauth2.algorithms.2 = RS256</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="jwks-endpoint">JWKS endpoint<a href="#jwks-endpoint" class="hash-link" aria-label="Direct link to JWKS endpoint" title="Direct link to JWKS endpoint">​</a></h2>
<p>The following configuration sets the JWKS endpoint from which RabbitMQ downloads the signing keys
using the configured CA certificate and TLS variables.</p>
<div class="language-ini codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-ini codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">auth_oauth2.resource_server_id = new_resource_server_id</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">auth_oauth2.jwks_url = https://my-jwt-issuer/jwks.json</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">auth_oauth2.https.cacertfile = test/config_schema_SUITE_data/certs/cacert.pem</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">auth_oauth2.https.peer_verification = verify_peer</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">auth_oauth2.https.depth = 5</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">auth_oauth2.https.fail_if_no_peer_cert = true</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">auth_oauth2.https.hostname_verification = wildcard</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">auth_oauth2.algorithms.1 = HS256</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">auth_oauth2.algorithms.2 = RS256</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="multiple-resource-servers-configuration">Multiple Resource Servers configuration<a href="#multiple-resource-servers-configuration" class="hash-link" aria-label="Direct link to Multiple Resource Servers configuration" title="Direct link to Multiple Resource Servers configuration">​</a></h2>
<p>Each <code>auth_oauth2.resource_servers.&lt;id/index&gt;.</code> entry has the following variables shown in the table
below. Except for the variables <code>id</code> and <code>oauth_provider_id</code>, if a resource does not configure a
variable, RabbitMQ uses the variable configured at the root level.</p>
<p>For example, if the resource <code>auth_oauth2.resource_servers.prod</code> does not configure
<code>preferred_username_claims</code> variable, RabbitMQ uses the value configured in
<code>auth_oauth2.preferred_username_claims</code> for the resource <code>prod</code>.</p>
<table><thead><tr><th>Key</th><th>Documentation</th></tr></thead><tbody><tr><td><code>id</code></td><td>The <a href="#resource-server-id">Resource Server ID</a></td></tr><tr><td><code>resource_server_type</code></td><td>The Resource Server Type required when using <a href="#rich-authorization-request">Rich Authorization Request</a> token format.</td></tr><tr><td><code>additional_scopes_key</code></td><td>Configure the plugin to look for scopes in other fields (maps to <code>additional_rabbitmq_scopes</code> in the old format).</td></tr><tr><td><code>scope_prefix</code></td><td><a href="#scope-prefix">Configure the prefix for all scopes</a>. The default value is <code>auth_oauth2.resource_server_id</code> followed by the dot <code>.</code> character.</td></tr><tr><td><code>preferred_username_claims</code></td><td><a href="#preferred-username-claims">List of the JWT claims</a> to look for the username associated with the token separated by commas.</td></tr><tr><td><code>oauth_provider_id</code></td><td>The identifier of the OAuth Provider associated to this resource. RabbitMQ uses the signing keys issued by this OAuth Provider to validate tokens whose audience matches this resource&#x27;s id.</td></tr></tbody></table>
<p>All available configurable parameters for each OAuth 2 provider is documented
<a href="#multiple-oauth-providers-configuration">in a separate section</a>.</p>
<p>Usually, a numeric value is used as <code>index</code>. For example,
<code>auth_oauth2.resource_servers.1.id = rabbit_prod</code>. However, it can be any string, such as
<code>auth_oauth2.resource_servers.rabbit_prod.jwks_url = http://some_url</code>. By default, the <code>index</code> is
the resource server&#x27;s ID. However, you can override it via the <code>id</code> variable like in
<code>auth_oauth2.resource_servers.1.id = rabbit_prod</code>.</p>
<p>Here is an example which configures two resources (<code>prod</code> and <code>dev</code>) which are used by the users and
clients managed by the same identity provider whose issuer URL is <code>https://my-idp.com/</code>:</p>
<div class="language-ini codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-ini codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">auth_oauth2.issuer = https://my-idp.com/</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">auth_oauth2.resource_servers.1.id = prod</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">auth_oauth2.resource_servers.2.id = dev</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>See the advanced usage section called <a href="#multiple-resource-servers">Multiple Resource Servers</a> for
more information on how to configure them.</p>
<h4 class="anchor anchorWithStickyNavbar_LWe7" id="multiple-oauth-providers-configuration">Multiple OAuth Providers configuration<a href="#multiple-oauth-providers-configuration" class="hash-link" aria-label="Direct link to Multiple OAuth Providers configuration" title="Direct link to Multiple OAuth Providers configuration">​</a></h4>
<p>Each <code>auth_oauth2.oauth_providers.{id/index}</code> entry has the following sub-keys.</p>
<table><thead><tr><th>Key</th><th>Documentation</th></tr></thead><tbody><tr><td><code>issuer</code></td><td>URL of OAuth Provider. RabbitMQ uses this URL to build the OpenId Connect Discovery endpoint by appending the path <code>.well-known/openid-configuration</code> to this URL</td></tr><tr><td><code>token_endpoint</code></td><td>The URL of the OAuth 2.0 token endpoint.</td></tr><tr><td><code>jwks_uri</code></td><td>The URL of the <a href="#jwks-endpoint">JWKS endpoint</a>. According to the <a href="https://datatracker.ietf.org/doc/html/rfc7515#section-4.1.2" target="_blank" rel="noopener noreferrer">JWT Specification</a>, the endpoint URL must use &quot;https&quot; for schema. <p></p><strong>Warning</strong>: RabbitMQ uses for each OAuth Provider the variable name <code>jwks_uri</code> used by the OpenId Connect Discovery Specification rather than <code>jwks_url</code>.</td></tr><tr><td><code>https.cacertfile</code></td><td>Path to a file containing PEM-encoded CA certificates used to connect <code>issuer</code> and/or <code>jwks_uri</code> URLs</td></tr><tr><td><code>https.depth</code></td><td>The maximum number of non-self-issued intermediate certificates that may follow the peer certificate in a valid <a href="/rabbitmq-website/docs/4.0/ssl#peer-verification-depth">certification path</a>. The default value is 10.</td></tr><tr><td><code>https.verify</code></td><td>Configures <a href="/rabbitmq-website/docs/4.0/ssl#peer-verification">peer verification</a>. Available values: <code>verify_none</code>, <code>verify_peer</code>. The default value is <code>verify_peer</code> if there are trusted CA installed in the OS or <code>auth_oauth2.https.cacertfile</code> is set.</td></tr><tr><td><code>https.fail_if_no_peer_cert</code></td><td>Used together with <code>auth_oauth2.https.peer_verification = verify_peer</code>. When set to <code>true</code>, TLS connection will be rejected if the client fails to provide a certificate. The default value is <code>false</code>.</td></tr><tr><td><code>https.hostname_verification</code></td><td>Enable wildcard-aware hostname verification for key server. Available values: <code>wildcard</code>, <code>none</code>. The default value is <code>none</code>.</td></tr><tr><td><code>https.crl_check</code></td><td><a href="https://www.erlang.org/doc/man/ssl#type-crl_check" target="_blank" rel="noopener noreferrer">Perform CRL verification</a> (Certificate Revocation List) verification. Default value is false.</td></tr><tr><td><code>signing_keys</code></td><td>Local filesystem paths to the <a href="#signing-key-files">signing key files</a>. The files must exist and be readable</td></tr><tr><td><code>default_key</code></td><td>ID of the default signing key</td></tr><tr><td><code>algorithms</code></td><td>Used to restrict <a href="https://github.com/potatosalad/erlang-jose#algorithm-support" target="_blank" rel="noopener noreferrer">the list of enabled algorithms</a></td></tr></tbody></table>
<p>Here is an example that configures two resources (<code>prod</code> and <code>dev</code>) where each resource is managed
by two distinct identity providers:</p>
<div class="language-ini codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-ini codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">auth_oauth2.scope_prefix = rabbitmq.</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">auth_oauth2.resource_servers.1.id = prod</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">auth_oauth2.resource_servers.1.oauth_provider_id = idp_prod</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">auth_oauth2.resource_servers.2.id = dev</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">auth_oauth2.resource_servers.2.oauth_provider_id = idp_dev</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">auth_oauth2.oauth_providers.idp_prod.issuer = https://idp_prod.com</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">auth_oauth2.oauth_providers.idp_dev.issuer = https://idp_dev.com</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>See the advanced usage section called <a href="#multiple-oauth-providers">Multiple OAuth Providers</a> for more
information on how to configure them.</p>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="token-validation">Token validation<a href="#token-validation" class="hash-link" aria-label="Direct link to Token validation" title="Direct link to Token validation">​</a></h3>
<p>When RabbitMQ receives a JWT token, it validates it before accepting it.</p>
<h4 class="anchor anchorWithStickyNavbar_LWe7" id="must-be-digitally-signed">Must be digitally signed<a href="#must-be-digitally-signed" class="hash-link" aria-label="Direct link to Must be digitally signed" title="Direct link to Must be digitally signed">​</a></h4>
<p>The token must carry a digital signature and optionally a <code>kid</code> header attribute which identifies
the key RabbitMQ should use to validate the signature.</p>
<h4 class="anchor anchorWithStickyNavbar_LWe7" id="must-not-be-expired">Must not be expired<a href="#must-not-be-expired" class="hash-link" aria-label="Direct link to Must not be expired" title="Direct link to Must not be expired">​</a></h4>
<p>RabbitMQ uses this field <code>exp</code> (<a href="https://tools.ietf.org/html/rfc7519#page-9" target="_blank" rel="noopener noreferrer">exp</a>) to validate the
token if present. It contains the expiration time after which the JWT MUST NOT be accepted for
processing.</p>
<h4 class="anchor anchorWithStickyNavbar_LWe7" id="audience-must-havematch-the-resource_server_id">Audience must have/match the resource_server_id<a href="#audience-must-havematch-the-resource_server_id" class="hash-link" aria-label="Direct link to Audience must have/match the resource_server_id" title="Direct link to Audience must have/match the resource_server_id">​</a></h4>
<p>The <code>aud</code> (<a href="https://tools.ietf.org/html/rfc7519#page-9" target="_blank" rel="noopener noreferrer">Audience</a>) identifies the recipients and/or
resource_server of the JWT.</p>
<p>By default, <strong>RabbitMQ uses this field to validate the token</strong>. This validation can be disabled by
setting the <code>auth_oauth2.verify_aud</code> setting set to <code>false</code>. When verification is enabled, this
<code>aud</code> field must either match the <code>resource_server_id</code> value or, in case of a list, it must contain
the <code>resource_server_id</code> value.</p>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="token-expiration">Token expiration and refresh<a href="#token-expiration" class="hash-link" aria-label="Direct link to Token expiration and refresh" title="Direct link to Token expiration and refresh">​</a></h3>
<p>For AMQP 0.9.1, when a token expires on an existing connection, the broker refuses further
operations after a limited time, but does not disconnect the client. To refresh the token, the
client can use the AMQP 0.9.1 <a href="/rabbitmq-website/docs/4.0/extensions">update-secret</a> method if supported by the client. For
an example, see the
<a href="/rabbitmq-website/client-libraries/java-api-guide#oauth2-refreshing-token">Java client documentation</a>. If the client
does not support <a href="/rabbitmq-website/docs/4.0/extensions"><code>update-secret</code></a>, it must disconnect and reconnect with a new
token.</p>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="scope-translation">Scope-to-Permission translation<a href="#scope-translation" class="hash-link" aria-label="Direct link to Scope-to-Permission translation" title="Direct link to Scope-to-Permission translation">​</a></h3>
<p>Scopes are translated into permission grants to RabbitMQ resources for the provided token.</p>
<p>The current scope format is <code>&lt;permission&gt;:&lt;vhost_pattern&gt;/&lt;name_pattern&gt;[/&lt;routing_key_pattern&gt;]</code>
where</p>
<ul>
<li><code>&lt;permission&gt;</code> is an access permission (<code>configure</code>, <code>read</code>, or <code>write</code>)</li>
<li><code>&lt;vhost_pattern&gt;</code> is a wildcard pattern for vhosts token has access to.</li>
<li><code>&lt;name_pattern&gt;</code> is a wildcard pattern for resource name</li>
<li><code>&lt;routing_key_pattern&gt;</code> is a wildcard pattern for routing key in topic authorization</li>
</ul>
<p>Wildcard patterns are strings with optional wildcard symbols <code>*</code> that match any sequence of
characters.</p>
<p>Wildcard patterns match as following:</p>
<ul>
<li><code>*</code> matches any string</li>
<li><code>foo*</code> matches any string starting with a <code>foo</code></li>
<li><code>*foo</code> matches any string ending with a <code>foo</code></li>
<li><code>foo*bar</code> matches any string starting with a <code>foo</code> and ending with a <code>bar</code></li>
</ul>
<p>There can be multiple wildcards in a pattern:</p>
<ul>
<li><code>start*middle*end</code></li>
<li><code>*before*after*</code></li>
</ul>
<p><strong>To use special characters like <code>*</code>, <code>%</code>, or <code>/</code> in a wildcard pattern, the pattern must be
<a href="https://en.wikipedia.org/wiki/Percent-encoding" target="_blank" rel="noopener noreferrer">URL-encoded</a>.</strong></p>
<p>These are the usually permissions examples:</p>
<ul>
<li><code>read:*/*</code>(<code>read:*/*/*</code>) - read permissions to any resource on any vhost</li>
<li><code>write:*/*</code>(<code>write:*/*/*</code>) - write permissions to any resource on any vhost</li>
<li><code>read:vhost1/*</code>(<code>read:vhost1/*/*</code>) - read permissions to any resource on the <code>vhost1</code> vhost</li>
<li><code>read:vhost1/some*</code> - read permissions to all the resources, starting with <code>some</code> on the <code>vhost1</code>
vhost</li>
<li><code>write:vhost1/some*/routing*</code> - topic write permissions to publish to an exchange starting with
<code>some</code> with a routing key starting with <code>routing</code></li>
<li><code>read:*/*/*</code> and <code>write:*/*/*</code> - queue binding permissions required to bind a queue on a topic
exchange with any routing key</li>
</ul>
<p>See the
<a href="https://github.com/rabbitmq/rabbitmq-server/blob/main/deps/rabbitmq_auth_backend_oauth2/test/wildcard_match_SUITE.erl" target="_blank" rel="noopener noreferrer">wildcard matching test suite</a>
and
<a href="https://github.com/rabbitmq/rabbitmq-server/blob/main/deps/rabbitmq_auth_backend_oauth2/test/scope_SUITE.erl" target="_blank" rel="noopener noreferrer">scopes test suite</a>
for more examples.</p>
<p>Scopes, by default, are prefixed with <code>resource_server_id</code> followed by the dot (<code>.</code>) character if
<code>scope_prefix</code> is not configured. For example, if <code>resource_server_id</code> is &quot;my_rabbit&quot;, a scope to
enable read from any vhost will be <code>my_rabbit.read:*/*</code>.</p>
<p>If <code>scope_prefix</code> is configured then scopes are prefixed as follows: <code>&lt;scope_prefix&gt;&lt;permission&gt;</code>.
For example, if <code>scope_prefix</code> is <code>api://</code> and the permission is <code>read:*/*</code> the scope would be
<code>api://read:*/*</code></p>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="topic-exchange-scopes">Topic Exchange scopes<a href="#topic-exchange-scopes" class="hash-link" aria-label="Direct link to Topic Exchange scopes" title="Direct link to Topic Exchange scopes">​</a></h3>
<p>The <a href="#scope-translation">previous</a> section explained, in detail, how permissions are mapped to
scopes. This section explains more specifically what scopes you need in order to operate on <strong>Topic
Exchanges</strong>.</p>
<p>To bind and/or unbind a queue to/from a <strong>Topic Exchange</strong>, you need to have the following scopes:</p>
<ul>
<li><strong>write</strong> permission on the queue and routing key -&gt; <code>rabbitmq.write:&lt;vhost&gt;/&lt;queue&gt;/&lt;routingkey&gt;</code></li>
</ul>
<blockquote>
<p>for example <code>rabbitmq.write:*/*/*</code></p>
</blockquote>
<ul>
<li><strong>read</strong> permission on the exchange and routing key -&gt; <code>rabbitmq.write:&lt;vhost&gt;/&lt;exchange&gt;/&lt;routingkey&gt;</code></li>
</ul>
<blockquote>
<p>for example <code>rabbitmq.read:*/*/*</code></p>
</blockquote>
<p>To publish to a <strong>Topic Exchange</strong>, you need to have the following scope:</p>
<ul>
<li><strong>write</strong> permission on the exchange and routing key -&gt; <code>rabbitmq.write:&lt;vhost&gt;/&lt;exchange&gt;/&lt;routingkey&gt;</code></li>
</ul>
<blockquote>
<p>for example <code>rabbitmq.write:*/*/*</code></p>
</blockquote>
<p>OAuth 2.0 authorization backend supports variable expansion when checking permission on topics. It
supports JWT claims whose value is a plain string, plus the <code>vhost</code> variable.</p>
<p>For example, a user connected with the token below to the vhost <code>prod</code> should have a write
permission on all exchanges starting with <code>x-prod-</code>, and any routing key starting with <code>u-bob-</code>:</p>
<div class="language-json codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-json codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token property" style="color:#36acaa">&quot;sub&quot;</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;bob&quot;</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token property" style="color:#36acaa">&quot;scope&quot;</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">[</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;rabbitmq.write:*/x-{vhost}-*/u-{sub}-*&quot;</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">]</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">}</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="scope-and-tags">Scope and tags<a href="#scope-and-tags" class="hash-link" aria-label="Direct link to Scope and tags" title="Direct link to Scope and tags">​</a></h3>
<p>Users in RabbitMQ can have <a href="/rabbitmq-website/docs/4.0/access-control#user-tags">tags associated with them</a>. Tags are used to
<a href="/rabbitmq-website/docs/4.0/management#permissions">control access to the management plugin</a>.</p>
<p>In the OAuth context, tags can be added as part of the scope, using a format like
<code>&lt;resource_server_id&gt;.tag:&lt;tag&gt;</code>. For example, if the <code>resource_server_id</code> is &quot;my_rabbit&quot;, a scope
to grant access to the management plugin with the <code>monitoring</code> tag will be
<code>my_rabbit.tag:monitoring</code>.</p>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="basic-usage">Basic usage<a href="#basic-usage" class="hash-link" aria-label="Direct link to Basic usage" title="Direct link to Basic usage">​</a></h2>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="configure-issuer">Configure OAuth 2.0 provider&#x27;s issuer<a href="#configure-issuer" class="hash-link" aria-label="Direct link to Configure OAuth 2.0 provider&#x27;s issuer" title="Direct link to Configure OAuth 2.0 provider&#x27;s issuer">​</a></h3>
<p>Before RabbitMQ 3.13, users had to either configure the JWKS endpoint (that is
<code>auth_oauth2.jwks_url</code> variable) or statically
<a href="#configure-signing-keys">configure the signing keys</a>. Now, users only need to configure the OpenID
Provider&#x27;s <strong>issuer</strong> URL and from this URL RabbitMQ downloads the OpenID Provider configuration
which includes the JWKS endpoint in addition to other endpoints which will be useful in other
contexts.</p>
<p>Usually, this <strong>issuer</strong> URL is the same URL configured in the management plugin
(<code>management.oauth_provider_url</code>). From now on, you only need to configure a single URL, specified
by the <code>auth_oauth2.issuer</code> variable. Except in edge cases where the <strong>issuer</strong> URL does not host
the login page. In that cases, the user configures the login page in the
<code>management.oauth_provider_url</code> variable.</p>
<p>Sample configuration using issuer:</p>
<div class="language-ini codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-ini codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">auth_oauth2.resource_server_id = my_rabbit_server</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">auth_oauth2.issuer = https://my-idp-provider/somerealm</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>Sample configuration which configures the jwks_url rather than the issuer:</p>
<div class="language-ini codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-ini codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">auth_oauth2.resource_server_id = my_rabbit_server</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">auth_oauth2.jwks_url = &quot;https://my-jwt-issuer/jwks.json</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<div class="theme-admonition theme-admonition-info admonition_xJq3 alert alert--info"><div class="admonitionHeading_Gvgb"><span class="admonitionIcon_Rf37"><svg viewBox="0 0 14 16"><path fill-rule="evenodd" d="M7 2.3c3.14 0 5.7 2.56 5.7 5.7s-2.56 5.7-5.7 5.7A5.71 5.71 0 0 1 1.3 8c0-3.14 2.56-5.7 5.7-5.7zM7 1C3.14 1 0 4.14 0 8s3.14 7 7 7 7-3.14 7-7-3.14-7-7-7zm1 3H6v5h2V4zm0 6H6v2h2v-2z"></path></svg></span>info</div><div class="admonitionContent_BuS1"><p>If you have both endpoints configured, RabbitMQ uses <code>jwks_url</code> because it does not need to discover
it via the <code>issuer</code> url.</p></div></div>
<div class="theme-admonition theme-admonition-info admonition_xJq3 alert alert--info"><div class="admonitionHeading_Gvgb"><span class="admonitionIcon_Rf37"><svg viewBox="0 0 14 16"><path fill-rule="evenodd" d="M7 2.3c3.14 0 5.7 2.56 5.7 5.7s-2.56 5.7-5.7 5.7A5.71 5.71 0 0 1 1.3 8c0-3.14 2.56-5.7 5.7-5.7zM7 1C3.14 1 0 4.14 0 8s3.14 7 7 7 7-3.14 7-7-3.14-7-7-7zm1 3H6v5h2V4zm0 6H6v2h2v-2z"></path></svg></span>info</div><div class="admonitionContent_BuS1"><p><strong>Note about TLS variables for the <code>jwks_url</code> or the <code>issuer</code> url</strong>: TLS variable such as the
<code>cacertfile</code> are configured as follows regardless which url we are using:</p></div></div>
<div class="language-ini codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-ini codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">...</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">auth_oauth2.https.cacertfile = /opts/certs/cacert.pem</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">...</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p><strong>VERY IMPORTANT</strong>: Since RabbitMQ 3.13, if <code>auth_oauth2.https.peer_verification</code> variable is not
set, RabbitMQ sets it to <code>verify_peer</code> as long as there are trusted certificates installed in the OS
or the user configured <code>auth_oauth2.https.cacertfile</code>.</p>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="configure-signing-keys">Configure signing keys<a href="#configure-signing-keys" class="hash-link" aria-label="Direct link to Configure signing keys" title="Direct link to Configure signing keys">​</a></h3>
<p>Currently, it is very rare you configure RabbitMQ with signing keys, when RabbitMQ can automatically
download them as explained in the previous section. However, RabbitMQ supports those edge cases
where you need to statically configure the signing keys, or when you need to support symmetric
signing keys as opposed to the most widely used asymmetric keys.</p>
<p>The following example uses <a href="https://github.com/cloudfoundry/uaa" target="_blank" rel="noopener noreferrer">Cloud Foundry UAA</a> as the OAuth 2.0
provider.</p>
<p>To get the signing key from the <a href="https://github.com/cloudfoundry/uaa" target="_blank" rel="noopener noreferrer">OAuth 2.0 provider UAA</a>, use
the
<a href="https://docs.cloudfoundry.org/api/uaa/version/4.6.0/index.html#token-key-s" target="_blank" rel="noopener noreferrer">token_key endpoint</a> or
<a href="https://github.com/cloudfoundry/cf-uaac" target="_blank" rel="noopener noreferrer">uaac</a> (the <code>uaac signing key</code> command).</p>
<p>The following fields are required: <code>kty</code>, <code>value</code>, <code>alg</code>, and <code>kid</code>.</p>
<p>Assuming UAA reports the following signing key information:</p>
<div class="language-erlang codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-erlang codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token atom">uaac</span><span class="token plain"> </span><span class="token atom">signing</span><span class="token plain"> </span><span class="token atom">key</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token atom">kty</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> </span><span class="token variable" style="color:#36acaa">RSA</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token atom">e</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> </span><span class="token variable" style="color:#36acaa">AQAB</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token atom">use</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> </span><span class="token atom">sig</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token atom">kid</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> </span><span class="token atom">a</span><span class="token operator" style="color:#393A34">-</span><span class="token atom">key</span><span class="token operator" style="color:#393A34">-</span><span class="token variable" style="color:#36acaa">ID</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token atom">alg</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> </span><span class="token variable" style="color:#36acaa">RS256</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token atom">value</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">--</span><span class="token operator" style="color:#393A34">--</span><span class="token operator" style="color:#393A34">-</span><span class="token variable" style="color:#36acaa">BEGIN</span><span class="token plain"> </span><span class="token variable" style="color:#36acaa">PUBLIC</span><span class="token plain"> </span><span class="token variable" style="color:#36acaa">KEY</span><span class="token operator" style="color:#393A34">--</span><span class="token operator" style="color:#393A34">--</span><span class="token operator" style="color:#393A34">-</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token variable" style="color:#36acaa">MIIBIjANBgkqhkiG9w0BAQEFAAOCAQ8AMIIBCgKCAQEA2dP</span><span class="token operator" style="color:#393A34">+</span><span class="token atom">vRn</span><span class="token operator" style="color:#393A34">+</span><span class="token variable" style="color:#36acaa">Kj</span><span class="token operator" style="color:#393A34">+</span><span class="token variable" style="color:#36acaa">S</span><span class="token operator" style="color:#393A34">/</span><span class="token atom">oGd49kq</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token number" style="color:#36acaa">6</span><span class="token operator" style="color:#393A34">+</span><span class="token variable" style="color:#36acaa">CKNAduCC1raLfTH7B3qjmZYm45yDl</span><span class="token operator" style="color:#393A34">+</span><span class="token variable" style="color:#36acaa">XmgK9CNmHXkho9qvmhdksdzDVsdeDlhK</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token variable" style="color:#36acaa">IdcIWadhqDzdtn1hj</span><span class="token operator" style="color:#393A34">/</span><span class="token number" style="color:#36acaa">22</span><span class="token atom">iUwrhH0bd475hlKcsiZ</span><span class="token operator" style="color:#393A34">+</span><span class="token atom">oy</span><span class="token operator" style="color:#393A34">/</span><span class="token atom">sdgGgAzvmmTQmdMqEXqV2</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token variable" style="color:#36acaa">B9q9KFBmo4Ahh</span><span class="token operator" style="color:#393A34">/</span><span class="token number" style="color:#36acaa">6</span><span class="token operator" style="color:#393A34">+</span><span class="token atom">d4wM1rH9kxl0RvMAKLe</span><span class="token operator" style="color:#393A34">+</span><span class="token atom">daoIHIjok8hCO4cKQQEw</span><span class="token operator" style="color:#393A34">/</span><span class="token variable" style="color:#36acaa">ErBe4SF</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token number" style="color:#36acaa">2</span><span class="token atom">cr3wQwCfF1qVu4eAVNVfxfy</span><span class="token operator" style="color:#393A34">/</span><span class="token atom">uEvG3Q7x005P3TcK</span><span class="token operator" style="color:#393A34">+</span><span class="token variable" style="color:#36acaa">QcYgJxav3lictSi5dyWLgG</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token variable" style="color:#36acaa">QAvkknWitpRK8KVLypEj5WKej6CF8nq30utn15FQg0JkHoqzwiCqqeen8GIPteI7</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token variable" style="color:#36acaa">VwIDAQAB</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token operator" style="color:#393A34">--</span><span class="token operator" style="color:#393A34">--</span><span class="token operator" style="color:#393A34">-</span><span class="token variable" style="color:#36acaa">END</span><span class="token plain"> </span><span class="token variable" style="color:#36acaa">PUBLIC</span><span class="token plain"> </span><span class="token variable" style="color:#36acaa">KEY</span><span class="token operator" style="color:#393A34">--</span><span class="token operator" style="color:#393A34">--</span><span class="token operator" style="color:#393A34">-</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token atom">n</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> </span><span class="token variable" style="color:#36acaa">ANnT_r0Z_io_kv6BnePZKuvgijQHbggta2i30x</span><span class="token operator" style="color:#393A34">-</span><span class="token atom">wd6o5mWJuOcg5fl5oCvQjZh15IaPar5oXZLHcw1bHXg5YSiHXCFmnYag83bZ9YY_9tolMK4R9G3eO</span><span class="token operator" style="color:#393A34">-</span><span class="token variable" style="color:#36acaa">YZSnLImfqMv7HYBoAM75pk0JnTKhF6ldgfavShQZqOAIYf</span><span class="token operator" style="color:#393A34">-</span><span class="token atom">vneMDNax_ZMZdEbzACi3vnWqCByI6JPIQju</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token variable" style="color:#36acaa">HCkEBMPxKwXuEhdnK98EMAnxdalbuHgFTVX8X8v7hLxt0O8dNOT903CvkHGICcWr95YnLUouXcli4BkAL5JJ1oraUSvClS8qRI</span><span class="token operator" style="color:#393A34">-</span><span class="token variable" style="color:#36acaa">Vino</span><span class="token operator" style="color:#393A34">-</span><span class="token atom">ghfJ6t9LrZ9eRUINCZB6Ks8Igqqnnp_BiD7XiO1c</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>it translates into the following configuration (in the <a href="/rabbitmq-website/docs/4.0/configure">advanced RabbitMQ config format</a>):</p>
<div class="language-ini codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-ini codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">auth_oauth2.resource_server_id = my_rabbit_server</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">auth_oauth2.signing_keys.a-key-ID = /path-to-signing-key-pem-file</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>If a symmetric key is used, the configuration looks like this:</p>
<div class="language-erlang codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-erlang codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token punctuation" style="color:#393A34">[</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token punctuation" style="color:#393A34">{</span><span class="token atom">rabbitmq_auth_backend_oauth2</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">[</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token punctuation" style="color:#393A34">{</span><span class="token atom">resource_server_id</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">&lt;&lt;</span><span class="token string" style="color:#e3116c">&quot;my_rabbit_server&quot;</span><span class="token punctuation" style="color:#393A34">&gt;&gt;</span><span class="token punctuation" style="color:#393A34">}</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token punctuation" style="color:#393A34">{</span><span class="token atom">key_config</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">[</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token punctuation" style="color:#393A34">{</span><span class="token atom">signing_keys</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">#</span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token punctuation" style="color:#393A34">&lt;&lt;</span><span class="token string" style="color:#e3116c">&quot;a-key-ID&quot;</span><span class="token punctuation" style="color:#393A34">&gt;&gt;</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">=</span><span class="token operator" style="color:#393A34">&gt;</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token atom">map</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">#</span><span class="token punctuation" style="color:#393A34">{</span><span class="token punctuation" style="color:#393A34">&lt;&lt;</span><span class="token string" style="color:#e3116c">&quot;kty&quot;</span><span class="token punctuation" style="color:#393A34">&gt;&gt;</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">=</span><span class="token operator" style="color:#393A34">&gt;</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">&lt;&lt;</span><span class="token string" style="color:#e3116c">&quot;MAC&quot;</span><span class="token punctuation" style="color:#393A34">&gt;&gt;</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                                  </span><span class="token punctuation" style="color:#393A34">&lt;&lt;</span><span class="token string" style="color:#e3116c">&quot;alg&quot;</span><span class="token punctuation" style="color:#393A34">&gt;&gt;</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">=</span><span class="token operator" style="color:#393A34">&gt;</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">&lt;&lt;</span><span class="token string" style="color:#e3116c">&quot;HS256&quot;</span><span class="token punctuation" style="color:#393A34">&gt;&gt;</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                                  </span><span class="token punctuation" style="color:#393A34">&lt;&lt;</span><span class="token string" style="color:#e3116c">&quot;value&quot;</span><span class="token punctuation" style="color:#393A34">&gt;&gt;</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">=</span><span class="token operator" style="color:#393A34">&gt;</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">&lt;&lt;</span><span class="token string" style="color:#e3116c">&quot;my_signing_key&quot;</span><span class="token punctuation" style="color:#393A34">&gt;&gt;</span><span class="token punctuation" style="color:#393A34">}</span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token punctuation" style="color:#393A34">}</span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token punctuation" style="color:#393A34">]</span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token punctuation" style="color:#393A34">]</span><span class="token punctuation" style="color:#393A34">}</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">]</span><span class="token punctuation" style="color:#393A34">.</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="use-different-token-field">Use a different token field for the scope<a href="#use-different-token-field" class="hash-link" aria-label="Direct link to Use a different token field for the scope" title="Direct link to Use a different token field for the scope">​</a></h3>
<p>By default the plugin looks for the <code>scope</code> key in the token, you can configure the plugin to also
look in other fields using the <code>extra_scopes_source</code> variable. Values format accepted are scope as
<strong>string</strong> or <strong>list</strong></p>
<div class="language-ini codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-ini codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">auth_oauth2.resource_server_id = my_rabbit_server</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">auth_oauth2.additional_scopes_key = my_custom_scope_key</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>Token sample:</p>
<div class="language-ini codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-ini codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">{</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"> &quot;exp&quot;: 1618592626,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"> &quot;iat&quot;: 1618578226,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"> &quot;aud&quot; : [&quot;my_id&quot;],</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"> ...</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"> &quot;scope_as_string&quot;: &quot;my_id.configure:*/* my_id.read:*/* my_id.write:*/*&quot;,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"> &quot;scope_as_list&quot;: [&quot;my_id.configure:*/*&quot;, &quot;my_id.read:*/*&quot;, &quot;my_id.write:*/*&quot;],</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"> ...</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"> }</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="preferred-username-claims">Preferred username claims<a href="#preferred-username-claims" class="hash-link" aria-label="Direct link to Preferred username claims" title="Direct link to Preferred username claims">​</a></h3>
<p>The username associated with the token must be available to RabbitMQ so that this username is
displayed in the RabbitMQ Management UI. By default, RabbitMQ searches for the <code>sub</code> claim first,
and if it is not found, RabbitMQ uses the <code>client_id</code>.</p>
<p>Most authorization servers return the user&#x27;s GUID in the <code>sub</code> claim instead of the user&#x27;s username
or email address, anything the user can relate to. When the <code>sub</code> claim does not carry a
<em>user-friendly username</em>, you can configure one or several claims to extract the username from the
token.</p>
<p>Example <code>rabbitmq.conf</code> configuration:</p>
<div class="language-ini codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-ini codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain"># ...</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">auth_oauth2.resource_server_id = rabbitmq</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">auth_oauth2.preferred_username_claims.1 = user_name</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">auth_oauth2.preferred_username_claims.2 = email</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"># ...</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>In the example configuration, RabbitMQ searches for the <code>user_name</code> claim first and if it is not
found, RabbitMQ searches for the <code>email</code>. If these are not found, RabbitMQ uses its default lookup
mechanism which first looks for <code>sub</code> and then <code>client_id</code>.</p>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="rich-authorization-request">Rich Authorization Request<a href="#rich-authorization-request" class="hash-link" aria-label="Direct link to Rich Authorization Request" title="Direct link to Rich Authorization Request">​</a></h3>
<p>The <a href="https://oauth.net/2/rich-authorization-requests/" target="_blank" rel="noopener noreferrer">Rich Authorization Request</a> extension
provides a way for OAuth clients to request fine-grained permissions during an authorization
request. It moves away from the concept of scopes that are text labels and instead defines a more
sophisticated permission model.</p>
<p>RabbitMQ supports JWT tokens compliant with the extension. Below is a sample example section of JWT
token:</p>
<div class="language-javascript codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-javascript codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token string-property property" style="color:#36acaa">&quot;authorization_details&quot;</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">[</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token string-property property" style="color:#36acaa">&quot;type&quot;</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;rabbitmq&quot;</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token string-property property" style="color:#36acaa">&quot;locations&quot;</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">[</span><span class="token string" style="color:#e3116c">&quot;cluster:finance/vhost:production-*&quot;</span><span class="token punctuation" style="color:#393A34">]</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token string-property property" style="color:#36acaa">&quot;actions&quot;</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">[</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;read&quot;</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;write&quot;</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;configure&quot;</span><span class="token plain">  </span><span class="token punctuation" style="color:#393A34">]</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token punctuation" style="color:#393A34">}</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token string-property property" style="color:#36acaa">&quot;type&quot;</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;rabbitmq&quot;</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token string-property property" style="color:#36acaa">&quot;locations&quot;</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">[</span><span class="token string" style="color:#e3116c">&quot;cluster:finance&quot;</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;cluster:inventory&quot;</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">]</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token string-property property" style="color:#36acaa">&quot;actions&quot;</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">[</span><span class="token string" style="color:#e3116c">&quot;administrator&quot;</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">]</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token punctuation" style="color:#393A34">]</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">}</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>The token above contains two permissions under the attribute <code>authorization_details</code>. Both
permissions are meant for RabbitMQ servers with <code>resource_server_type</code> set to <code>rabbitmq</code>. This field
identifies RabbitMQ-specific permissions.</p>
<p>The first permission grants <code>read</code>, <code>write</code> and <code>configure</code> permissions to any queue and/or exchange
on any virtual host whose name matches the pattern <code>production-*</code>, and that reside in clusters whose
<code>resource_server_id</code> contains the string <code>finance</code>. The <code>cluster</code> attribute&#x27;s value is also a
regular expression. To match exactly the string <code>finance</code>, use <code>^finance$</code>.</p>
<p>The second permission grants the <code>administrator</code> user tag in two clusters, <code>finance</code> and
<code>inventory</code>. Other supported user tags as <code>management</code>, <code>policymaker</code> and <code>monitoring</code>.</p>
<h4 class="anchor anchorWithStickyNavbar_LWe7" id="type-field">Type field<a href="#type-field" class="hash-link" aria-label="Direct link to Type field" title="Direct link to Type field">​</a></h4>
<p>In order for a RabbitMQ node to accept a permission, its value must match that node&#x27;s
<code>resource_server_type</code> variable&#x27;s value. A JWT token may have permissions for multiple resource
types.</p>
<h4 class="anchor anchorWithStickyNavbar_LWe7" id="locations-field">Locations field<a href="#locations-field" class="hash-link" aria-label="Direct link to Locations field" title="Direct link to Locations field">​</a></h4>
<p>The <code>locations</code> field can be either a string containing a single location or a Json array containing
zero or many locations.</p>
<p>A location consists of a list of key-value pairs separated by forward slash <code>/</code> character. Here is
the format:</p>
<div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">cluster:</span><span class="token operator" style="color:#393A34">&lt;</span><span class="token plain">resource_server_id_pattern</span><span class="token operator" style="color:#393A34">&gt;</span><span class="token punctuation" style="color:#393A34">[</span><span class="token plain">/vhost:</span><span class="token operator" style="color:#393A34">&lt;</span><span class="token plain">vhost_pattern</span><span class="token operator" style="color:#393A34">&gt;</span><span class="token punctuation" style="color:#393A34">]</span><span class="token punctuation" style="color:#393A34">[</span><span class="token plain">/queue:</span><span class="token operator" style="color:#393A34">&lt;</span><span class="token plain">queue_name_pattern</span><span class="token operator" style="color:#393A34">&gt;|</span><span class="token plain">/exchange:</span><span class="token operator" style="color:#393A34">&lt;</span><span class="token plain">exchange_name_pattern</span><span class="token operator" style="color:#393A34">&gt;</span><span class="token punctuation" style="color:#393A34">]</span><span class="token punctuation" style="color:#393A34">[</span><span class="token plain">/routing-key:</span><span class="token operator" style="color:#393A34">&lt;</span><span class="token plain">routing_key_pattern</span><span class="token operator" style="color:#393A34">&gt;</span><span class="token punctuation" style="color:#393A34">]</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>Any string separated by <code>/</code> which does not conform to <code>&lt;key&gt;:&lt;value&gt;</code> is ignored. For instance, if
your locations start with a prefix, for example <code>vrn/cluster:rabbitmq</code>, the <code>vrn</code> pattern part is
ignored.</p>
<p>The supported location&#x27;s attributed are:</p>
<ul>
<li><code>cluster</code>: This is the only mandatory attribute. It is a wildcard pattern which must match
RabbitMQ&#x27;s <code>resource_server_id</code> otherwise the location is ignored.</li>
<li><code>vhost</code>: This is the virtual host you are granting access to. It also a wildcard pattern. If not
specified, <code>*</code> will be used.</li>
<li><code>queue</code>|<code>exchange</code>: queue or exchange name pattern. The location grants the permission to a set of
queues (or exchanges) that match it. One location can only specify either <code>queue</code> or <code>exchange</code>
but not both. If not specified, <code>*</code> will be used</li>
<li><code>routing-key</code>: this is the routing key pattern the location grants the permission to. If not
specified, <code>*</code> will be used</li>
</ul>
<p>For more information about wildcard patterns, check the section
<a href="#scope-translation">Scope-to-Permission Translation</a>.</p>
<h4 class="anchor anchorWithStickyNavbar_LWe7" id="actions-field">Actions field<a href="#actions-field" class="hash-link" aria-label="Direct link to Actions field" title="Direct link to Actions field">​</a></h4>
<p>The <code>actions</code> field can be either a string containing a single action or a JSON array containing
zero or many actions.</p>
<p>The supported actions map to either <a href="/rabbitmq-website/docs/4.0/access-control#authorisation">RabbitMQ permissions</a>:</p>
<ul>
<li><code>configure</code></li>
<li><code>read</code></li>
<li><code>write</code></li>
</ul>
<p>Or RabbitMQ user tags:</p>
<ul>
<li><code>administrator</code></li>
<li><code>monitoring</code></li>
<li><code>management</code></li>
<li><code>policymaker</code></li>
</ul>
<h4 class="anchor anchorWithStickyNavbar_LWe7" id="rich-permission-to-scope-translation">Rich-Permission to scope translation<a href="#rich-permission-to-scope-translation" class="hash-link" aria-label="Direct link to Rich-Permission to scope translation" title="Direct link to Rich-Permission to scope translation">​</a></h4>
<p>Rich Authorization Request permissions are translated into JWT token scopes that use the
aforementioned convention using the following algorithm:</p>
<p>For each location found in the <code>locations</code> where the <code>cluster</code> attribute matches the current
RabbitMQ server&#x27;s <code>resource_server_id</code>:</p>
<ul>
<li>
<p>For each location found in the <code>locations</code> field where the <code>cluster</code> attribute matches the current
RabbitMQ node&#x27;s <code>resource_server_id</code>, the plugin extracts the <code>vhost</code>, <code>queue</code> or <code>exchange</code> and
<code>routing_key</code> attributes from the location. If the location does not have any of those attributes,
the default value of <code>*</code> is assumed. Out of those values, the following scope suffix will be
produced:</p>
<div class="language-ini codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-ini codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">scope_suffix = &lt;vhost&gt;/&lt;queue&gt;|&lt;exchange&gt;/&lt;routing-key&gt;</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<ul>
<li>
<p>For each action found in the <code>actions</code> field:</p>
<p>If the action is not a known user tag, the following scope is produced out of it:</p>
<div class="language-ini codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-ini codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">  scope = &lt;resource_server_id&gt;.&lt;action&gt;:&lt;scope_suffix&gt;</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>For known user tag actions, the following scope is produced:</p>
<div class="language-ini codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-ini codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">  scope = &lt;resource_server_id&gt;.&lt;action&gt;</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
</li>
</ul>
</li>
</ul>
<p>The plugin produces permutations of all <code>actions</code> by all <code>locations</code> that match the node&#x27;s
configured <code>resource_server_id</code>.</p>
<p>In the following RAR example</p>
<div class="language-javascript codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-javascript codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token string-property property" style="color:#36acaa">&quot;authorization_details&quot;</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">[</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"> </span><span class="token string-property property" style="color:#36acaa">&quot;type&quot;</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;rabbitmq&quot;</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token string-property property" style="color:#36acaa">&quot;locations&quot;</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">[</span><span class="token string" style="color:#e3116c">&quot;cluster:finance/vhost:primary-*&quot;</span><span class="token punctuation" style="color:#393A34">]</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token string-property property" style="color:#36acaa">&quot;actions&quot;</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">[</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;read&quot;</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;write&quot;</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;configure&quot;</span><span class="token plain">  </span><span class="token punctuation" style="color:#393A34">]</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token punctuation" style="color:#393A34">}</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"> </span><span class="token string-property property" style="color:#36acaa">&quot;type&quot;</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;rabbitmq&quot;</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token string-property property" style="color:#36acaa">&quot;locations&quot;</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">[</span><span class="token string" style="color:#e3116c">&quot;cluster:finance&quot;</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;cluster:inventory&quot;</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">]</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token string-property property" style="color:#36acaa">&quot;actions&quot;</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">[</span><span class="token string" style="color:#e3116c">&quot;administrator&quot;</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">]</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token punctuation" style="color:#393A34">]</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">}</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>if RabbitMQ nodes <code>resource_server_id</code> is equal to <code>finance</code>, the plugin computes the following sets
of scopes:</p>
<ul>
<li><code>finance.read:primary-*/*/*</code></li>
<li><code>finance.write:primary-*/*/*</code></li>
<li><code>finance.configure:primary-*/*/*</code></li>
<li><code>finance.tag:administrator</code></li>
</ul>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="advanced-usage">Advanced usage<a href="#advanced-usage" class="hash-link" aria-label="Direct link to Advanced usage" title="Direct link to Advanced usage">​</a></h2>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="use-oauth-provider">Use default OAuth 2.0 provider<a href="#use-oauth-provider" class="hash-link" aria-label="Direct link to Use default OAuth 2.0 provider" title="Direct link to Use default OAuth 2.0 provider">​</a></h3>
<p>As long as you have only one OAuth 2.0 provider, you can skip this advanced usage although you can
use it.</p>
<p>Under the <a href="#configure-issuer">basic usage</a> section, you configured the <code>issuer</code> URL or maybe the
<code>jwks_url</code> along with the TLS variables if needed. This advanced usage configures everything
relative to the OAuth provider into a dedicated configuration.</p>
<p>Here is an example configuration that uses <code>issuer</code> to configure the identity provider&#x27;s URL:</p>
<div class="language-ini codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-ini codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">auth_oauth2.resource_server_id = rabbitmq-prod</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">auth_oauth2.scope_prefix = rabbitmq.</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">auth_oauth2.issuer = https://prodkeycloak:8080/realm/prod</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">auth_oauth2.https.cacertfile = /opts/certs/prodcacert.pem</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>The equivalent configuration where the identity provider is configured under
<code>auth_oauth2.oauth_providers</code> variable is:</p>
<div class="language-ini codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-ini codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">auth_oauth2.resource_server_id = rabbitmq-prod</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">auth_oauth2.scope_prefix = rabbitmq.</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">auth_oauth2.default_oauth_provider = prodkeycloak</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">auth_oauth2.oauth_providers.prodkeycloak.issuer = https://prodkeycloak:8080/realm/prod</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">auth_oauth2.oauth_providers.prodkeycloak.https.cacertfile = /opts/certs/prodcacert.pem</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>This latter configuration is more relevant when users present tokens which are issued or signed by
different OAuth 2.0 providers. However, one can still use it provided
<code>auth_oauth2.default_oauth_provider</code> is set.</p>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="configure-end-session-endpoint">Configure OAuth 2.0 provider&#x27;s end_session_endpoint<a href="#configure-end-session-endpoint" class="hash-link" aria-label="Direct link to Configure OAuth 2.0 provider&#x27;s end_session_endpoint" title="Direct link to Configure OAuth 2.0 provider&#x27;s end_session_endpoint">​</a></h3>
<p>This advanced setting is only required when the
<a href="https://openid.net/specs/openid-connect-discovery-1_0.html#ProviderConfigurationRequest" target="_blank" rel="noopener noreferrer">OpenId Connect Discovery endpoint</a>
does not return an <code>end_session_endpoint</code> and you want Single Logout functionality. In other words,
when the user logs out from the management UI it is also logged out from the OAuth Provider.</p>
<div class="theme-admonition theme-admonition-info admonition_xJq3 alert alert--info"><div class="admonitionHeading_Gvgb"><span class="admonitionIcon_Rf37"><svg viewBox="0 0 14 16"><path fill-rule="evenodd" d="M7 2.3c3.14 0 5.7 2.56 5.7 5.7s-2.56 5.7-5.7 5.7A5.71 5.71 0 0 1 1.3 8c0-3.14 2.56-5.7 5.7-5.7zM7 1C3.14 1 0 4.14 0 8s3.14 7 7 7 7-3.14 7-7-3.14-7-7-7zm1 3H6v5h2V4zm0 6H6v2h2v-2z"></path></svg></span>info</div><div class="admonitionContent_BuS1"><p>If the <a href="https://openid.net/specs/openid-connect-discovery-1_0.html#ProviderConfigurationRequest" target="_blank" rel="noopener noreferrer">OpenId Connect Discovery endpoint</a>
response does include an <code>end_session_endpoint</code>, the management UI uses it over the configured
endpoint.</p></div></div>
<p>Here is an example configuration that sets <code>end_session_endpoint</code>:</p>
<div class="language-ini codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-ini codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">auth_oauth2.resource_server_id = rabbitmq-prod</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">auth_oauth2.scope_prefix = rabbitmq.</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">auth_oauth2.issuer = https://prodkeycloak:8080/realm/prod</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">auth_oauth2.end_session_endpoint = https://prodkeycloak:8080/realm/prod/logout</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>The equivalent configuration where the identity provider is configured under
<code>auth_oauth2.oauth_providers</code> variable is:</p>
<div class="language-ini codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-ini codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">auth_oauth2.resource_server_id = rabbitmq-prod</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">auth_oauth2.scope_prefix = rabbitmq.</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">auth_oauth2.default_oauth_provider = prodkeycloak</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">auth_oauth2.oauth_providers.prodkeycloak.issuer = https://prodkeycloak:8080/realm/prod</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">auth_oauth2.oauth_providers.prodkeycloak.end_session_endpoint = https://prodkeycloak:8080/realm/prod/logout</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="multiple-resource-servers">Configure multiple resource servers<a href="#multiple-resource-servers" class="hash-link" aria-label="Direct link to Configure multiple resource servers" title="Direct link to Configure multiple resource servers">​</a></h3>
<p>Usually, all users that access a RabbitMQ cluster are registered within the same identity provider.
Likewise, all tokens targeting the same RabbitMQ cluster also carry the same <em>audience</em>. In other
words, all users reference a RabbitMQ cluster with the same resource name which must match the value
of the <code>auth_oauth2.resource_server_id</code> variable.</p>
<p>However, there are some use-cases where RabbitMQ is accessed by users registered in different
identity providers or tokens are issued for the same RabbitMQ installation but with different
<em>Audience</em>(s). For these use-cases, RabbitMQ OAuth 2.0 plugin and the Management plugin can be
configured with multiple OAuth 2.0 resources.</p>
<p>The following is the OAuth 2.0 plugin configuration for two resources with the ids: <code>rabbit_prod</code>
and <code>rabbit_dev</code>. Both resources (also known as <em>audience</em>) are managed by the same Identity
Provider whose issuer is <code>http//some_idp_url</code>.</p>
<div class="language-ini codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-ini codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">auth_oauth2.issuer = http//some_idp_url</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">auth_oauth2.scope_prefix = rabbitmq.</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">auth_oauth2.resource_servers.1.id = rabbit_prod</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">auth_oauth2.resource_servers.2.id = rabbit_dev</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">auth_oauth2.resource_servers.2.scope_prefix = dev-rabbitmq.</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>All resource servers share the variables you set so far under <code>auth_oauth2.</code> such as <code>scope_prefix</code>.
However, they can override them. Here are the list of variables a resource server can override:</p>
<ul>
<li>
<p><code>id</code> - This is the actual resource identifier carried in the <code>audience</code> field of a token. If
omitted, the value is the index. For example, given the
<code>auth_oauth2.resource_servers.prod.scope_prefix</code> variable, the <code>id</code> would be <code>prod</code>.</p>
</li>
<li>
<p><code>scope_prefix</code></p>
</li>
<li>
<p><code>additional_scopes_key</code></p>
</li>
<li>
<p><code>resource_server_type</code></p>
</li>
<li>
<p><code>oauth_provider_id</code> - This is the identifier of the OAuth provider. It is configured in RabbitMQ.
It provides all the variables to contact the authorization server and discover all its endpoints,
such as the <code>jwks_uri</code> to download the signing keys to validate the token.</p>
<p>If this variable is omitted, RabbitMQ looks up the default Authorization Provider&#x27;s id in the
variable <code>auth_oauth2.default_oauth_provider</code>, and if it is also omitted, RabbitMQ uses
<code>auth_oauth2.issuer</code> or <code>auth_oauth2.jwks_url</code> to download the signings keys to validate the
token.</p>
</li>
</ul>
<p>The list of supported resource servers is the combination of <code>auth_oauth2.resource_servers</code> and
<code>auth_oauth2.resource_server_id</code>. You can use both or only one of them.</p>
<div class="theme-admonition theme-admonition-info admonition_xJq3 alert alert--info"><div class="admonitionHeading_Gvgb"><span class="admonitionIcon_Rf37"><svg viewBox="0 0 14 16"><path fill-rule="evenodd" d="M7 2.3c3.14 0 5.7 2.56 5.7 5.7s-2.56 5.7-5.7 5.7A5.71 5.71 0 0 1 1.3 8c0-3.14 2.56-5.7 5.7-5.7zM7 1C3.14 1 0 4.14 0 8s3.14 7 7 7 7-3.14 7-7-3.14-7-7-7zm1 3H6v5h2V4zm0 6H6v2h2v-2z"></path></svg></span>info</div><div class="admonitionContent_BuS1"><p>There is an <a href="/rabbitmq-website/docs/4.0/oauth2-examples-multiresource">example</a> that demonstrate how to use multiple OAuth 2
resources.</p></div></div>
<p>A list of <a href="#multiple-resource-servers-configuration">all the configurable variables</a> for each OAuth
Provider is documented in a separate section.</p>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="multiple-oauth-providers">Configure multiple OAuth 2.0 providers<a href="#multiple-oauth-providers" class="hash-link" aria-label="Direct link to Configure multiple OAuth 2.0 providers" title="Direct link to Configure multiple OAuth 2.0 providers">​</a></h3>
<p>It only makes sense to set multiple OAuth 2.0 providers if there are
<a href="#multiple-resource-servers">multiple resources configured</a>.</p>
<p>This is the configuration used in the previous section but modified to use multiple OAuth 2.0
providers:</p>
<div class="language-ini codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-ini codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">auth_oauth2.scope_prefix = rabbitmq.</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">auth_oauth2.resource_servers.1.id = rabbit_prod</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">auth_oauth2.resource_servers.1.oauth_provider_id = prod</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">auth_oauth2.resource_servers.2.id = rabbit_dev</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">auth_oauth2.resource_servers.2.oauth_provider_id = dev</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">auth_oauth2.resource_servers.2.scope_prefix = dev-rabbitmq.</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">auth_oauth2.oauth_providers.prod.issuer = https://rabbit_prod:8080</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">auth_oauth2.oauth_providers.prod.https.cacertfile = /opts/certs/prod.pem</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">auth_oauth2.oauth_providers.dev.issuer = https://rabbit_dev:8080</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">auth_oauth2.oauth_providers.dev.https.cacertfile = /opts/certs/dev.pem</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>A list of <a href="#multiple-resource-servers-configuration">all the configurable variables</a> for each OAuth
Provider is documented in a separate section.</p>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="examples">Examples<a href="#examples" class="hash-link" aria-label="Direct link to Examples" title="Direct link to Examples">​</a></h2>
<p>The <a href="/rabbitmq-website/docs/4.0/oauth2-examples">RabbitMQ OAuth 2.0 Auth backend examples</a> contain many example configuration
files, that can be used to set up several OAuth 2.0 providers, including UAA, Auth0, and Azure, and
issue tokens, which can be used to access RabbitMQ resources.</p></div><footer class="theme-doc-footer docusaurus-mt-lg"><div class="row margin-top--sm theme-doc-footer-edit-meta-row"><div class="col"><a href="https://github.com/rabbitmq/rabbitmq-website/tree/main/versioned_docs/version-4.0/oauth2.md" target="_blank" rel="noopener noreferrer" class="theme-edit-this-page"><svg fill="currentColor" height="20" width="20" viewBox="0 0 40 40" class="iconEdit_Z9Sw" aria-hidden="true"><g><path d="m34.5 11.7l-3 3.1-6.3-6.3 3.1-3q0.5-0.5 1.2-0.5t1.1 0.5l3.9 3.9q0.5 0.4 0.5 1.1t-0.5 1.2z m-29.5 17.1l18.4-18.5 6.3 6.3-18.4 18.4h-6.3v-6.2z"></path></g></svg>Edit this page</a></div><div class="col lastUpdated_JAkA"></div></div></footer></article><nav class="pagination-nav docusaurus-mt-lg" aria-label="Docs pages"><a class="pagination-nav__link pagination-nav__link--prev" href="/rabbitmq-website/docs/4.0/passwords"><div class="pagination-nav__sublabel">Previous</div><div class="pagination-nav__label">Credentials and Passwords</div></a><a class="pagination-nav__link pagination-nav__link--next" href="/rabbitmq-website/docs/4.0/ldap"><div class="pagination-nav__sublabel">Next</div><div class="pagination-nav__label">LDAP</div></a></nav></div></div><div class="col col--3"><div class="tableOfContents_bqdL thin-scrollbar theme-doc-toc-desktop"><ul class="table-of-contents table-of-contents__left-border"><li><a href="#overview" class="table-of-contents__link toc-highlight">Overview</a></li><li><a href="#table-of-contents" class="table-of-contents__link toc-highlight">Table of Contents</a><ul><li><a href="#how-to-configure-it" class="table-of-contents__link toc-highlight">How to configure it</a></li><li><a href="#how-it-works" class="table-of-contents__link toc-highlight">How it works</a></li><li><a href="#basic-usage" class="table-of-contents__link toc-highlight">Basic usage</a></li><li><a href="#advanced-usage" class="table-of-contents__link toc-highlight">Advanced usage</a></li><li><a href="#examples-for-specific-identity-providers" class="table-of-contents__link toc-highlight">Examples for Specific Identity Providers</a></li></ul></li><li><a href="#how-to-configure-it" class="table-of-contents__link toc-highlight">How to configure it</a><ul><li><a href="#prerequisites" class="table-of-contents__link toc-highlight">Prerequisites</a></li><li><a href="#configure-for-openid-connect" class="table-of-contents__link toc-highlight">Configure OAuth 2.0 for identity providers compliant with OpenId Connect</a></li></ul></li><li><a href="#how-it-works" class="table-of-contents__link toc-highlight">How it works</a></li><li><a href="#prerequisites" class="table-of-contents__link toc-highlight">Prerequisites</a></li><li><a href="#authorization-flow" class="table-of-contents__link toc-highlight">Authorization Flow</a></li><li><a href="#variables-configurable" class="table-of-contents__link toc-highlight">Variables configurable in rabbitmq.conf</a></li><li><a href="#resource-server-id" class="table-of-contents__link toc-highlight">Resource Server ID</a></li><li><a href="#scope-prefix" class="table-of-contents__link toc-highlight">Scope Prefix</a></li><li><a href="#signing-key-files" class="table-of-contents__link toc-highlight">Signing keys files</a></li><li><a href="#jwks-endpoint" class="table-of-contents__link toc-highlight">JWKS endpoint</a></li><li><a href="#multiple-resource-servers-configuration" class="table-of-contents__link toc-highlight">Multiple Resource Servers configuration</a><ul><li><a href="#token-validation" class="table-of-contents__link toc-highlight">Token validation</a></li><li><a href="#token-expiration" class="table-of-contents__link toc-highlight">Token expiration and refresh</a></li><li><a href="#scope-translation" class="table-of-contents__link toc-highlight">Scope-to-Permission translation</a></li><li><a href="#topic-exchange-scopes" class="table-of-contents__link toc-highlight">Topic Exchange scopes</a></li><li><a href="#scope-and-tags" class="table-of-contents__link toc-highlight">Scope and tags</a></li></ul></li><li><a href="#basic-usage" class="table-of-contents__link toc-highlight">Basic usage</a><ul><li><a href="#configure-issuer" class="table-of-contents__link toc-highlight">Configure OAuth 2.0 provider&#39;s issuer</a></li><li><a href="#configure-signing-keys" class="table-of-contents__link toc-highlight">Configure signing keys</a></li><li><a href="#use-different-token-field" class="table-of-contents__link toc-highlight">Use a different token field for the scope</a></li><li><a href="#preferred-username-claims" class="table-of-contents__link toc-highlight">Preferred username claims</a></li><li><a href="#rich-authorization-request" class="table-of-contents__link toc-highlight">Rich Authorization Request</a></li></ul></li><li><a href="#advanced-usage" class="table-of-contents__link toc-highlight">Advanced usage</a><ul><li><a href="#use-oauth-provider" class="table-of-contents__link toc-highlight">Use default OAuth 2.0 provider</a></li><li><a href="#configure-end-session-endpoint" class="table-of-contents__link toc-highlight">Configure OAuth 2.0 provider&#39;s end_session_endpoint</a></li><li><a href="#multiple-resource-servers" class="table-of-contents__link toc-highlight">Configure multiple resource servers</a></li><li><a href="#multiple-oauth-providers" class="table-of-contents__link toc-highlight">Configure multiple OAuth 2.0 providers</a></li></ul></li><li><a href="#examples" class="table-of-contents__link toc-highlight">Examples</a></li></ul></div></div></div></div></main></div></div></div><footer class="footer footer--dark"><div class="container container-fluid"><div class="row footer__links"><div class="col footer__col"><div class="footer__title">Learn about RabbitMQ</div><ul class="footer__items clean-list"><li class="footer__item"><a class="footer__link-item" href="/rabbitmq-website/tutorials">Getting Started</a></li><li class="footer__item"><a class="footer__link-item" href="/rabbitmq-website/docs">Documentation</a></li><li class="footer__item"><a class="footer__link-item" href="/rabbitmq-website/blog">Blog</a></li></ul></div><div class="col footer__col"><div class="footer__title">Reach out to the RabbitMQ team</div><ul class="footer__items clean-list"><li class="footer__item"><a href="https://github.com/rabbitmq" target="_blank" rel="noopener noreferrer" class="footer__link-item">GitHub<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_nPIU"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a></li><li class="footer__item"><a href="https://github.com/rabbitmq/rabbitmq-server/discussions" target="_blank" rel="noopener noreferrer" class="footer__link-item">GitHub Discussions<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_nPIU"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a></li><li class="footer__item"><a class="footer__link-item" href="/rabbitmq-website/contact?utm_source=rmq_release-information_tableheader&amp;utm_medium=rmq_website&amp;utm_campaign=tanzu">Long Term Commercial Support</a></li><li class="footer__item"><a class="footer__link-item" href="/rabbitmq-website/contact">Contact Us</a></li><li class="footer__item"><a href="https://www.rabbitmq.com/discord" target="_blank" rel="noopener noreferrer" class="footer__link-item">Discord<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_nPIU"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a></li></ul></div><div class="col footer__col"><div class="footer__title">Broadcom</div><ul class="footer__items clean-list"><li class="footer__item"><a href="https://tanzu.vmware.com/" target="_blank" rel="noopener noreferrer" class="footer__link-item">VMware Tanzu<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_nPIU"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a></li><li class="footer__item"><a href="https://www.vmware.com/help/legal.html" target="_blank" rel="noopener noreferrer" class="footer__link-item">Terms of Use<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_nPIU"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a></li><li class="footer__item"><a href="https://www.vmware.com/help/privacy.html" target="_blank" rel="noopener noreferrer" class="footer__link-item">Privacy<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_nPIU"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a></li><li class="footer__item"><a class="footer__link-item" href="/rabbitmq-website/trademark-guidelines">Trademark Guidelines</a></li><li class="footer__item"><a href="https://www.vmware.com/help/privacy/california-privacy-rights.html" target="_blank" rel="noopener noreferrer" class="footer__link-item">Your California Privacy Rights<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_nPIU"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a></li><li class="footer__item"><a class="footer__link-item ot-sdk-show-settings">Cookie Settings</a></li></ul></div></div><div class="footer__bottom text--center"><div class="footer__copyright">Copyright © 2005-2025 Broadcom. All Rights Reserved. The term "Broadcom" refers to Broadcom Inc. and/or its subsidiaries.</div></div></div></footer></div>
</body>
</html>
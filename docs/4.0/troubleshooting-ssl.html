<!doctype html>
<html lang="en" dir="ltr" class="docs-wrapper plugin-docs plugin-id-default docs-version-4.0 docs-doc-page docs-doc-id-troubleshooting-ssl" data-has-hydrated="false">
<head>
<meta charset="UTF-8">
<meta name="generator" content="Docusaurus v3.7.0">
<title data-rh="true">Troubleshooting TLS-enabled Connections | RabbitMQ</title><meta data-rh="true" name="viewport" content="width=device-width,initial-scale=1"><meta data-rh="true" name="twitter:card" content="summary_large_image"><meta data-rh="true" property="og:image" content="https://www.rabbitmq.com/rabbitmq-website/img/rabbitmq-social-media-card.svg"><meta data-rh="true" name="twitter:image" content="https://www.rabbitmq.com/rabbitmq-website/img/rabbitmq-social-media-card.svg"><meta data-rh="true" property="og:url" content="https://www.rabbitmq.com/rabbitmq-website/docs/4.0/troubleshooting-ssl"><meta data-rh="true" property="og:locale" content="en"><meta data-rh="true" name="docusaurus_locale" content="en"><meta data-rh="true" name="docsearch:language" content="en"><meta data-rh="true" name="docusaurus_version" content="4.0"><meta data-rh="true" name="docusaurus_tag" content="docs-default-4.0"><meta data-rh="true" name="docsearch:version" content="4.0"><meta data-rh="true" name="docsearch:docusaurus_tag" content="docs-default-4.0"><meta data-rh="true" property="og:title" content="Troubleshooting TLS-enabled Connections | RabbitMQ"><meta data-rh="true" name="description" content="&lt;!--"><meta data-rh="true" property="og:description" content="&lt;!--"><link data-rh="true" rel="icon" href="/rabbitmq-website/img/rabbitmq-logo.svg"><link data-rh="true" rel="canonical" href="https://www.rabbitmq.com/rabbitmq-website/docs/4.0/troubleshooting-ssl"><link data-rh="true" rel="alternate" href="https://www.rabbitmq.com/rabbitmq-website/docs/4.0/troubleshooting-ssl" hreflang="en"><link data-rh="true" rel="alternate" href="https://www.rabbitmq.com/rabbitmq-website/docs/4.0/troubleshooting-ssl" hreflang="x-default"><link data-rh="true" rel="preconnect" href="https://H10VQIW16Y-dsn.algolia.net" crossorigin="anonymous"><link rel="alternate" type="application/rss+xml" href="/rabbitmq-website/blog/rss.xml" title="RabbitMQ RSS Feed">
<link rel="alternate" type="application/atom+xml" href="/rabbitmq-website/blog/atom.xml" title="RabbitMQ Atom Feed">




<link rel="search" type="application/opensearchdescription+xml" title="RabbitMQ" href="/rabbitmq-website/opensearch.xml">







<link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Raleway:400,700">
<script src="https://cdn.cookielaw.org/scripttemplates/otSDKStub.js" data-domain-script="018ee308-473e-754f-b0c2-cbe82d25512f"></script>
<script>function OptanonWrapper(){}</script>
<script>function setGTM(e,t,o,n,r){e[n]=e[n]||[],e[n].push({"gtm.start":(new Date).getTime(),event:"gtm.js"});var i=t.getElementsByTagName(o)[0],a=t.createElement(o),s="dataLayer"!=n?"&l="+n:"";a.async=!0,a.src="https://www.googletagmanager.com/gtm.js?id="+r+s,i.parentNode.insertBefore(a,i)}var timer;function waitForOnetrustActiveGroups(){document.cookie.indexOf("OptanonConsent")>-1&&document.cookie.indexOf("groups=")>-1?(clearTimeout(timer),setGTM(window,document,"script","dataLayer","GTM-TT84L8K")):timer=setTimeout(waitForOnetrustActiveGroups,250)}document.cookie.indexOf("OptanonConsent")>-1&&document.cookie.indexOf("groups=")>-1?setGTM(window,document,"script","dataLayer","GTM-TT84L8K"):waitForOnetrustActiveGroups()</script><link rel="stylesheet" href="/rabbitmq-website/styles.css">
<script src="/rabbitmq-website/runtime~main.js" defer="defer"></script>
<script src="/rabbitmq-website/main.js" defer="defer"></script>
</head>
<body class="navigation-with-keyboard">
<script>!function(){function t(t){document.documentElement.setAttribute("data-theme",t)}var e=function(){try{return new URLSearchParams(window.location.search).get("docusaurus-theme")}catch(t){}}()||function(){try{return window.localStorage.getItem("theme")}catch(t){}}();null!==e?t(e):window.matchMedia("(prefers-color-scheme: dark)").matches?t("dark"):(window.matchMedia("(prefers-color-scheme: light)").matches,t("light"))}(),function(){try{const n=new URLSearchParams(window.location.search).entries();for(var[t,e]of n)if(t.startsWith("docusaurus-data-")){var a=t.replace("docusaurus-data-","data-");document.documentElement.setAttribute(a,e)}}catch(t){}}(),document.documentElement.setAttribute("data-announcement-bar-initially-dismissed",function(){try{return"true"===localStorage.getItem("docusaurus.announcement.dismiss")}catch(t){}return!1}())</script><div id="__docusaurus"><div role="region" aria-label="Skip to main content"><a class="skipToContent_fXgn" href="#__docusaurus_skipToContent_fallback">Skip to main content</a></div><div class="announcementBar_mb4j" style="background-color:var(--ifm-color-primary-contrast-background);color:var(--ifm-font-color-base)" role="banner"><div class="announcementBarPlaceholder_vyr4"></div><div class="content_knG7 announcementBarContent_xLdY"><strong style="font-size: var(--ifm-h4-font-size);"><a href="https://github.com/rabbitmq/rabbitmq-server/releases/tag/v4.1.0">RabbitMQ 4.1.0 is out</a></strong></div><button type="button" aria-label="Close" class="clean-btn close closeButton_CVFx announcementBarClose_gvF7"><svg viewBox="0 0 15 15" width="14" height="14"><g stroke="currentColor" stroke-width="3.1"><path d="M.75.75l13.5 13.5M14.25.75L.75 14.25"></path></g></svg></button></div><nav aria-label="Main" class="navbar navbar--fixed-top"><div class="navbar__inner"><div class="navbar__items"><button aria-label="Toggle navigation bar" aria-expanded="false" class="navbar__toggle clean-btn" type="button"><svg width="30" height="30" viewBox="0 0 30 30" aria-hidden="true"><path stroke="currentColor" stroke-linecap="round" stroke-miterlimit="10" stroke-width="2" d="M4 7h22M4 15h22M4 23h22"></path></svg></button><a class="navbar__brand" href="/rabbitmq-website/"><div class="navbar__logo"><img src="/rabbitmq-website/img/rabbitmq-logo-with-name.svg" alt="RabbitMQ" class="themedComponent_mlkZ themedComponent--light_NVdE"><img src="/rabbitmq-website/img/rabbitmq-logo-with-name.svg" alt="RabbitMQ" class="themedComponent_mlkZ themedComponent--dark_xIcU"></div></a><a class="navbar__item navbar__link" href="/rabbitmq-website/tutorials">Getting Started</a><a aria-current="page" class="navbar__item navbar__link navbar__link--active" href="/rabbitmq-website/docs/4.0">Docs</a><a class="navbar__item navbar__link" href="/rabbitmq-website/blog">Blog</a><a class="navbar__item navbar__link" href="/rabbitmq-website/contact">Support</a></div><div class="navbar__items navbar__items--right"><div class="navbar__item dropdown dropdown--hoverable dropdown--right"><a aria-current="page" class="navbar__link active" aria-haspopup="true" aria-expanded="false" role="button" href="/rabbitmq-website/docs/4.0/troubleshooting-ssl">4.0</a><ul class="dropdown__menu"><li class=""><strong>Release series</strong></li><li><a class="dropdown__link" href="/rabbitmq-website/docs/next/troubleshooting-ssl">Next</a></li><li><a class="dropdown__link" href="/rabbitmq-website/docs/troubleshooting-ssl">4.1</a></li><li><a aria-current="page" class="dropdown__link dropdown__link--active" href="/rabbitmq-website/docs/4.0/troubleshooting-ssl">4.0</a></li><li><a class="dropdown__link" href="/rabbitmq-website/docs/3.13/troubleshooting-ssl">3.13</a></li><li><a href="https://v3-12.rabbitmq.com/documentation.html" target="_blank" rel="noopener noreferrer" class="dropdown__link">3.12<svg width="12" height="12" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_nPIU"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a></li><li><a class="dropdown__link" href="/rabbitmq-website/release-information">Release Information</a></li></ul></div><a href="https://github.com/rabbitmq/rabbitmq-website" target="_blank" rel="noopener noreferrer" class="navbar__item navbar__link">GitHub<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_nPIU"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a><div class="toggle_vylO colorModeToggle_DEke"><button class="clean-btn toggleButton_gllP toggleButtonDisabled_aARS" type="button" disabled="" title="Switch between dark and light mode (currently light mode)" aria-label="Switch between dark and light mode (currently light mode)" aria-live="polite" aria-pressed="false"><svg viewBox="0 0 24 24" width="24" height="24" class="lightToggleIcon_pyhR"><path fill="currentColor" d="M12,9c1.65,0,3,1.35,3,3s-1.35,3-3,3s-3-1.35-3-3S10.35,9,12,9 M12,7c-2.76,0-5,2.24-5,5s2.24,5,5,5s5-2.24,5-5 S14.76,7,12,7L12,7z M2,13l2,0c0.55,0,1-0.45,1-1s-0.45-1-1-1l-2,0c-0.55,0-1,0.45-1,1S1.45,13,2,13z M20,13l2,0c0.55,0,1-0.45,1-1 s-0.45-1-1-1l-2,0c-0.55,0-1,0.45-1,1S19.45,13,20,13z M11,2v2c0,0.55,0.45,1,1,1s1-0.45,1-1V2c0-0.55-0.45-1-1-1S11,1.45,11,2z M11,20v2c0,0.55,0.45,1,1,1s1-0.45,1-1v-2c0-0.55-0.45-1-1-1C11.45,19,11,19.45,11,20z M5.99,4.58c-0.39-0.39-1.03-0.39-1.41,0 c-0.39,0.39-0.39,1.03,0,1.41l1.06,1.06c0.39,0.39,1.03,0.39,1.41,0s0.39-1.03,0-1.41L5.99,4.58z M18.36,16.95 c-0.39-0.39-1.03-0.39-1.41,0c-0.39,0.39-0.39,1.03,0,1.41l1.06,1.06c0.39,0.39,1.03,0.39,1.41,0c0.39-0.39,0.39-1.03,0-1.41 L18.36,16.95z M19.42,5.99c0.39-0.39,0.39-1.03,0-1.41c-0.39-0.39-1.03-0.39-1.41,0l-1.06,1.06c-0.39,0.39-0.39,1.03,0,1.41 s1.03,0.39,1.41,0L19.42,5.99z M7.05,18.36c0.39-0.39,0.39-1.03,0-1.41c-0.39-0.39-1.03-0.39-1.41,0l-1.06,1.06 c-0.39,0.39-0.39,1.03,0,1.41s1.03,0.39,1.41,0L7.05,18.36z"></path></svg><svg viewBox="0 0 24 24" width="24" height="24" class="darkToggleIcon_wfgR"><path fill="currentColor" d="M9.37,5.51C9.19,6.15,9.1,6.82,9.1,7.5c0,4.08,3.32,7.4,7.4,7.4c0.68,0,1.35-0.09,1.99-0.27C17.45,17.19,14.93,19,12,19 c-3.86,0-7-3.14-7-7C5,9.07,6.81,6.55,9.37,5.51z M12,3c-4.97,0-9,4.03-9,9s4.03,9,9,9s9-4.03,9-9c0-0.46-0.04-0.92-0.1-1.36 c-0.98,1.37-2.58,2.26-4.4,2.26c-2.98,0-5.4-2.42-5.4-5.4c0-1.81,0.89-3.42,2.26-4.4C12.92,3.04,12.46,3,12,3L12,3z"></path></svg></button></div><div class="navbarSearchContainer_Bca1"><button type="button" class="DocSearch DocSearch-Button" aria-label="Search (Command+K)"><span class="DocSearch-Button-Container"><svg width="20" height="20" class="DocSearch-Search-Icon" viewBox="0 0 20 20" aria-hidden="true"><path d="M14.386 14.386l4.0877 4.0877-4.0877-4.0877c-2.9418 2.9419-7.7115 2.9419-10.6533 0-2.9419-2.9418-2.9419-7.7115 0-10.6533 2.9418-2.9419 7.7115-2.9419 10.6533 0 2.9419 2.9418 2.9419 7.7115 0 10.6533z" stroke="currentColor" fill="none" fill-rule="evenodd" stroke-linecap="round" stroke-linejoin="round"></path></svg><span class="DocSearch-Button-Placeholder">Search</span></span><span class="DocSearch-Button-Keys"></span></button></div></div></div><div role="presentation" class="navbar-sidebar__backdrop"></div></nav><div id="__docusaurus_skipToContent_fallback" class="main-wrapper mainWrapper_z2l0"><div class="docsWrapper_hBAB"><button aria-label="Scroll back to top" class="clean-btn theme-back-to-top-button backToTopButton_sjWU" type="button"></button><div class="docRoot_UBD9"><aside class="theme-doc-sidebar-container docSidebarContainer_YfHR"><div class="sidebarViewport_aRkj"><div class="sidebar_njMd"><nav aria-label="Docs sidebar" class="menu thin-scrollbar menu_SIkG menuWithAnnouncementBar_GW3s"><ul class="theme-doc-sidebar-menu menu__list"><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/rabbitmq-website/docs/4.0">Introduction</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/rabbitmq-website/release-information">Release Information</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/rabbitmq-website/tutorials">Getting Started</a></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist" href="/rabbitmq-website/docs/4.0/download">Install and Upgrade</a><button aria-label="Expand sidebar category &#x27;Install and Upgrade&#x27;" aria-expanded="false" type="button" class="clean-btn menu__caret"></button></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist" href="/rabbitmq-website/docs/4.0/use-rabbitmq">How to Use RabbitMQ</a><button aria-label="Expand sidebar category &#x27;How to Use RabbitMQ&#x27;" aria-expanded="false" type="button" class="clean-btn menu__caret"></button></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--active" href="/rabbitmq-website/docs/4.0/manage-rabbitmq">How to Manage RabbitMQ</a><button aria-label="Collapse sidebar category &#x27;How to Manage RabbitMQ&#x27;" aria-expanded="true" type="button" class="clean-btn menu__caret"></button></div><ul style="display:block;overflow:visible;height:auto" class="menu__list"><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/rabbitmq-website/docs/4.0/cli">CLI</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/rabbitmq-website/docs/4.0/configure">Configuration</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/rabbitmq-website/docs/4.0/relocate">File and Directory Locations</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/rabbitmq-website/docs/4.0/logging">Logging</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/rabbitmq-website/docs/4.0/vhosts">Virtual Hosts</a></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-2 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist" tabindex="0" href="/rabbitmq-website/docs/4.0/access-control"> Authentication and Authorization</a><button aria-label="Expand sidebar category &#x27; Authentication and Authorization&#x27;" aria-expanded="false" type="button" class="clean-btn menu__caret"></button></div></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/rabbitmq-website/docs/4.0/parameters">Policies and Runtime Parameters</a></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-2 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist" tabindex="0" href="/rabbitmq-website/docs/4.0/metadata-store">Metadata store</a><button aria-label="Expand sidebar category &#x27;Metadata store&#x27;" aria-expanded="false" type="button" class="clean-btn menu__caret"></button></div></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/rabbitmq-website/docs/4.0/definitions">Schema Definitions</a></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-2 menu__list-item"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--active" tabindex="0" href="/rabbitmq-website/docs/4.0/networking">Networking</a><button aria-label="Collapse sidebar category &#x27;Networking&#x27;" aria-expanded="true" type="button" class="clean-btn menu__caret"></button></div><ul style="display:block;overflow:visible;height:auto" class="menu__list"><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class="menu__link" tabindex="0" href="/rabbitmq-website/docs/4.0/nettick">Net Tick Time</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class="menu__link" tabindex="0" href="/rabbitmq-website/docs/4.0/ssl">TLS Support</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class="menu__link" tabindex="0" href="/rabbitmq-website/docs/4.0/troubleshooting-networking">Troubleshooting Connectivity</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class="menu__link menu__link--active" aria-current="page" tabindex="0" href="/rabbitmq-website/docs/4.0/troubleshooting-ssl">Troubleshooting TLS</a></li></ul></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-2 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist" tabindex="0" href="/rabbitmq-website/docs/4.0/clustering">Clustering</a><button aria-label="Expand sidebar category &#x27;Clustering&#x27;" aria-expanded="false" type="button" class="clean-btn menu__caret"></button></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-2 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret" role="button" aria-expanded="false" tabindex="0" href="/rabbitmq-website/docs/4.0/memory-use">Resource Management</a></div></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/rabbitmq-website/docs/4.0/backup">Backup and Restore</a></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-2 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret" role="button" aria-expanded="false" tabindex="0" href="/rabbitmq-website/docs/4.0/runtime">Tuning</a></div></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/rabbitmq-website/docs/4.0/production-checklist">Deployment Guidelines</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/rabbitmq-website/kubernetes/operator/operator-overview">RabbitMQ on Kubernetes</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/rabbitmq-website/docs/4.0/troubleshooting">Troubleshooting RabbitMQ</a></li></ul></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist" href="/rabbitmq-website/docs/4.0/monitoring">How to Monitor RabbitMQ</a><button aria-label="Expand sidebar category &#x27;How to Monitor RabbitMQ&#x27;" aria-expanded="false" type="button" class="clean-btn menu__caret"></button></div></li></ul></nav></div></div></aside><main class="docMainContainer_TBSr"><div class="container padding-top--md padding-bottom--lg"><div class="row"><div class="col docItemCol_VOVn"><div class="theme-doc-version-banner alert alert--warning margin-bottom--md" role="alert"><div>This is documentation for <!-- -->RabbitMQ<!-- --> <b>4.0</b>, which is no longer actively maintained.</div><div class="margin-top--md">For up-to-date documentation, see the <b><a href="/rabbitmq-website/docs/troubleshooting-ssl">latest version</a></b> (<!-- -->4.1<!-- -->).</div></div><div class="docItemContainer_Djhp"><article><nav class="theme-doc-breadcrumbs breadcrumbsContainer_Z_bl" aria-label="Breadcrumbs"><ul class="breadcrumbs" itemscope="" itemtype="https://schema.org/BreadcrumbList"><li class="breadcrumbs__item"><a aria-label="Home page" class="breadcrumbs__link" href="/rabbitmq-website/"><svg viewBox="0 0 24 24" class="breadcrumbHomeIcon_YNFT"><path d="M10 19v-5h4v5c0 .55.45 1 1 1h3c.55 0 1-.45 1-1v-7h1.7c.46 0 .68-.57.33-.87L12.67 3.6c-.38-.34-.96-.34-1.34 0l-8.36 7.53c-.34.3-.13.87.33.87H5v7c0 .55.45 1 1 1h3c.55 0 1-.45 1-1z" fill="currentColor"></path></svg></a></li><li itemscope="" itemprop="itemListElement" itemtype="https://schema.org/ListItem" class="breadcrumbs__item"><a class="breadcrumbs__link" itemprop="item" href="/rabbitmq-website/docs/4.0/manage-rabbitmq"><span itemprop="name">How to Manage RabbitMQ</span></a><meta itemprop="position" content="1"></li><li itemscope="" itemprop="itemListElement" itemtype="https://schema.org/ListItem" class="breadcrumbs__item"><a class="breadcrumbs__link" itemprop="item" href="/rabbitmq-website/docs/4.0/networking"><span itemprop="name">Networking</span></a><meta itemprop="position" content="2"></li><li itemscope="" itemprop="itemListElement" itemtype="https://schema.org/ListItem" class="breadcrumbs__item breadcrumbs__item--active"><span class="breadcrumbs__link" itemprop="name">Troubleshooting TLS</span><meta itemprop="position" content="3"></li></ul></nav><span class="theme-doc-version-badge badge badge--secondary">Version: 4.0</span><div class="tocCollapsible_ETCw theme-doc-toc-mobile tocMobile_ITEo"><button type="button" class="clean-btn tocCollapsibleButton_TO0P">On this page</button></div><div class="theme-doc-markdown markdown"><header><h1>Troubleshooting TLS-enabled Connections</h1></header>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="overview">Overview<a href="#overview" class="hash-link" aria-label="Direct link to Overview" title="Direct link to Overview">​</a></h2>
<p>This guide covers a methodology and some tooling that can help diagnose TLS connectivity issues and errors (TLS alerts).
It accompanies the main guide on <a href="/rabbitmq-website/docs/4.0/ssl">TLS in RabbitMQ</a>.
The strategy is to test the required components with an alternative TLS
implementation in the process of elimination to identify the problematic end (client or server).</p>
<p>Bear in mind that this process is not guaranteed to identify the problem if
the interaction between two specific components is responsible for the problem.</p>
<p>The steps recommended in this guide are:</p>
<ul>
<li>Verify <a href="#verify-config">effective configuration</a></li>
<li>Verify that the node <a href="#verify-listeners">listens for TLS connections</a></li>
<li>Verify <a href="#verify-file-permissions">file permissions</a></li>
<li>Verify <a href="#verify-file-format">file format</a> used by the certificate and private key files</li>
<li>Verify <a href="#verify-tls-support-in-erlang">TLS support in Erlang/OTP</a></li>
<li>Verify certificate/key pairs and test with alternative TLS client or server <a href="#openssl-tools">using OpenSSL command line tools</a></li>
<li>Verify available and configured <a href="#verify-cipher-suites">cipher suites</a> and certificate key usage options</li>
<li>Verify client connections <a href="#stunnel">with a TLS-terminating proxy</a></li>
<li>And finally, test a real client connection against a real server connection again</li>
</ul>
<p>When testing with a RabbitMQ node and/or a real RabbitMQ client it is important to inspect
<a href="/rabbitmq-website/docs/4.0/logging">logs</a> for both server and client.</p>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="verify-config">Check Effective Node Configuration<a href="#verify-config" class="hash-link" aria-label="Direct link to Check Effective Node Configuration" title="Direct link to Check Effective Node Configuration">​</a></h2>
<p>Setting up a RabbitMQ node with TLS involves modifying
configuration. Before performing any other TLS
troubleshooting steps it is important to verify config file
location and effective configuration (whether the node has
loaded it successfully). See <a href="/rabbitmq-website/docs/4.0/configure">Configuration guide</a>
for details.</p>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="verify-listeners">Check TLS Listeners (Ports)<a href="#verify-listeners" class="hash-link" aria-label="Direct link to Check TLS Listeners (Ports)" title="Direct link to Check TLS Listeners (Ports)">​</a></h2>
<p>This step checks that the broker is listening on the <a href="/rabbitmq-website/docs/4.0/networking">expected port(s)</a>, such as
5671 for AMQP 0-9-1 and 1.0, 8883 for MQTT, and so on.</p>
<p>To verify that TLS has been enabled on the node, use <code>[rabbitmq-diagnostics](./man/rabbitmq-diagnostics.8) listeners</code>
or the <code>listeners</code> section in <code>[rabbitmq-diagnostics](./man/rabbitmq-diagnostics.8) status</code>.</p>
<p>The listeners section will look something like this:</p>
<div class="language-ini codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-ini codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">Interface: [::], port: 25672, protocol: clustering, purpose: inter-node and CLI tool communication</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">Interface: [::], port: 5672, protocol: amqp, purpose: AMQP 0-9-1 and AMQP 1.0</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">Interface: [::], port: 5671, protocol: amqp/ssl, purpose: AMQP 0-9-1 and AMQP 1.0 over TLS</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">Interface: [::], port: 15672, protocol: http, purpose: HTTP API</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">Interface: [::], port: 15671, protocol: https, purpose: HTTP API over TLS (HTTPS)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">Interface: [::], port: 1883, protocol: mqtt, purpose: MQTT</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>In the above example, there are 6 TCP listeners on the node. Two of them accept TLS-enabled connections:</p>
<ul>
<li>Inter-node and CLI tool communication on port <code>25672</code></li>
<li>AMQP 0-9-1 (and 1.0, if enabled) listener for non-TLS connections on port <code>5672</code></li>
<li>AMQP 0-9-1 (and 1.0, if enabled) listener for TLS-enabled connections on port <code>5671</code></li>
<li><a href="/rabbitmq-website/docs/4.0/management">HTTP API</a> listeners on ports 15672 (HTTP) and 15671 (HTTPS)</li>
<li><a href="/rabbitmq-website/docs/4.0/mqtt">MQTT</a> listener for non-TLS connections 1883</li>
</ul>
<p>If the above steps are not an option, inspecting node&#x27;s <a href="/rabbitmq-website/docs/4.0/logging">log file</a> can be a viable alternative.
It should contain an entry about a TLS listener being enabled, looking like this:</p>
<div class="codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">2018-09-02 14:24:58.611 [info] &lt;0.664.0&gt; started TCP listener on [::]:5672</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">2018-09-02 14:24:58.614 [info] &lt;0.680.0&gt; started SSL listener on [::]:5671</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>If the node is configured to use TLS but a message similar to the above is not logged,
it is possible that the configuration file was placed at an incorrect location and was not read by
the broker or the node was not restarted after config file changes.
See the <a href="/rabbitmq-website/docs/4.0/configure">configuration page</a> for details
on config file verification.</p>
<p>Tools such as <code>lsof</code> and <code>netstat</code> can be used to verify what ports
a node is listening on, as covered in the <a href="/rabbitmq-website/docs/4.0/troubleshooting-networking">Troubleshooting Networking</a> guide.</p>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="verify-file-permissions">Check Certificate, Private Key and CA Bundle File Permissions<a href="#verify-file-permissions" class="hash-link" aria-label="Direct link to Check Certificate, Private Key and CA Bundle File Permissions" title="Direct link to Check Certificate, Private Key and CA Bundle File Permissions">​</a></h2>
<p>RabbitMQ must be able to read its configured CA certificate bundle, server certificate and private key.
The files must exist and have the appropriate permissions. Incorrect permissions (e.g. files
being owned by <code>root</code> or another superuser account that installed them) is a very common issue
with TLS setups.</p>
<p>On Linux, BSD and MacOS directory permissions can also affect node&#x27;s ability to read the files.</p>
<p>When certificate or private key files are not readable or do not exist,
the node will fail to accept TLS-enabled connections or TLS connections will just hang (the behavior
differs between Erlang/OTP versions).</p>
<p>When <a href="/rabbitmq-website/docs/4.0/configure#config-file-formats">new style configuration format</a> is used to configure certificate and private
key paths, the node will check if the files exist on boot and refuse to start if that&#x27;s not the case.</p>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="verify-file-format">Check Certificate, Private Key and CA Bundle File Format<a href="#verify-file-format" class="hash-link" aria-label="Direct link to Check Certificate, Private Key and CA Bundle File Format" title="Direct link to Check Certificate, Private Key and CA Bundle File Format">​</a></h2>
<p>RabbitMQ nodes require that all certificate, private key and CA certificate bundle files be
in the <a href="https://en.wikipedia.org/wiki/Privacy-Enhanced_Mail" target="_blank" rel="noopener noreferrer">PEM format</a>. Other formats will not be accepted.</p>
<p>Files in other formats can be <a href="https://aboutssl.org/convert-certificate-to-pem-crt-to-pem-crt-to-pem-der-to-pem/" target="_blank" rel="noopener noreferrer">converted to PEM files</a>
using OpenSSL CLI tools.</p>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="verify-tls-support-in-erlang">Check TLS Support in Erlang<a href="#verify-tls-support-in-erlang" class="hash-link" aria-label="Direct link to Check TLS Support in Erlang" title="Direct link to Check TLS Support in Erlang">​</a></h2>
<p>Another key requirement for establishing TLS connections to the broker
is TLS support in the broker. Confirm that the Erlang VM has support
for TLS by running</p>
<div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">rabbitmq-diagnostics </span><span class="token parameter variable" style="color:#36acaa">--silent</span><span class="token plain"> tls_versions</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>Or, on Windows</p>
<div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">rabbitmq-diagnostics.bat </span><span class="token parameter variable" style="color:#36acaa">--silent</span><span class="token plain"> tls_versions</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>The output will look like this:</p>
<div class="language-ini codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-ini codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">tlsv1.2</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">tlsv1.1</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">tlsv1</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">sslv3</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>With versions that do not provide <code>rabbitmq-diagnostics tls_versions</code>, use</p>
<div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">rabbitmqctl </span><span class="token builtin class-name">eval</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&#x27;ssl:versions().&#x27;</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>Or, on Windows</p>
<div class="language-PowerShell language-powershell codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-powershell codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">rabbitmqctl</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">bat eval </span><span class="token string" style="color:#e3116c">&#x27;ssl:versions().&#x27;</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>The output in this case will look like so:</p>
<div class="language-erlang codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-erlang codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token punctuation" style="color:#393A34">[</span><span class="token punctuation" style="color:#393A34">{</span><span class="token atom">ssl_app</span><span class="token punctuation" style="color:#393A34">,</span><span class="token string" style="color:#e3116c">&quot;9.1&quot;</span><span class="token punctuation" style="color:#393A34">}</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token atom">supported</span><span class="token punctuation" style="color:#393A34">,</span><span class="token punctuation" style="color:#393A34">[</span><span class="token quoted-atom atom">&#x27;tlsv1.2&#x27;</span><span class="token punctuation" style="color:#393A34">,</span><span class="token quoted-atom atom">&#x27;tlsv1.1&#x27;</span><span class="token punctuation" style="color:#393A34">,</span><span class="token atom">tlsv1</span><span class="token punctuation" style="color:#393A34">]</span><span class="token punctuation" style="color:#393A34">}</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token atom">supported_dtls</span><span class="token punctuation" style="color:#393A34">,</span><span class="token punctuation" style="color:#393A34">[</span><span class="token quoted-atom atom">&#x27;dtlsv1.2&#x27;</span><span class="token punctuation" style="color:#393A34">,</span><span class="token atom">dtlsv1</span><span class="token punctuation" style="color:#393A34">]</span><span class="token punctuation" style="color:#393A34">}</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token atom">available</span><span class="token punctuation" style="color:#393A34">,</span><span class="token punctuation" style="color:#393A34">[</span><span class="token quoted-atom atom">&#x27;tlsv1.2&#x27;</span><span class="token punctuation" style="color:#393A34">,</span><span class="token quoted-atom atom">&#x27;tlsv1.1&#x27;</span><span class="token punctuation" style="color:#393A34">,</span><span class="token atom">tlsv1</span><span class="token punctuation" style="color:#393A34">,</span><span class="token atom">sslv3</span><span class="token punctuation" style="color:#393A34">]</span><span class="token punctuation" style="color:#393A34">}</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token atom">available_dtls</span><span class="token punctuation" style="color:#393A34">,</span><span class="token punctuation" style="color:#393A34">[</span><span class="token quoted-atom atom">&#x27;dtlsv1.2&#x27;</span><span class="token punctuation" style="color:#393A34">,</span><span class="token atom">dtlsv1</span><span class="token punctuation" style="color:#393A34">]</span><span class="token punctuation" style="color:#393A34">}</span><span class="token punctuation" style="color:#393A34">]</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>If an error is reported instead, confirm that the Erlang/OTP installation <a href="/rabbitmq-website/docs/4.0/ssl#erlang-otp-requirements">includes TLS support</a>.</p>
<p>It is also possible to list cipher suites available on a node:</p>
<div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">rabbitmq-diagnostics cipher_suites </span><span class="token parameter variable" style="color:#36acaa">--format</span><span class="token plain"> openssl </span><span class="token parameter variable" style="color:#36acaa">--silent</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>Or, on Windows:</p>
<div class="language-PowerShell language-powershell codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-powershell codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">rabbitmq-diagnostics</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">bat cipher_suites </span><span class="token operator" style="color:#393A34">--</span><span class="token plain">format openssl </span><span class="token operator" style="color:#393A34">--</span><span class="token plain">silent</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>It is also possible to inspect what TLS versions are supported by the local Erlang runtime.
To do so, run <code>erl</code> (or <code>werl.exe</code> on Windows) on the command line to open an Erlang shell and
enter</p>
<div class="language-erlang codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-erlang codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token comment" style="color:#999988;font-style:italic">%% the trailing dot is significant!</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token atom">ssl</span><span class="token punctuation" style="color:#393A34">:</span><span class="token function" style="color:#d73a49">versions</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">.</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>Note that this will report supported versions on the local node (for the runtime found in <code>PATH</code>),
which may be different from that used by RabbitMQ node(s) inspected.</p>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="openssl-tools">Use OpenSSL Tools to Test TLS Connections<a href="#openssl-tools" class="hash-link" aria-label="Direct link to Use OpenSSL Tools to Test TLS Connections" title="Direct link to Use OpenSSL Tools to Test TLS Connections">​</a></h2>
<p>OpenSSL <a href="http://www.openssl.org/docs/apps/s_client.html" target="_blank" rel="noopener noreferrer">s_client</a>
and <a href="http://www.openssl.org/docs/apps/s_server.html" target="_blank" rel="noopener noreferrer">s_server</a>
are commonly used command line tools that can be used to test TLS connections
and certificate/key pairs. They help narrow problems down by testing against
alternative TLS client and server implementations. For example, if a certain TLS
client works successfully with <code>s_server</code> but not a RabbitMQ node,
the root cause is likely on the server end. Likewise if an <code>s_client</code>
client can successfully connect to a RabbitMQ node but a different client cannot,
it&#x27;s the client setup that should be inspected closely first.</p>
<p>The example below seeks to confirm that the certificates and keys can be used to
establish a TLS connection by connecting an <code>s_client</code> client to an <code>s_server</code> server
in two separate shells (terminal windows).</p>
<p>The example will assume you have the following <a href="/rabbitmq-website/docs/4.0/ssl#certificates-and-keys">certificate and key files</a>
(these filenames are used by <a href="https://github.com/rabbitmq/tls-gen" target="_blank" rel="noopener noreferrer">tls-gen</a>):</p>
<table><tr><td>Item</td><td>Location</td></tr><tr><td>CA certificate (public key)</td><td><code>ca_certificate.pem</code></td></tr><tr><td>Server certificate (public key)</td><td><code>server_certificate.pem</code></td></tr><tr><td>Server private key</td><td><code>server_key.pem</code></td></tr><tr><td>Client certificate (public key)</td><td><code>client_certificate.pem</code></td></tr><tr><td>Client private key</td><td><code>client_key.pem</code></td></tr></table>
<p>In one terminal window or tab execute the following command:</p>
<div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">openssl s_server </span><span class="token parameter variable" style="color:#36acaa">-accept</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">8443</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">\</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token parameter variable" style="color:#36acaa">-cert</span><span class="token plain"> server_certificate.pem </span><span class="token parameter variable" style="color:#36acaa">-key</span><span class="token plain"> server_key.pem </span><span class="token parameter variable" style="color:#36acaa">-CAfile</span><span class="token plain"> ca_certificate.pem</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>It will start an OpenSSL <code>s_server</code> that uses the provided
CA certificate bundler, server certificate and private key. It will be used
to confidence check the certificates with test TLS connections against this example server.</p>
<p>In another terminal window, run the following command, substituting <code>CN_NAME</code>
with the expected hostname or <code>CN</code> name from the certificate:</p>
<div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">openssl s_client </span><span class="token parameter variable" style="color:#36acaa">-connect</span><span class="token plain"> localhost:8443 </span><span class="token punctuation" style="color:#393A34">\</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token parameter variable" style="color:#36acaa">-cert</span><span class="token plain"> client_certificate.pem </span><span class="token parameter variable" style="color:#36acaa">-key</span><span class="token plain"> client_key.pem </span><span class="token parameter variable" style="color:#36acaa">-CAfile</span><span class="token plain"> ca_certificate.pem </span><span class="token punctuation" style="color:#393A34">\</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token parameter variable" style="color:#36acaa">-verify</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">8</span><span class="token plain"> </span><span class="token parameter variable" style="color:#36acaa">-verify_hostname</span><span class="token plain"> CN_NAME</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>It will open a new TLS connection to the example TLS server started above. You may leave
off the <code>-verify_hostname</code> argument but OpenSSL will no longer perform that
verification.</p>
<p>If the certificates and keys have been correctly created, a TLS connection output
will appear in both tabs. There is now a connection between the example client and the example
server, similar to <code>telnet</code>.</p>
<p>If the <a href="/rabbitmq-website/docs/4.0/ssl#peer-verification">trust chain</a> could be established, the second terminal will display
a verification confirmation with the code of <code>0</code>:</p>
<div class="language-ini codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-ini codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">Verify return code: 0 (ok)</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>Just like with command line tools, a non-zero code communicates an error of some kind.</p>
<p>If an error is reported, confirm that the certificates and keys were
generated correctly and that a matching certificate/private key pair is used.
In addition, certificates can have their <a href="https://tools.ietf.org/html/rfc5280#section-4.2.1.3" target="_blank" rel="noopener noreferrer">usage scenarios restricted</a>
at generation time. This means a certificate meant to be used by clients to authenticate themselves
will be rejected by a server, such as a RabbitMQ node.</p>
<p>For environments where self-signed certificates are appropriate,
we recommend using <a href="https://github.com/rabbitmq/tls-gen" target="_blank" rel="noopener noreferrer">tls-gen</a> for generation.</p>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="verify-cipher-suites">Validate Available Cipher Suites<a href="#verify-cipher-suites" class="hash-link" aria-label="Direct link to Validate Available Cipher Suites" title="Direct link to Validate Available Cipher Suites">​</a></h2>
<p>RabbitMQ nodes and clients can be limited in what <a href="/rabbitmq-website/docs/4.0/ssl#cipher-suites">cipher suites</a> they are allowed
to use during TLS handshake. It is important to make sure that the two sides have
some cipher suites in common or otherwise the handshake will fail.</p>
<p>Certificate&#x27;s key usage properties can also limit what cipher suites can be used.</p>
<p>See <a href="/rabbitmq-website/docs/4.0/ssl#cipher-suites">Configuring Cipher Suites</a> and <a href="/rabbitmq-website/docs/4.0/ssl#key-usage">Public Key Usage Extensions</a> in the main TLS guide
to learn more.</p>
<div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">openssl ciphers </span><span class="token parameter variable" style="color:#36acaa">-v</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>will display all cipher suites supported by the local build of OpenSSL.</p>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="sclient-connection">Attempt TLS Connection to a RabbitMQ Node<a href="#sclient-connection" class="hash-link" aria-label="Direct link to Attempt TLS Connection to a RabbitMQ Node" title="Direct link to Attempt TLS Connection to a RabbitMQ Node">​</a></h2>
<p>Once a RabbitMQ node was configured to listen on a TLS port,
the OpenSSL <code>s_client</code> can be used to test TLS connection establishment, this time against the node.
This check establishes whether the broker is likely to be configured correctly, without needing
to configure a RabbitMQ client. The tool can also be useful to compare the behaviour of different clients.
The example assumes a node running on <code>localhost</code> on <a href="/rabbitmq-website/docs/4.0/networking#ports">default TLS port for AMQP 0-9-1 and AMQP 1.0</a>, 5671:</p>
<div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">openssl s_client </span><span class="token parameter variable" style="color:#36acaa">-connect</span><span class="token plain"> localhost:5671 </span><span class="token parameter variable" style="color:#36acaa">-cert</span><span class="token plain"> client_certificate.pem </span><span class="token parameter variable" style="color:#36acaa">-key</span><span class="token plain"> client_key.pem </span><span class="token parameter variable" style="color:#36acaa">-CAfile</span><span class="token plain"> ca_certificate.pem</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>The output should appear similar to the case where port 8443 was used. The node log file
should <a href="/rabbitmq-website/docs/4.0/logging#logged-events">contain a new entry when the connection is established</a>:</p>
<div class="language-ini codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-ini codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">2018-09-27 15:46:20 [info] &lt;0.1082.0&gt; accepting AMQP connection &lt;0.1082.0&gt; (127.0.0.1:50915 -&gt; 127.0.0.1:5671)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">2018-09-27 15:46:20 [info] &lt;0.1082.0&gt; connection &lt;0.1082.0&gt; (127.0.0.1:50915 -&gt; 127.0.0.1:5671): user &#x27;user&#x27; authenticated and granted access to vhost &#x27;virtual_host&#x27;</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>The node will expect clients to perform protocol handshake (AMQP 0-9-1, AMQP 1.0 and so on). If that doesn&#x27;t
happen within a short time window (10 seconds by default for most protocols), the node will close the
connection.</p>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="stunnel">Validate Client Connections with Stunnel<a href="#stunnel" class="hash-link" aria-label="Direct link to Validate Client Connections with Stunnel" title="Direct link to Validate Client Connections with Stunnel">​</a></h2>
<p><a href="http://www.stunnel.org/" target="_blank" rel="noopener noreferrer">stunnel</a> is a tool that can be used to validate TLS-enabled clients.
In this configuration clients will make a secure connection to stunnel,
which will pass the decrypted data through to a &quot;regular&quot; port of the broker (say, 5672 for AMQP 0-9-1 and AMQP 1.0).
This provides some confidence that the client TLS configuration is correct independently of the broker TLS configuration.</p>
<p><code>stunnel</code> is a specialised proxy. In this example it will run in daemon mode on the same host as the broker.
In the discussion that follows it is assumed that stunnel will only be used temporarily. It is also possible to use stunnel to
perform TLS termination but that is out of scope for this guide.</p>
<p>In this example <code>stunnel</code> will connect to the unencrypted port of the broker (5672) and accept
TLS connections from TLS-capable clients on port 5679.</p>
<p>Parameters are passed via a config file named <code>stunnel.conf</code>. It has the following content:</p>
<div class="language-ini codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-ini codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">foreground = yes</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">[rabbit-amqp]</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">connect = localhost:5672</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">accept = 5679</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">cert = client/key-cert.pem</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">debug = 7</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p><code>stunnel</code> is started as follows:</p>
<div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token function" style="color:#d73a49">cat</span><span class="token plain"> client_key.pem client_certificate.pem </span><span class="token operator" style="color:#393A34">&gt;</span><span class="token plain"> client/key-cert.pem</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">stunnel stunnel.conf</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p><code>stunnel</code> requires a certificate and its corresponding private key. The certificate
and private key files must be concatenated as shown above with the <code>cat</code> command.
<code>stunnel</code> requires that the key not be password-protected.
TLS-capable clients should now be able to connect to port 5679 and any TLS errors will appear
on the console where <code>stunnel</code> was started.</p>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="client-connection">Validate RabbitMQ Client Connection to RabbitMQ Node<a href="#client-connection" class="hash-link" aria-label="Direct link to Validate RabbitMQ Client Connection to RabbitMQ Node" title="Direct link to Validate RabbitMQ Client Connection to RabbitMQ Node">​</a></h2>
<p>Assuming none of the previous steps produced errors then you can confidently connect the tested TLS-enabled
client to the TLS-enabled port of the broker, making sure to stop any running OpenSSL <code>s_server</code>
or <code>stunnel</code> instances first.</p>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="verify-verification-depth">Certificate Chains and Verification Depth<a href="#verify-verification-depth" class="hash-link" aria-label="Direct link to Certificate Chains and Verification Depth" title="Direct link to Certificate Chains and Verification Depth">​</a></h2>
<p>When using a client certificate <a href="/rabbitmq-website/docs/4.0/ssl#peer-verification">signed by an intermediate CA</a>, it may be necessary
to configure RabbitMQ server to use a higher <a href="/rabbitmq-website/docs/4.0/ssl#peer-verification-depth">verification depth</a>.</p>
<p>Insufficient verification depth will result in TLS peer verification failures.</p>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="logs">Understanding TLS Connection Log Errors<a href="#logs" class="hash-link" aria-label="Direct link to Understanding TLS Connection Log Errors" title="Direct link to Understanding TLS Connection Log Errors">​</a></h2>
<p>New broker logfile entries will be generated during many of the preceding steps. These entries
together with diagnostic output from commands on the console should help to identify the cause
of TLS-related errors. What follows is a list of the most common error entries:</p>
<table><thead><td><strong>Logged Errors</strong></td><td><strong>Explanation</strong></td></thead><tr><td><p>Entries containing <code>{undef, [{crypto,hash,...</code></p></td><td><p>The <code>crypto</code> module is missing in the Erlang/OTP installation
used or it is out of date. On Debian, Ubuntu, and other Debian-derived distributions
it usually means that the <a href="http://packages.ubuntu.com/search?keywords=erlang-ssl" target="_blank" rel="noopener noreferrer">erlang-ssl</a> package was not installed.</p></td></tr><tr><td><p>Entries containing <code>{ssl_upgrade_error, ekeyfile}</code>
or <code>{ssl_upgrade_error, ecertfile}</code></p></td><td><p>This means the broker keyfile or certificate file is invalid.
Confirm that the keyfile matches the certificate and that both are in PEM format.
PEM format is a printable encoding with recognisable delimiters. The certificate
will start and end with <code>-----BEGIN CERTIFICATE-----</code> and
<code>-----END CERTIFICATE-----</code> respectively. The keyfile will likewise
start and end with <code>-----BEGIN RSA PRIVATE KEY-----</code> and
<code>-----END RSA PRIVATE KEY-----</code> respectively.</p></td></tr><tr><td><p>Entries containing <code>{ssl_upgrade_failure, ... certify ...}</code></p></td><td><p>This error is related to client verification. The client is presenting an invalid
certificate or no certificate. If the ssl_options has the <code>verify</code> option
set to <code>verify_peer</code> then try using the value <code>verify_none</code>
temporarily. Ensure that the client certificate has been generated correctly, and that
the client is presenting the correct certificate.</p></td></tr><tr><td><p>Entries containing <code>{ssl_upgrade_error, ...}</code></p></td><td><p>This is a generic error that could have many causes. Make sure you are
using the recommended version of Erlang.</p></td></tr><tr><td><p>Entries containing <code>{tls_alert,&quot;bad record mac&quot;}</code></p></td><td><p>The server has tried verifying integrity of a piece of data it received
and the check failed. This can be due to problematic network equipment, unintentional
socket sharing in the client (e.g. due to the use of <code>fork(2)</code>) or a bug
in the client implementation of TLS.</p></td></tr></table></div><footer class="theme-doc-footer docusaurus-mt-lg"><div class="row margin-top--sm theme-doc-footer-edit-meta-row"><div class="col"><a href="https://github.com/rabbitmq/rabbitmq-website/tree/main/versioned_docs/version-4.0/troubleshooting-ssl.md" target="_blank" rel="noopener noreferrer" class="theme-edit-this-page"><svg fill="currentColor" height="20" width="20" viewBox="0 0 40 40" class="iconEdit_Z9Sw" aria-hidden="true"><g><path d="m34.5 11.7l-3 3.1-6.3-6.3 3.1-3q0.5-0.5 1.2-0.5t1.1 0.5l3.9 3.9q0.5 0.4 0.5 1.1t-0.5 1.2z m-29.5 17.1l18.4-18.5 6.3 6.3-18.4 18.4h-6.3v-6.2z"></path></g></svg>Edit this page</a></div><div class="col lastUpdated_JAkA"></div></div></footer></article><nav class="pagination-nav docusaurus-mt-lg" aria-label="Docs pages"><a class="pagination-nav__link pagination-nav__link--prev" href="/rabbitmq-website/docs/4.0/troubleshooting-networking"><div class="pagination-nav__sublabel">Previous</div><div class="pagination-nav__label">Troubleshooting Connectivity</div></a><a class="pagination-nav__link pagination-nav__link--next" href="/rabbitmq-website/docs/4.0/clustering"><div class="pagination-nav__sublabel">Next</div><div class="pagination-nav__label">Clustering Guide</div></a></nav></div></div><div class="col col--3"><div class="tableOfContents_bqdL thin-scrollbar theme-doc-toc-desktop"><ul class="table-of-contents table-of-contents__left-border"><li><a href="#overview" class="table-of-contents__link toc-highlight">Overview</a></li><li><a href="#verify-config" class="table-of-contents__link toc-highlight">Check Effective Node Configuration</a></li><li><a href="#verify-listeners" class="table-of-contents__link toc-highlight">Check TLS Listeners (Ports)</a></li><li><a href="#verify-file-permissions" class="table-of-contents__link toc-highlight">Check Certificate, Private Key and CA Bundle File Permissions</a></li><li><a href="#verify-file-format" class="table-of-contents__link toc-highlight">Check Certificate, Private Key and CA Bundle File Format</a></li><li><a href="#verify-tls-support-in-erlang" class="table-of-contents__link toc-highlight">Check TLS Support in Erlang</a></li><li><a href="#openssl-tools" class="table-of-contents__link toc-highlight">Use OpenSSL Tools to Test TLS Connections</a></li><li><a href="#verify-cipher-suites" class="table-of-contents__link toc-highlight">Validate Available Cipher Suites</a></li><li><a href="#sclient-connection" class="table-of-contents__link toc-highlight">Attempt TLS Connection to a RabbitMQ Node</a></li><li><a href="#stunnel" class="table-of-contents__link toc-highlight">Validate Client Connections with Stunnel</a></li><li><a href="#client-connection" class="table-of-contents__link toc-highlight">Validate RabbitMQ Client Connection to RabbitMQ Node</a></li><li><a href="#verify-verification-depth" class="table-of-contents__link toc-highlight">Certificate Chains and Verification Depth</a></li><li><a href="#logs" class="table-of-contents__link toc-highlight">Understanding TLS Connection Log Errors</a></li></ul></div></div></div></div></main></div></div></div><footer class="footer footer--dark"><div class="container container-fluid"><div class="row footer__links"><div class="col footer__col"><div class="footer__title">Learn about RabbitMQ</div><ul class="footer__items clean-list"><li class="footer__item"><a class="footer__link-item" href="/rabbitmq-website/tutorials">Getting Started</a></li><li class="footer__item"><a class="footer__link-item" href="/rabbitmq-website/docs">Documentation</a></li><li class="footer__item"><a class="footer__link-item" href="/rabbitmq-website/blog">Blog</a></li></ul></div><div class="col footer__col"><div class="footer__title">Reach out to the RabbitMQ team</div><ul class="footer__items clean-list"><li class="footer__item"><a href="https://github.com/rabbitmq" target="_blank" rel="noopener noreferrer" class="footer__link-item">GitHub<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_nPIU"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a></li><li class="footer__item"><a href="https://github.com/rabbitmq/rabbitmq-server/discussions" target="_blank" rel="noopener noreferrer" class="footer__link-item">GitHub Discussions<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_nPIU"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a></li><li class="footer__item"><a class="footer__link-item" href="/rabbitmq-website/contact?utm_source=rmq_release-information_tableheader&amp;utm_medium=rmq_website&amp;utm_campaign=tanzu">Long Term Commercial Support</a></li><li class="footer__item"><a class="footer__link-item" href="/rabbitmq-website/contact">Contact Us</a></li><li class="footer__item"><a href="https://www.rabbitmq.com/discord" target="_blank" rel="noopener noreferrer" class="footer__link-item">Discord<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_nPIU"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a></li></ul></div><div class="col footer__col"><div class="footer__title">Broadcom</div><ul class="footer__items clean-list"><li class="footer__item"><a href="https://tanzu.vmware.com/" target="_blank" rel="noopener noreferrer" class="footer__link-item">VMware Tanzu<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_nPIU"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a></li><li class="footer__item"><a href="https://www.vmware.com/help/legal.html" target="_blank" rel="noopener noreferrer" class="footer__link-item">Terms of Use<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_nPIU"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a></li><li class="footer__item"><a href="https://www.vmware.com/help/privacy.html" target="_blank" rel="noopener noreferrer" class="footer__link-item">Privacy<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_nPIU"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a></li><li class="footer__item"><a class="footer__link-item" href="/rabbitmq-website/trademark-guidelines">Trademark Guidelines</a></li><li class="footer__item"><a href="https://www.vmware.com/help/privacy/california-privacy-rights.html" target="_blank" rel="noopener noreferrer" class="footer__link-item">Your California Privacy Rights<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_nPIU"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a></li><li class="footer__item"><a class="footer__link-item ot-sdk-show-settings">Cookie Settings</a></li></ul></div></div><div class="footer__bottom text--center"><div class="footer__copyright">Copyright © 2005-2025 Broadcom. All Rights Reserved. The term "Broadcom" refers to Broadcom Inc. and/or its subsidiaries.</div></div></div></footer></div>
</body>
</html>
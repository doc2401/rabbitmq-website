<!doctype html>
<html lang="en" dir="ltr" class="docs-wrapper plugin-docs plugin-id-default docs-version-4.0 docs-doc-page docs-doc-id-quorum-queues/index" data-has-hydrated="false">
<head>
<meta charset="UTF-8">
<meta name="generator" content="Docusaurus v3.7.0">
<title data-rh="true">Quorum Queues | RabbitMQ</title><meta data-rh="true" name="viewport" content="width=device-width,initial-scale=1"><meta data-rh="true" name="twitter:card" content="summary_large_image"><meta data-rh="true" property="og:image" content="https://www.rabbitmq.com/rabbitmq-website/img/rabbitmq-social-media-card.svg"><meta data-rh="true" name="twitter:image" content="https://www.rabbitmq.com/rabbitmq-website/img/rabbitmq-social-media-card.svg"><meta data-rh="true" property="og:url" content="https://www.rabbitmq.com/rabbitmq-website/docs/4.0/quorum-queues"><meta data-rh="true" property="og:locale" content="en"><meta data-rh="true" name="docusaurus_locale" content="en"><meta data-rh="true" name="docsearch:language" content="en"><meta data-rh="true" name="docusaurus_version" content="4.0"><meta data-rh="true" name="docusaurus_tag" content="docs-default-4.0"><meta data-rh="true" name="docsearch:version" content="4.0"><meta data-rh="true" name="docsearch:docusaurus_tag" content="docs-default-4.0"><meta data-rh="true" property="og:title" content="Quorum Queues | RabbitMQ"><meta data-rh="true" name="description" content="&lt;!--"><meta data-rh="true" property="og:description" content="&lt;!--"><link data-rh="true" rel="icon" href="/rabbitmq-website/img/rabbitmq-logo.svg"><link data-rh="true" rel="canonical" href="https://www.rabbitmq.com/rabbitmq-website/docs/4.0/quorum-queues"><link data-rh="true" rel="alternate" href="https://www.rabbitmq.com/rabbitmq-website/docs/4.0/quorum-queues" hreflang="en"><link data-rh="true" rel="alternate" href="https://www.rabbitmq.com/rabbitmq-website/docs/4.0/quorum-queues" hreflang="x-default"><link data-rh="true" rel="preconnect" href="https://H10VQIW16Y-dsn.algolia.net" crossorigin="anonymous"><link rel="alternate" type="application/rss+xml" href="/rabbitmq-website/blog/rss.xml" title="RabbitMQ RSS Feed">
<link rel="alternate" type="application/atom+xml" href="/rabbitmq-website/blog/atom.xml" title="RabbitMQ Atom Feed">




<link rel="search" type="application/opensearchdescription+xml" title="RabbitMQ" href="/rabbitmq-website/opensearch.xml">







<link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Raleway:400,700">
<script src="https://cdn.cookielaw.org/scripttemplates/otSDKStub.js" data-domain-script="018ee308-473e-754f-b0c2-cbe82d25512f"></script>
<script>function OptanonWrapper(){}</script>
<script>function setGTM(e,t,o,n,r){e[n]=e[n]||[],e[n].push({"gtm.start":(new Date).getTime(),event:"gtm.js"});var i=t.getElementsByTagName(o)[0],a=t.createElement(o),s="dataLayer"!=n?"&l="+n:"";a.async=!0,a.src="https://www.googletagmanager.com/gtm.js?id="+r+s,i.parentNode.insertBefore(a,i)}var timer;function waitForOnetrustActiveGroups(){document.cookie.indexOf("OptanonConsent")>-1&&document.cookie.indexOf("groups=")>-1?(clearTimeout(timer),setGTM(window,document,"script","dataLayer","GTM-TT84L8K")):timer=setTimeout(waitForOnetrustActiveGroups,250)}document.cookie.indexOf("OptanonConsent")>-1&&document.cookie.indexOf("groups=")>-1?setGTM(window,document,"script","dataLayer","GTM-TT84L8K"):waitForOnetrustActiveGroups()</script><link rel="stylesheet" href="/rabbitmq-website/styles.css">
<script src="/rabbitmq-website/runtime~main.js" defer="defer"></script>
<script src="/rabbitmq-website/main.js" defer="defer"></script>
</head>
<body class="navigation-with-keyboard">
<script>!function(){function t(t){document.documentElement.setAttribute("data-theme",t)}var e=function(){try{return new URLSearchParams(window.location.search).get("docusaurus-theme")}catch(t){}}()||function(){try{return window.localStorage.getItem("theme")}catch(t){}}();null!==e?t(e):window.matchMedia("(prefers-color-scheme: dark)").matches?t("dark"):(window.matchMedia("(prefers-color-scheme: light)").matches,t("light"))}(),function(){try{const n=new URLSearchParams(window.location.search).entries();for(var[t,e]of n)if(t.startsWith("docusaurus-data-")){var a=t.replace("docusaurus-data-","data-");document.documentElement.setAttribute(a,e)}}catch(t){}}(),document.documentElement.setAttribute("data-announcement-bar-initially-dismissed",function(){try{return"true"===localStorage.getItem("docusaurus.announcement.dismiss")}catch(t){}return!1}())</script><div id="__docusaurus"><div role="region" aria-label="Skip to main content"><a class="skipToContent_fXgn" href="#__docusaurus_skipToContent_fallback">Skip to main content</a></div><div class="announcementBar_mb4j" style="background-color:var(--ifm-color-primary-contrast-background);color:var(--ifm-font-color-base)" role="banner"><div class="announcementBarPlaceholder_vyr4"></div><div class="content_knG7 announcementBarContent_xLdY"><strong style="font-size: var(--ifm-h4-font-size);"><a href="https://github.com/rabbitmq/rabbitmq-server/releases/tag/v4.1.0">RabbitMQ 4.1.0 is out</a></strong></div><button type="button" aria-label="Close" class="clean-btn close closeButton_CVFx announcementBarClose_gvF7"><svg viewBox="0 0 15 15" width="14" height="14"><g stroke="currentColor" stroke-width="3.1"><path d="M.75.75l13.5 13.5M14.25.75L.75 14.25"></path></g></svg></button></div><nav aria-label="Main" class="navbar navbar--fixed-top"><div class="navbar__inner"><div class="navbar__items"><button aria-label="Toggle navigation bar" aria-expanded="false" class="navbar__toggle clean-btn" type="button"><svg width="30" height="30" viewBox="0 0 30 30" aria-hidden="true"><path stroke="currentColor" stroke-linecap="round" stroke-miterlimit="10" stroke-width="2" d="M4 7h22M4 15h22M4 23h22"></path></svg></button><a class="navbar__brand" href="/rabbitmq-website/"><div class="navbar__logo"><img src="/rabbitmq-website/img/rabbitmq-logo-with-name.svg" alt="RabbitMQ" class="themedComponent_mlkZ themedComponent--light_NVdE"><img src="/rabbitmq-website/img/rabbitmq-logo-with-name.svg" alt="RabbitMQ" class="themedComponent_mlkZ themedComponent--dark_xIcU"></div></a><a class="navbar__item navbar__link" href="/rabbitmq-website/tutorials">Getting Started</a><a aria-current="page" class="navbar__item navbar__link navbar__link--active" href="/rabbitmq-website/docs/4.0">Docs</a><a class="navbar__item navbar__link" href="/rabbitmq-website/blog">Blog</a><a class="navbar__item navbar__link" href="/rabbitmq-website/contact">Support</a></div><div class="navbar__items navbar__items--right"><div class="navbar__item dropdown dropdown--hoverable dropdown--right"><a aria-current="page" class="navbar__link active" aria-haspopup="true" aria-expanded="false" role="button" href="/rabbitmq-website/docs/4.0/quorum-queues">4.0</a><ul class="dropdown__menu"><li class=""><strong>Release series</strong></li><li><a class="dropdown__link" href="/rabbitmq-website/docs/next/quorum-queues">Next</a></li><li><a class="dropdown__link" href="/rabbitmq-website/docs/quorum-queues">4.1</a></li><li><a aria-current="page" class="dropdown__link dropdown__link--active" href="/rabbitmq-website/docs/4.0/quorum-queues">4.0</a></li><li><a class="dropdown__link" href="/rabbitmq-website/docs/3.13/quorum-queues">3.13</a></li><li><a href="https://v3-12.rabbitmq.com/documentation.html" target="_blank" rel="noopener noreferrer" class="dropdown__link">3.12<svg width="12" height="12" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_nPIU"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a></li><li><a class="dropdown__link" href="/rabbitmq-website/release-information">Release Information</a></li></ul></div><a href="https://github.com/rabbitmq/rabbitmq-website" target="_blank" rel="noopener noreferrer" class="navbar__item navbar__link">GitHub<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_nPIU"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a><div class="toggle_vylO colorModeToggle_DEke"><button class="clean-btn toggleButton_gllP toggleButtonDisabled_aARS" type="button" disabled="" title="Switch between dark and light mode (currently light mode)" aria-label="Switch between dark and light mode (currently light mode)" aria-live="polite" aria-pressed="false"><svg viewBox="0 0 24 24" width="24" height="24" class="lightToggleIcon_pyhR"><path fill="currentColor" d="M12,9c1.65,0,3,1.35,3,3s-1.35,3-3,3s-3-1.35-3-3S10.35,9,12,9 M12,7c-2.76,0-5,2.24-5,5s2.24,5,5,5s5-2.24,5-5 S14.76,7,12,7L12,7z M2,13l2,0c0.55,0,1-0.45,1-1s-0.45-1-1-1l-2,0c-0.55,0-1,0.45-1,1S1.45,13,2,13z M20,13l2,0c0.55,0,1-0.45,1-1 s-0.45-1-1-1l-2,0c-0.55,0-1,0.45-1,1S19.45,13,20,13z M11,2v2c0,0.55,0.45,1,1,1s1-0.45,1-1V2c0-0.55-0.45-1-1-1S11,1.45,11,2z M11,20v2c0,0.55,0.45,1,1,1s1-0.45,1-1v-2c0-0.55-0.45-1-1-1C11.45,19,11,19.45,11,20z M5.99,4.58c-0.39-0.39-1.03-0.39-1.41,0 c-0.39,0.39-0.39,1.03,0,1.41l1.06,1.06c0.39,0.39,1.03,0.39,1.41,0s0.39-1.03,0-1.41L5.99,4.58z M18.36,16.95 c-0.39-0.39-1.03-0.39-1.41,0c-0.39,0.39-0.39,1.03,0,1.41l1.06,1.06c0.39,0.39,1.03,0.39,1.41,0c0.39-0.39,0.39-1.03,0-1.41 L18.36,16.95z M19.42,5.99c0.39-0.39,0.39-1.03,0-1.41c-0.39-0.39-1.03-0.39-1.41,0l-1.06,1.06c-0.39,0.39-0.39,1.03,0,1.41 s1.03,0.39,1.41,0L19.42,5.99z M7.05,18.36c0.39-0.39,0.39-1.03,0-1.41c-0.39-0.39-1.03-0.39-1.41,0l-1.06,1.06 c-0.39,0.39-0.39,1.03,0,1.41s1.03,0.39,1.41,0L7.05,18.36z"></path></svg><svg viewBox="0 0 24 24" width="24" height="24" class="darkToggleIcon_wfgR"><path fill="currentColor" d="M9.37,5.51C9.19,6.15,9.1,6.82,9.1,7.5c0,4.08,3.32,7.4,7.4,7.4c0.68,0,1.35-0.09,1.99-0.27C17.45,17.19,14.93,19,12,19 c-3.86,0-7-3.14-7-7C5,9.07,6.81,6.55,9.37,5.51z M12,3c-4.97,0-9,4.03-9,9s4.03,9,9,9s9-4.03,9-9c0-0.46-0.04-0.92-0.1-1.36 c-0.98,1.37-2.58,2.26-4.4,2.26c-2.98,0-5.4-2.42-5.4-5.4c0-1.81,0.89-3.42,2.26-4.4C12.92,3.04,12.46,3,12,3L12,3z"></path></svg></button></div><div class="navbarSearchContainer_Bca1"><button type="button" class="DocSearch DocSearch-Button" aria-label="Search (Command+K)"><span class="DocSearch-Button-Container"><svg width="20" height="20" class="DocSearch-Search-Icon" viewBox="0 0 20 20" aria-hidden="true"><path d="M14.386 14.386l4.0877 4.0877-4.0877-4.0877c-2.9418 2.9419-7.7115 2.9419-10.6533 0-2.9419-2.9418-2.9419-7.7115 0-10.6533 2.9418-2.9419 7.7115-2.9419 10.6533 0 2.9419 2.9418 2.9419 7.7115 0 10.6533z" stroke="currentColor" fill="none" fill-rule="evenodd" stroke-linecap="round" stroke-linejoin="round"></path></svg><span class="DocSearch-Button-Placeholder">Search</span></span><span class="DocSearch-Button-Keys"></span></button></div></div></div><div role="presentation" class="navbar-sidebar__backdrop"></div></nav><div id="__docusaurus_skipToContent_fallback" class="main-wrapper mainWrapper_z2l0"><div class="docsWrapper_hBAB"><button aria-label="Scroll back to top" class="clean-btn theme-back-to-top-button backToTopButton_sjWU" type="button"></button><div class="docRoot_UBD9"><aside class="theme-doc-sidebar-container docSidebarContainer_YfHR"><div class="sidebarViewport_aRkj"><div class="sidebar_njMd"><nav aria-label="Docs sidebar" class="menu thin-scrollbar menu_SIkG menuWithAnnouncementBar_GW3s"><ul class="theme-doc-sidebar-menu menu__list"><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/rabbitmq-website/docs/4.0">Introduction</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/rabbitmq-website/release-information">Release Information</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/rabbitmq-website/tutorials">Getting Started</a></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist" href="/rabbitmq-website/docs/4.0/download">Install and Upgrade</a><button aria-label="Expand sidebar category &#x27;Install and Upgrade&#x27;" aria-expanded="false" type="button" class="clean-btn menu__caret"></button></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--active" href="/rabbitmq-website/docs/4.0/use-rabbitmq">How to Use RabbitMQ</a><button aria-label="Collapse sidebar category &#x27;How to Use RabbitMQ&#x27;" aria-expanded="true" type="button" class="clean-btn menu__caret"></button></div><ul style="display:block;overflow:visible;height:auto" class="menu__list"><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-2 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist" tabindex="0" href="/rabbitmq-website/docs/4.0/publishers">Publishing Messages</a><button aria-label="Expand sidebar category &#x27;Publishing Messages&#x27;" aria-expanded="false" type="button" class="clean-btn menu__caret"></button></div></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/rabbitmq-website/docs/4.0/exchanges">Exchanges</a></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-2 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist" tabindex="0" href="/rabbitmq-website/docs/4.0/consumers">Consuming Messages</a><button aria-label="Expand sidebar category &#x27;Consuming Messages&#x27;" aria-expanded="false" type="button" class="clean-btn menu__caret"></button></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-2 menu__list-item"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--active" tabindex="0" href="/rabbitmq-website/docs/4.0/queues">Queues</a><button aria-label="Collapse sidebar category &#x27;Queues&#x27;" aria-expanded="true" type="button" class="clean-btn menu__caret"></button></div><ul style="display:block;overflow:visible;height:auto" class="menu__list"><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class="menu__link menu__link--active" aria-current="page" tabindex="0" href="/rabbitmq-website/docs/4.0/quorum-queues">Quorum Queues</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class="menu__link" tabindex="0" href="/rabbitmq-website/docs/4.0/classic-queues">Classic Queues</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class="menu__link" tabindex="0" href="/rabbitmq-website/docs/4.0/ttl">Time-to-Live and Expiration</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class="menu__link" tabindex="0" href="/rabbitmq-website/docs/4.0/maxlength">Queue Length</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class="menu__link" tabindex="0" href="/rabbitmq-website/docs/4.0/lazy-queues">Lazy Queues</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class="menu__link" tabindex="0" href="/rabbitmq-website/docs/4.0/dlx">Dead Lettering</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class="menu__link" tabindex="0" href="/rabbitmq-website/docs/4.0/priority">Priority Queues</a></li></ul></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/rabbitmq-website/docs/4.0/streams">Streams</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/rabbitmq-website/docs/4.0/channels">Channels</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/rabbitmq-website/docs/4.0/reliability">Reliability and Data Safety</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/rabbitmq-website/docs/4.0/confirms">Consumer Acknowledgements and Publisher Confirms</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/rabbitmq-website/docs/4.0/distributed">Network Distribution</a></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-2 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist" tabindex="0" href="/rabbitmq-website/docs/4.0/plugins">Plugins</a><button aria-label="Expand sidebar category &#x27;Plugins&#x27;" aria-expanded="false" type="button" class="clean-btn menu__caret"></button></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-2 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist" tabindex="0" href="/rabbitmq-website/docs/4.0/protocols">Protocols</a><button aria-label="Expand sidebar category &#x27;Protocols&#x27;" aria-expanded="false" type="button" class="clean-btn menu__caret"></button></div></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/rabbitmq-website/client-libraries">Client Libraries</a></li></ul></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist" href="/rabbitmq-website/docs/4.0/manage-rabbitmq">How to Manage RabbitMQ</a><button aria-label="Expand sidebar category &#x27;How to Manage RabbitMQ&#x27;" aria-expanded="false" type="button" class="clean-btn menu__caret"></button></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist" href="/rabbitmq-website/docs/4.0/monitoring">How to Monitor RabbitMQ</a><button aria-label="Expand sidebar category &#x27;How to Monitor RabbitMQ&#x27;" aria-expanded="false" type="button" class="clean-btn menu__caret"></button></div></li></ul></nav></div></div></aside><main class="docMainContainer_TBSr"><div class="container padding-top--md padding-bottom--lg"><div class="row"><div class="col docItemCol_VOVn"><div class="theme-doc-version-banner alert alert--warning margin-bottom--md" role="alert"><div>This is documentation for <!-- -->RabbitMQ<!-- --> <b>4.0</b>, which is no longer actively maintained.</div><div class="margin-top--md">For up-to-date documentation, see the <b><a href="/rabbitmq-website/docs/quorum-queues">latest version</a></b> (<!-- -->4.1<!-- -->).</div></div><div class="docItemContainer_Djhp"><article><nav class="theme-doc-breadcrumbs breadcrumbsContainer_Z_bl" aria-label="Breadcrumbs"><ul class="breadcrumbs" itemscope="" itemtype="https://schema.org/BreadcrumbList"><li class="breadcrumbs__item"><a aria-label="Home page" class="breadcrumbs__link" href="/rabbitmq-website/"><svg viewBox="0 0 24 24" class="breadcrumbHomeIcon_YNFT"><path d="M10 19v-5h4v5c0 .55.45 1 1 1h3c.55 0 1-.45 1-1v-7h1.7c.46 0 .68-.57.33-.87L12.67 3.6c-.38-.34-.96-.34-1.34 0l-8.36 7.53c-.34.3-.13.87.33.87H5v7c0 .55.45 1 1 1h3c.55 0 1-.45 1-1z" fill="currentColor"></path></svg></a></li><li itemscope="" itemprop="itemListElement" itemtype="https://schema.org/ListItem" class="breadcrumbs__item"><a class="breadcrumbs__link" itemprop="item" href="/rabbitmq-website/docs/4.0/use-rabbitmq"><span itemprop="name">How to Use RabbitMQ</span></a><meta itemprop="position" content="1"></li><li itemscope="" itemprop="itemListElement" itemtype="https://schema.org/ListItem" class="breadcrumbs__item"><a class="breadcrumbs__link" itemprop="item" href="/rabbitmq-website/docs/4.0/queues"><span itemprop="name">Queues</span></a><meta itemprop="position" content="2"></li><li itemscope="" itemprop="itemListElement" itemtype="https://schema.org/ListItem" class="breadcrumbs__item breadcrumbs__item--active"><span class="breadcrumbs__link" itemprop="name">Quorum Queues</span><meta itemprop="position" content="3"></li></ul></nav><span class="theme-doc-version-badge badge badge--secondary">Version: 4.0</span><div class="tocCollapsible_ETCw theme-doc-toc-mobile tocMobile_ITEo"><button type="button" class="clean-btn tocCollapsibleButton_TO0P">On this page</button></div><div class="theme-doc-markdown markdown"><header><h1>Quorum Queues</h1></header>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="overview">Overview<a href="#overview" class="hash-link" aria-label="Direct link to Overview" title="Direct link to Overview">​</a></h2>
<p>The RabbitMQ quorum queue is a modern queue type which implements a durable,
replicated queue based on the <a href="https://raft.github.io/" target="_blank" rel="noopener noreferrer">Raft consensus algorithm</a>
and should be considered the default choice when needing a replicated, highly
available queue.</p>
<p>Quorum queues are designed for excellent data safety as well as reliable and fast
leader election properties to ensure high availability even during upgrades
or other turbulence.</p>
<p>Quorum queues are optimized for certain <a href="#use-cases">use cases</a> where <a href="#data-safety">data safety</a> is
the top priority. This is covered in the <a href="#motivation">Motivation</a> section.</p>
<p>Quorum queues have <a href="#behaviour">differences in behaviour</a> compared to classic
queues as well as some <a href="#feature-comparison">limitations</a> that it is important
to be aware of when converting
an application from using classic to quorum queues.</p>
<p>Some features are specific to quorum queues such as <a href="#poison-message-handling">poison message handling</a>
, <a href="#activating-at-least-once-dead-lettering">at least once dead-lettering</a> and
the <code>modified</code> outcome when using <a href="/rabbitmq-website/docs/4.0/amqp">AMQP</a>.</p>
<p>For cases that would benefit from replication and repeatable reads, <a href="/rabbitmq-website/docs/4.0/streams">streams</a> may
be a better option than quorum queues.</p>
<p>Quorum queues and <a href="/rabbitmq-website/docs/4.0/streams">streams</a> are the two replicated data structures
available. Classic queue mirroring was removed starting with RabbitMQ 4.0.</p>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="toc">Topics Covered<a href="#toc" class="hash-link" aria-label="Direct link to Topics Covered" title="Direct link to Topics Covered">​</a></h2>
<p>Topics covered in this document include:</p>
<ul>
<li><a href="#motivation">What are quorum queues</a> and why they were introduced</li>
<li><a href="#feature-comparison">How are they different</a> from classic queues</li>
<li>Primary <a href="#use-cases">use cases</a> of quorum queues and when not to use them</li>
<li>How to <a href="#usage">declare a quorum queue</a></li>
<li><a href="#replication">Replication</a>-related topics: <a href="#member-management">replica management</a>, <a href="#replica-rebalancing">replica leader rebalancing</a>, optimal number of replicas, etc</li>
<li>What guarantees quorum queues offer in terms of <a href="#leader-election">leader failure handling</a>, <a href="#data-safety">data safety</a> and <a href="#availability">availability</a></li>
<li>Continuous <a href="#replica-reconciliation">Membership Reconciliation</a></li>
<li>The additional <a href="#dead-lettering">dead lettering</a> features supported by quorum queues</li>
<li><a href="#resource-use">Memory and disk footprint</a> of quorum queues</li>
<li><a href="#performance">Performance</a> characteristics of quorum queues</li>
<li><a href="#performance-tuning">Performance tuning</a>, both for workloads with <a href="#performance-tuning-small-messages">small messages</a> and <a href="#performance-tuning-large-messages">large messages</a></li>
<li><a href="#poison-message-handling">Poison message handling</a> (failure-redelivery loop protection)</li>
<li>Options to Relax <a href="#relaxed-property-equivalence">Property Equivalence</a></li>
<li><a href="#configuration">Configurable settings</a> of quorum queues</li>
</ul>
<p>and more.</p>
<p>General familiarity with <a href="/rabbitmq-website/docs/4.0/clustering">RabbitMQ clustering</a> would be helpful here when learning more about quorum queues.</p>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="motivation">Motivation<a href="#motivation" class="hash-link" aria-label="Direct link to Motivation" title="Direct link to Motivation">​</a></h2>
<p>Quorum queues adopt a different replication
and consensus protocol and give up support for certain &quot;transient&quot; in nature features, which results in some limitations. These limitations are covered later in this information.</p>
<p>Quorum queues pass a <a href="https://github.com/rabbitmq/jepsen#jepsen-tests-for-rabbitmq" target="_blank" rel="noopener noreferrer">refactored and more demanding version</a> of the <a href="https://aphyr.com/posts/315-jepsen-rabbitmq#rabbit-as-a-queue" target="_blank" rel="noopener noreferrer">original Jepsen test</a>.
This ensures they behave as expected under network partitions and failure scenarios.
The new test runs continuously to spot possible regressions and is enhanced regularly to test new features (e.g. <a href="#dead-lettering">dead lettering</a>).</p>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="what-is-quorum">What is a Quorum?<a href="#what-is-quorum" class="hash-link" aria-label="Direct link to What is a Quorum?" title="Direct link to What is a Quorum?">​</a></h3>
<p>If intentionally simplified, <a href="https://en.wikipedia.org/wiki/Quorum_(distributed_computing)" target="_blank" rel="noopener noreferrer">quorum</a> in a distributed system can
be defined as an agreement between the majority of nodes (<code>(N/2)+1</code> where <code>N</code> is the total number of
system participants).</p>
<p>When applied to queue mirroring in RabbitMQ <a href="/rabbitmq-website/docs/4.0/clustering">clusters</a>
this means that the majority of replicas (including the currently elected queue leader)
agree on the state of the queue and its contents.</p>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="use-cases">Use Cases<a href="#use-cases" class="hash-link" aria-label="Direct link to Use Cases" title="Direct link to Use Cases">​</a></h2>
<p>Quorum queues intended use is in topologies where queues exist for a long time
and are critical to certain aspects of an application&#x27;s architecture.</p>
<p>Examples of good use cases would be incoming orders in a sales system
or votes cast in an electoral system where potentially losing messages
would have a significant impact on overall system correctness and function.</p>
<p>Quorum queues are <em>not</em> designed to be used for every problem.
Stock tickers, instant messaging systems and RPC reply queues benefit less or
not at all from use of quorum queues.</p>
<p>Publishers should <a href="/rabbitmq-website/docs/4.0/publishers#data-safety">use publisher confirms</a> as this is how clients can interact with
the quorum queue consensus system. Publisher confirms will <a href="/rabbitmq-website/docs/4.0/confirms#when-publishes-are-confirmed">only be issued</a> once
a published message has been successfully replicated to a quorum of replicas
and is considered &quot;safe&quot; within the context of the queue.</p>
<p>Consumers should use <a href="/rabbitmq-website/docs/4.0/confirms">manual acknowledgements</a> to ensure messages that aren&#x27;t
successfully processed are returned to the queue so that
another consumer can re-attempt processing.</p>
<h4 class="anchor anchorWithStickyNavbar_LWe7" id="when-not-to-use-quorum-queues">When Not to Use Quorum Queues<a href="#when-not-to-use-quorum-queues" class="hash-link" aria-label="Direct link to When Not to Use Quorum Queues" title="Direct link to When Not to Use Quorum Queues">​</a></h4>
<p>In some cases quorum queues should not be used. They typically involve:</p>
<ul>
<li>Temporary queues: transient or exclusive queues, high queue churn (declaration and deletion rates)</li>
<li>Lowest possible latency: the underlying consensus algorithm has an inherently higher latency due to its data safety features</li>
<li>When data safety is not a priority (e.g. applications do not use <a href="/rabbitmq-website/docs/4.0/confirms">manual acknowledgements and publisher confirms</a> are not used)</li>
<li>Very long queue backlogs (5M+ messages) (<a href="/rabbitmq-website/docs/4.0/stream">streams</a> are likely to be a better fit)</li>
<li>Large fanouts: (<a href="/rabbitmq-website/docs/4.0/stream">streams</a> are likely to be a better fit)</li>
</ul>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="features">Features<a href="#features" class="hash-link" aria-label="Direct link to Features" title="Direct link to Features">​</a></h2>
<p>Quorum queues share most of the fundamentals with other <a href="/rabbitmq-website/docs/4.0/queues">queue</a> types.</p>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="feature-comparison">Comparison with Classic Queues<a href="#feature-comparison" class="hash-link" aria-label="Direct link to Comparison with Classic Queues" title="Direct link to Comparison with Classic Queues">​</a></h3>
<p>The following operations work the same way for quorum queues as they do for classic queues:</p>
<ul>
<li>Consumption, consumer registration</li>
<li><a href="/rabbitmq-website/docs/4.0/confirms">Consumer acknowledgements</a> (except for global <a href="#global-qos">QoS and prefetch</a>)</li>
<li>Consumer cancellation</li>
<li>Purging</li>
<li>Deletion</li>
</ul>
<p>With some queue operations there are minor differences:</p>
<ul>
<li><a href="#declaring">Declaration</a></li>
<li>Setting prefetch for consumers</li>
</ul>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="feature-matrix">Feature Matrix<a href="#feature-matrix" class="hash-link" aria-label="Direct link to Feature Matrix" title="Direct link to Feature Matrix">​</a></h3>
<table><thead><tr><th style="text-align:left">Feature</th><th style="text-align:left">Classic queues</th><th>Quorum queues</th></tr></thead><tbody><tr><td style="text-align:left"><a href="/rabbitmq-website/docs/4.0/queues">Non-durable queues</a></td><td style="text-align:left">yes</td><td>no</td></tr><tr><td style="text-align:left">Message replication</td><td style="text-align:left">no</td><td>yes</td></tr><tr><td style="text-align:left"><a href="/rabbitmq-website/docs/4.0/queues">Exclusivity</a></td><td style="text-align:left">yes</td><td>no</td></tr><tr><td style="text-align:left">Per message persistence</td><td style="text-align:left">per message</td><td>always</td></tr><tr><td style="text-align:left">Membership changes</td><td style="text-align:left">no</td><td><a href="#replica-reconciliation">semi-automatic</a></td></tr><tr><td style="text-align:left"><a href="/rabbitmq-website/docs/4.0/ttl">Message TTL (Time-To-Live)</a></td><td style="text-align:left">yes</td><td>yes</td></tr><tr><td style="text-align:left"><a href="/rabbitmq-website/docs/4.0/ttl#queue-ttl">Queue TTL</a></td><td style="text-align:left">yes</td><td>partially (lease is not renewed on queue re-declaration)</td></tr><tr><td style="text-align:left"><a href="/rabbitmq-website/docs/4.0/maxlength">Queue length limits</a></td><td style="text-align:left">yes</td><td>yes (except <code>x-overflow</code>: <code>reject-publish-dlx</code>)</td></tr><tr><td style="text-align:left">Keeps messages in memory</td><td style="text-align:left">see <a href="/rabbitmq-website/docs/4.0/classic-queues#memory">Classic Queues</a></td><td>never (see <a href="#resource-use">Resource Use</a>)</td></tr><tr><td style="text-align:left"><a href="/rabbitmq-website/docs/4.0/priority">Message priority</a></td><td style="text-align:left">yes</td><td><a href="/rabbitmq-website/docs/4.0/quorum-queues#priorities">yes</a></td></tr><tr><td style="text-align:left"><a href="/rabbitmq-website/docs/4.0/consumers#single-active-consumer">Single Active Consumer</a></td><td style="text-align:left">yes</td><td>yes</td></tr><tr><td style="text-align:left"><a href="/rabbitmq-website/docs/4.0/consumers#exclusivity">Consumer exclusivity</a></td><td style="text-align:left">yes</td><td>no (use <a href="/rabbitmq-website/docs/4.0/consumers#single-active-consumer">Single Active Consumer</a>)</td></tr><tr><td style="text-align:left"><a href="/rabbitmq-website/docs/4.0/consumer-priority">Consumer priority</a></td><td style="text-align:left">yes</td><td>yes</td></tr><tr><td style="text-align:left"><a href="/rabbitmq-website/docs/4.0/dlx">Dead letter exchanges</a></td><td style="text-align:left">yes</td><td>yes</td></tr><tr><td style="text-align:left">Adheres to <a href="/rabbitmq-website/docs/4.0/policies">policies</a></td><td style="text-align:left">yes</td><td>yes (see <a href="#policy-support">Policy support</a>)</td></tr><tr><td style="text-align:left">Poison message handling</td><td style="text-align:left">no</td><td>yes</td></tr><tr><td style="text-align:left"><a href="/rabbitmq-website/docs/4.0/queues#server-named-queues">Server-named queues</a></td><td style="text-align:left">yes</td><td>no</td></tr></tbody></table>
<p>Modern quorum queues also offer <a href="/rabbitmq-website/blog/2022/05/16/rabbitmq-3.10-performance-improvements">higher throughput and less latency variability</a>
for many workloads.</p>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="queue-and-per-message-ttl">Queue and Per-Message TTL<a href="#queue-and-per-message-ttl" class="hash-link" aria-label="Direct link to Queue and Per-Message TTL" title="Direct link to Queue and Per-Message TTL">​</a></h3>
<p>Quorum queues support both <a href="/rabbitmq-website/docs/4.0/ttl#queue-ttl">Queue TTL</a> and message TTL (since RabbitMQ 3.10)
(including <a href="/rabbitmq-website/docs/4.0/ttl#per-queue-message-ttl">Per-Queue Message TTL in Queues</a> and
<a href="/rabbitmq-website/docs/4.0/ttl#per-message-ttl-in-publishers">Per-Message TTL in Publishers</a>).
When using any form of message TTL, the memory overhead increases by 2 bytes per message.</p>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="length-limit">Length Limit<a href="#length-limit" class="hash-link" aria-label="Direct link to Length Limit" title="Direct link to Length Limit">​</a></h3>
<p>Quorum queues has support for <a href="/rabbitmq-website/docs/4.0/maxlength">queue length limits</a>.</p>
<p>The <code>drop-head</code> and <code>reject-publish</code> overflow behaviours are supported but they
do not support <code>reject-publish-dlx</code> configurations as Quorum queues take a different
implementation approach than classic queues.</p>
<p>The current implementation of <code>reject-publish</code> overflow behaviour does not strictly
enforce the limit and allows a quorum queue to overshoot its limit by at least
one message, therefore it should be taken with care in scenarios where a precise
limit is required.</p>
<p>When a quorum queue reaches the max-length limit and <code>reject-publish</code> is configured
it notifies each publishing channel who from thereon will reject all messages back to
the client. This means that quorum queues may overshoot their limit by some small number
of messages as there may be messages in flight whilst the channels are notified.
The number of additional messages that are accepted by the queue will vary depending
on how many messages are in flight at the time.</p>
<h4 class="anchor anchorWithStickyNavbar_LWe7" id="dead-lettering">Dead Lettering<a href="#dead-lettering" class="hash-link" aria-label="Direct link to Dead Lettering" title="Direct link to Dead Lettering">​</a></h4>
<p>Quorum queues support <a href="/rabbitmq-website/docs/4.0/dlx">dead lettering via dead letter exchanges</a> (DLXs).</p>
<p>Traditionally, using DLXs in a clustered environment has not been <a href="/rabbitmq-website/docs/4.0/dlx#safety">safe</a>.</p>
<p>Quorum queues support a safer form of dead-lettering that uses
<code>at-least-once</code> guarantees for the message transfer between queues
(with the limitations and caveats outlined below).</p>
<p>This is done by implementing a special, internal dead-letter consumer process
that works similarly to a normal queue consumer with manual acknowledgements apart
from it only consumes messages that have been dead-lettered.</p>
<p>This means that the source quorum queue will retain the
dead-lettered messages until they have been acknowledged. The internal consumer
will consume dead-lettered messages and publish them to the target queue(s) using
publisher confirms. It will only acknowledge once publisher confirms have been
received, hence providing <code>at-least-once</code> guarantees.</p>
<p><code>at-most-once</code> remains the default dead-letter-strategy for quorum queues and is useful for scenarios
where the dead lettered messages are more of an informational nature and where it does not matter so much
if they are lost in transit between queues or when the overflow
configuration restriction outlined below is not suitable.</p>
<h5 class="anchor anchorWithStickyNavbar_LWe7" id="activating-at-least-once-dead-lettering">Activating at-least-once Dead-Lettering<a href="#activating-at-least-once-dead-lettering" class="hash-link" aria-label="Direct link to Activating at-least-once Dead-Lettering" title="Direct link to Activating at-least-once Dead-Lettering">​</a></h5>
<p>To activate or turn on <code>at-least-once</code> dead-lettering for a source quorum queue, adapt the <a href="/rabbitmq-website/docs/4.0/dlx">policy
that enables dead lettering</a> like so:</p>
<ul>
<li>Set <code>dead-letter-strategy</code> to <code>at-least-once</code> (default is <code>at-most-once</code>).</li>
<li>Set <code>overflow</code> to <code>reject-publish</code> (default is <code>drop-head</code>).</li>
<li>Configure a <code>dead-letter-exchange</code></li>
<li>Enable the <code>stream_queue</code> <a href="/rabbitmq-website/docs/4.0/feature-flags">feature flag</a> in case it is not enabled</li>
</ul>
<p>It is recommended to additionally configure <code>max-length</code> or <code>max-length-bytes</code>
to prevent excessive message buildup in the source quorum queue (see caveats below).</p>
<p>Optionally, configure a <code>dead-letter-routing-key</code>.</p>
<h4 class="anchor anchorWithStickyNavbar_LWe7" id="limitations">Limitations<a href="#limitations" class="hash-link" aria-label="Direct link to Limitations" title="Direct link to Limitations">​</a></h4>
<p><code>at-least-once</code> dead lettering does not work with the default <code>drop-head</code> overflow
strategy even if a queue length limit is not set.
Hence if <code>drop-head</code> is configured the dead-lettering will fall back
to <code>at-most-once</code>. Use the overflow strategy <code>reject-publish</code> instead.</p>
<h4 class="anchor anchorWithStickyNavbar_LWe7" id="caveats">Caveats<a href="#caveats" class="hash-link" aria-label="Direct link to Caveats" title="Direct link to Caveats">​</a></h4>
<p><code>at-least-once</code> dead-lettering will require more system resources such as memory and CPU.
Therefore, turn on <code>at-least-once</code> only if dead lettered messages should not be lost.</p>
<p><code>at-least-once</code> guarantees opens up some specific failure cases that needs handling.
As dead-lettered messages are now retained by the source quorum queue until they have been
safely accepted by the dead-letter target queue(s) this means they have to contribute to the
queue resource limits, such as max length limits so that the queue can refuse to accept
more messages until some have been removed. Theoretically it is then possible for a queue
to <em>only</em> contain dead-lettered messages, in the case where, say a target dead-letter
queue isn&#x27;t available to accept messages for a long time and normal queue consumers
consume most of the messages.</p>
<p>Dead-lettered messages are considered &quot;live&quot; until they have been confirmed
by the dead-letter target queue(s).</p>
<p>There are few cases for which dead lettered messages will not be removed
from the source queue in a timely manner:</p>
<ul>
<li>The configured dead-letter exchange does not exist.</li>
<li>The messages cannot be routed to any queue (equivalent to the <code>mandatory</code> message property).</li>
<li>One (of possibly many) routed target queues does not confirm receipt of the message.
This can happen when a target queue is not available or when a target queue rejects a message
(e.g. due to exceeded queue length limit).</li>
</ul>
<p>The dead-letter consumer process will retry periodically if either of the scenarios above
occur which means there is a possibility of duplicates appearing at the DLX target queue(s).</p>
<p>For each quorum queue with <code>at-least-once</code> dead-lettering turned on, there will be one internal dead-letter
consumer process. The internal dead-letter consumer process is co-located on the quorum queue leader node.
It keeps all dead-lettered message bodies in memory.
It uses a prefetch size of 32 messages to limit the amount of message bodies kept in memory if no confirms
are received from the target queues.</p>
<p>That prefetch size can be increased by the <code>dead_letter_worker_consumer_prefetch</code> setting in the <code>rabbit</code> app section of the
<a href="/rabbitmq-website/docs/4.0/configure#advanced-config-file">advanced config file</a> if high dead-lettering throughput
(thousands of messages per second) is required.</p>
<p>For a source quorum queue, it is possible to switch dead-letter strategy dynamically from <code>at-most-once</code>
to <code>at-least-once</code> and vice versa. If the dead-letter strategy is changed either directly
from <code>at-least-once</code> to <code>at-most-once</code> or indirectly, for example by changing overflow from <code>reject-publish</code>
to <code>drop-head</code>, any dead-lettered messages that have not yet been confirmed by all target queues will be deleted.</p>
<p>Messages published to the source quorum queue are persisted on disk regardless of the message delivery mode (transient or persistent).
However, messages that are dead lettered by the source quorum queue will keep the original message delivery mode.
This means if dead lettered messages in the target queue should survive a broker restart, the target queue must be durable and
the message delivery mode must be set to persistent when publishing messages to the source quorum queue.</p>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="priorities">Priorities<a href="#priorities" class="hash-link" aria-label="Direct link to Priorities" title="Direct link to Priorities">​</a></h3>
<div class="theme-admonition theme-admonition-important admonition_xJq3 alert alert--info"><div class="admonitionHeading_Gvgb"><span class="admonitionIcon_Rf37"><svg viewBox="0 0 14 16"><path fill-rule="evenodd" d="M7 2.3c3.14 0 5.7 2.56 5.7 5.7s-2.56 5.7-5.7 5.7A5.71 5.71 0 0 1 1.3 8c0-3.14 2.56-5.7 5.7-5.7zM7 1C3.14 1 0 4.14 0 8s3.14 7 7 7 7-3.14 7-7-3.14-7-7-7zm1 3H6v5h2V4zm0 6H6v2h2v-2z"></path></svg></span>important</div><div class="admonitionContent_BuS1"><p>Quorum queue priority support is available as of RabbitMQ 4.0. However, there are differences
in how quorum queues and classic queues implement priorities.</p></div></div>
<p>Quorum queues support <a href="/rabbitmq-website/docs/4.0/consumer-priority">consumer priorities</a> and starting with 4.0,
they also support a type of message prioritisation that is quite different
from <a href="/rabbitmq-website/docs/4.0/priority">classic queue message priorities</a>.</p>
<p>Quorum queue message priorities are always active and do not require a policy to work.
As soon as a quorum queue receives a message with a priority set it will enable
prioritization.</p>
<p>Quorum queues internally only support two priorities: high and normal. Messages without
a priority set will be mapped to normal as will priorities 0 - 4. Messages with a
priority higher than 4 will be mapped to high.</p>
<p>High priority messages will be favoured over normal priority messages at a ratio
of 2:1, i.e. for every 2 high priority message the queue will deliver 1 normal priority
message (if available). Hence, quorum queues implement a kind of non-strict,
&quot;fair share&quot; priority processing. This ensures progress is always made on normal
priority messages but high priorities are favoured at a ratio of 2:1.</p>
<div class="theme-admonition theme-admonition-important admonition_xJq3 alert alert--info"><div class="admonitionHeading_Gvgb"><span class="admonitionIcon_Rf37"><svg viewBox="0 0 14 16"><path fill-rule="evenodd" d="M7 2.3c3.14 0 5.7 2.56 5.7 5.7s-2.56 5.7-5.7 5.7A5.71 5.71 0 0 1 1.3 8c0-3.14 2.56-5.7 5.7-5.7zM7 1C3.14 1 0 4.14 0 8s3.14 7 7 7 7-3.14 7-7-3.14-7-7-7zm1 3H6v5h2V4zm0 6H6v2h2v-2z"></path></svg></span>important</div><div class="admonitionContent_BuS1"><p>If a high priority message was published before a normal priority one, the high priority
message will always be delivered first even if it is the normal priority&#x27;s turn.</p></div></div>
<h4 class="anchor anchorWithStickyNavbar_LWe7" id="more-advanced-scenarios">More Advanced Scenarios<a href="#more-advanced-scenarios" class="hash-link" aria-label="Direct link to More Advanced Scenarios" title="Direct link to More Advanced Scenarios">​</a></h4>
<p>For more advanced message priority scenarios, separate queues should be used for different
message types, one for each type (priority). Queues used for more important message types
should generally have more (overprovisioned) consumers.</p>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="poison-message-handling">Poison Message Handling<a href="#poison-message-handling" class="hash-link" aria-label="Direct link to Poison Message Handling" title="Direct link to Poison Message Handling">​</a></h2>
<p>Quorum queue support handling of <a href="https://en.wikipedia.org/wiki/Poison_message" target="_blank" rel="noopener noreferrer">poison messages</a>,
that is, messages that cause a consumer to repeatedly requeue a delivery (possibly due to a consumer failure)
such that the message is never consumed completely and <a href="/rabbitmq-website/docs/4.0/confirms">positively acknowledged</a> so that it can be marked for
deletion by RabbitMQ.</p>
<p>Quorum queues keep track of the number of unsuccessful (re)delivery attempts and expose it in the
&quot;x-delivery-count&quot; header that is included with any redelivered message.</p>
<div class="theme-admonition theme-admonition-important admonition_xJq3 alert alert--info"><div class="admonitionHeading_Gvgb"><span class="admonitionIcon_Rf37"><svg viewBox="0 0 14 16"><path fill-rule="evenodd" d="M7 2.3c3.14 0 5.7 2.56 5.7 5.7s-2.56 5.7-5.7 5.7A5.71 5.71 0 0 1 1.3 8c0-3.14 2.56-5.7 5.7-5.7zM7 1C3.14 1 0 4.14 0 8s3.14 7 7 7 7-3.14 7-7-3.14-7-7-7zm1 3H6v5h2V4zm0 6H6v2h2v-2z"></path></svg></span>important</div><div class="admonitionContent_BuS1"><p>When a message has been redelivered more times than the limit the message will be dropped (removed) or
<a href="/rabbitmq-website/docs/4.0/dlx">dead-lettered</a> (if a DLX is configured).</p><p>For consumers with a <a href="/rabbitmq-website/docs/4.0/confirms#channel-qos-prefetch">prefetch</a> greater than 1, all outstanding
unacknowledged deliveries can be discarded by this mechanism if they all were requeued as a group multiple times,
due to, say, consumer application instance failures.</p></div></div>
<p>It is recommended that all quorum queues have a dead letter configuration of some
sort to ensure messages aren&#x27;t dropped and lost unintentionally. Using a single
<a href="/rabbitmq-website/docs/4.0/streams">stream</a> for a low priority dead letter policy is a good, low resource way to ensure
dropped messages are retained for some time after.</p>
<div class="theme-admonition theme-admonition-important admonition_xJq3 alert alert--info"><div class="admonitionHeading_Gvgb"><span class="admonitionIcon_Rf37"><svg viewBox="0 0 14 16"><path fill-rule="evenodd" d="M7 2.3c3.14 0 5.7 2.56 5.7 5.7s-2.56 5.7-5.7 5.7A5.71 5.71 0 0 1 1.3 8c0-3.14 2.56-5.7 5.7-5.7zM7 1C3.14 1 0 4.14 0 8s3.14 7 7 7 7-3.14 7-7-3.14-7-7-7zm1 3H6v5h2V4zm0 6H6v2h2v-2z"></path></svg></span>important</div><div class="admonitionContent_BuS1"><p>Starting with RabbitMQ 4.0, the delivery limit for quorum queues defaults to 20.</p><p>The 3.13.x era behavior where there was no limit can be restored by setting the limit to <code>-1</code>
using an <a href="/rabbitmq-website/docs/4.0/queues#optional-arguments">optional queue argument</a> at declaration time or using a policy as demonstrated below.</p></div></div>
<p>See <a href="#repeated-requeues">repeated requeues</a> for more details.</p>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="position-message-handling-configuring-limit">Configuring the Limit<a href="#position-message-handling-configuring-limit" class="hash-link" aria-label="Direct link to Configuring the Limit" title="Direct link to Configuring the Limit">​</a></h3>
<p>It is possible to set a delivery limit for a queue using a <a href="/rabbitmq-website/docs/4.0/policies">policy</a> argument, <code>delivery-limit</code>.</p>
<h4 class="anchor anchorWithStickyNavbar_LWe7" id="overriding-the-limit">Overriding the Limit<a href="#overriding-the-limit" class="hash-link" aria-label="Direct link to Overriding the Limit" title="Direct link to Overriding the Limit">​</a></h4>
<p>The following example sets the limit to 50 for queues whose names begin with
<code>qq</code>.</p>
<div class="tabs-container tabList__CuJ"><ul role="tablist" aria-orientation="horizontal" class="tabs"><li role="tab" tabindex="0" aria-selected="true" class="tabs__item tabItem_LNqP tabs__item--active">bash</li><li role="tab" tabindex="-1" aria-selected="false" class="tabs__item tabItem_LNqP">PowerShell</li><li role="tab" tabindex="-1" aria-selected="false" class="tabs__item tabItem_LNqP">HTTP API</li><li role="tab" tabindex="-1" aria-selected="false" class="tabs__item tabItem_LNqP">Management UI</li></ul><div class="margin-top--md"><div role="tabpanel" class="tabItem_Ymn6"><div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">rabbitmqctl set_policy qq-overrides </span><span class="token punctuation" style="color:#393A34">\</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token string" style="color:#e3116c">&quot;^qq\.&quot;</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&#x27;{&quot;delivery-limit&quot;: 50}&#x27;</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">\</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token parameter variable" style="color:#36acaa">--priority</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">123</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">\</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    --apply-to </span><span class="token string" style="color:#e3116c">&quot;quorum_queues&quot;</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div></div><div role="tabpanel" class="tabItem_Ymn6" hidden=""><div class="language-PowerShell language-powershell codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-powershell codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">rabbitmqctl</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">bat set_policy qq-overrides ^</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token string" style="color:#e3116c">&quot;^qq\.&quot;</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;{&quot;</span><span class="token string" style="color:#e3116c">&quot;delivery-limit&quot;</span><span class="token string" style="color:#e3116c">&quot;: 50}&quot;</span><span class="token plain"> ^</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token operator" style="color:#393A34">--</span><span class="token plain">priority 123 ^</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token operator" style="color:#393A34">--</span><span class="token plain">apply-to </span><span class="token string" style="color:#e3116c">&quot;quorum_queues&quot;</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div></div><div role="tabpanel" class="tabItem_Ymn6" hidden=""><div class="language-ini codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-ini codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">PUT /api/policies/%2f/qq-overrides</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    {&quot;pattern&quot;: &quot;^qq\.&quot;,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">     &quot;definition&quot;: {&quot;delivery-limit&quot;: 50},</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">     &quot;priority&quot;: 1,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    &quot;apply-to&quot;: &quot;quorum_queues&quot;}</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div></div><div role="tabpanel" class="tabItem_Ymn6" hidden=""><ol><li><p>Navigate to <code>Admin</code> &gt; <code>Policies</code> &gt; <code>Add / update a     policy</code>.</p></li><li><p>Enter a policy name (such as &quot;qq-overrides&quot;) next to Name, a pattern (such as &quot;^qq.&quot;) next to
Pattern, and select what kind of entities (quorum queues in this example) the policy should apply to using the <code>Apply to</code>
drop down.</p></li><li><p>Enter &quot;delivery-limit&quot; for policy argument and 50 for its value in the first line next to
<code>Policy</code>.</p></li><li><p>Click <code>Add policy</code>.</p></li></ol></div></div></div>
<h4 class="anchor anchorWithStickyNavbar_LWe7" id="disabling-the-limit">Disabling the Limit<a href="#disabling-the-limit" class="hash-link" aria-label="Direct link to Disabling the Limit" title="Direct link to Disabling the Limit">​</a></h4>
<p>The following example disables the limit for queues whose names begin with
<code>qq.unlimited</code>.</p>
<div class="tabs-container tabList__CuJ"><ul role="tablist" aria-orientation="horizontal" class="tabs"><li role="tab" tabindex="0" aria-selected="true" class="tabs__item tabItem_LNqP tabs__item--active">bash</li><li role="tab" tabindex="-1" aria-selected="false" class="tabs__item tabItem_LNqP">PowerShell</li><li role="tab" tabindex="-1" aria-selected="false" class="tabs__item tabItem_LNqP">HTTP API</li><li role="tab" tabindex="-1" aria-selected="false" class="tabs__item tabItem_LNqP">Management UI</li></ul><div class="margin-top--md"><div role="tabpanel" class="tabItem_Ymn6"><div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">rabbitmqctl set_policy qq-overrides </span><span class="token punctuation" style="color:#393A34">\</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token string" style="color:#e3116c">&quot;^qq\.unlimited&quot;</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&#x27;{&quot;delivery-limit&quot;: -1}&#x27;</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">\</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token parameter variable" style="color:#36acaa">--priority</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">123</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">\</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    --apply-to </span><span class="token string" style="color:#e3116c">&quot;quorum_queues&quot;</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div></div><div role="tabpanel" class="tabItem_Ymn6" hidden=""><div class="language-PowerShell language-powershell codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-powershell codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">rabbitmqctl</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">bat set_policy qq-overrides ^</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token string" style="color:#e3116c">&quot;^qq\.unlimited&quot;</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;{&quot;</span><span class="token string" style="color:#e3116c">&quot;delivery-limit&quot;</span><span class="token string" style="color:#e3116c">&quot;: -1}&quot;</span><span class="token plain"> ^</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token operator" style="color:#393A34">--</span><span class="token plain">priority 123 ^</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token operator" style="color:#393A34">--</span><span class="token plain">apply-to </span><span class="token string" style="color:#e3116c">&quot;quorum_queues&quot;</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div></div><div role="tabpanel" class="tabItem_Ymn6" hidden=""><div class="language-ini codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-ini codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">PUT /api/policies/%2f/qq-overrides</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    {&quot;pattern&quot;: &quot;^qq\.unlimited&quot;,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">     &quot;definition&quot;: {&quot;delivery-limit&quot;: -1},</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">     &quot;priority&quot;: 1,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    &quot;apply-to&quot;: &quot;quorum_queues&quot;}</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div></div><div role="tabpanel" class="tabItem_Ymn6" hidden=""><ol><li><p>Navigate to <code>Admin</code> &gt; <code>Policies</code> &gt; <code>Add / update a     policy</code>.</p></li><li><p>Enter a policy name (such as &quot;qq-overrides&quot;) next to Name, a pattern (such as &quot;^qq.unlimited&quot;) next to
Pattern, and select what kind of entities (quorum queues in this example) the policy should apply to using the <code>Apply to</code>
drop down.</p></li><li><p>Enter &quot;delivery-limit&quot; for policy argument and -1 for its value in the first line next to
<code>Policy</code>.</p></li><li><p>Click <code>Add policy</code>.</p></li></ol></div></div></div>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="position-message-handling-configuring-dlx">Configuring the Limit and Setting Up Dead-Lettering<a href="#position-message-handling-configuring-dlx" class="hash-link" aria-label="Direct link to Configuring the Limit and Setting Up Dead-Lettering" title="Direct link to Configuring the Limit and Setting Up Dead-Lettering">​</a></h3>
<p>Messages that are redelivered more times than the limit allows for will be either dropped (removed) or <a href="/rabbitmq-website/docs/4.0/dlx">dead-lettered</a>.</p>
<p>The following example configures both the limit and an exchange to dead-letter (republish) such
messages. The target exchange in this example is called &quot;redeliveries.limit.dlx&quot;. Declaring it and setting up its topology
(binding queues and/or streams to it) is not covered in this example.</p>
<div class="tabs-container tabList__CuJ"><ul role="tablist" aria-orientation="horizontal" class="tabs"><li role="tab" tabindex="0" aria-selected="true" class="tabs__item tabItem_LNqP tabs__item--active">bash</li><li role="tab" tabindex="-1" aria-selected="false" class="tabs__item tabItem_LNqP">PowerShell</li><li role="tab" tabindex="-1" aria-selected="false" class="tabs__item tabItem_LNqP">HTTP API</li><li role="tab" tabindex="-1" aria-selected="false" class="tabs__item tabItem_LNqP">Management UI</li></ul><div class="margin-top--md"><div role="tabpanel" class="tabItem_Ymn6"><div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">rabbitmqctl set_policy qq-overrides </span><span class="token punctuation" style="color:#393A34">\</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token string" style="color:#e3116c">&quot;^qq\.&quot;</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&#x27;{&quot;delivery-limit&quot;: 50, &quot;dead-letter-exchange&quot;: &quot;redeliveries.limit.dlx&quot;}&#x27;</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">\</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token parameter variable" style="color:#36acaa">--priority</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">123</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">\</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    --apply-to </span><span class="token string" style="color:#e3116c">&quot;quorum_queues&quot;</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div></div><div role="tabpanel" class="tabItem_Ymn6" hidden=""><div class="language-PowerShell language-powershell codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-powershell codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">rabbitmqctl</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">bat set_policy qq-overrides ^</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token string" style="color:#e3116c">&quot;^qq\.&quot;</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;{&quot;</span><span class="token string" style="color:#e3116c">&quot;delivery-limit&quot;</span><span class="token string" style="color:#e3116c">&quot;: 50, &quot;</span><span class="token string" style="color:#e3116c">&quot;dead-letter-exchange&quot;</span><span class="token string" style="color:#e3116c">&quot;: &quot;</span><span class="token string" style="color:#e3116c">&quot;redeliveries.limit.dlx&quot;</span><span class="token string" style="color:#e3116c">&quot;}&quot;</span><span class="token plain"> ^</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token operator" style="color:#393A34">--</span><span class="token plain">priority 123 ^</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token operator" style="color:#393A34">--</span><span class="token plain">apply-to </span><span class="token string" style="color:#e3116c">&quot;quorum_queues&quot;</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div></div><div role="tabpanel" class="tabItem_Ymn6" hidden=""><div class="language-ini codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-ini codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">PUT /api/policies/%2f/qq-overrides</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    {&quot;pattern&quot;: &quot;^qq\.&quot;,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">     &quot;definition&quot;: {&quot;delivery-limit&quot;: 50, &quot;dead-letter-exchange&quot;: &quot;redeliveries.limit.dlx&quot;},</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">     &quot;priority&quot;: 1,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    &quot;apply-to&quot;: &quot;quorum_queues&quot;}</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div></div><div role="tabpanel" class="tabItem_Ymn6" hidden=""><ol><li><p>Navigate to <code>Admin</code> &gt; <code>Policies</code> &gt; <code>Add / update a     policy</code>.</p></li><li><p>Enter a policy name (such as &quot;qq-overrides&quot;) next to Name, a pattern (such as &quot;^qq.&quot;) next to
Pattern, and select what kind of entities (quorum queues in this example) the policy should apply to using the <code>Apply to</code>
drop down.</p></li><li><p>Enter &quot;delivery-limit&quot; for policy argument and 50 for its value in the first line next to
<code>Policy</code>, then &quot;dead-letter-exchange&quot; for the second key and &quot;redeliveries.limit.dlx&quot; for its value.</p></li><li><p>Click <code>Add policy</code>.</p></li></ol></div></div></div>
<p>To learn more about dead-lettering, please consult its <a href="/rabbitmq-website/docs/4.0/dlx">dedicated guide</a>.</p>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="policy-support">Policy Support<a href="#policy-support" class="hash-link" aria-label="Direct link to Policy Support" title="Direct link to Policy Support">​</a></h3>
<p>Quorum queues can be configured via RabbitMQ policies. The below table summarises the
policy keys they adhere to.</p>
<table><thead><tr><th style="text-align:left">Definition Key</th><th style="text-align:left">Type</th></tr></thead><tbody><tr><td style="text-align:left"><code>max-length</code></td><td style="text-align:left">Number</td></tr><tr><td style="text-align:left"><code>max-length-bytes</code></td><td style="text-align:left">Number</td></tr><tr><td style="text-align:left"><code>overflow</code></td><td style="text-align:left">&quot;drop-head&quot; or &quot;reject-publish&quot;</td></tr><tr><td style="text-align:left"><code>expires</code></td><td style="text-align:left">Number (milliseconds)</td></tr><tr><td style="text-align:left"><code>dead-letter-exchange</code></td><td style="text-align:left">String</td></tr><tr><td style="text-align:left"><code>dead-letter-routing-key</code></td><td style="text-align:left">String</td></tr><tr><td style="text-align:left"><code>delivery-limit</code></td><td style="text-align:left">Number</td></tr></tbody></table>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="features-that-are-not-supported">Features that are not Supported<a href="#features-that-are-not-supported" class="hash-link" aria-label="Direct link to Features that are not Supported" title="Direct link to Features that are not Supported">​</a></h2>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="transient-non-durable-queues">Transient (non-Durable) Queues<a href="#transient-non-durable-queues" class="hash-link" aria-label="Direct link to Transient (non-Durable) Queues" title="Direct link to Transient (non-Durable) Queues">​</a></h3>
<p>Classic queues can be <a href="/rabbitmq-website/docs/4.0/queues">non-durable</a>. Quorum queues are always durable per their
assumed <a href="#use-cases">use cases</a>.</p>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="exclusivity">Exclusivity<a href="#exclusivity" class="hash-link" aria-label="Direct link to Exclusivity" title="Direct link to Exclusivity">​</a></h3>
<p><a href="/rabbitmq-website/docs/4.0/queues#exclusive-queues">Exclusive queues</a> are tied to the lifecycle of their declaring connection.
Quorum queues by design are replicated and durable, therefore the exclusive property makes
no sense in their context. Therefore quorum queues cannot be exclusive.</p>
<p>Quorum queues are not meant to be used as <a href="/rabbitmq-website/docs/4.0/queues#temporary-queues">temporary queues</a>.</p>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="global-qos">Global QoS<a href="#global-qos" class="hash-link" aria-label="Direct link to Global QoS" title="Direct link to Global QoS">​</a></h3>
<p>Quorum queues do not support global <a href="/rabbitmq-website/docs/4.0/confirms#channel-qos-prefetch">QoS prefetch</a>
where a channel sets a single
prefetch limit for all consumers using that channel. If an attempt
is made to consume from a quorum queue from a channel with global QoS activated
a channel error will be returned.</p>
<p>Use <a href="/rabbitmq-website/docs/4.0/consumer-prefetch">per-consumer QoS prefetch</a>,
which is the default in several popular clients.</p>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="usage">Usage<a href="#usage" class="hash-link" aria-label="Direct link to Usage" title="Direct link to Usage">​</a></h2>
<p>Quorum queues share most of the fundamentals with other <a href="/rabbitmq-website/docs/4.0/queues">queue</a> types.
Any AMQP 0.9.1 client library that can specify <a href="/rabbitmq-website/docs/4.0/queues#optional-arguments">optional queue arguments</a>
when declaring will be able to use quorum queues.</p>
<p>First we will cover how to declare a quorum queue using AMQP 0.9.1.</p>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="declaring">Declaring<a href="#declaring" class="hash-link" aria-label="Direct link to Declaring" title="Direct link to Declaring">​</a></h3>
<p>To declare a quorum queue set the <code>x-queue-type</code> queue argument to <code>quorum</code>
(the default is <code>classic</code>). This argument must be provided by a client
at queue declaration time; it cannot be set or changed using a <a href="/rabbitmq-website/docs/4.0/policies">policy</a>.
This is because policy definition or applicable policy can be changed dynamically but
queue type cannot. It must be specified at the time of declaration.</p>
<p>Declaring a queue with an <code>x-queue-type</code> argument set to <code>quorum</code> will declare a quorum queue with
up to three replicas (default <a href="#replication-factor">replication factor</a>),
one per each <a href="/rabbitmq-website/docs/4.0/clustering">cluster node</a>.</p>
<p>For example, a cluster of three nodes will have three replicas, one on each node.
In a cluster of five nodes, three nodes will have one replica each but two nodes won&#x27;t host any replicas.</p>
<p>After declaration a quorum queue can be bound to any exchange just as any other
RabbitMQ queue.</p>
<p>If declaring using <a href="/rabbitmq-website/docs/4.0/management">management UI</a>, queue type must be specified using
the queue type drop down menu.</p>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="client-operations">Client Operations<a href="#client-operations" class="hash-link" aria-label="Direct link to Client Operations" title="Direct link to Client Operations">​</a></h3>
<p>The following operations work the same way for quorum queues as they do for classic queues:</p>
<ul>
<li><a href="/rabbitmq-website/docs/4.0/consumers">Consumption</a> (subscription)</li>
<li><a href="/rabbitmq-website/docs/4.0/confirms">Consumer acknowledgements</a> (keep <a href="#global-qos">QoS Prefetch Limitations</a> in mind)</li>
<li>Cancellation of consumers</li>
<li>Purging of queue messages</li>
<li>Queue deletion</li>
</ul>
<p>With some queue operations there are minor differences:</p>
<ul>
<li><a href="#declaring">Declaration</a> (covered above)</li>
<li>Setting <a href="#global-qos">QoS prefetch</a> for consumers</li>
</ul>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="replication">Replication Factor and Membership Management<a href="#replication" class="hash-link" aria-label="Direct link to Replication Factor and Membership Management" title="Direct link to Replication Factor and Membership Management">​</a></h2>
<p>When a quorum queue is declared, an initial number of replicas for it must be started in the cluster.
By default the number of replicas to be started is up to three, one per RabbitMQ node in the cluster.</p>
<p>Three nodes is the <strong>practical minimum</strong> of replicas for a quorum queue. In RabbitMQ clusters with a larger
number of nodes, adding more replicas than a <a href="#what-is-quorum">quorum</a> (majority) will not provide
any improvements in terms of <a href="#quorum-requirements">quorum queue availability</a> but it will consume
more cluster resources.</p>
<p>Therefore the <strong>recommended number of replicas</strong> for a quorum queue is the quorum of cluster nodes
(but no fewer than three). This assumes a <a href="/rabbitmq-website/docs/4.0/cluster-formation">fully formed</a> cluster of at least three nodes.</p>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="replication-factor">Controlling the Initial Replication Factor<a href="#replication-factor" class="hash-link" aria-label="Direct link to Controlling the Initial Replication Factor" title="Direct link to Controlling the Initial Replication Factor">​</a></h3>
<p>For example, a cluster of three nodes will have three replicas, one on each node.
In a cluster of seven nodes, three nodes will have one replica each but four more nodes won&#x27;t host any replicas
of the newly declared queue.</p>
<p>The replication factor (number of replicas a queue has) can be configured for quorum queues.</p>
<p>The minimum factor value that makes practical sense is three.
It is highly recommended for the factor to be an odd number.
This way a clear quorum (majority) of nodes can be computed. For example, there is no &quot;majority&quot; of
nodes in a two node cluster. This is covered with more examples below in the <a href="#quorum-requirements">Fault Tolerance and Minimum Number of Replicas Online</a>
section.</p>
<p>This may not be desirable for larger clusters or for cluster with an even number of
nodes. To control the number of quorum queue members set the
<code>x-quorum-initial-group-size</code> queue argument when declaring the queue. The
group size argument provided should be an integer that is greater than zero and smaller or
equal to the current RabbitMQ cluster size. The quorum queue will be
launched to run on a random subset of RabbitMQ nodes present in the cluster at declaration time.</p>
<p>In case a quorum queue is declared before all cluster nodes have joined the cluster, and the initial replica
count is greater than the total number of cluster members, the effective value used will
be equal to the total number of cluster nodes. When more nodes join the cluster, the replica count
will not be automatically increased but it can be <a href="#member-management">increased by the operator</a>.</p>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="member-management">Managing Replicas<a href="#member-management" class="hash-link" aria-label="Direct link to Managing Replicas" title="Direct link to Managing Replicas">​</a></h3>
<p>Replicas of a quorum queue are explicitly managed by the operator. When a new node is added
to the cluster, it will host no quorum queue replicas unless the operator explicitly adds it
to a member (replica) list of a quorum queue or a set of quorum queues.</p>
<p>When a node has to be decommissioned (permanently removed from the cluster), the
<a href="/rabbitmq-website/docs/4.0/cli"><code>forget_cluster_node</code></a> command will automatically attempt to remove all quorum queue
members on the decommissioned node. Alternatively the <code>shrink</code> command below can be used ahead of
node removal to move any replicas to a new node.</p>
<p>Also see <a href="#replica-reconciliation">Continuous Membership Reconciliation</a> for a
more automated way to grow quorum queues.</p>
<p>Several <a href="/rabbitmq-website/docs/4.0/cli">CLI commands</a> are provided to perform the above operations:</p>
<div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">rabbitmq-queues add_member </span><span class="token punctuation" style="color:#393A34">[</span><span class="token plain">-p </span><span class="token operator" style="color:#393A34">&lt;</span><span class="token plain">vhost</span><span class="token operator" style="color:#393A34">&gt;</span><span class="token punctuation" style="color:#393A34">]</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">&lt;</span><span class="token plain">queue-name</span><span class="token operator" style="color:#393A34">&gt;</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">&lt;</span><span class="token plain">node</span><span class="token operator" style="color:#393A34">&gt;</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">rabbitmq-queues delete_member </span><span class="token punctuation" style="color:#393A34">[</span><span class="token plain">-p </span><span class="token operator" style="color:#393A34">&lt;</span><span class="token plain">vhost</span><span class="token operator" style="color:#393A34">&gt;</span><span class="token punctuation" style="color:#393A34">]</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">&lt;</span><span class="token plain">queue-name</span><span class="token operator" style="color:#393A34">&gt;</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">&lt;</span><span class="token plain">node</span><span class="token operator" style="color:#393A34">&gt;</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">rabbitmq-queues grow </span><span class="token operator" style="color:#393A34">&lt;</span><span class="token plain">node</span><span class="token operator" style="color:#393A34">&gt;</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">&lt;</span><span class="token plain">all </span><span class="token operator" style="color:#393A34">|</span><span class="token plain"> even</span><span class="token operator" style="color:#393A34">&gt;</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">[</span><span class="token plain">--vhost-pattern </span><span class="token operator" style="color:#393A34">&lt;</span><span class="token plain">pattern</span><span class="token operator" style="color:#393A34">&gt;</span><span class="token punctuation" style="color:#393A34">]</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">[</span><span class="token plain">--queue-pattern </span><span class="token operator" style="color:#393A34">&lt;</span><span class="token plain">pattern</span><span class="token operator" style="color:#393A34">&gt;</span><span class="token punctuation" style="color:#393A34">]</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">rabbitmq-queues shrink </span><span class="token operator" style="color:#393A34">&lt;</span><span class="token plain">node</span><span class="token operator" style="color:#393A34">&gt;</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">[</span><span class="token plain">--errors-only</span><span class="token punctuation" style="color:#393A34">]</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>To successfully add and remove members a quorum of replicas in the queue must be available
because membership changes are treated as queue state changes.</p>
<p>Care needs to be taken not to accidentally make a queue unavailable by losing
the quorum whilst performing maintenance operations that involve membership changes.</p>
<p>When replacing a cluster node, it is safer to first add a new node, grow any quorum queues
that need a member on the new node and then decommission the node it replaces.</p>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="leader-placement">Queue Leader Location<a href="#leader-placement" class="hash-link" aria-label="Direct link to Queue Leader Location" title="Direct link to Queue Leader Location">​</a></h3>
<p>Every quorum queue has a primary replica. That replica is called
<em>queue leader</em>. All queue operations go through the leader
first and then are replicated to followers. This is necessary to
guarantee FIFO ordering of messages.</p>
<p>To avoid some nodes in a cluster hosting the majority of queue leader
replicas and thus handling most of the load, queue leaders should
be reasonably evenly distributed across cluster nodes.</p>
<p>When a new quorum queue is declared, the set of nodes that will host its
replicas is randomly picked, but will always include the node the client that
declares the queue is connected to.</p>
<p>Which replica becomes the initial leader can controlled using three options:</p>
<ol>
<li>Setting the <code>queue-leader-locator</code> <a href="/rabbitmq-website/docs/4.0/policies">policy</a> key (recommended)</li>
<li>By defining the <code>queue_leader_locator</code> key in <a href="/rabbitmq-website/docs/4.0/configure#configuration-files">the configuration file</a> (recommended)</li>
<li>Using the <code>x-queue-leader-locator</code> <a href="/rabbitmq-website/docs/4.0/queues#optional-arguments">optional queue argument</a></li>
</ol>
<p>Supported queue leader locator values are</p>
<ul>
<li><code>client-local</code>: Pick the node the client that declares the queue is connected to. This is the default value.</li>
<li><code>balanced</code>: If there are overall less than 1000 queues (classic queues, quorum queues, and streams),
pick the node hosting the minimum number of quorum queue leaders.
If there are overall more than 1000 queues, pick a random node.</li>
</ul>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="replica-rebalancing">Rebalancing Replicas<a href="#replica-rebalancing" class="hash-link" aria-label="Direct link to Rebalancing Replicas" title="Direct link to Rebalancing Replicas">​</a></h3>
<p>Once declared, the RabbitMQ quorum queue leaders may be unevenly
distributed across the RabbitMQ cluster.
To re-balance use the <code>rabbitmq-queues rebalance</code> command.
It is important to know that this does not change the nodes which the quorum queues span.
To modify the membership instead see <a href="#member-management">managing replicas</a>.</p>
<div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token comment" style="color:#999988;font-style:italic"># rebalances all quorum queues</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">rabbitmq-queues rebalance quorum</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>It is possible to rebalance a subset of queues selected by name:</p>
<div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token comment" style="color:#999988;font-style:italic"># rebalances a subset of quorum queues</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">rabbitmq-queues rebalance quorum --queue-pattern </span><span class="token string" style="color:#e3116c">&quot;orders.*&quot;</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>or quorum queues in a particular set of virtual hosts:</p>
<div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token comment" style="color:#999988;font-style:italic"># rebalances a subset of quorum queues</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">rabbitmq-queues rebalance quorum --vhost-pattern </span><span class="token string" style="color:#e3116c">&quot;production.*&quot;</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="replica-reconciliation">Continuous Membership Reconciliation (CMR)<a href="#replica-reconciliation" class="hash-link" aria-label="Direct link to Continuous Membership Reconciliation (CMR)" title="Direct link to Continuous Membership Reconciliation (CMR)">​</a></h3>
<div class="theme-admonition theme-admonition-important admonition_xJq3 alert alert--info"><div class="admonitionHeading_Gvgb"><span class="admonitionIcon_Rf37"><svg viewBox="0 0 14 16"><path fill-rule="evenodd" d="M7 2.3c3.14 0 5.7 2.56 5.7 5.7s-2.56 5.7-5.7 5.7A5.71 5.71 0 0 1 1.3 8c0-3.14 2.56-5.7 5.7-5.7zM7 1C3.14 1 0 4.14 0 8s3.14 7 7 7 7-3.14 7-7-3.14-7-7-7zm1 3H6v5h2V4zm0 6H6v2h2v-2z"></path></svg></span>important</div><div class="admonitionContent_BuS1"><p>The continuous membership reconciliation (CMR) feature exists in addition to, and not as a replacement for,
<a href="#member-management">explicit replica management</a>. In certain cases where nodes are permanently removed
from the cluster, explicitly removing quorum queue replicas may still be necessary.</p></div></div>
<p>In addition to controlling quorum queue replica membership by using the initial target size and <a href="#member-management">explicit replica management</a>,
nodes can be configured to automatically try to grow the quorum queue replica membership
to a configured target group size by enabling the continuous membership reconciliation feature.</p>
<p>When activated, every quorum queue leader replica will periodically check its current membership group size
(the number of configured replicas), and compare it with the target value.</p>
<p>If a queue is below the target value, RabbitMQ will attempt to grow the queue onto the available nodes that
do not currently host replicas of said queue, if any, up to the target value.</p>
<h4 class="anchor anchorWithStickyNavbar_LWe7" id="when-is-continuous-membership-reconciliation-triggered">When is Continuous Membership Reconciliation Triggered?<a href="#when-is-continuous-membership-reconciliation-triggered" class="hash-link" aria-label="Direct link to When is Continuous Membership Reconciliation Triggered?" title="Direct link to When is Continuous Membership Reconciliation Triggered?">​</a></h4>
<p>The default reconciliation interval is 60 minutes. In addition, automatic reconciliation is triggered by
certain events in the cluster, such as an addition of a new node, or permanent node removal,
or a quorum queue-related policy change.</p>
<div class="theme-admonition theme-admonition-warning admonition_xJq3 alert alert--warning"><div class="admonitionHeading_Gvgb"><span class="admonitionIcon_Rf37"><svg viewBox="0 0 16 16"><path fill-rule="evenodd" d="M8.893 1.5c-.183-.31-.52-.5-.887-.5s-.703.19-.886.5L.138 13.499a.98.98 0 0 0 0 1.001c.193.31.53.501.886.501h13.964c.367 0 .704-.19.877-.5a1.03 1.03 0 0 0 .01-1.002L8.893 1.5zm.133 11.497H6.987v-2.003h2.039v2.003zm0-3.004H6.987V5.987h2.039v4.006z"></path></svg></span>warning</div><div class="admonitionContent_BuS1"><p>Note that a node or quorum queue replica failure does not trigger automatic membership reconciliation.</p><p>If a node is failed in an unrecoverable way and cannot be brought back, it must be explicitly removed from the cluster
or the operator must opt-in and enable the <code>quorum_queue.continuous_membership_reconciliation.auto_remove</code> setting.</p><p>This also means that <a href="/rabbitmq-website/docs/4.0/upgrade">upgrades</a> do not trigger automatic membership reconciliation since nodes
are expected to come back and only a minority (often just one) node is stopped for upgrading at a time.</p></div></div>
<h4 class="anchor anchorWithStickyNavbar_LWe7" id="cmr-configuration">CMR Configuration<a href="#cmr-configuration" class="hash-link" aria-label="Direct link to CMR Configuration" title="Direct link to CMR Configuration">​</a></h4>
<h5 class="anchor anchorWithStickyNavbar_LWe7" id="via-rabbitmqconf">Via <code>rabbitmq.conf</code><a href="#via-rabbitmqconf" class="hash-link" aria-label="Direct link to via-rabbitmqconf" title="Direct link to via-rabbitmqconf">​</a></h5>
<table class="name-description"><caption>Continuous Membership Reconciliation (CMR) Settings</caption><thead><td><code>rabbitmq.conf</code> <a href="./configure">configuration key</a></td><td>Description</td></thead><tr><td><p><code>quorum_queue.continuous_membership_reconciliation.enabled</code></p></td><td><p>Enables or disables continuous membership reconciliation.</p><p></p><ul><li>Data type: boolean</li><li>Default: <code>false</code></li></ul><p></p></td></tr><tr><td><p><code>quorum_queue.continuous_membership_reconciliation.target_group_size</code></p></td><td><p>The target replica count (group size) for queue members.</p><p></p><ul><li>Data type: positive integer</li><li>Default: none</li></ul><p></p></td></tr><tr><td><p><code>quorum_queue.continuous_membership_reconciliation.auto_remove</code></p></td><td><p>Enables or disables automatic removal of member nodes that are no longer part of the cluster, but still a member of the quorum queue.</p><p></p><ul><li>Data type: boolean</li><li>Default: <code>false</code></li></ul><p></p></td></tr><tr><td><p><code>quorum_queue.continuous_membership_reconciliation.interval</code></p></td><td><p>The default evaluation interval in milliseconds.</p><p></p><ul><li>Data type: positive integer</li><li>Default: <code>3600000</code> (60 minutes)</li></ul><p></p></td></tr><tr><td><p><code>quorum_queue.continuous_membership_reconciliation.trigger_interval</code></p></td><td><p>The reconciliation delay in milliseconds, used when a trigger event occurs, for example, a node is added or removed from the cluster or an applicable policy changes.
This delay will be applied only once, then the regular interval will be used again.</p><p></p><ul><li>Data type: positive integer</li><li>Default: <code>10000</code> (10 seconds)</li></ul><p></p></td></tr></table>
<h5 class="anchor anchorWithStickyNavbar_LWe7" id="policy-keys">Policy Keys<a href="#policy-keys" class="hash-link" aria-label="Direct link to Policy Keys" title="Direct link to Policy Keys">​</a></h5>
<table class="name-description"><caption>Policy-driven CMR Settings</caption><thead><td><a href="/policies">Policy key</a></td><td>Description</td></thead><tr><td><p><code>target-group-size</code></p></td><td><p>Defines the target replica count (group size) for matching queues. This policy can be set by users and operators.</p><p></p><ul><li>Data type: positive integer</li><li>Default: none</li></ul><p></p></td></tr></table>
<table class="name-description"><caption>Optional Arguments-driven CMR Settings</caption><thead><td><a href="./queues#optional-arguments">Optional arguments key</a></td><td>Description</td></thead><tr><td><p><code>x-quorum-target-group-size</code></p></td><td><p>Defines the target replica count (group size) for matching queues. This key can be overridden by operator policies.</p><p></p><ul><li>Data type: positive integer</li><li>Default: none</li></ul><p></p></td></tr></table>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="behaviour">Quorum Queue Behaviour<a href="#behaviour" class="hash-link" aria-label="Direct link to Quorum Queue Behaviour" title="Direct link to Quorum Queue Behaviour">​</a></h2>
<p>A quorum queue relies on a consensus protocol called Raft to ensure data consistency and safety.</p>
<p>Every quorum queue has a primary replica (a <em>leader</em> in Raft parlance) and zero or more
secondary replicas (called <em>followers</em>).</p>
<p>A leader is elected when the cluster is first formed and later if the leader
becomes unavailable.</p>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="leader-election">Leader Election and Failure Handling<a href="#leader-election" class="hash-link" aria-label="Direct link to Leader Election and Failure Handling" title="Direct link to Leader Election and Failure Handling">​</a></h3>
<p>A quorum queue requires a quorum of the declared nodes to be available
to function. When a RabbitMQ node hosting a quorum queue&#x27;s
<em>leader</em> fails or is stopped another node hosting one of that
quorum queue&#x27;s <em>follower</em> will be elected leader and resume
operations.</p>
<p>Failed and rejoining followers will re-synchronise (&quot;catch up&quot;) with the leader.
With quorum queues, a temporary replica failure
does not require a full re-synchronization from the currently elected leader. Only the delta
will be transferred if a re-joining replica is behind the leader. This &quot;catching up&quot; process
does not affect leader availability.</p>
<p>When a new replica is <a href="#member-management">added</a>, it will synchronise the entire queue state
from the leader.</p>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="quorum-requirements">Fault Tolerance and Minimum Number of Replicas Online<a href="#quorum-requirements" class="hash-link" aria-label="Direct link to Fault Tolerance and Minimum Number of Replicas Online" title="Direct link to Fault Tolerance and Minimum Number of Replicas Online">​</a></h3>
<p>Consensus systems can provide certain guarantees with regard to data safety.
These guarantees do mean that certain conditions need to be met before they
become relevant such as requiring a minimum of three cluster nodes to provide
fault tolerance and requiring more than half of members to be available to
work at all.</p>
<p>Failure tolerance characteristics of clusters of various size can be described
in a table:</p>
<table><thead><tr><th style="text-align:center">Cluster node count</th><th style="text-align:center">Tolerated number of node failures</th><th style="text-align:center">Tolerant to a network partition</th></tr></thead><tbody><tr><td style="text-align:center">1</td><td style="text-align:center">0</td><td style="text-align:center">not applicable</td></tr><tr><td style="text-align:center">2</td><td style="text-align:center">0</td><td style="text-align:center">no</td></tr><tr><td style="text-align:center">3</td><td style="text-align:center">1</td><td style="text-align:center">yes</td></tr><tr><td style="text-align:center">4</td><td style="text-align:center">1</td><td style="text-align:center">yes if a majority exists on one side</td></tr><tr><td style="text-align:center">5</td><td style="text-align:center">2</td><td style="text-align:center">yes</td></tr><tr><td style="text-align:center">6</td><td style="text-align:center">2</td><td style="text-align:center">yes if a majority exists on one side</td></tr><tr><td style="text-align:center">7</td><td style="text-align:center">3</td><td style="text-align:center">yes</td></tr><tr><td style="text-align:center">8</td><td style="text-align:center">3</td><td style="text-align:center">yes if a majority exists on one side</td></tr><tr><td style="text-align:center">9</td><td style="text-align:center">4</td><td style="text-align:center">yes</td></tr></tbody></table>
<p>As the table above shows RabbitMQ clusters with fewer than three nodes do not
benefit fully from the quorum queue guarantees. RabbitMQ clusters with an even
number of RabbitMQ nodes do not benefit from having quorum queue members spread
over all nodes. For these systems the quorum queue size should be constrained to a
smaller uneven number of nodes.</p>
<p>Performance tails off quite a bit for quorum queue node sizes larger than 5.
We do not recommend running quorum queues on more than 7 RabbitMQ nodes. The
default quorum queue size is 3 and is controllable using the
<code>x-quorum-initial-group-size</code> <a href="/rabbitmq-website/docs/4.0/queues#optional-arguments">queue argument</a>.</p>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="data-safety">Data Safety<a href="#data-safety" class="hash-link" aria-label="Direct link to Data Safety" title="Direct link to Data Safety">​</a></h3>
<p>Quorum queues are designed to provide data safety under network partition and
failure scenarios. A message that was successfully confirmed back to the publisher
using the <a href="/rabbitmq-website/docs/4.0/confirms">publisher confirms</a> feature should not be lost as long as at
least a majority of RabbitMQ nodes hosting the quorum queue are not
permanently made unavailable.</p>
<p>Generally quorum queues favours data consistency over availability.</p>
<div class="theme-admonition theme-admonition-important admonition_xJq3 alert alert--info"><div class="admonitionHeading_Gvgb"><span class="admonitionIcon_Rf37"><svg viewBox="0 0 14 16"><path fill-rule="evenodd" d="M7 2.3c3.14 0 5.7 2.56 5.7 5.7s-2.56 5.7-5.7 5.7A5.71 5.71 0 0 1 1.3 8c0-3.14 2.56-5.7 5.7-5.7zM7 1C3.14 1 0 4.14 0 8s3.14 7 7 7 7-3.14 7-7-3.14-7-7-7zm1 3H6v5h2V4zm0 6H6v2h2v-2z"></path></svg></span>important</div><div class="admonitionContent_BuS1"><p>Quorum queues cannot provide any safety guarantees for messages that have not been <a href="/rabbitmq-website/docs/4.0/confirms">confirmed to the publisher</a>.
Such messages could be lost &quot;in flight&quot;, in an operating
system buffer or otherwise fail to reach the target node or the queue leader.</p></div></div>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="availability">Availability<a href="#availability" class="hash-link" aria-label="Direct link to Availability" title="Direct link to Availability">​</a></h3>
<p>A quorum queue should be able to tolerate a minority of queue members becoming unavailable
with no or little effect on availability.</p>
<p>Note that depending on the <a href="/rabbitmq-website/docs/4.0/partitions">partition handling strategy</a>
used RabbitMQ may restart itself during recovery and reset the node but as long as that
does not happen, this availability guarantee should hold true.</p>
<p>For example, a queue with three replicas can tolerate one node failure without losing availability.
A queue with five replicas can tolerate two, and so on.</p>
<p>If a quorum of nodes cannot be recovered (say if 2 out of 3 RabbitMQ nodes are
permanently lost) the queue is permanently unavailable and
will need to be force deleted and recreated.</p>
<p>Quorum queue follower replicas that are disconnected from the leader or participating in a leader
election will ignore queue operations sent to it until they become aware of a newly elected leader.
There will be warnings in the log (<code>received unhandled msg</code> and similar) about such events.
As soon as the replica discovers a newly elected leader, it will sync the queue operation
log entries it does not have from the leader, including the dropped ones. Quorum queue state
will therefore remain consistent.</p>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="performance">Performance Characteristics<a href="#performance" class="hash-link" aria-label="Direct link to Performance Characteristics" title="Direct link to Performance Characteristics">​</a></h3>
<div class="theme-admonition theme-admonition-important admonition_xJq3 alert alert--info"><div class="admonitionHeading_Gvgb"><span class="admonitionIcon_Rf37"><svg viewBox="0 0 14 16"><path fill-rule="evenodd" d="M7 2.3c3.14 0 5.7 2.56 5.7 5.7s-2.56 5.7-5.7 5.7A5.71 5.71 0 0 1 1.3 8c0-3.14 2.56-5.7 5.7-5.7zM7 1C3.14 1 0 4.14 0 8s3.14 7 7 7 7-3.14 7-7-3.14-7-7-7zm1 3H6v5h2V4zm0 6H6v2h2v-2z"></path></svg></span>important</div><div class="admonitionContent_BuS1"><p>Quorum queues have been optimized further in RabbitMQ 4.1.x
and now <a href="https://www.rabbitmq.com/blog/2025/04/08/4.1-performance-improvements" target="_blank" rel="noopener noreferrer">feature lower memory footprints and improved consumer delivery rates</a>, parallelism under peak load.</p></div></div>
<p>Quorum queues are designed to trade latency for throughput and have been tested
in 3, 5 and 7 node configurations with several different message sizes.</p>
<p>In scenarios using both consumer acks and publisher confirms
quorum queues have been observed to have superior throughput to
classic mirrored queues (deprecated in 2021, removed in 2024 for RabbitMQ 4.0).
For example, take a look at <a href="/rabbitmq-website/blog/2022/05/16/rabbitmq-3.10-performance-improvements">these benchmarks with 3.10</a>
and <a href="/rabbitmq-website/blog/2023/05/17/rabbitmq-3.12-performance-improvements#significant-improvements-to-quorum-queues">another with 3.12</a>.</p>
<p>As quorum queues persist all data to disks before doing anything it is recommended
to use the fastest disks possible and certain <a href="#performance-tuning">Performance Tuning</a> settings.</p>
<p>Quorum queues also benefit from consumers
using higher prefetch values to ensure consumers aren&#x27;t starved whilst
acknowledgements are flowing through the system and allowing messages
to be delivered in a timely fashion.</p>
<p>Due to the disk I/O-heavy nature of quorum queues, their throughput decreases
as message sizes increase.</p>
<p>Quorum queue throughput is also affected by the number of replicas.
The more replicas a quorum queue has, the lower its throughput generally will
be since more work has to be done to replicate data and achieve consensus.</p>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="configuration">Configurable Settings<a href="#configuration" class="hash-link" aria-label="Direct link to Configurable Settings" title="Direct link to Configurable Settings">​</a></h2>
<p>There are a few new configuration parameters that can be tweaked using
the <a href="/rabbitmq-website/docs/4.0/configure#advanced-config-file">advanced</a> config file.</p>
<p>Note that all settings related to <a href="#resource-use">resource footprint</a> are documented
in a separate section.</p>
<p>The <code>ra</code> application (which is the Raft library that quorum
queues use) has <a href="https://github.com/rabbitmq/ra#configuration" target="_blank" rel="noopener noreferrer">its own set of tunable parameters</a>.</p>
<p>The <code>rabbit</code> application has several quorum queue related configuration items available.</p>
<table><thead><tr><td><code>advanced.config</code> <a href="./configure">configuration key</a></td><td>Description</td><td>Default value</td></tr></thead><tbody><tr><td>rabbit.quorum_cluster_size</td><td><p>Sets the default quorum queue cluster size (can be over-ridden by the <code>x-quorum-initial-group-size</code>
queue argument at declaration time.</p></td><td>3</td></tr><tr><td>rabbit.quorum_commands_soft_limit</td><td><p>This is a flow control related parameter defining
the maximum number of unconfirmed messages a channel accepts before entering flow.
The current default is configured to provide good performance and stability
when there are multiple publishers sending to the same quorum queue. If the applications
typically only have a single publisher per queue this limit could be increased to provide
somewhat better ingress rates.</p></td><td>32</td></tr></tbody></table>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="example-of-a-quorum-queue-configuration">Example of a Quorum Queue Configuration<a href="#example-of-a-quorum-queue-configuration" class="hash-link" aria-label="Direct link to Example of a Quorum Queue Configuration" title="Direct link to Example of a Quorum Queue Configuration">​</a></h3>
<p>The following <code>advanced.config</code> example modifies all values listed above:</p>
<div class="language-erlang codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-erlang codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token punctuation" style="color:#393A34">[</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"> </span><span class="token comment" style="color:#999988;font-style:italic">%% five replicas by default, only makes sense for nine node clusters</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token atom">rabbit</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">[</span><span class="token punctuation" style="color:#393A34">{</span><span class="token atom">quorum_cluster_size</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">5</span><span class="token punctuation" style="color:#393A34">}</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">           </span><span class="token punctuation" style="color:#393A34">{</span><span class="token atom">quorum_commands_soft_limit</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">64</span><span class="token punctuation" style="color:#393A34">}</span><span class="token punctuation" style="color:#393A34">]</span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">]</span><span class="token punctuation" style="color:#393A34">.</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="relaxed-property-equivalence">Options to Relax Property Equivalence Checks<a href="#relaxed-property-equivalence" class="hash-link" aria-label="Direct link to Options to Relax Property Equivalence Checks" title="Direct link to Options to Relax Property Equivalence Checks">​</a></h2>
<p>When a client redeclares a queue, RabbitMQ nodes <a href="/rabbitmq-website/docs/4.0/queues#property-equivalence">perform a property equivalence checks</a>.
If some properties are not equivalent, the declaration will fail with a <a href="/rabbitmq-website/docs/4.0/channels#error-handling">channel error</a>.</p>
<p>In environment where applications explicitly set the type of the queue via the <code>x-queue-type</code> argument
and cannot be quickly updated and/or redeployed, the equivalence check for <code>x-queue-type</code> can be ignored
with an opt-in setting:</p>
<div class="codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">quorum_queue.property_equivalence.relaxed_checks_on_redeclaration = true</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>If <code>quorum_queue.property_equivalence.relaxed_checks_on_redeclaration</code> is set to <code>true</code>,
the &#x27;x-queue-type&#x27; header will be ignored (not compared for equivalence)
for queue redeclaration.</p>
<p>This can simplify upgrades of applications that explicitly
set &#x27;x-queue-type&#x27; to &#x27;classic&#x27; for historical reasons but do not set any other
properties that may conflict or significantly change queue behavior and semantics,
such as the <a href="/rabbitmq-website/docs/4.0/queues#exclusive-queues">&#x27;exclusive&#x27; field</a>.</p>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="resource-use">Resource Use<a href="#resource-use" class="hash-link" aria-label="Direct link to Resource Use" title="Direct link to Resource Use">​</a></h2>
<div class="theme-admonition theme-admonition-important admonition_xJq3 alert alert--info"><div class="admonitionHeading_Gvgb"><span class="admonitionIcon_Rf37"><svg viewBox="0 0 14 16"><path fill-rule="evenodd" d="M7 2.3c3.14 0 5.7 2.56 5.7 5.7s-2.56 5.7-5.7 5.7A5.71 5.71 0 0 1 1.3 8c0-3.14 2.56-5.7 5.7-5.7zM7 1C3.14 1 0 4.14 0 8s3.14 7 7 7 7-3.14 7-7-3.14-7-7-7zm1 3H6v5h2V4zm0 6H6v2h2v-2z"></path></svg></span>important</div><div class="admonitionContent_BuS1"><p>Quorum queues have been optimized further in RabbitMQ 4.1.x
and now <a href="https://www.rabbitmq.com/blog/2025/04/08/4.1-performance-improvements" target="_blank" rel="noopener noreferrer">feature lower memory footprints and improved consumer delivery rates</a>, parallelism under peak load.</p></div></div>
<p>Quorum queues are optimised for data safety and performance. Each quorum queue process maintains an in-memory index of
the messages in the queue, which requires at least 32 bytes of metadata for each message (more, if the message was returned or has a TTL set).
A quorum queue process will therefore use at least 1MB for every 30000 messages in the queue (message size is irrelevant).
You can perform back-of-the-envelope calculations based on the number of queues and expected or maximum number of messages in them).
Keeping the queues short is the best way to maintain low memory usage. <a href="/rabbitmq-website/docs/4.0/maxlength">Setting the maximum queue length</a>
for all queues is a good way to limit the total memory usage if the queues become long for any reason.</p>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="how-memory-wal-and-segments-files-interact">How Memory, WAL and Segments Files Interact<a href="#how-memory-wal-and-segments-files-interact" class="hash-link" aria-label="Direct link to How Memory, WAL and Segments Files Interact" title="Direct link to How Memory, WAL and Segments Files Interact">​</a></h3>
<p>Quorum queues on a given node share a write-ahead-log (WAL) for all operations.
The WAL contains a limited number of recent operations on the queue.
WAL entries are stored both in memory and written to disk.
When the current WAL file reaches a predefined limit, it is flushed to segment files on disk
for each quorum queue member on a node
and the system will begin to release the memory used by that batch of log entries.</p>
<p>The segment files are then compacted over time as consumers <a href="/rabbitmq-website/docs/4.0/confirms">acknowledge deliveries</a>.
Compaction is the process that reclaims disk space.</p>
<p>The WAL file size limit at which it is flushed to disk can be controlled:</p>
<div class="language-ini codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-ini codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain"># Flush current WAL file to a segment file on disk once it reaches 64 MiB in size</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">raft.wal_max_size_bytes = 64000000</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>The value defaults to 512 MiB. This means that during steady load, the WAL table memory
footprint can reach 512 MiB.</p>
<div class="theme-admonition theme-admonition-important admonition_xJq3 alert alert--info"><div class="admonitionHeading_Gvgb"><span class="admonitionIcon_Rf37"><svg viewBox="0 0 14 16"><path fill-rule="evenodd" d="M7 2.3c3.14 0 5.7 2.56 5.7 5.7s-2.56 5.7-5.7 5.7A5.71 5.71 0 0 1 1.3 8c0-3.14 2.56-5.7 5.7-5.7zM7 1C3.14 1 0 4.14 0 8s3.14 7 7 7 7-3.14 7-7-3.14-7-7-7zm1 3H6v5h2V4zm0 6H6v2h2v-2z"></path></svg></span>important</div><div class="admonitionContent_BuS1"><p>Because memory is not guaranteed to be deallocated instantly by the <a href="/rabbitmq-website/docs/4.0/runtime">runtime</a>,
we recommend that the RabbitMQ node is allocated at least 3 times the memory of the effective WAL file size limit.
More will be required in high-throughput systems.
4 times is a good starting point for those.</p></div></div>
<p>The memory footprint pattern of quorum queues will typically look like this:</p>
<figure><p><img decoding="async" loading="lazy" alt="Quorum Queues memory usage pattern" src="/rabbitmq-website/assets/images/quorum-queue-memory-usage-pattern-de3661a6a62acd5351b680e8cc490270.png" width="1098" height="294" class="img_ev3q"></p></figure>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="disk-space">Disk Space<a href="#disk-space" class="hash-link" aria-label="Direct link to Disk Space" title="Direct link to Disk Space">​</a></h3>
<div class="theme-admonition theme-admonition-important admonition_xJq3 alert alert--info"><div class="admonitionHeading_Gvgb"><span class="admonitionIcon_Rf37"><svg viewBox="0 0 14 16"><path fill-rule="evenodd" d="M7 2.3c3.14 0 5.7 2.56 5.7 5.7s-2.56 5.7-5.7 5.7A5.71 5.71 0 0 1 1.3 8c0-3.14 2.56-5.7 5.7-5.7zM7 1C3.14 1 0 4.14 0 8s3.14 7 7 7 7-3.14 7-7-3.14-7-7-7zm1 3H6v5h2V4zm0 6H6v2h2v-2z"></path></svg></span>important</div><div class="admonitionContent_BuS1"><p>In environments with heavy quorum queue usage and/or large messages flowing through them,
it is very important to overprovision disk space, that is, have the extra spare capacity.
This follows the <a href="/rabbitmq-website/docs/4.0/production-checklist#storage">general recommendation for storage</a> for modern release series.</p></div></div>
<p>With large messages (say, 1 MiB and higher), quorum queue disk footprint can be large.
Depending on the workload — and in particular, the number of messages pending <a href="/rabbitmq-website/docs/4.0/consumers">consumer acknowledgement</a> —
the removal of segment files can progress slowly, resulting in a growing disk footprint.</p>
<p>This leads to several recommendations:</p>
<ol>
<li>In environments with heavy quorum queue usage and/or large messages flowing through them,
it is very important to overprovision disk space, that is, have the extra spare capacity</li>
<li>Quorum queues depend heavily on consumers acknowledging messages in a timely manner,
so a <a href="/rabbitmq-website/docs/4.0/consumers#acknowledgement-timeout">reasonably low delivery acknowledgement timeout</a> must be used</li>
<li>With larger messages, <a href="#performance-tuning-large-messages">decreasing the number of entries per segment file</a> can be beneficial
to reduce the size of segment files and allow for more frequent truncation (removal) of those files</li>
<li>Larger messages can be stored in a blob store as an alternative, with relevant metadata being passed around
in messages flowing through quorum qeueues</li>
</ol>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="segment-file-truncation">When Does Segment File Truncation Happen?<a href="#segment-file-truncation" class="hash-link" aria-label="Direct link to When Does Segment File Truncation Happen?" title="Direct link to When Does Segment File Truncation Happen?">​</a></h3>
<p>Segment file truncation happens periodically in response to client operations,
when it is safe to do so. Quorum queues periodically take checkpoints and snapshots,
and truncate the segment files that are know to not contain any more &quot;live&quot; (ready for delivery
or pending consumer acknowledgement) messages.</p>
<p>When there is no client activity, these events won&#x27;t happen, and neither will segment
file truncation. If a queue is completely idle and empty but has a large number of
on disk segment files from an earlier period of peak activity, making sure the queue is
empty then <strong>purging it</strong> may help force a segment file truncation.</p>
<p>To purge a queue, use</p>
<ul>
<li>Using the <code>Purge Messages</code> button one the queue&#x27;s page in the management UI</li>
<li>When using AMQP 0-9-1, the <code>queue.purge</code> operation, exposed via similarly named functions or methods in most AMQP 0-9-1 client libraries</li>
<li>When using AMQP 1.0, similarly named functions or methods in the AMQP 1.0 client libraries maintained by Team RabbitMQ</li>
</ul>
<p>Note that purging a queue with unacknowedged deliveries won&#x27;t have the desired effect
on all the segment files, and possibly no effects at all.</p>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="repeated-requeues">Repeatedly Requeued Deliveries (Deliver-Requeue Loops)<a href="#repeated-requeues" class="hash-link" aria-label="Direct link to Repeatedly Requeued Deliveries (Deliver-Requeue Loops)" title="Direct link to Repeatedly Requeued Deliveries (Deliver-Requeue Loops)">​</a></h3>
<p>Internally quorum queues are implemented using a log where all operations including
messages are persisted. To avoid this log growing too large it needs to be
truncated regularly. To be able to truncate a section of the log all messages
in that section needs to be acknowledged. Usage patterns that continuously
<a href="/rabbitmq-website/docs/4.0/nack">reject or nack</a> the same message with the <code>requeue</code> flag set to true
could cause the log to grow in an unbounded fashion and eventually fill
up the disks. Therefore since RabbitMQ 4.0 a default <code>delivery-limit</code> of 20 is
always set after which the message will be dropped or dead lettered.</p>
<p>Messages that are rejected or nacked back to a quorum queue will be
returned to the <em>back</em> of the queue <em>if</em> no <a href="#poison-message-handling">delivery-limit</a> is set.
This avoids the above scenario where repeated re-queues causes the Raft log to grow in an unbounded manner. If a <code>delivery-limit</code> is set it will use the original behaviour
of returning the message near the head of the queue.</p>
<p>The old unlimited delivery-limit behaviour can be restored by setting a queue
argument or policy with a delivery limit of -1. It is not recommended to do
so but may be needed for 3.13.x compatibility in some rare cases.</p>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="atom-use">Increased Atom Use<a href="#atom-use" class="hash-link" aria-label="Direct link to Increased Atom Use" title="Direct link to Increased Atom Use">​</a></h3>
<p>The internal implementation of quorum queues converts the queue name
into an Erlang atom. If queues with arbitrary names are continuously
created and deleted it <em>may</em> threaten the long term stability of the
RabbitMQ system if the size of the atom table reaches the default limit of
5 million.</p>
<p>While quorum queues were not designed to be used in high churn environments
(non-mirrored classic queues are the optimal choice for those), the limit
can be increased if really necessary.</p>
<p>See <a href="/rabbitmq-website/docs/4.0/runtime#atom-usage">the Runtime guide</a> to learn more.</p>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="performance-tuning">Performance Tuning<a href="#performance-tuning" class="hash-link" aria-label="Direct link to Performance Tuning" title="Direct link to Performance Tuning">​</a></h2>
<div class="theme-admonition theme-admonition-important admonition_xJq3 alert alert--info"><div class="admonitionHeading_Gvgb"><span class="admonitionIcon_Rf37"><svg viewBox="0 0 14 16"><path fill-rule="evenodd" d="M7 2.3c3.14 0 5.7 2.56 5.7 5.7s-2.56 5.7-5.7 5.7A5.71 5.71 0 0 1 1.3 8c0-3.14 2.56-5.7 5.7-5.7zM7 1C3.14 1 0 4.14 0 8s3.14 7 7 7 7-3.14 7-7-3.14-7-7-7zm1 3H6v5h2V4zm0 6H6v2h2v-2z"></path></svg></span>important</div><div class="admonitionContent_BuS1"><p>Quorum queues have been optimized further in RabbitMQ 4.1.x
and now <a href="https://www.rabbitmq.com/blog/2025/04/08/4.1-performance-improvements" target="_blank" rel="noopener noreferrer">feature lower memory footprints and improved consumer delivery rates</a>, parallelism under peak load.</p></div></div>
<p>This section aims to cover a couple of tunable parameters that may increase throughput of quorum queues for
<strong>some workloads</strong>. Other workloads may not see any increases, or observe decreases in throughput, with these settings.</p>
<p>Use the values and recommendations here as a <strong>starting point</strong> and conduct your own benchmark (for example,
<a href="https://rabbitmq.github.io/rabbitmq-perf-test/stable/htmlsingle/" target="_blank" rel="noopener noreferrer">using PerfTest</a>) to conclude what combination of values works best for a particular workloads.</p>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="tuning-raft-segment-file-entry-count">Tuning: Raft Segment File Entry Count<a href="#tuning-raft-segment-file-entry-count" class="hash-link" aria-label="Direct link to Tuning: Raft Segment File Entry Count" title="Direct link to Tuning: Raft Segment File Entry Count">​</a></h3>
<h4 class="anchor anchorWithStickyNavbar_LWe7" id="performance-tuning-small-messages">For Small Messages<a href="#performance-tuning-small-messages" class="hash-link" aria-label="Direct link to For Small Messages" title="Direct link to For Small Messages">​</a></h4>
<p>Workloads with small messages and higher message rates can benefit from the following
configuration change that increases the number of Raft log entries (such as enqueued messages)
that are allowed in a segment file.</p>
<p>Having fewer segment files can be beneficial when consuming from a queue with a long backlog:</p>
<div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token comment" style="color:#999988;font-style:italic"># Positive values up to 65535 are allowed, the default is 4096.</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token comment" style="color:#999988;font-style:italic"># This value is reasonable for workloads with small (say, smaller than 8 kiB) messages</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">raft.segment_max_entries </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">32768</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>Values greater than <code>65535</code> are <strong>not supported</strong>.</p>
<h4 class="anchor anchorWithStickyNavbar_LWe7" id="performance-tuning-large-messages">For Large Messages<a href="#performance-tuning-large-messages" class="hash-link" aria-label="Direct link to For Large Messages" title="Direct link to For Large Messages">​</a></h4>
<p>Workloads with large (100s of kilobytes or even a few MiB) messages will benefit from the following
configuration change that <strong>significantly reduces</strong> the number of Raft log entries (such as enqueued messages)
that are allowed in a segment file.</p>
<p>Having significantly fewer entries per segment file
will keep the size of each segment reasonable and allow nodes truncate them
at a higher rate because each segment file will have a lower probability to have
a very small number of live messages that keep the entire file around.</p>
<p>As a back-of-the-envelope calculation, consider a workload that enqueues 4096 messages
of 1 MiB each. That would result in a segment file of over 4 GiB in size, and the entire
file won&#x27;t be ready for deletion as long as at least one of those messages is alive
(was not delivered and confirmed).</p>
<p>For example, to allow only 128 entries per segment file:</p>
<div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token comment" style="color:#999988;font-style:italic"># The default is 4096.</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token comment" style="color:#999988;font-style:italic"># This value is only reasonable for workloads with messages of 1 MiB or even larger</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">raft.segment_max_entries </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">128</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="performance-tuning-linux-readahead">Tuning: Linux Readahead<a href="#performance-tuning-linux-readahead" class="hash-link" aria-label="Direct link to Tuning: Linux Readahead" title="Direct link to Tuning: Linux Readahead">​</a></h3>
<p>In addition, the aforementioned workloads with a higher rate of small messages can benefit from
a higher <code>readahead</code>, a configurable block device parameter of storage devices on Linux.</p>
<p>To inspect the effective <code>readahead</code> value, use <a href="https://man7.org/linux/man-pages/man8/blockdev.8.html" target="_blank" rel="noopener noreferrer"><code>blockdev --getra</code></a>
and specify the block device that hosts RabbitMQ node data directory:</p>
<div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token comment" style="color:#999988;font-style:italic"># This is JUST AN EXAMPLE.</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token comment" style="color:#999988;font-style:italic"># The name of the block device in your environment will be different.</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token comment" style="color:#999988;font-style:italic">#</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token comment" style="color:#999988;font-style:italic"># Displays effective readahead value device /dev/sda.</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token function" style="color:#d73a49">sudo</span><span class="token plain"> blockdev </span><span class="token parameter variable" style="color:#36acaa">--getra</span><span class="token plain"> /dev/sda</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>To configure <code>readahead</code>, use <a href="https://man7.org/linux/man-pages/man8/blockdev.8.html" target="_blank" rel="noopener noreferrer"><code>blockdev --setra</code></a> for
the block device that hosts RabbitMQ node data directory:</p>
<div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token comment" style="color:#999988;font-style:italic"># This is JUST AN EXAMPLE.</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token comment" style="color:#999988;font-style:italic"># The name of the block device in your environment will be different.</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token comment" style="color:#999988;font-style:italic"># Values between 256 and 4096 in steps of 256 are most commonly used.</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token comment" style="color:#999988;font-style:italic">#</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token comment" style="color:#999988;font-style:italic"># Sets readahead for device /dev/sda to 4096.</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token function" style="color:#d73a49">sudo</span><span class="token plain"> blockdev </span><span class="token parameter variable" style="color:#36acaa">--setra</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">4096</span><span class="token plain"> /dev/sda</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div></div><footer class="theme-doc-footer docusaurus-mt-lg"><div class="row margin-top--sm theme-doc-footer-edit-meta-row"><div class="col"><a href="https://github.com/rabbitmq/rabbitmq-website/tree/main/versioned_docs/version-4.0/quorum-queues/index.md" target="_blank" rel="noopener noreferrer" class="theme-edit-this-page"><svg fill="currentColor" height="20" width="20" viewBox="0 0 40 40" class="iconEdit_Z9Sw" aria-hidden="true"><g><path d="m34.5 11.7l-3 3.1-6.3-6.3 3.1-3q0.5-0.5 1.2-0.5t1.1 0.5l3.9 3.9q0.5 0.4 0.5 1.1t-0.5 1.2z m-29.5 17.1l18.4-18.5 6.3 6.3-18.4 18.4h-6.3v-6.2z"></path></g></svg>Edit this page</a></div><div class="col lastUpdated_JAkA"></div></div></footer></article><nav class="pagination-nav docusaurus-mt-lg" aria-label="Docs pages"><a class="pagination-nav__link pagination-nav__link--prev" href="/rabbitmq-website/docs/4.0/queues"><div class="pagination-nav__sublabel">Previous</div><div class="pagination-nav__label">Queues</div></a><a class="pagination-nav__link pagination-nav__link--next" href="/rabbitmq-website/docs/4.0/classic-queues"><div class="pagination-nav__sublabel">Next</div><div class="pagination-nav__label">Classic Queues</div></a></nav></div></div><div class="col col--3"><div class="tableOfContents_bqdL thin-scrollbar theme-doc-toc-desktop"><ul class="table-of-contents table-of-contents__left-border"><li><a href="#overview" class="table-of-contents__link toc-highlight">Overview</a></li><li><a href="#toc" class="table-of-contents__link toc-highlight">Topics Covered</a></li><li><a href="#motivation" class="table-of-contents__link toc-highlight">Motivation</a><ul><li><a href="#what-is-quorum" class="table-of-contents__link toc-highlight">What is a Quorum?</a></li></ul></li><li><a href="#use-cases" class="table-of-contents__link toc-highlight">Use Cases</a></li><li><a href="#features" class="table-of-contents__link toc-highlight">Features</a><ul><li><a href="#feature-comparison" class="table-of-contents__link toc-highlight">Comparison with Classic Queues</a></li><li><a href="#feature-matrix" class="table-of-contents__link toc-highlight">Feature Matrix</a></li><li><a href="#queue-and-per-message-ttl" class="table-of-contents__link toc-highlight">Queue and Per-Message TTL</a></li><li><a href="#length-limit" class="table-of-contents__link toc-highlight">Length Limit</a></li><li><a href="#priorities" class="table-of-contents__link toc-highlight">Priorities</a></li></ul></li><li><a href="#poison-message-handling" class="table-of-contents__link toc-highlight">Poison Message Handling</a><ul><li><a href="#position-message-handling-configuring-limit" class="table-of-contents__link toc-highlight">Configuring the Limit</a></li><li><a href="#position-message-handling-configuring-dlx" class="table-of-contents__link toc-highlight">Configuring the Limit and Setting Up Dead-Lettering</a></li><li><a href="#policy-support" class="table-of-contents__link toc-highlight">Policy Support</a></li></ul></li><li><a href="#features-that-are-not-supported" class="table-of-contents__link toc-highlight">Features that are not Supported</a><ul><li><a href="#transient-non-durable-queues" class="table-of-contents__link toc-highlight">Transient (non-Durable) Queues</a></li><li><a href="#exclusivity" class="table-of-contents__link toc-highlight">Exclusivity</a></li><li><a href="#global-qos" class="table-of-contents__link toc-highlight">Global QoS</a></li></ul></li><li><a href="#usage" class="table-of-contents__link toc-highlight">Usage</a><ul><li><a href="#declaring" class="table-of-contents__link toc-highlight">Declaring</a></li><li><a href="#client-operations" class="table-of-contents__link toc-highlight">Client Operations</a></li></ul></li><li><a href="#replication" class="table-of-contents__link toc-highlight">Replication Factor and Membership Management</a><ul><li><a href="#replication-factor" class="table-of-contents__link toc-highlight">Controlling the Initial Replication Factor</a></li><li><a href="#member-management" class="table-of-contents__link toc-highlight">Managing Replicas</a></li><li><a href="#leader-placement" class="table-of-contents__link toc-highlight">Queue Leader Location</a></li><li><a href="#replica-rebalancing" class="table-of-contents__link toc-highlight">Rebalancing Replicas</a></li><li><a href="#replica-reconciliation" class="table-of-contents__link toc-highlight">Continuous Membership Reconciliation (CMR)</a></li></ul></li><li><a href="#behaviour" class="table-of-contents__link toc-highlight">Quorum Queue Behaviour</a><ul><li><a href="#leader-election" class="table-of-contents__link toc-highlight">Leader Election and Failure Handling</a></li><li><a href="#quorum-requirements" class="table-of-contents__link toc-highlight">Fault Tolerance and Minimum Number of Replicas Online</a></li><li><a href="#data-safety" class="table-of-contents__link toc-highlight">Data Safety</a></li><li><a href="#availability" class="table-of-contents__link toc-highlight">Availability</a></li><li><a href="#performance" class="table-of-contents__link toc-highlight">Performance Characteristics</a></li></ul></li><li><a href="#configuration" class="table-of-contents__link toc-highlight">Configurable Settings</a><ul><li><a href="#example-of-a-quorum-queue-configuration" class="table-of-contents__link toc-highlight">Example of a Quorum Queue Configuration</a></li></ul></li><li><a href="#relaxed-property-equivalence" class="table-of-contents__link toc-highlight">Options to Relax Property Equivalence Checks</a></li><li><a href="#resource-use" class="table-of-contents__link toc-highlight">Resource Use</a><ul><li><a href="#how-memory-wal-and-segments-files-interact" class="table-of-contents__link toc-highlight">How Memory, WAL and Segments Files Interact</a></li><li><a href="#disk-space" class="table-of-contents__link toc-highlight">Disk Space</a></li><li><a href="#segment-file-truncation" class="table-of-contents__link toc-highlight">When Does Segment File Truncation Happen?</a></li><li><a href="#repeated-requeues" class="table-of-contents__link toc-highlight">Repeatedly Requeued Deliveries (Deliver-Requeue Loops)</a></li><li><a href="#atom-use" class="table-of-contents__link toc-highlight">Increased Atom Use</a></li></ul></li><li><a href="#performance-tuning" class="table-of-contents__link toc-highlight">Performance Tuning</a><ul><li><a href="#tuning-raft-segment-file-entry-count" class="table-of-contents__link toc-highlight">Tuning: Raft Segment File Entry Count</a></li><li><a href="#performance-tuning-linux-readahead" class="table-of-contents__link toc-highlight">Tuning: Linux Readahead</a></li></ul></li></ul></div></div></div></div></main></div></div></div><footer class="footer footer--dark"><div class="container container-fluid"><div class="row footer__links"><div class="col footer__col"><div class="footer__title">Learn about RabbitMQ</div><ul class="footer__items clean-list"><li class="footer__item"><a class="footer__link-item" href="/rabbitmq-website/tutorials">Getting Started</a></li><li class="footer__item"><a class="footer__link-item" href="/rabbitmq-website/docs">Documentation</a></li><li class="footer__item"><a class="footer__link-item" href="/rabbitmq-website/blog">Blog</a></li></ul></div><div class="col footer__col"><div class="footer__title">Reach out to the RabbitMQ team</div><ul class="footer__items clean-list"><li class="footer__item"><a href="https://github.com/rabbitmq" target="_blank" rel="noopener noreferrer" class="footer__link-item">GitHub<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_nPIU"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a></li><li class="footer__item"><a href="https://github.com/rabbitmq/rabbitmq-server/discussions" target="_blank" rel="noopener noreferrer" class="footer__link-item">GitHub Discussions<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_nPIU"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a></li><li class="footer__item"><a class="footer__link-item" href="/rabbitmq-website/contact?utm_source=rmq_release-information_tableheader&amp;utm_medium=rmq_website&amp;utm_campaign=tanzu">Long Term Commercial Support</a></li><li class="footer__item"><a class="footer__link-item" href="/rabbitmq-website/contact">Contact Us</a></li><li class="footer__item"><a href="https://www.rabbitmq.com/discord" target="_blank" rel="noopener noreferrer" class="footer__link-item">Discord<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_nPIU"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a></li></ul></div><div class="col footer__col"><div class="footer__title">Broadcom</div><ul class="footer__items clean-list"><li class="footer__item"><a href="https://tanzu.vmware.com/" target="_blank" rel="noopener noreferrer" class="footer__link-item">VMware Tanzu<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_nPIU"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a></li><li class="footer__item"><a href="https://www.vmware.com/help/legal.html" target="_blank" rel="noopener noreferrer" class="footer__link-item">Terms of Use<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_nPIU"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a></li><li class="footer__item"><a href="https://www.vmware.com/help/privacy.html" target="_blank" rel="noopener noreferrer" class="footer__link-item">Privacy<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_nPIU"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a></li><li class="footer__item"><a class="footer__link-item" href="/rabbitmq-website/trademark-guidelines">Trademark Guidelines</a></li><li class="footer__item"><a href="https://www.vmware.com/help/privacy/california-privacy-rights.html" target="_blank" rel="noopener noreferrer" class="footer__link-item">Your California Privacy Rights<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_nPIU"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a></li><li class="footer__item"><a class="footer__link-item ot-sdk-show-settings">Cookie Settings</a></li></ul></div></div><div class="footer__bottom text--center"><div class="footer__copyright">Copyright © 2005-2025 Broadcom. All Rights Reserved. The term "Broadcom" refers to Broadcom Inc. and/or its subsidiaries.</div></div></div></footer></div>
</body>
</html>
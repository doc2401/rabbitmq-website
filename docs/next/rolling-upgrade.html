<!doctype html>
<html lang="en" dir="ltr" class="docs-wrapper plugin-docs plugin-id-default docs-version-current docs-doc-page docs-doc-id-rolling-upgrade" data-has-hydrated="false">
<head>
<meta charset="UTF-8">
<meta name="generator" content="Docusaurus v3.7.0">
<title data-rh="true">Rolling (in-place) Upgrade | RabbitMQ</title><meta data-rh="true" name="viewport" content="width=device-width,initial-scale=1"><meta data-rh="true" name="twitter:card" content="summary_large_image"><meta data-rh="true" property="og:image" content="https://www.rabbitmq.com/rabbitmq-website/img/rabbitmq-social-media-card.svg"><meta data-rh="true" name="twitter:image" content="https://www.rabbitmq.com/rabbitmq-website/img/rabbitmq-social-media-card.svg"><meta data-rh="true" property="og:url" content="https://www.rabbitmq.com/rabbitmq-website/docs/next/rolling-upgrade"><meta data-rh="true" property="og:locale" content="en"><meta data-rh="true" name="docusaurus_locale" content="en"><meta data-rh="true" name="docsearch:language" content="en"><meta data-rh="true" name="docusaurus_version" content="current"><meta data-rh="true" name="docusaurus_tag" content="docs-default-current"><meta data-rh="true" name="docsearch:version" content="current"><meta data-rh="true" name="docsearch:docusaurus_tag" content="docs-default-current"><meta data-rh="true" property="og:title" content="Rolling (in-place) Upgrade | RabbitMQ"><meta data-rh="true" name="description" content="&lt;!--"><meta data-rh="true" property="og:description" content="&lt;!--"><link data-rh="true" rel="icon" href="/rabbitmq-website/img/rabbitmq-logo.svg"><link data-rh="true" rel="canonical" href="https://www.rabbitmq.com/rabbitmq-website/docs/next/rolling-upgrade"><link data-rh="true" rel="alternate" href="https://www.rabbitmq.com/rabbitmq-website/docs/next/rolling-upgrade" hreflang="en"><link data-rh="true" rel="alternate" href="https://www.rabbitmq.com/rabbitmq-website/docs/next/rolling-upgrade" hreflang="x-default"><link data-rh="true" rel="preconnect" href="https://H10VQIW16Y-dsn.algolia.net" crossorigin="anonymous"><link rel="alternate" type="application/rss+xml" href="/rabbitmq-website/blog/rss.xml" title="RabbitMQ RSS Feed">
<link rel="alternate" type="application/atom+xml" href="/rabbitmq-website/blog/atom.xml" title="RabbitMQ Atom Feed">




<link rel="search" type="application/opensearchdescription+xml" title="RabbitMQ" href="/rabbitmq-website/opensearch.xml">







<link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Raleway:400,700">
<script src="https://cdn.cookielaw.org/scripttemplates/otSDKStub.js" data-domain-script="018ee308-473e-754f-b0c2-cbe82d25512f"></script>
<script>function OptanonWrapper(){}</script>
<script>function setGTM(e,t,o,n,r){e[n]=e[n]||[],e[n].push({"gtm.start":(new Date).getTime(),event:"gtm.js"});var i=t.getElementsByTagName(o)[0],a=t.createElement(o),s="dataLayer"!=n?"&l="+n:"";a.async=!0,a.src="https://www.googletagmanager.com/gtm.js?id="+r+s,i.parentNode.insertBefore(a,i)}var timer;function waitForOnetrustActiveGroups(){document.cookie.indexOf("OptanonConsent")>-1&&document.cookie.indexOf("groups=")>-1?(clearTimeout(timer),setGTM(window,document,"script","dataLayer","GTM-TT84L8K")):timer=setTimeout(waitForOnetrustActiveGroups,250)}document.cookie.indexOf("OptanonConsent")>-1&&document.cookie.indexOf("groups=")>-1?setGTM(window,document,"script","dataLayer","GTM-TT84L8K"):waitForOnetrustActiveGroups()</script><link rel="stylesheet" href="/rabbitmq-website/styles.css">
<script src="/rabbitmq-website/runtime~main.js" defer="defer"></script>
<script src="/rabbitmq-website/main.js" defer="defer"></script>
</head>
<body class="navigation-with-keyboard">
<script>!function(){function t(t){document.documentElement.setAttribute("data-theme",t)}var e=function(){try{return new URLSearchParams(window.location.search).get("docusaurus-theme")}catch(t){}}()||function(){try{return window.localStorage.getItem("theme")}catch(t){}}();null!==e?t(e):window.matchMedia("(prefers-color-scheme: dark)").matches?t("dark"):(window.matchMedia("(prefers-color-scheme: light)").matches,t("light"))}(),function(){try{const n=new URLSearchParams(window.location.search).entries();for(var[t,e]of n)if(t.startsWith("docusaurus-data-")){var a=t.replace("docusaurus-data-","data-");document.documentElement.setAttribute(a,e)}}catch(t){}}(),document.documentElement.setAttribute("data-announcement-bar-initially-dismissed",function(){try{return"true"===localStorage.getItem("docusaurus.announcement.dismiss")}catch(t){}return!1}())</script><div id="__docusaurus"><div role="region" aria-label="Skip to main content"><a class="skipToContent_fXgn" href="#__docusaurus_skipToContent_fallback">Skip to main content</a></div><div class="announcementBar_mb4j" style="background-color:var(--ifm-color-primary-contrast-background);color:var(--ifm-font-color-base)" role="banner"><div class="announcementBarPlaceholder_vyr4"></div><div class="content_knG7 announcementBarContent_xLdY"><strong style="font-size: var(--ifm-h4-font-size);"><a href="https://github.com/rabbitmq/rabbitmq-server/releases/tag/v4.1.0">RabbitMQ 4.1.0 is out</a></strong></div><button type="button" aria-label="Close" class="clean-btn close closeButton_CVFx announcementBarClose_gvF7"><svg viewBox="0 0 15 15" width="14" height="14"><g stroke="currentColor" stroke-width="3.1"><path d="M.75.75l13.5 13.5M14.25.75L.75 14.25"></path></g></svg></button></div><nav aria-label="Main" class="navbar navbar--fixed-top"><div class="navbar__inner"><div class="navbar__items"><button aria-label="Toggle navigation bar" aria-expanded="false" class="navbar__toggle clean-btn" type="button"><svg width="30" height="30" viewBox="0 0 30 30" aria-hidden="true"><path stroke="currentColor" stroke-linecap="round" stroke-miterlimit="10" stroke-width="2" d="M4 7h22M4 15h22M4 23h22"></path></svg></button><a class="navbar__brand" href="/rabbitmq-website/"><div class="navbar__logo"><img src="/rabbitmq-website/img/rabbitmq-logo-with-name.svg" alt="RabbitMQ" class="themedComponent_mlkZ themedComponent--light_NVdE"><img src="/rabbitmq-website/img/rabbitmq-logo-with-name.svg" alt="RabbitMQ" class="themedComponent_mlkZ themedComponent--dark_xIcU"></div></a><a class="navbar__item navbar__link" href="/rabbitmq-website/tutorials">Getting Started</a><a aria-current="page" class="navbar__item navbar__link navbar__link--active" href="/rabbitmq-website/docs/next">Docs</a><a class="navbar__item navbar__link" href="/rabbitmq-website/blog">Blog</a><a class="navbar__item navbar__link" href="/rabbitmq-website/contact">Support</a></div><div class="navbar__items navbar__items--right"><div class="navbar__item dropdown dropdown--hoverable dropdown--right"><a aria-current="page" class="navbar__link active" aria-haspopup="true" aria-expanded="false" role="button" href="/rabbitmq-website/docs/next/rolling-upgrade">Next</a><ul class="dropdown__menu"><li class=""><strong>Release series</strong></li><li><a aria-current="page" class="dropdown__link dropdown__link--active" href="/rabbitmq-website/docs/next/rolling-upgrade">Next</a></li><li><a class="dropdown__link" href="/rabbitmq-website/docs/rolling-upgrade">4.1</a></li><li><a class="dropdown__link" href="/rabbitmq-website/docs/4.0/rolling-upgrade">4.0</a></li><li><a class="dropdown__link" href="/rabbitmq-website/docs/3.13">3.13</a></li><li><a href="https://v3-12.rabbitmq.com/documentation.html" target="_blank" rel="noopener noreferrer" class="dropdown__link">3.12<svg width="12" height="12" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_nPIU"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a></li><li><a class="dropdown__link" href="/rabbitmq-website/release-information">Release Information</a></li></ul></div><a href="https://github.com/rabbitmq/rabbitmq-website" target="_blank" rel="noopener noreferrer" class="navbar__item navbar__link">GitHub<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_nPIU"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a><div class="toggle_vylO colorModeToggle_DEke"><button class="clean-btn toggleButton_gllP toggleButtonDisabled_aARS" type="button" disabled="" title="Switch between dark and light mode (currently light mode)" aria-label="Switch between dark and light mode (currently light mode)" aria-live="polite" aria-pressed="false"><svg viewBox="0 0 24 24" width="24" height="24" class="lightToggleIcon_pyhR"><path fill="currentColor" d="M12,9c1.65,0,3,1.35,3,3s-1.35,3-3,3s-3-1.35-3-3S10.35,9,12,9 M12,7c-2.76,0-5,2.24-5,5s2.24,5,5,5s5-2.24,5-5 S14.76,7,12,7L12,7z M2,13l2,0c0.55,0,1-0.45,1-1s-0.45-1-1-1l-2,0c-0.55,0-1,0.45-1,1S1.45,13,2,13z M20,13l2,0c0.55,0,1-0.45,1-1 s-0.45-1-1-1l-2,0c-0.55,0-1,0.45-1,1S19.45,13,20,13z M11,2v2c0,0.55,0.45,1,1,1s1-0.45,1-1V2c0-0.55-0.45-1-1-1S11,1.45,11,2z M11,20v2c0,0.55,0.45,1,1,1s1-0.45,1-1v-2c0-0.55-0.45-1-1-1C11.45,19,11,19.45,11,20z M5.99,4.58c-0.39-0.39-1.03-0.39-1.41,0 c-0.39,0.39-0.39,1.03,0,1.41l1.06,1.06c0.39,0.39,1.03,0.39,1.41,0s0.39-1.03,0-1.41L5.99,4.58z M18.36,16.95 c-0.39-0.39-1.03-0.39-1.41,0c-0.39,0.39-0.39,1.03,0,1.41l1.06,1.06c0.39,0.39,1.03,0.39,1.41,0c0.39-0.39,0.39-1.03,0-1.41 L18.36,16.95z M19.42,5.99c0.39-0.39,0.39-1.03,0-1.41c-0.39-0.39-1.03-0.39-1.41,0l-1.06,1.06c-0.39,0.39-0.39,1.03,0,1.41 s1.03,0.39,1.41,0L19.42,5.99z M7.05,18.36c0.39-0.39,0.39-1.03,0-1.41c-0.39-0.39-1.03-0.39-1.41,0l-1.06,1.06 c-0.39,0.39-0.39,1.03,0,1.41s1.03,0.39,1.41,0L7.05,18.36z"></path></svg><svg viewBox="0 0 24 24" width="24" height="24" class="darkToggleIcon_wfgR"><path fill="currentColor" d="M9.37,5.51C9.19,6.15,9.1,6.82,9.1,7.5c0,4.08,3.32,7.4,7.4,7.4c0.68,0,1.35-0.09,1.99-0.27C17.45,17.19,14.93,19,12,19 c-3.86,0-7-3.14-7-7C5,9.07,6.81,6.55,9.37,5.51z M12,3c-4.97,0-9,4.03-9,9s4.03,9,9,9s9-4.03,9-9c0-0.46-0.04-0.92-0.1-1.36 c-0.98,1.37-2.58,2.26-4.4,2.26c-2.98,0-5.4-2.42-5.4-5.4c0-1.81,0.89-3.42,2.26-4.4C12.92,3.04,12.46,3,12,3L12,3z"></path></svg></button></div><div class="navbarSearchContainer_Bca1"><button type="button" class="DocSearch DocSearch-Button" aria-label="Search (Command+K)"><span class="DocSearch-Button-Container"><svg width="20" height="20" class="DocSearch-Search-Icon" viewBox="0 0 20 20" aria-hidden="true"><path d="M14.386 14.386l4.0877 4.0877-4.0877-4.0877c-2.9418 2.9419-7.7115 2.9419-10.6533 0-2.9419-2.9418-2.9419-7.7115 0-10.6533 2.9418-2.9419 7.7115-2.9419 10.6533 0 2.9419 2.9418 2.9419 7.7115 0 10.6533z" stroke="currentColor" fill="none" fill-rule="evenodd" stroke-linecap="round" stroke-linejoin="round"></path></svg><span class="DocSearch-Button-Placeholder">Search</span></span><span class="DocSearch-Button-Keys"></span></button></div></div></div><div role="presentation" class="navbar-sidebar__backdrop"></div></nav><div id="__docusaurus_skipToContent_fallback" class="main-wrapper mainWrapper_z2l0"><div class="docsWrapper_hBAB"><button aria-label="Scroll back to top" class="clean-btn theme-back-to-top-button backToTopButton_sjWU" type="button"></button><div class="docRoot_UBD9"><aside class="theme-doc-sidebar-container docSidebarContainer_YfHR"><div class="sidebarViewport_aRkj"><div class="sidebar_njMd"><nav aria-label="Docs sidebar" class="menu thin-scrollbar menu_SIkG menuWithAnnouncementBar_GW3s"><ul class="theme-doc-sidebar-menu menu__list"><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/rabbitmq-website/docs/next">Introduction</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/rabbitmq-website/release-information">Release Information</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/rabbitmq-website/tutorials">Getting Started</a></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--active" href="/rabbitmq-website/docs/next/download">Install and Upgrade</a><button aria-label="Collapse sidebar category &#x27;Install and Upgrade&#x27;" aria-expanded="true" type="button" class="clean-btn menu__caret"></button></div><ul style="display:block;overflow:visible;height:auto" class="menu__list"><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/rabbitmq-website/docs/next/which-erlang">Erlang Version Requirements</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/rabbitmq-website/docs/next/signatures">Package Signatures</a></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-2 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist" tabindex="0" href="/rabbitmq-website/docs/next/platforms">Supported Operating Systems</a><button aria-label="Expand sidebar category &#x27;Supported Operating Systems&#x27;" aria-expanded="false" type="button" class="clean-btn menu__caret"></button></div></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/rabbitmq-website/kubernetes/operator/install-operator">Kubernetes Operator</a></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-2 menu__list-item"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--active" tabindex="0" href="/rabbitmq-website/docs/next/upgrade">Upgrade</a><button aria-label="Collapse sidebar category &#x27;Upgrade&#x27;" aria-expanded="true" type="button" class="clean-btn menu__caret"></button></div><ul style="display:block;overflow:visible;height:auto" class="menu__list"><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class="menu__link menu__link--active" aria-current="page" tabindex="0" href="/rabbitmq-website/docs/next/rolling-upgrade">Rolling Upgrade</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class="menu__link" tabindex="0" href="/rabbitmq-website/docs/next/blue-green-upgrade">Blue-Green Deployment</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class="menu__link" tabindex="0" href="/rabbitmq-website/docs/next/grow-then-shrink-upgrade">Grow-Then-Shrink Upgrade</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class="menu__link" tabindex="0" href="/rabbitmq-website/docs/next/feature-flags">Feature Flags</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class="menu__link" tabindex="0" href="/rabbitmq-website/docs/next/deprecated-features">Deprecated Features</a></li></ul></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/rabbitmq-website/docs/next/snapshots">Snapshots</a></li></ul></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist" href="/rabbitmq-website/docs/next/use-rabbitmq">How to Use RabbitMQ</a><button aria-label="Expand sidebar category &#x27;How to Use RabbitMQ&#x27;" aria-expanded="false" type="button" class="clean-btn menu__caret"></button></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist" href="/rabbitmq-website/docs/next/manage-rabbitmq">How to Manage RabbitMQ</a><button aria-label="Expand sidebar category &#x27;How to Manage RabbitMQ&#x27;" aria-expanded="false" type="button" class="clean-btn menu__caret"></button></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist" href="/rabbitmq-website/docs/next/monitoring">How to Monitor RabbitMQ</a><button aria-label="Expand sidebar category &#x27;How to Monitor RabbitMQ&#x27;" aria-expanded="false" type="button" class="clean-btn menu__caret"></button></div></li></ul></nav></div></div></aside><main class="docMainContainer_TBSr"><div class="container padding-top--md padding-bottom--lg"><div class="row"><div class="col docItemCol_VOVn"><div class="theme-doc-version-banner alert alert--warning margin-bottom--md" role="alert"><div>This is unreleased documentation for <!-- -->RabbitMQ<!-- --> <b>Next</b> version.</div><div class="margin-top--md">For up-to-date documentation, see the <b><a href="/rabbitmq-website/docs/rolling-upgrade">latest version</a></b> (<!-- -->4.1<!-- -->).</div></div><div class="docItemContainer_Djhp"><article><nav class="theme-doc-breadcrumbs breadcrumbsContainer_Z_bl" aria-label="Breadcrumbs"><ul class="breadcrumbs" itemscope="" itemtype="https://schema.org/BreadcrumbList"><li class="breadcrumbs__item"><a aria-label="Home page" class="breadcrumbs__link" href="/rabbitmq-website/"><svg viewBox="0 0 24 24" class="breadcrumbHomeIcon_YNFT"><path d="M10 19v-5h4v5c0 .55.45 1 1 1h3c.55 0 1-.45 1-1v-7h1.7c.46 0 .68-.57.33-.87L12.67 3.6c-.38-.34-.96-.34-1.34 0l-8.36 7.53c-.34.3-.13.87.33.87H5v7c0 .55.45 1 1 1h3c.55 0 1-.45 1-1z" fill="currentColor"></path></svg></a></li><li itemscope="" itemprop="itemListElement" itemtype="https://schema.org/ListItem" class="breadcrumbs__item"><a class="breadcrumbs__link" itemprop="item" href="/rabbitmq-website/docs/next/download"><span itemprop="name">Install and Upgrade</span></a><meta itemprop="position" content="1"></li><li itemscope="" itemprop="itemListElement" itemtype="https://schema.org/ListItem" class="breadcrumbs__item"><a class="breadcrumbs__link" itemprop="item" href="/rabbitmq-website/docs/next/upgrade"><span itemprop="name">Upgrade</span></a><meta itemprop="position" content="2"></li><li itemscope="" itemprop="itemListElement" itemtype="https://schema.org/ListItem" class="breadcrumbs__item breadcrumbs__item--active"><span class="breadcrumbs__link" itemprop="name">Rolling Upgrade</span><meta itemprop="position" content="3"></li></ul></nav><span class="theme-doc-version-badge badge badge--secondary">Version: Next</span><div class="tocCollapsible_ETCw theme-doc-toc-mobile tocMobile_ITEo"><button type="button" class="clean-btn tocCollapsibleButton_TO0P">On this page</button></div><div class="theme-doc-markdown markdown"><header><h1>Rolling (in-place) Upgrade</h1></header><p>Rolling upgrade is a popular upgrade strategy, in which nodes are upgraded
one by one: each node is stopped, upgraded and then started. Upgraded nodes rejoin the cluster,
which temporarily works in a mixed-version mode: some nodes run the old version, some run the new one.</p>
<p>While all nodes have to be restarted during the upgrade, the
cluster as a whole remains available throughout the process
(unless it only has one node, of course).</p>
<div class="theme-admonition theme-admonition-important admonition_xJq3 alert alert--info"><div class="admonitionHeading_Gvgb"><span class="admonitionIcon_Rf37"><svg viewBox="0 0 14 16"><path fill-rule="evenodd" d="M7 2.3c3.14 0 5.7 2.56 5.7 5.7s-2.56 5.7-5.7 5.7A5.71 5.71 0 0 1 1.3 8c0-3.14 2.56-5.7 5.7-5.7zM7 1C3.14 1 0 4.14 0 8s3.14 7 7 7 7-3.14 7-7-3.14-7-7-7zm1 3H6v5h2V4zm0 6H6v2h2v-2z"></path></svg></span>important</div><div class="admonitionContent_BuS1"><p>Rolling upgrades don&#x27;t support skipping versions, except patch releases (for example you <strong>can</strong> upgrade directly
from 3.13.0 to 3.13.7 but you <strong>cannot</strong> upgrade directly from 3.12.x to 4.0). Moreover, for specific upgrades,
additional constraints may apply. Please refer to the <a href="/rabbitmq-website/docs/next/upgrade#rabbitmq-version-upgradability">version upgradability</a> table for more information.</p></div></div>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="before">Before the Upgrade<a href="#before" class="hash-link" aria-label="Direct link to Before the Upgrade" title="Direct link to Before the Upgrade">​</a></h2>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="investigate-if-the-current-and-target-versions-have-a-rolling-upgrade-path">Investigate if the current and target versions have a rolling upgrade path<a href="#investigate-if-the-current-and-target-versions-have-a-rolling-upgrade-path" class="hash-link" aria-label="Direct link to Investigate if the current and target versions have a rolling upgrade path" title="Direct link to Investigate if the current and target versions have a rolling upgrade path">​</a></h3>
<p>Please refer to the <a href="/rabbitmq-website/docs/next/upgrade#rabbitmq-version-upgradability">version upgradability</a> table for information
about the supported upgrade paths.</p>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="check-erlang-version-requirements">Check Erlang Version Requirements<a href="#check-erlang-version-requirements" class="hash-link" aria-label="Direct link to Check Erlang Version Requirements" title="Direct link to Check Erlang Version Requirements">​</a></h3>
<p>Refer to <a href="/rabbitmq-website/docs/next/upgrade#rabbitmq-erlang-version-requirement">Erlang Version Requirements</a>.</p>
<p>If the same Erlang version is supported by both the current and target RabbitMQ versions,
you can leave Erlang as is. However, you can consider upgrading Erlang to the latest
supported version at the same time. Both Erlang and RabbitMQ upgrades require a restart,
so it may be more convenient to do both at the same time.</p>
<p>If the target RabbitMQ version requires a newer Erlang version,
you need to prepare to upgrade Erlang together with RabbitMQ.</p>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="carefully-read-the-release-notes-up-to-the-selected-rabbitmq-version">Carefully Read the Release Notes Up to the Selected RabbitMQ Version<a href="#carefully-read-the-release-notes-up-to-the-selected-rabbitmq-version" class="hash-link" aria-label="Direct link to Carefully Read the Release Notes Up to the Selected RabbitMQ Version" title="Direct link to Carefully Read the Release Notes Up to the Selected RabbitMQ Version">​</a></h3>
<p>The <a href="https://github.com/rabbitmq/rabbitmq-server/releases" target="_blank" rel="noopener noreferrer">release notes</a>
may indicate specific additional upgrade steps. Always consult the release notes
of all versions between the one currently deployed and the target one.</p>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="verify-all-stable-feature-flags-are-enabled">Verify All Stable Feature Flags Are Enabled<a href="#verify-all-stable-feature-flags-are-enabled" class="hash-link" aria-label="Direct link to Verify All Stable Feature Flags Are Enabled" title="Direct link to Verify All Stable Feature Flags Are Enabled">​</a></h3>
<p><a href="/rabbitmq-website/docs/next/feature-flags#how-to-enable-feature-flags">All stable feature flags should be enabled</a> after each upgrade.
Otherwise, the upgrade process is not really complete, since some of the changes are not effective.
If you follow this advice, there should be nothing to do with regards to the feature flags before the upgrade,
since they were all enabled after the previous upgrade.</p>
<p>However, since attempting an upgrade with disabled feature flags may lead to serious issues, it&#x27;s a good
practice to check if all stable feature flags are enabled before starting the upgrade. You can safely
run <code>rabbitmqctl enable_feature_flag all</code> - it will do nothing if all flags are already enabled.</p>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="make-sure-all-package-dependencies-including-erlang-are-available">Make Sure All Package Dependencies (including Erlang) are Available<a href="#make-sure-all-package-dependencies-including-erlang-are-available" class="hash-link" aria-label="Direct link to Make Sure All Package Dependencies (including Erlang) are Available" title="Direct link to Make Sure All Package Dependencies (including Erlang) are Available">​</a></h3>
<p>If you are using Debian or RPM packages, you must ensure
that all dependencies are available. In particular, the
correct version of Erlang. You may have to setup additional
third-party package repositories to achieve that.</p>
<p>Please read recommendations for
<a href="/rabbitmq-website/docs/next/which-erlang#debian">Debian-based</a> and
<a href="/rabbitmq-website/docs/next/which-erlang#redhat">RPM-based</a> distributions to find the
appropriate repositories for Erlang.</p>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="assess-cluster-health">Assess Cluster Health<a href="#assess-cluster-health" class="hash-link" aria-label="Direct link to Assess Cluster Health" title="Direct link to Assess Cluster Health">​</a></h3>
<p>Make sure nodes are healthy and there are no <a href="/rabbitmq-website/docs/next/partitions">network partition</a>
or <a href="/rabbitmq-website/docs/next/alarms">disk or memory alarms</a> in effect.</p>
<p>RabbitMQ management UI, CLI tools or HTTP API can be used for
assessing the health of the system.</p>
<p>The overview page in the management UI displays effective RabbitMQ
and Erlang versions, multiple cluster-wide metrics and rates. From
this page ensure that all nodes are running and they are all &quot;green&quot;
(w.r.t. file descriptors, memory, disk space, and so on).</p>
<p>We recommend recording the number of durable queues, the number
of messages they hold and other pieces of information about the
topology that are relevant. This data will help verify that the
system operates within reasonable parameters after the upgrade.</p>
<p>Use <a href="/rabbitmq-website/docs/next/monitoring#health-checks">node health checks</a> to
vet individual nodes.</p>
<p>Queues in flow state or blocked/blocking connections might not be a problem,
depending on your workload. It&#x27;s up to you to determine if this is
a normal situation or if the cluster is under unexpected load and
thus, decide if it&#x27;s safe to continue with the upgrade.</p>
<p>However, if there are queues in an undefined state (a.k.a. <code>NaN</code> or
&quot;ghost&quot; queues), you should first start by understanding what is
wrong before starting an upgrade.</p>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="ensure-cluster-has-the-capacity-for-upgrading">Ensure Cluster Has the Capacity for Upgrading<a href="#ensure-cluster-has-the-capacity-for-upgrading" class="hash-link" aria-label="Direct link to Ensure Cluster Has the Capacity for Upgrading" title="Direct link to Ensure Cluster Has the Capacity for Upgrading">​</a></h3>
<p>Please refer to <a href="/rabbitmq-website/docs/next/upgrade#system-resource-usage">changes in system resource usage</a>
for information about how the upgrade process can affect resource usage.</p>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="perform-the-upgrade">Perform the Upgrade<a href="#perform-the-upgrade" class="hash-link" aria-label="Direct link to Perform the Upgrade" title="Direct link to Perform the Upgrade">​</a></h2>
<p>The main part of the upgrade process is performed by stopping, upgrading and starting each node one by one.
The following steps should be performed for all nodes.</p>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="stop-the-node">Stop the Node<a href="#stop-the-node" class="hash-link" aria-label="Direct link to Stop the Node" title="Direct link to Stop the Node">​</a></h3>
<p>The exact way to stop a node depends on how it was started.</p>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="take-a-backup">Take a Backup<a href="#take-a-backup" class="hash-link" aria-label="Direct link to Take a Backup" title="Direct link to Take a Backup">​</a></h3>
<p>Optionally, when the node is stopped, you can <a href="/rabbitmq-website/docs/next/backup">backup</a> its data folder.</p>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="upgrade-the-node">Upgrade the Node<a href="#upgrade-the-node" class="hash-link" aria-label="Direct link to Upgrade the Node" title="Direct link to Upgrade the Node">​</a></h3>
<p>Install the new version of RabbitMQ and other packages if necessary.</p>
<p>Make sure you have an Erlang version compatible with the new RabbitMQ version.</p>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="start-the-node">Start the Node<a href="#start-the-node" class="hash-link" aria-label="Direct link to Start the Node" title="Direct link to Start the Node">​</a></h3>
<p>Start the node and verify that it joins the cluster.</p>
<p>You can perform the following checks to ensure that the node started and rejoined
the cluster successfully:</p>
<ul>
<li>run <code>rabbitmqctl cluster_status</code> and verify the output<!-- -->
<ul>
<li>the upgraded node should be listed as running</li>
<li>there should be no network partitions nor active alarms</li>
</ul>
</li>
<li>check the management UI<!-- -->
<ul>
<li>all nodes should be listed on the main page</li>
<li>resource usage should be within acceptable limits</li>
</ul>
</li>
<li>check the logs<!-- -->
<ul>
<li>there should be no errors</li>
</ul>
</li>
</ul>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="after">After the Upgrade<a href="#after" class="hash-link" aria-label="Direct link to After the Upgrade" title="Direct link to After the Upgrade">​</a></h2>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="verify-that-the-upgrade-has-succeeded">Verify that the Upgrade Has Succeeded<a href="#verify-that-the-upgrade-has-succeeded" class="hash-link" aria-label="Direct link to Verify that the Upgrade Has Succeeded" title="Direct link to Verify that the Upgrade Has Succeeded">​</a></h3>
<p>Like you did before the upgrade, verify the health and <a href="/rabbitmq-website/docs/next/monitoring">monitoring data</a> to
make sure all cluster nodes are in good shape and the service is running again.</p>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="enable-ff-after-upgrade">Enable New Feature Flags<a href="#enable-ff-after-upgrade" class="hash-link" aria-label="Direct link to Enable New Feature Flags" title="Direct link to Enable New Feature Flags">​</a></h3>
<p>Once all the nodes are upgraded and the cluster is healthy,
<a href="/rabbitmq-website/docs/next/feature-flags#how-to-enable-feature-flags">enable all stable feature flags</a>.
If the new version doesn&#x27;t provide any new feature flags, you can still run
<code>rabbitmqctl enable_feature_flag all</code> - it will simply do nothing.</p>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="example">Real-world Example<a href="#example" class="hash-link" aria-label="Direct link to Real-world Example" title="Direct link to Real-world Example">​</a></h2>
<p>Rolling upgrade strategy is not specific to any particular deployment tooling
or infrastructure. Many orchestration tools have a built-in concept of rolling upgrades
with hooks allowing to perform custom actions before and after each node is upgraded.</p>
<p>One such orchestration tool is Kubernetes. It can perform a <a href="https://kubernetes.io/docs/tutorials/stateful-application/basic-stateful-set/#rolling-update" target="_blank" rel="noopener noreferrer">rolling update</a>
of a <code>StatefulSet</code>. Let&#x27;s walk through what happens when you want to upgrade RabbitMQ
deployed to Kubernetes using the <a href="/rabbitmq-website/kubernetes/operator/operator-overview">Cluster Operator</a>.
Let&#x27;s assume the cluster has three nodes, which means the nodes are called <code>server-0</code>, <code>server-1</code>, and <code>server-2</code>
(there would be a prefix with the name of your cluster, but that&#x27;s irrelevant for this example).</p>
<ol>
<li>Make sure the existing cluster is running RabbitMQ 3.13 and has all stable feature flags enabled</li>
<li>Update the <code>RabbitmqCluster</code> object with the new image (eg. change from <code>rabbitmq:3.13.7-management</code> to <code>rabbitmq:4.0.5-management</code>)</li>
<li>The Cluster Operator will update the <code>StatefulSet</code> object with the new image, triggering the rolling upgrade mechanism built-in to Kubernetes</li>
<li>Kubernetes will stop <code>server-2</code> (it always goes from the highest index to the lowest)<!-- -->
<ul>
<li>The pod will check if it can safely stop, by calling <code>rabbitmq-upgrade await_online_quorum_plus_one</code></li>
<li>When that command exits with a zero status, the pod will stop</li>
</ul>
</li>
<li>Kubernetes will download and start the new OCI image. Effectively, it upgraded the packages of RabbitMQ, Erlang and other system dependencies</li>
<li><code>server-2</code> starts and <a href="/rabbitmq-website/docs/next/feature-flags#version-compatibility">attempts to rejoin the cluster</a>
<ul>
<li>it has the same feature flags enabled as it had before it stopped (the state of feature flags is stored in a file)</li>
<li>feature flags that were introduced in RabbitMQ 4.0 or <strong>not</strong> enabled at this point</li>
<li>therefore, the upgraded node can join the cluster</li>
</ul>
</li>
<li>Once the node starts, it synchronizes its metadata (eg. becomes aware of queues declared while it was down), and starts quorum
queue and stream members, which should quickly catch up with the rest of the cluster (any messages published while the node was down
are replicated to it, etc)</li>
<li>Once <code>server-2</code> is running, Kubernetes stops <code>server-1</code> and the process repeats</li>
<li>Once <code>server-0</code> is upgraded and running, all nodes are running on the new version</li>
<li>You can now enable new feature flags and <a href="/rabbitmq-website/docs/next/upgrade#rebalance">rebalance the cluster</a></li>
</ol>
<p>While the process has many steps (and we skipped some details), you only had to change the <code>image</code> value,
wait a few minutes and then ran two commands to enable new feature flags and rebalance the cluster.</p>
<p>When performing a rolling upgrade without Kubernetes, you need to go through the same steps - you just have
to do them manually or using some other automation. Using OCI images further simplifies the process since the image
contains the new RabbitMQ version already with a compatible Erlang version and other dependencies.</p></div><footer class="theme-doc-footer docusaurus-mt-lg"><div class="row margin-top--sm theme-doc-footer-edit-meta-row"><div class="col"><a href="https://github.com/rabbitmq/rabbitmq-website/tree/main/docs/rolling-upgrade.md" target="_blank" rel="noopener noreferrer" class="theme-edit-this-page"><svg fill="currentColor" height="20" width="20" viewBox="0 0 40 40" class="iconEdit_Z9Sw" aria-hidden="true"><g><path d="m34.5 11.7l-3 3.1-6.3-6.3 3.1-3q0.5-0.5 1.2-0.5t1.1 0.5l3.9 3.9q0.5 0.4 0.5 1.1t-0.5 1.2z m-29.5 17.1l18.4-18.5 6.3 6.3-18.4 18.4h-6.3v-6.2z"></path></g></svg>Edit this page</a></div><div class="col lastUpdated_JAkA"></div></div></footer></article><nav class="pagination-nav docusaurus-mt-lg" aria-label="Docs pages"><a class="pagination-nav__link pagination-nav__link--prev" href="/rabbitmq-website/docs/next/upgrade"><div class="pagination-nav__sublabel">Previous</div><div class="pagination-nav__label">Upgrading RabbitMQ</div></a><a class="pagination-nav__link pagination-nav__link--next" href="/rabbitmq-website/docs/next/blue-green-upgrade"><div class="pagination-nav__sublabel">Next</div><div class="pagination-nav__label">Blue-Green Deployment</div></a></nav></div></div><div class="col col--3"><div class="tableOfContents_bqdL thin-scrollbar theme-doc-toc-desktop"><ul class="table-of-contents table-of-contents__left-border"><li><a href="#before" class="table-of-contents__link toc-highlight">Before the Upgrade</a><ul><li><a href="#investigate-if-the-current-and-target-versions-have-a-rolling-upgrade-path" class="table-of-contents__link toc-highlight">Investigate if the current and target versions have a rolling upgrade path</a></li><li><a href="#check-erlang-version-requirements" class="table-of-contents__link toc-highlight">Check Erlang Version Requirements</a></li><li><a href="#carefully-read-the-release-notes-up-to-the-selected-rabbitmq-version" class="table-of-contents__link toc-highlight">Carefully Read the Release Notes Up to the Selected RabbitMQ Version</a></li><li><a href="#verify-all-stable-feature-flags-are-enabled" class="table-of-contents__link toc-highlight">Verify All Stable Feature Flags Are Enabled</a></li><li><a href="#make-sure-all-package-dependencies-including-erlang-are-available" class="table-of-contents__link toc-highlight">Make Sure All Package Dependencies (including Erlang) are Available</a></li><li><a href="#assess-cluster-health" class="table-of-contents__link toc-highlight">Assess Cluster Health</a></li><li><a href="#ensure-cluster-has-the-capacity-for-upgrading" class="table-of-contents__link toc-highlight">Ensure Cluster Has the Capacity for Upgrading</a></li></ul></li><li><a href="#perform-the-upgrade" class="table-of-contents__link toc-highlight">Perform the Upgrade</a><ul><li><a href="#stop-the-node" class="table-of-contents__link toc-highlight">Stop the Node</a></li><li><a href="#take-a-backup" class="table-of-contents__link toc-highlight">Take a Backup</a></li><li><a href="#upgrade-the-node" class="table-of-contents__link toc-highlight">Upgrade the Node</a></li><li><a href="#start-the-node" class="table-of-contents__link toc-highlight">Start the Node</a></li></ul></li><li><a href="#after" class="table-of-contents__link toc-highlight">After the Upgrade</a><ul><li><a href="#verify-that-the-upgrade-has-succeeded" class="table-of-contents__link toc-highlight">Verify that the Upgrade Has Succeeded</a></li><li><a href="#enable-ff-after-upgrade" class="table-of-contents__link toc-highlight">Enable New Feature Flags</a></li></ul></li><li><a href="#example" class="table-of-contents__link toc-highlight">Real-world Example</a></li></ul></div></div></div></div></main></div></div></div><footer class="footer footer--dark"><div class="container container-fluid"><div class="row footer__links"><div class="col footer__col"><div class="footer__title">Learn about RabbitMQ</div><ul class="footer__items clean-list"><li class="footer__item"><a class="footer__link-item" href="/rabbitmq-website/tutorials">Getting Started</a></li><li class="footer__item"><a class="footer__link-item" href="/rabbitmq-website/docs">Documentation</a></li><li class="footer__item"><a class="footer__link-item" href="/rabbitmq-website/blog">Blog</a></li></ul></div><div class="col footer__col"><div class="footer__title">Reach out to the RabbitMQ team</div><ul class="footer__items clean-list"><li class="footer__item"><a href="https://github.com/rabbitmq" target="_blank" rel="noopener noreferrer" class="footer__link-item">GitHub<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_nPIU"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a></li><li class="footer__item"><a href="https://github.com/rabbitmq/rabbitmq-server/discussions" target="_blank" rel="noopener noreferrer" class="footer__link-item">GitHub Discussions<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_nPIU"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a></li><li class="footer__item"><a class="footer__link-item" href="/rabbitmq-website/contact?utm_source=rmq_release-information_tableheader&amp;utm_medium=rmq_website&amp;utm_campaign=tanzu">Long Term Commercial Support</a></li><li class="footer__item"><a class="footer__link-item" href="/rabbitmq-website/contact">Contact Us</a></li><li class="footer__item"><a href="https://www.rabbitmq.com/discord" target="_blank" rel="noopener noreferrer" class="footer__link-item">Discord<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_nPIU"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a></li></ul></div><div class="col footer__col"><div class="footer__title">Broadcom</div><ul class="footer__items clean-list"><li class="footer__item"><a href="https://tanzu.vmware.com/" target="_blank" rel="noopener noreferrer" class="footer__link-item">VMware Tanzu<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_nPIU"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a></li><li class="footer__item"><a href="https://www.vmware.com/help/legal.html" target="_blank" rel="noopener noreferrer" class="footer__link-item">Terms of Use<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_nPIU"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a></li><li class="footer__item"><a href="https://www.vmware.com/help/privacy.html" target="_blank" rel="noopener noreferrer" class="footer__link-item">Privacy<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_nPIU"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a></li><li class="footer__item"><a class="footer__link-item" href="/rabbitmq-website/trademark-guidelines">Trademark Guidelines</a></li><li class="footer__item"><a href="https://www.vmware.com/help/privacy/california-privacy-rights.html" target="_blank" rel="noopener noreferrer" class="footer__link-item">Your California Privacy Rights<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_nPIU"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a></li><li class="footer__item"><a class="footer__link-item ot-sdk-show-settings">Cookie Settings</a></li></ul></div></div><div class="footer__bottom text--center"><div class="footer__copyright">Copyright © 2005-2025 Broadcom. All Rights Reserved. The term "Broadcom" refers to Broadcom Inc. and/or its subsidiaries.</div></div></div></footer></div>
</body>
</html>
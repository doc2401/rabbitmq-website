<!doctype html>
<html lang="en" dir="ltr" class="docs-wrapper plugin-docs plugin-id-default docs-version-current docs-doc-page docs-doc-id-ssl/index" data-has-hydrated="false">
<head>
<meta charset="UTF-8">
<meta name="generator" content="Docusaurus v3.7.0">
<title data-rh="true">TLS Support | RabbitMQ</title><meta data-rh="true" name="viewport" content="width=device-width,initial-scale=1"><meta data-rh="true" name="twitter:card" content="summary_large_image"><meta data-rh="true" property="og:image" content="https://www.rabbitmq.com/rabbitmq-website/img/rabbitmq-social-media-card.svg"><meta data-rh="true" name="twitter:image" content="https://www.rabbitmq.com/rabbitmq-website/img/rabbitmq-social-media-card.svg"><meta data-rh="true" property="og:url" content="https://www.rabbitmq.com/rabbitmq-website/docs/next/ssl"><meta data-rh="true" property="og:locale" content="en"><meta data-rh="true" name="docusaurus_locale" content="en"><meta data-rh="true" name="docsearch:language" content="en"><meta data-rh="true" name="docusaurus_version" content="current"><meta data-rh="true" name="docusaurus_tag" content="docs-default-current"><meta data-rh="true" name="docsearch:version" content="current"><meta data-rh="true" name="docsearch:docusaurus_tag" content="docs-default-current"><meta data-rh="true" property="og:title" content="TLS Support | RabbitMQ"><meta data-rh="true" name="description" content="&lt;!--"><meta data-rh="true" property="og:description" content="&lt;!--"><link data-rh="true" rel="icon" href="/rabbitmq-website/img/rabbitmq-logo.svg"><link data-rh="true" rel="canonical" href="https://www.rabbitmq.com/rabbitmq-website/docs/next/ssl"><link data-rh="true" rel="alternate" href="https://www.rabbitmq.com/rabbitmq-website/docs/next/ssl" hreflang="en"><link data-rh="true" rel="alternate" href="https://www.rabbitmq.com/rabbitmq-website/docs/next/ssl" hreflang="x-default"><link data-rh="true" rel="preconnect" href="https://H10VQIW16Y-dsn.algolia.net" crossorigin="anonymous"><link rel="alternate" type="application/rss+xml" href="/rabbitmq-website/blog/rss.xml" title="RabbitMQ RSS Feed">
<link rel="alternate" type="application/atom+xml" href="/rabbitmq-website/blog/atom.xml" title="RabbitMQ Atom Feed">




<link rel="search" type="application/opensearchdescription+xml" title="RabbitMQ" href="/rabbitmq-website/opensearch.xml">







<link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Raleway:400,700">
<script src="https://cdn.cookielaw.org/scripttemplates/otSDKStub.js" data-domain-script="018ee308-473e-754f-b0c2-cbe82d25512f"></script>
<script>function OptanonWrapper(){}</script>
<script>function setGTM(e,t,o,n,r){e[n]=e[n]||[],e[n].push({"gtm.start":(new Date).getTime(),event:"gtm.js"});var i=t.getElementsByTagName(o)[0],a=t.createElement(o),s="dataLayer"!=n?"&l="+n:"";a.async=!0,a.src="https://www.googletagmanager.com/gtm.js?id="+r+s,i.parentNode.insertBefore(a,i)}var timer;function waitForOnetrustActiveGroups(){document.cookie.indexOf("OptanonConsent")>-1&&document.cookie.indexOf("groups=")>-1?(clearTimeout(timer),setGTM(window,document,"script","dataLayer","GTM-TT84L8K")):timer=setTimeout(waitForOnetrustActiveGroups,250)}document.cookie.indexOf("OptanonConsent")>-1&&document.cookie.indexOf("groups=")>-1?setGTM(window,document,"script","dataLayer","GTM-TT84L8K"):waitForOnetrustActiveGroups()</script><link rel="stylesheet" href="/rabbitmq-website/styles.css">
<script src="/rabbitmq-website/runtime~main.js" defer="defer"></script>
<script src="/rabbitmq-website/main.js" defer="defer"></script>
</head>
<body class="navigation-with-keyboard">
<script>!function(){function t(t){document.documentElement.setAttribute("data-theme",t)}var e=function(){try{return new URLSearchParams(window.location.search).get("docusaurus-theme")}catch(t){}}()||function(){try{return window.localStorage.getItem("theme")}catch(t){}}();null!==e?t(e):window.matchMedia("(prefers-color-scheme: dark)").matches?t("dark"):(window.matchMedia("(prefers-color-scheme: light)").matches,t("light"))}(),function(){try{const n=new URLSearchParams(window.location.search).entries();for(var[t,e]of n)if(t.startsWith("docusaurus-data-")){var a=t.replace("docusaurus-data-","data-");document.documentElement.setAttribute(a,e)}}catch(t){}}(),document.documentElement.setAttribute("data-announcement-bar-initially-dismissed",function(){try{return"true"===localStorage.getItem("docusaurus.announcement.dismiss")}catch(t){}return!1}())</script><div id="__docusaurus"><div role="region" aria-label="Skip to main content"><a class="skipToContent_fXgn" href="#__docusaurus_skipToContent_fallback">Skip to main content</a></div><div class="announcementBar_mb4j" style="background-color:var(--ifm-color-primary-contrast-background);color:var(--ifm-font-color-base)" role="banner"><div class="announcementBarPlaceholder_vyr4"></div><div class="content_knG7 announcementBarContent_xLdY"><strong style="font-size: var(--ifm-h4-font-size);"><a href="https://github.com/rabbitmq/rabbitmq-server/releases/tag/v4.1.0">RabbitMQ 4.1.0 is out</a></strong></div><button type="button" aria-label="Close" class="clean-btn close closeButton_CVFx announcementBarClose_gvF7"><svg viewBox="0 0 15 15" width="14" height="14"><g stroke="currentColor" stroke-width="3.1"><path d="M.75.75l13.5 13.5M14.25.75L.75 14.25"></path></g></svg></button></div><nav aria-label="Main" class="navbar navbar--fixed-top"><div class="navbar__inner"><div class="navbar__items"><button aria-label="Toggle navigation bar" aria-expanded="false" class="navbar__toggle clean-btn" type="button"><svg width="30" height="30" viewBox="0 0 30 30" aria-hidden="true"><path stroke="currentColor" stroke-linecap="round" stroke-miterlimit="10" stroke-width="2" d="M4 7h22M4 15h22M4 23h22"></path></svg></button><a class="navbar__brand" href="/rabbitmq-website/"><div class="navbar__logo"><img src="/rabbitmq-website/img/rabbitmq-logo-with-name.svg" alt="RabbitMQ" class="themedComponent_mlkZ themedComponent--light_NVdE"><img src="/rabbitmq-website/img/rabbitmq-logo-with-name.svg" alt="RabbitMQ" class="themedComponent_mlkZ themedComponent--dark_xIcU"></div></a><a class="navbar__item navbar__link" href="/rabbitmq-website/tutorials">Getting Started</a><a aria-current="page" class="navbar__item navbar__link navbar__link--active" href="/rabbitmq-website/docs/next">Docs</a><a class="navbar__item navbar__link" href="/rabbitmq-website/blog">Blog</a><a class="navbar__item navbar__link" href="/rabbitmq-website/contact">Support</a></div><div class="navbar__items navbar__items--right"><div class="navbar__item dropdown dropdown--hoverable dropdown--right"><a aria-current="page" class="navbar__link active" aria-haspopup="true" aria-expanded="false" role="button" href="/rabbitmq-website/docs/next/ssl">Next</a><ul class="dropdown__menu"><li class=""><strong>Release series</strong></li><li><a aria-current="page" class="dropdown__link dropdown__link--active" href="/rabbitmq-website/docs/next/ssl">Next</a></li><li><a class="dropdown__link" href="/rabbitmq-website/docs/ssl">4.1</a></li><li><a class="dropdown__link" href="/rabbitmq-website/docs/4.0/ssl">4.0</a></li><li><a class="dropdown__link" href="/rabbitmq-website/docs/3.13/ssl">3.13</a></li><li><a href="https://v3-12.rabbitmq.com/documentation.html" target="_blank" rel="noopener noreferrer" class="dropdown__link">3.12<svg width="12" height="12" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_nPIU"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a></li><li><a class="dropdown__link" href="/rabbitmq-website/release-information">Release Information</a></li></ul></div><a href="https://github.com/rabbitmq/rabbitmq-website" target="_blank" rel="noopener noreferrer" class="navbar__item navbar__link">GitHub<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_nPIU"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a><div class="toggle_vylO colorModeToggle_DEke"><button class="clean-btn toggleButton_gllP toggleButtonDisabled_aARS" type="button" disabled="" title="Switch between dark and light mode (currently light mode)" aria-label="Switch between dark and light mode (currently light mode)" aria-live="polite" aria-pressed="false"><svg viewBox="0 0 24 24" width="24" height="24" class="lightToggleIcon_pyhR"><path fill="currentColor" d="M12,9c1.65,0,3,1.35,3,3s-1.35,3-3,3s-3-1.35-3-3S10.35,9,12,9 M12,7c-2.76,0-5,2.24-5,5s2.24,5,5,5s5-2.24,5-5 S14.76,7,12,7L12,7z M2,13l2,0c0.55,0,1-0.45,1-1s-0.45-1-1-1l-2,0c-0.55,0-1,0.45-1,1S1.45,13,2,13z M20,13l2,0c0.55,0,1-0.45,1-1 s-0.45-1-1-1l-2,0c-0.55,0-1,0.45-1,1S19.45,13,20,13z M11,2v2c0,0.55,0.45,1,1,1s1-0.45,1-1V2c0-0.55-0.45-1-1-1S11,1.45,11,2z M11,20v2c0,0.55,0.45,1,1,1s1-0.45,1-1v-2c0-0.55-0.45-1-1-1C11.45,19,11,19.45,11,20z M5.99,4.58c-0.39-0.39-1.03-0.39-1.41,0 c-0.39,0.39-0.39,1.03,0,1.41l1.06,1.06c0.39,0.39,1.03,0.39,1.41,0s0.39-1.03,0-1.41L5.99,4.58z M18.36,16.95 c-0.39-0.39-1.03-0.39-1.41,0c-0.39,0.39-0.39,1.03,0,1.41l1.06,1.06c0.39,0.39,1.03,0.39,1.41,0c0.39-0.39,0.39-1.03,0-1.41 L18.36,16.95z M19.42,5.99c0.39-0.39,0.39-1.03,0-1.41c-0.39-0.39-1.03-0.39-1.41,0l-1.06,1.06c-0.39,0.39-0.39,1.03,0,1.41 s1.03,0.39,1.41,0L19.42,5.99z M7.05,18.36c0.39-0.39,0.39-1.03,0-1.41c-0.39-0.39-1.03-0.39-1.41,0l-1.06,1.06 c-0.39,0.39-0.39,1.03,0,1.41s1.03,0.39,1.41,0L7.05,18.36z"></path></svg><svg viewBox="0 0 24 24" width="24" height="24" class="darkToggleIcon_wfgR"><path fill="currentColor" d="M9.37,5.51C9.19,6.15,9.1,6.82,9.1,7.5c0,4.08,3.32,7.4,7.4,7.4c0.68,0,1.35-0.09,1.99-0.27C17.45,17.19,14.93,19,12,19 c-3.86,0-7-3.14-7-7C5,9.07,6.81,6.55,9.37,5.51z M12,3c-4.97,0-9,4.03-9,9s4.03,9,9,9s9-4.03,9-9c0-0.46-0.04-0.92-0.1-1.36 c-0.98,1.37-2.58,2.26-4.4,2.26c-2.98,0-5.4-2.42-5.4-5.4c0-1.81,0.89-3.42,2.26-4.4C12.92,3.04,12.46,3,12,3L12,3z"></path></svg></button></div><div class="navbarSearchContainer_Bca1"><button type="button" class="DocSearch DocSearch-Button" aria-label="Search (Command+K)"><span class="DocSearch-Button-Container"><svg width="20" height="20" class="DocSearch-Search-Icon" viewBox="0 0 20 20" aria-hidden="true"><path d="M14.386 14.386l4.0877 4.0877-4.0877-4.0877c-2.9418 2.9419-7.7115 2.9419-10.6533 0-2.9419-2.9418-2.9419-7.7115 0-10.6533 2.9418-2.9419 7.7115-2.9419 10.6533 0 2.9419 2.9418 2.9419 7.7115 0 10.6533z" stroke="currentColor" fill="none" fill-rule="evenodd" stroke-linecap="round" stroke-linejoin="round"></path></svg><span class="DocSearch-Button-Placeholder">Search</span></span><span class="DocSearch-Button-Keys"></span></button></div></div></div><div role="presentation" class="navbar-sidebar__backdrop"></div></nav><div id="__docusaurus_skipToContent_fallback" class="main-wrapper mainWrapper_z2l0"><div class="docsWrapper_hBAB"><button aria-label="Scroll back to top" class="clean-btn theme-back-to-top-button backToTopButton_sjWU" type="button"></button><div class="docRoot_UBD9"><aside class="theme-doc-sidebar-container docSidebarContainer_YfHR"><div class="sidebarViewport_aRkj"><div class="sidebar_njMd"><nav aria-label="Docs sidebar" class="menu thin-scrollbar menu_SIkG menuWithAnnouncementBar_GW3s"><ul class="theme-doc-sidebar-menu menu__list"><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/rabbitmq-website/docs/next">Introduction</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/rabbitmq-website/release-information">Release Information</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/rabbitmq-website/tutorials">Getting Started</a></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist" href="/rabbitmq-website/docs/next/download">Install and Upgrade</a><button aria-label="Expand sidebar category &#x27;Install and Upgrade&#x27;" aria-expanded="false" type="button" class="clean-btn menu__caret"></button></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist" href="/rabbitmq-website/docs/next/use-rabbitmq">How to Use RabbitMQ</a><button aria-label="Expand sidebar category &#x27;How to Use RabbitMQ&#x27;" aria-expanded="false" type="button" class="clean-btn menu__caret"></button></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--active" href="/rabbitmq-website/docs/next/manage-rabbitmq">How to Manage RabbitMQ</a><button aria-label="Collapse sidebar category &#x27;How to Manage RabbitMQ&#x27;" aria-expanded="true" type="button" class="clean-btn menu__caret"></button></div><ul style="display:block;overflow:visible;height:auto" class="menu__list"><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/rabbitmq-website/docs/next/cli">CLI</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/rabbitmq-website/docs/next/configure">Configuration</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/rabbitmq-website/docs/next/relocate">File and Directory Locations</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/rabbitmq-website/docs/next/logging">Logging</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/rabbitmq-website/docs/next/vhosts">Virtual Hosts</a></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-2 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist" tabindex="0" href="/rabbitmq-website/docs/next/access-control"> Authentication and Authorization</a><button aria-label="Expand sidebar category &#x27; Authentication and Authorization&#x27;" aria-expanded="false" type="button" class="clean-btn menu__caret"></button></div></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/rabbitmq-website/docs/next/parameters">Policies and Runtime Parameters</a></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-2 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist" tabindex="0" href="/rabbitmq-website/docs/next/metadata-store">Metadata store</a><button aria-label="Expand sidebar category &#x27;Metadata store&#x27;" aria-expanded="false" type="button" class="clean-btn menu__caret"></button></div></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/rabbitmq-website/docs/next/definitions">Schema Definitions</a></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-2 menu__list-item"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--active" tabindex="0" href="/rabbitmq-website/docs/next/networking">Networking</a><button aria-label="Collapse sidebar category &#x27;Networking&#x27;" aria-expanded="true" type="button" class="clean-btn menu__caret"></button></div><ul style="display:block;overflow:visible;height:auto" class="menu__list"><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class="menu__link" tabindex="0" href="/rabbitmq-website/docs/next/nettick">Net Tick Time</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class="menu__link menu__link--active" aria-current="page" tabindex="0" href="/rabbitmq-website/docs/next/ssl">TLS Support</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class="menu__link" tabindex="0" href="/rabbitmq-website/docs/next/troubleshooting-networking">Troubleshooting Connectivity</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class="menu__link" tabindex="0" href="/rabbitmq-website/docs/next/troubleshooting-ssl">Troubleshooting TLS</a></li></ul></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-2 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist" tabindex="0" href="/rabbitmq-website/docs/next/clustering">Clustering</a><button aria-label="Expand sidebar category &#x27;Clustering&#x27;" aria-expanded="false" type="button" class="clean-btn menu__caret"></button></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-2 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret" role="button" aria-expanded="false" tabindex="0" href="/rabbitmq-website/docs/next/memory-use">Resource Management</a></div></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/rabbitmq-website/docs/next/backup">Backup and Restore</a></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-2 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret" role="button" aria-expanded="false" tabindex="0" href="/rabbitmq-website/docs/next/runtime">Tuning</a></div></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/rabbitmq-website/docs/next/production-checklist">Deployment Guidelines</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/rabbitmq-website/kubernetes/operator/operator-overview">RabbitMQ on Kubernetes</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/rabbitmq-website/docs/next/troubleshooting">Troubleshooting RabbitMQ</a></li></ul></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist" href="/rabbitmq-website/docs/next/monitoring">How to Monitor RabbitMQ</a><button aria-label="Expand sidebar category &#x27;How to Monitor RabbitMQ&#x27;" aria-expanded="false" type="button" class="clean-btn menu__caret"></button></div></li></ul></nav></div></div></aside><main class="docMainContainer_TBSr"><div class="container padding-top--md padding-bottom--lg"><div class="row"><div class="col docItemCol_VOVn"><div class="theme-doc-version-banner alert alert--warning margin-bottom--md" role="alert"><div>This is unreleased documentation for <!-- -->RabbitMQ<!-- --> <b>Next</b> version.</div><div class="margin-top--md">For up-to-date documentation, see the <b><a href="/rabbitmq-website/docs/ssl">latest version</a></b> (<!-- -->4.1<!-- -->).</div></div><div class="docItemContainer_Djhp"><article><nav class="theme-doc-breadcrumbs breadcrumbsContainer_Z_bl" aria-label="Breadcrumbs"><ul class="breadcrumbs" itemscope="" itemtype="https://schema.org/BreadcrumbList"><li class="breadcrumbs__item"><a aria-label="Home page" class="breadcrumbs__link" href="/rabbitmq-website/"><svg viewBox="0 0 24 24" class="breadcrumbHomeIcon_YNFT"><path d="M10 19v-5h4v5c0 .55.45 1 1 1h3c.55 0 1-.45 1-1v-7h1.7c.46 0 .68-.57.33-.87L12.67 3.6c-.38-.34-.96-.34-1.34 0l-8.36 7.53c-.34.3-.13.87.33.87H5v7c0 .55.45 1 1 1h3c.55 0 1-.45 1-1z" fill="currentColor"></path></svg></a></li><li itemscope="" itemprop="itemListElement" itemtype="https://schema.org/ListItem" class="breadcrumbs__item"><a class="breadcrumbs__link" itemprop="item" href="/rabbitmq-website/docs/next/manage-rabbitmq"><span itemprop="name">How to Manage RabbitMQ</span></a><meta itemprop="position" content="1"></li><li itemscope="" itemprop="itemListElement" itemtype="https://schema.org/ListItem" class="breadcrumbs__item"><a class="breadcrumbs__link" itemprop="item" href="/rabbitmq-website/docs/next/networking"><span itemprop="name">Networking</span></a><meta itemprop="position" content="2"></li><li itemscope="" itemprop="itemListElement" itemtype="https://schema.org/ListItem" class="breadcrumbs__item breadcrumbs__item--active"><span class="breadcrumbs__link" itemprop="name">TLS Support</span><meta itemprop="position" content="3"></li></ul></nav><span class="theme-doc-version-badge badge badge--secondary">Version: Next</span><div class="tocCollapsible_ETCw theme-doc-toc-mobile tocMobile_ITEo"><button type="button" class="clean-btn tocCollapsibleButton_TO0P">On this page</button></div><div class="theme-doc-markdown markdown"><header><h1>TLS Support</h1></header>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="overview">Table of Contents<a href="#overview" class="hash-link" aria-label="Direct link to Table of Contents" title="Direct link to Table of Contents">​</a></h2>
<p>RabbitMQ has inbuilt support for TLS. This includes client connections and popular plugins, where applicable,
such as <a href="/rabbitmq-website/docs/next/federation">Federation links</a>. It is also possible to use TLS
to <a href="/rabbitmq-website/docs/next/clustering-ssl">encrypt inter-node connections in clusters</a>.</p>
<p>This guide covers various topics related to TLS in RabbitMQ, with a focus on client
connections:</p>
<ul>
<li>Two <a href="#tls-connectivity-options">ways of using TLS</a> for client connections: direct or via a TLS terminating proxy</li>
<li><a href="#erlang-otp-requirements">Erlang/OTP requirements</a> for TLS support</li>
<li><a href="#enabling-tls">Enabling TLS</a> in RabbitMQ</li>
<li>How to generate self-signed certificates for development and QA environments <a href="#automated-certificate-generation">with tls-gen</a> or <a href="#manual-certificate-generation">manually</a></li>
<li>TLS configuration in <a href="#java-client">Java</a> and <a href="#dotnet-client">.NET</a> clients</li>
<li><a href="#peer-verification">Peer (certificate chain) verification</a> of client connections or mutual (&quot;mTLS&quot;)</li>
<li>Public <a href="#key-usage">key usage extensions</a> relevant to RabbitMQ</li>
<li>How to control what <a href="#tls-versions">TLS version</a> and <a href="#cipher-suites">cipher suite</a> are enabled</li>
<li><a href="#tls1.3">TLSv1.3</a> support</li>
<li>Tools that can be used to <a href="#tls-evaluation-tools">evaluate a TLS setup</a></li>
<li><a href="#rotation">Certificate and key rotation</a></li>
<li>The <a href="#trust-store-plugin">trust store plugin</a> for environments where trusted certificates changes frequently</li>
<li>Known <a href="#major-vulnerabilities">attacks on TLS</a> and their mitigation</li>
<li>How to use <a href="#private-key-passwords">private key passwords</a></li>
</ul>
<p>and more.</p>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="basics">Where to Learn the Basics of TLS<a href="#basics" class="hash-link" aria-label="Direct link to Where to Learn the Basics of TLS" title="Direct link to Where to Learn the Basics of TLS">​</a></h2>
<p>This guide tries to <a href="#certificates-and-keys">explain the basics of TLS</a> but it is not, however, a primer on TLS, encryption, <a href="https://en.wikipedia.org/wiki/public_key_infrastructure" target="_blank" rel="noopener noreferrer">public Key Infrastructure</a> and related topics, so the concepts are covered very briefly.</p>
<p>A number of beginner-oriented primers on TLS are available elsewhere on the Web:</p>
<ul>
<li><a href="https://medium.com/zkpass/a-primer-on-transport-layer-security-tls-a7495eeff004" target="_blank" rel="noopener noreferrer">one</a></li>
<li><a href="https://www.cloudflare.com/en-ca/learning/ssl/why-use-tls-1.3/" target="_blank" rel="noopener noreferrer">two</a></li>
<li><a href="https://hpbn.co/transport-layer-security-tls/" target="_blank" rel="noopener noreferrer">three</a></li>
<li><a href="https://medium.com/talpor/ssl-tls-authentication-explained-86f00064280" target="_blank" rel="noopener noreferrer">four</a></li>
</ul>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="protocols">TLS and Messaging Protocols<a href="#protocols" class="hash-link" aria-label="Direct link to TLS and Messaging Protocols" title="Direct link to TLS and Messaging Protocols">​</a></h2>
<p>TLS can be enabled for all protocols supported by RabbitMQ.
However, this guide primarily focuses on AMQP 1.0 and AMQP 0-9-1 listeners.
See <a href="/rabbitmq-website/docs/next/mqtt">MQTT</a>, <a href="/rabbitmq-website/docs/next/stomp">STOMP</a>, and their <a href="/rabbitmq-website/docs/next/web-mqtt">respective WebSocket transport</a> guides
for TLS configuration examples for those protocols.</p>
<p><a href="/rabbitmq-website/docs/next/management">HTTP API</a>, <a href="/rabbitmq-website/docs/next/clustering-ssl">inter-node and CLI tool traffic</a> can be configured
to use TLS (HTTPS) as well.</p>
<p>To configure TLS on Kubernetes using the RabbitMQ Cluster Operator, see the guide for <a href="/rabbitmq-website/kubernetes/operator/using-operator#tls">Configuring TLS</a>.</p>
<p>For an overview of common TLS troubleshooting techniques, see <a href="/rabbitmq-website/docs/next/troubleshooting-ssl">Troubleshooting TLS-related issues</a>
and <a href="/rabbitmq-website/docs/next/troubleshooting-networking">Troubleshooting Networking</a>.</p>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="tls-connectivity-options">Common Approaches to TLS for client Connections with RabbitMQ<a href="#tls-connectivity-options" class="hash-link" aria-label="Direct link to Common Approaches to TLS for client Connections with RabbitMQ" title="Direct link to Common Approaches to TLS for client Connections with RabbitMQ">​</a></h2>
<p>For client connections, there are two common approaches:</p>
<ul>
<li>Configure RabbitMQ to handle TLS connections</li>
<li>Use a proxy or load balancer (such as <a href="http://www.haproxy.org/" target="_blank" rel="noopener noreferrer">HAproxy</a>)
to perform <a href="https://en.wikipedia.org/wiki/TLS_termination_proxy" target="_blank" rel="noopener noreferrer">TLS termination</a> of client connections and use plain TCP connections to RabbitMQ nodes.</li>
</ul>
<p>Both approaches are valid and have pros and cons. This guide will focus on the
first option. Certain parts of this guide would still be relevant for environments
that choose the second option.</p>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="erlang-otp-requirements">Erlang/OTP Requirements for TLS Support<a href="#erlang-otp-requirements" class="hash-link" aria-label="Direct link to Erlang/OTP Requirements for TLS Support" title="Direct link to Erlang/OTP Requirements for TLS Support">​</a></h2>
<p>In order to support TLS connections, RabbitMQ needs TLS and
crypto-related modules to be available in the Erlang/OTP
installation. The recommended Erlang/OTP version to use with
TLS is the most recent <a href="/rabbitmq-website/docs/next/which-erlang">supported Erlang release</a>.
Earlier versions, even if they are supported, may work for most certificates
but have known limitations (see below).</p>
<p>The Erlang <code>asn1</code>, <code>crypto</code>,
<code>public_key</code>, and <code>ssl</code> libraries
(applications) must be installed and functional. On Debian and
Ubuntu this is provided by the <a href="http://packages.ubuntu.com/search?keywords=erlang-asn1" target="_blank" rel="noopener noreferrer">erlang-asn1</a>,
<a href="http://packages.ubuntu.com/search?keywords=erlang-crypto" target="_blank" rel="noopener noreferrer">erlang-crypto</a>, <a href="http://packages.ubuntu.com/search?keywords=erlang-public-key" target="_blank" rel="noopener noreferrer">erlang-public-key</a>, and
<a href="http://packages.ubuntu.com/search?keywords=erlang-ssl" target="_blank" rel="noopener noreferrer">erlang-ssl</a> packages, respectively. The <a href="https://github.com/rabbitmq/erlang-rpm" target="_blank" rel="noopener noreferrer">zero dependency
Erlang RPM for RabbitMQ</a> includes the above modules.</p>
<p>If Erlang/OTP is compiled from source, it is necessary to ensure that <code>configure</code>
finds OpenSSL and builds the above libraries.</p>
<p>When investigating TLS connectivity issues, please keep in mind that in the vast majority
of cases they are environment-specific (e.g. certificates are missing from the <a href="#peer-verification-trusted-certificates">trusted certificate store</a>)
and do not indicate a bug or limitation in Erlang/OTP&#x27;s TLS implementation. Please go through the steps outlined
in the <a href="/rabbitmq-website/docs/next/troubleshooting-ssl">Troubleshooting TLS guide</a> to gather
more information first.</p>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="known-compatibility-issues">Known Incompatibilities and Limitations<a href="#known-compatibility-issues" class="hash-link" aria-label="Direct link to Known Incompatibilities and Limitations" title="Direct link to Known Incompatibilities and Limitations">​</a></h2>
<p>If Elliptic curve cryptography (ECC) cipher suites is
expected to be used, a recent <a href="/rabbitmq-website/docs/next/which-erlang">supported Erlang release</a>
is highly recommended. Earlier releases have known limitations around ECC support.</p>
<p>If you face the above limitations or any other incompatibilities,
use the TLS termination option (see above).</p>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="certificates-and-keys">TLS Basics: Certificate Authorities, Certificates, Keys<a href="#certificates-and-keys" class="hash-link" aria-label="Direct link to TLS Basics: Certificate Authorities, Certificates, Keys" title="Direct link to TLS Basics: Certificate Authorities, Certificates, Keys">​</a></h2>
<p>TLS is a large and fairly complex topic. Before explaining <a href="#enabling-tls">how to enable TLS in RabbitMQ</a>
it&#x27;s worth briefly cover some of the concepts used in this guide. This section is intentionally brief and oversimplifies
some things. Its goal is to get the reader started with enabling TLS for RabbitMQ and applications.</p>
<p>A number of beginner-oriented primers on TLS are available elsewhere on the Web:</p>
<ul>
<li><a href="https://medium.com/zkpass/a-primer-on-transport-layer-security-tls-a7495eeff004" target="_blank" rel="noopener noreferrer">one</a></li>
<li><a href="https://www.cloudflare.com/en-ca/learning/ssl/why-use-tls-1.3/" target="_blank" rel="noopener noreferrer">two</a></li>
<li><a href="https://hpbn.co/transport-layer-security-tls/" target="_blank" rel="noopener noreferrer">three</a></li>
<li><a href="https://medium.com/talpor/ssl-tls-authentication-explained-86f00064280" target="_blank" rel="noopener noreferrer">four</a></li>
</ul>
<p>For a thorough understanding of
TLS and how to get the most out of it, we would recommend the use
of other resources, for example <a class="extlink" href="http://oreilly.com/catalog/9780596002701/">Network Security with
OpenSSL</a>.</p>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="two-primary-objectives-of-tls">Two Primary Objectives of TLS<a href="#two-primary-objectives-of-tls" class="hash-link" aria-label="Direct link to Two Primary Objectives of TLS" title="Direct link to Two Primary Objectives of TLS">​</a></h3>
<p>TLS has two primary purposes: encrypting connection traffic and providing a way to authenticate (<a href="#peer-verification">verify</a>)
the peer to mitigate against <a href="https://en.wikipedia.org/wiki/Man-in-the-middle_attack" target="_blank" rel="noopener noreferrer">Man-in-the-Middle attacks</a>.
Both are accomplished using a set of roles, policies and procedures known as <a href="https://en.wikipedia.org/wiki/public_key_infrastructure" target="_blank" rel="noopener noreferrer">Public Key Infrastructure</a> (PKI).</p>
<p>A PKI is based on the concept of digital identities that can be cryptographically (mathematically) verified. Those identities are called
<em>certificates</em> or more precisely, <em>certificate/key pairs</em>. Every TLS-enabled server usually has its own certificate/key
pair that it uses to compute a connection-specific key that will be used to encrypt traffic sent on the connection.</p>
<p>Also, if asked, it can present its certificate (public key) to the connection peer. Clients may or may not have their own certificates.
In the context of messaging and tools such as RabbitMQ it is quite common for
clients to also use certificate/key pairs so that servers can validate their identity.</p>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="certificates-private-keys-and-certificate-authorities">Certificates, Private Keys, and Certificate Authorities<a href="#certificates-private-keys-and-certificate-authorities" class="hash-link" aria-label="Direct link to Certificates, Private Keys, and Certificate Authorities" title="Direct link to Certificates, Private Keys, and Certificate Authorities">​</a></h3>
<p>Certificate/key pairs are generated by tools such as OpenSSL and signed by entities called <em><a href="https://en.wikipedia.org/wiki/Certificate_authority" target="_blank" rel="noopener noreferrer">Certificate Authorities</a></em> (CA).
CAs issue certificates that users (applications or other CAs) use. When a certificate is signed by a CA, they form a <em>chain of trust</em>. Such chains can include
more than one CA but ultimately sign a certificate/key pair used by an application (a <em>leaf</em> or <em>end user</em> certificate).
Chains of CA certificates are usually distributed together in a single file. Such file is called a <em>CA bundle</em>.</p>
<p>Here&#x27;s an example of the most basic chain with one root CA and one leaf (server or client) certificate:</p>
<figure><p><img decoding="async" loading="lazy" alt="Root CA and leaf certificates" src="/rabbitmq-website/assets/images/root_ca_and_leaf-8bc604562329d97549515682cb232d74.png" width="248" height="197" class="img_ev3q"></p></figure>
<p>A chain with intermediate certificates might look like this:</p>
<figure><p><img decoding="async" loading="lazy" alt="Root CA, intermediate and leaf certificates" src="/rabbitmq-website/assets/images/root_intermediate_ca_and_leaf-0db0418e7a066229fe9e758463916de8.png" width="248" height="318" class="img_ev3q"></p></figure>
<p>There are organizations that sign and issue certificate/key pairs. Most of them are widely trusted CAs and charge a fee for their services.</p>
<p>A TLS-enabled RabbitMQ node must have a set of Certificate Authority certificates it considers to be trusted in a file (a CA bundle),
a certificate (public key) file and a private key file. The files will be read from the local filesystem. They must be readable by the effective user
of the RabbitMQ node process.</p>
<p>Both ends of a TLS-enabled connection can optionally verify
the other end of the connection. While doing so, they try to locate a trusted Certificate Authority in the certificate list
presented by the peer. When both sides perform this verification process, this is known
as <em>mutual TLS authentication</em> or <em>mTLS</em>.
More on this in the <a href="#peer-verification">Peer Verification</a> section.</p>
<p>This guide assumes the user has access to a Certificate Authority and two certificate/key pairs
in a number of formats for different client libraries to use.
This is best done using <a href="#automated-certificate-generation">existing tools</a>
but those looking to get more familiar with the topic and OpenSSL command line
tools there&#x27;s a <a href="#manual-certificate-generation">separate section</a>.</p>
<p>In production environments certificates are generated by a commercial Certificate Authority
or a Certificate Authority issued by the internal security team. In those cases Certificate Authority
bundle files very likely will contain more than one certificate. This doesn&#x27;t change how the bundle file
is used when configuration RabbitMQ as long as the same basic <a href="#enabling-tls-paths">file and path requirements</a> are met.
In other words, whether the certificates are self-signed or issued by a <a href="#peer-verification-trusted-certificates">trusted CA</a>, they are
configured the same way. The section on <a href="#peer-verification">peer verification</a> covers this in detail.</p>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="automated-certificate-generation">The Short Route to Generating a CA, Certificates, and Keys<a href="#automated-certificate-generation" class="hash-link" aria-label="Direct link to The Short Route to Generating a CA, Certificates, and Keys" title="Direct link to The Short Route to Generating a CA, Certificates, and Keys">​</a></h2>
<p>This guide assumes the user has access to a CA certificate bundle file and two <a href="#certificates-and-keys">certificate/key pairs</a>.
The certificate/key pairs are used by RabbitMQ and clients that connect to the server on a
TLS-enabled port. The process of generating a Certificate Authority and two key pairs is fairly labourious
and can be error-prone. An easier way of generating all that
stuff on MacOS or Linux is with <a href="https://github.com/rabbitmq/tls-gen">tls-gen</a>:
it requires <code>Python 3.5+</code>, <code>make</code> and <code>openssl</code> in <code>PATH</code>.</p>
<p>Note that <code>tls-gen</code> and the certificate/key pairs
it generates are self-signed and only suitable for development
and test environments. The vast majority of production environments
should use certificates and keys issued by a widely trusted commercial
CA.</p>
<p><code>tls-gen</code> supports RSA and <a href="https://blog.cloudflare.com/a-relatively-easy-to-understand-primer-on-Elliptic-curve-cryptography/" target="_blank" rel="noopener noreferrer">Elliptic Curve Cryptography</a>
algorithms for key generation.</p>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="automated-certificate-generation-transcript">Using tls-gen&#x27;s Basic Profile<a href="#automated-certificate-generation-transcript" class="hash-link" aria-label="Direct link to Using tls-gen&#x27;s Basic Profile" title="Direct link to Using tls-gen&#x27;s Basic Profile">​</a></h3>
<p>Below is an example that generates a CA and uses it to produce two certificate/key pairs, one
for the server and another for clients. This is the setup that is expected by the rest of this guide.</p>
<div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token function" style="color:#d73a49">git</span><span class="token plain"> clone https://github.com/rabbitmq/tls-gen tls-gen</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token builtin class-name">cd</span><span class="token plain"> tls-gen/basic</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token comment" style="color:#999988;font-style:italic"># private key password</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token function" style="color:#d73a49">make</span><span class="token plain"> </span><span class="token assign-left variable" style="color:#36acaa">PASSWORD</span><span class="token operator" style="color:#393A34">=</span><span class="token plain">bunnies</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token function" style="color:#d73a49">make</span><span class="token plain"> verify</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token function" style="color:#d73a49">make</span><span class="token plain"> info</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token function" style="color:#d73a49">ls</span><span class="token plain"> </span><span class="token parameter variable" style="color:#36acaa">-l</span><span class="token plain"> ./result</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>The certificate chain produced by this basic tls-gen profile looks like this:</p>
<figure><p><img decoding="async" loading="lazy" alt="Root CA and leaf certificates" src="/rabbitmq-website/assets/images/root_ca_and_leaf-8bc604562329d97549515682cb232d74.png" width="248" height="197" class="img_ev3q"></p></figure>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="enabling-tls">Enabling TLS Support in RabbitMQ<a href="#enabling-tls" class="hash-link" aria-label="Direct link to Enabling TLS Support in RabbitMQ" title="Direct link to Enabling TLS Support in RabbitMQ">​</a></h2>
<p>To enable the TLS support in RabbitMQ, the node has to be configured
to know the location of the <a href="#certificates-and-keys">Certificate Authority
bundle</a> (a file with one more CA certificates), the server&#x27;s certificate file, and the server&#x27;s
key. A TLS listener should also be enabled to know what port to listen on for TLS-enabled client connections.
More TLS-related things can be configured. Those are covered in the rest of this guide.</p>
<p>Here are the essential configuration settings related to TLS:</p>
<table class="plain"><thead><td>Configuration Key</td><td>Description</td></thead><tr><td><code>listeners.ssl</code></td><td><p>A list of ports to listen on for TLS
connections. RabbitMQ can listen on a <a href="./networking">single interface or multiple ones</a>.</p></td></tr><tr><td><code>ssl_options.cacertfile</code></td><td>Certificate Authority (CA) bundle file path</td></tr><tr><td><code>ssl_options.certfile</code></td><td>Server certificate file path</td></tr><tr><td><code>ssl_options.keyfile</code></td><td>Server private key file path</td></tr><tr><td><code>ssl_options.password</code></td><td>Password for private key file</td></tr><tr><td><code>ssl_options.verify</code></td><td>Should <a href="#peer-verification">peer verification</a> be enabled?</td></tr><tr><td><code>ssl_options.fail_if_no_peer_cert</code></td><td><p>When set to <code>true</code>, TLS connection
will be rejected if client fails to provide a certificate</p></td></tr></table>
<p>The options are provided in the <a href="./configure#configuration-files">configuration
file</a>. An example of the config file is below, which
will start one TLS listener on port 5671 on all interfaces
on this hostname:</p>
<div class="language-ini codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-ini codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">listeners.ssl.default = 5671</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">ssl_options.cacertfile = /path/to/ca_certificate.pem</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">ssl_options.certfile   = /path/to/server_certificate.pem</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">ssl_options.keyfile    = /path/to/server_key.pem</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">ssl_options.verify     = verify_peer</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">ssl_options.fail_if_no_peer_cert = true</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"># If the private key file is password protected, set this value:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"># ssl_options.password = PASSWORD</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>This configuration will also perform <a href="#peer-verification">peer certificate chain verification</a>
so clients without any certificates will be rejected.</p>
<p>It is possible to completely disable regular (non-TLS) listeners. Only TLS-enabled
clients would be able to connect to such a node, and only if they use the correct port:</p>
<div class="language-ini codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-ini codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain"># disables non-TLS listeners, only TLS-enabled clients will be able to connect</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">listeners.tcp = none</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">listeners.ssl.default = 5671</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">ssl_options.cacertfile = /path/to/ca_certificate.pem</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">ssl_options.certfile   = /path/to/server_certificate.pem</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">ssl_options.keyfile    = /path/to/server_key.pem</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">ssl_options.verify     = verify_peer</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">ssl_options.fail_if_no_peer_cert = true</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>TLS settings can also be configured using the <a href="/rabbitmq-website/docs/next/configure#erlang-term-config-file">classic config format</a>:</p>
<div class="language-erlang codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-erlang codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token punctuation" style="color:#393A34">[</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token punctuation" style="color:#393A34">{</span><span class="token atom">rabbit</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">[</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">     </span><span class="token punctuation" style="color:#393A34">{</span><span class="token atom">ssl_listeners</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">[</span><span class="token number" style="color:#36acaa">5671</span><span class="token punctuation" style="color:#393A34">]</span><span class="token punctuation" style="color:#393A34">}</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">     </span><span class="token punctuation" style="color:#393A34">{</span><span class="token atom">ssl_options</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">[</span><span class="token punctuation" style="color:#393A34">{</span><span class="token atom">cacertfile</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;/path/to/ca_certificate.pem&quot;</span><span class="token punctuation" style="color:#393A34">}</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                    </span><span class="token punctuation" style="color:#393A34">{</span><span class="token atom">certfile</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain">   </span><span class="token string" style="color:#e3116c">&quot;/path/to/server_certificate.pem&quot;</span><span class="token punctuation" style="color:#393A34">}</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                    </span><span class="token punctuation" style="color:#393A34">{</span><span class="token atom">keyfile</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain">    </span><span class="token string" style="color:#e3116c">&quot;/path/to/server_key.pem&quot;</span><span class="token punctuation" style="color:#393A34">}</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                    </span><span class="token punctuation" style="color:#393A34">{</span><span class="token atom">verify</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain">     </span><span class="token atom">verify_peer</span><span class="token punctuation" style="color:#393A34">}</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                    </span><span class="token punctuation" style="color:#393A34">{</span><span class="token atom">fail_if_no_peer_cert</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token boolean" style="color:#36acaa">true</span><span class="token punctuation" style="color:#393A34">}</span><span class="token punctuation" style="color:#393A34">]</span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">   </span><span class="token punctuation" style="color:#393A34">]</span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">]</span><span class="token punctuation" style="color:#393A34">.</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="enabling-tls-paths">Certificate and Private Key File Paths<a href="#enabling-tls-paths" class="hash-link" aria-label="Direct link to Certificate and Private Key File Paths" title="Direct link to Certificate and Private Key File Paths">​</a></h3>
<p>RabbitMQ must be able to read its configured CA certificate bundle, server certificate and private key. The files
must exist and have the appropriate permissions. When that&#x27;s not the case the node will fail to start or fail to
accept TLS-enabled connections.</p>
<p><strong>Note for Windows users</strong>: on Windows, backslashes (&quot;&quot;) in the
configuration file are interpreted as escape sequences.
For example, to specify the
path <code>c:\ca_certificate.pem</code> for the CA certificate on Windows,
would need to use <code>&quot;c:\\ca_certificate.pem&quot;</code> or <code>&quot;c:/ca_certificate.pem&quot;</code>.</p>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="enabling-tls-verify-configuration">How to Verify that TLS is Enabled<a href="#enabling-tls-verify-configuration" class="hash-link" aria-label="Direct link to How to Verify that TLS is Enabled" title="Direct link to How to Verify that TLS is Enabled">​</a></h3>
<p>To verify that TLS has been enabled on the node, restart it and inspect its <a href="/rabbitmq-website/docs/next/logging">log file</a>.
It should contain an entry about a TLS listener being enabled, looking like this:</p>
<div class="codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">2020-07-13 21:13:01.015 [info] &lt;0.573.0&gt; started TCP listener on [::]:5672</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">2020-07-13 21:13:01.055 [info] &lt;0.589.0&gt; started TLS (SSL) listener on [::]:5671</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>Another way is by using <code>rabbitmq-diagnostics listeners</code> which should contain
lines for TLS-enabled listeners:</p>
<div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">rabbitmq-diagnostics listeners</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token comment" style="color:#999988;font-style:italic">#</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token comment" style="color:#999988;font-style:italic"># ... (some output omitted for brevity)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token comment" style="color:#999988;font-style:italic"># =&gt; Interface: [::], port: 5671, protocol: amqp/ssl, purpose: AMQP 0-9-1 and AMQP 1.0 over TLS</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token comment" style="color:#999988;font-style:italic"># ...</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="private-key-passwords">Providing Private Key Password<a href="#private-key-passwords" class="hash-link" aria-label="Direct link to Providing Private Key Password" title="Direct link to Providing Private Key Password">​</a></h3>
<p>Private keys can be optional protected by a password.
To provide the password, use the <code>password</code> option:</p>
<div class="language-ini codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-ini codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">listeners.ssl.1 = 5671</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">ssl_options.cacertfile = /path/to/ca_certificate.pem</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">ssl_options.certfile   = /path/to/server_certificate.pem</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">ssl_options.keyfile    = /path/to/server_key.pem</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">ssl_options.password   = t0p$3kRe7</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>The same example using the <a href="/rabbitmq-website/docs/next/configure#erlang-term-config-file">classic config format</a>:</p>
<div class="language-erlang codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-erlang codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token punctuation" style="color:#393A34">[</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token atom">rabbit</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">[</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">           </span><span class="token punctuation" style="color:#393A34">{</span><span class="token atom">ssl_listeners</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">[</span><span class="token number" style="color:#36acaa">5671</span><span class="token punctuation" style="color:#393A34">]</span><span class="token punctuation" style="color:#393A34">}</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">           </span><span class="token punctuation" style="color:#393A34">{</span><span class="token atom">ssl_options</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">[</span><span class="token punctuation" style="color:#393A34">{</span><span class="token atom">cacertfile</span><span class="token punctuation" style="color:#393A34">,</span><span class="token string" style="color:#e3116c">&quot;/path/to/ca_certificate.pem&quot;</span><span class="token punctuation" style="color:#393A34">}</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                          </span><span class="token punctuation" style="color:#393A34">{</span><span class="token atom">certfile</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain">  </span><span class="token string" style="color:#e3116c">&quot;/path/to/server_certificate.pem&quot;</span><span class="token punctuation" style="color:#393A34">}</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                          </span><span class="token punctuation" style="color:#393A34">{</span><span class="token atom">keyfile</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain">   </span><span class="token string" style="color:#e3116c">&quot;/path/to/server_key.pem&quot;</span><span class="token punctuation" style="color:#393A34">}</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                          </span><span class="token punctuation" style="color:#393A34">{</span><span class="token atom">password</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain">  </span><span class="token string" style="color:#e3116c">&quot;t0p$3kRe7&quot;</span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                         </span><span class="token punctuation" style="color:#393A34">]</span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">          </span><span class="token punctuation" style="color:#393A34">]</span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">]</span><span class="token punctuation" style="color:#393A34">.</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>Classic config file format allows for <a href="/rabbitmq-website/docs/next/configure#configuration-encryption">config value encryption</a>,
which is recommended for passwords.</p>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="peer-verification">TLS Peer Verification: Who Do You Say You Are?<a href="#peer-verification" class="hash-link" aria-label="Direct link to TLS Peer Verification: Who Do You Say You Are?" title="Direct link to TLS Peer Verification: Who Do You Say You Are?">​</a></h2>
<p>As mentioned in the <a href="#certificates-and-keys">Certificates and Keys</a> section, TLS has two
primary purposes: encrypting connection traffic and providing a way to verify
that the peer can be trusted (e.g. signed by a trusted Certificate Authority)
to mitigate against <a href="https://en.wikipedia.org/wiki/Man-in-the-middle_attack" target="_blank" rel="noopener noreferrer">Man-in-the-Middle attacks</a>,
a class of attacks where an attacker impersonates a legitimate trusted peer (usually a server).
This section will focus on the latter.</p>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="peer-verification-how-it-works">How Peer Verification Works<a href="#peer-verification-how-it-works" class="hash-link" aria-label="Direct link to How Peer Verification Works" title="Direct link to How Peer Verification Works">​</a></h3>
<p>When a TLS connection is established client and server perform connection negotiation that takes several steps.
The first step is when the peers <em>optionally</em> exchange their <a href="#certificates-and-keys">certificates</a>.
Having exchanged certificates, the peers can <em>optionally</em> attempt
to establish a chain of trust between their CA certificates and the certificates presented.
This acts to verify that the peer is who it claims to be (provided the private key hasn&#x27;t been
stolen).</p>
<p>The process is known as peer verification or peer validation
and follows an algorithm known as the <a href="https://en.wikipedia.org/wiki/Certification_path_validation_algorithm" target="_blank" rel="noopener noreferrer">Certification path validation algorithm</a>.
Understanding the entire algorithm is not necessary in order to use peer verification,
so this section provides an oversimplified explanation of the key parts.</p>
<p>Each peer provides a <em>chain of certificates</em> that begins with a &quot;leaf&quot;
(client or server) certificate and continues with at least one Certificate Authority (CA) certificate. That
CA issued (signed) the leaf CA. If there are multiple CA certificates, they usually form a chain of signatures,
meaning that each CA certificate was signed by the next one. For example, if certificate B is signed by A and C is signed by B,
the chain is <code>A, B, C</code> (commas here are used for clarity). The &quot;topmost&quot; (first or only) CA is often referred
to as the <em>root CA</em> for the chain. Root CAs can be issued by well-known Certificate Authorities
(commercial vendors) or any other party (<a href="https://en.wikipedia.org/wiki/Self-signed_certificate" target="_blank" rel="noopener noreferrer">self-signed</a>).</p>
<p>Here&#x27;s an example of the most basic chain with one root CA and one leaf (server or client) certificate:</p>
<figure><p><img decoding="async" loading="lazy" alt="Root CA and leaf certificates" src="/rabbitmq-website/assets/images/root_ca_and_leaf-8bc604562329d97549515682cb232d74.png" width="248" height="197" class="img_ev3q"></p></figure>
<p>A chain with intermediate certificates might look like this:</p>
<figure><p><img decoding="async" loading="lazy" alt="Root CA, intermediate and leaf certificates" src="/rabbitmq-website/assets/images/root_intermediate_ca_and_leaf-0db0418e7a066229fe9e758463916de8.png" width="248" height="318" class="img_ev3q"></p></figure>
<p>During peer verification TLS connection client (or server) traverses
the chain of certificates presented by the peer
and if a trusted certificate is found, considers the peer trusted.</p>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="mutual-peer-verification-mutual-tls-authentication-or-mtls">Mutual Peer Verification (Mutual TLS Authentication or mTLS)<a href="#mutual-peer-verification-mutual-tls-authentication-or-mtls" class="hash-link" aria-label="Direct link to Mutual Peer Verification (Mutual TLS Authentication or mTLS)" title="Direct link to Mutual Peer Verification (Mutual TLS Authentication or mTLS)">​</a></h3>
<p>When both sides perform this peer verification process, this is known
as <em>mutual TLS authentication</em> or <em>mTLS</em>.</p>
<p>Enabling mutual peer verification involves two things:</p>
<ul>
<li><a href="#peer-verification-configuration">Enabling peer verification for client connections</a> on the RabbitMQ side</li>
<li><a href="#peer-verification">Enabling peer verification of the server</a> in application code</li>
</ul>
<p>In other words, mutual peer verification (&quot;mTLS&quot;) is a joint responsibility of RabbitMQ nodes
and client connections. Enabling peer verification on just one end is not enough.</p>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="when-peer-verification-fails">When Peer Verification Fails<a href="#when-peer-verification-fails" class="hash-link" aria-label="Direct link to When Peer Verification Fails" title="Direct link to When Peer Verification Fails">​</a></h3>
<p>If no trusted and otherwise valid certificate is found, peer verification fails and client&#x27;s TLS (TCP) connection is
closed with a fatal error (&quot;alert&quot; in OpenSSL parlance) that says &quot;Unknown CA&quot; or similar. The alert
will be logged by the server with a message similar to this:</p>
<div class="language-ini codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-ini codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">2018-09-10 18:10:46.502 [info] &lt;0.902.0&lt; TLS server generated SERVER ALERT: Fatal - Unknown CA</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>Certificate validity is also checked at every step. Certificates that are expired
or aren&#x27;t yet valid will be rejected. The TLS alert in that case will look something
like this:</p>
<div class="language-ini codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-ini codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">2018-09-10 18:11:05.168 [info] &lt;0.923.0&lt; TLS server generated SERVER ALERT: Fatal - Certificate Expired</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>The examples above demonstrate TLS alert messages logged by a RabbitMQ node.
Clients that perform peer verification will also raise alerts but may use different
error messages. <a href="https://tools.ietf.org/html/rfc8446#section-6.2" target="_blank" rel="noopener noreferrer">RFC 8446 section 6.2</a>
provides an overview of various alerts and what they mean.</p>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="peer-verification-trusted-certificates">Trusted Certificates<a href="#peer-verification-trusted-certificates" class="hash-link" aria-label="Direct link to Trusted Certificates" title="Direct link to Trusted Certificates">​</a></h3>
<p>Every TLS-enabled tool and TLS implementation, including Erlang/OTP and
RabbitMQ, has a way of marking a set of certificates as trusted.</p>
<p>There are three common approaches to this:</p>
<ul>
<li>All trusted CA certificates must be added to a single file called the <em>CA certificate bundle</em></li>
<li>All CA certificates in a directory are considered to be trusted</li>
<li>A dedicated tool is used to manage trusted CA certificates</li>
</ul>
<p>Different TLS implementation and tools use different options. In the context of RabbitMQ this means that
the trusted certificate management approach may be different for different client
libraries, tools and RabbitMQ server itself.</p>
<p>For example, OpenSSL and OpenSSL command line tools such as <code>s_client</code> on Linux and other UNIX-like systems
will use a directory administered by superusers.
CA certificates in that directory will be considered trusted,
and so are the certificates issued by them (such as those presented by clients).
Locations of the trusted certificate directory will <a href="https://www.happyassassin.net/2015/01/12/a-note-about-ssltls-trusted-certificate-stores-and-platforms/" target="_blank" rel="noopener noreferrer">vary</a>
<a href="http://gagravarr.org/writing/openssl-certs/others.shtml" target="_blank" rel="noopener noreferrer">between distributions</a>, operating systems and releases.</p>
<p>On Windows trusted certificates are managed using tools such as <a href="https://docs.microsoft.com/en-us/dotnet/framework/tools/certmgr-exe-certificate-manager-tool" target="_blank" rel="noopener noreferrer">certmgr</a>.</p>
<p>The certificates in the server&#x27;s CA certificate bundle may be considered trusted.
We say &quot;may&quot; because it doesn&#x27;t work the same way for all client libraries since this varies from TLS implementation
to implementation. Certificates in a CA certificate bundler won&#x27;t be considered to be trusted in Python,
for example, unless explicitly added to the trust store.</p>
<p>RabbitMQ relies on Erlang&#x27;s TLS implementation. It assumes that
<strong>all trusted CA certificates are added to the server certificate bundle</strong>.</p>
<p>When performing peer verification, RabbitMQ will only consider the root certificate (first certificate in the list) to be trusted.
Any intermediate certificates will be ignored. If it&#x27;s desired that intermediate certificates
are also considered to be trusted they must be added to the trusted certificate list: the certificate bundle.</p>
<p>While it is possible to place final (&quot;leaf&quot;) certificates
such as those used by servers and clients to the trusted certificate directory,
a much more common practice is to add CA certificates to the trusted certificate list.</p>
<p>The most common way of appending several certificates to one
another and use in a single Certificate Authority bundle file
is to simply concatenate them:</p>
<div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token function" style="color:#d73a49">cat</span><span class="token plain"> rootca/ca_certificate.pem otherca/ca_certificate.pem </span><span class="token operator" style="color:#393A34">&gt;</span><span class="token plain"> all_cacerts.pem</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="peer-verification-configuration">Enabling Peer Verification<a href="#peer-verification-configuration" class="hash-link" aria-label="Direct link to Enabling Peer Verification" title="Direct link to Enabling Peer Verification">​</a></h3>
<p>On the server end, peer verification is primarily controlled using two configuration
options: <code>ssl_options.verify</code> and <code>ssl_options.fail_if_no_peer_cert</code>.</p>
<p>Setting the <code>ssl_options.fail_if_no_peer_cert</code> option to <code>false</code> tells
the node to accept clients which don&#x27;t present a certificate (for example, were not configured to use one).</p>
<p>When the <code>ssl_options.verify</code> option is set to <code>verify_peer</code>,
the client does send us a certificate, the node must perform peer verification.
When set to <code>verify_none</code>, peer verification will be disabled and certificate
exchange won&#x27;t be performed.</p>
<p>For example, the following
config will perform peer verification and reject clients that do not provide
a certificate:</p>
<div class="language-ini codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-ini codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">listeners.ssl.default = 5671</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">ssl_options.cacertfile = /path/to/ca_certificate.pem</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">ssl_options.certfile = /path/to/server_certificate.pem</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">ssl_options.keyfile = /path/to/server_key.pem</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">ssl_options.verify = verify_peer</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">ssl_options.fail_if_no_peer_cert = true</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>The same example in the <a href="/rabbitmq-website/docs/next/configure#config-file">classic config format</a>:</p>
<div class="language-erlang codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-erlang codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token punctuation" style="color:#393A34">[</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">{</span><span class="token atom">rabbit</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">[</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">   </span><span class="token punctuation" style="color:#393A34">{</span><span class="token atom">ssl_listeners</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">[</span><span class="token number" style="color:#36acaa">5671</span><span class="token punctuation" style="color:#393A34">]</span><span class="token punctuation" style="color:#393A34">}</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">   </span><span class="token punctuation" style="color:#393A34">{</span><span class="token atom">ssl_options</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">[</span><span class="token punctuation" style="color:#393A34">{</span><span class="token atom">cacertfile</span><span class="token punctuation" style="color:#393A34">,</span><span class="token string" style="color:#e3116c">&quot;/path/to/ca_certificate.pem&quot;</span><span class="token punctuation" style="color:#393A34">}</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                  </span><span class="token punctuation" style="color:#393A34">{</span><span class="token atom">certfile</span><span class="token punctuation" style="color:#393A34">,</span><span class="token string" style="color:#e3116c">&quot;/path/to/server_certificate.pem&quot;</span><span class="token punctuation" style="color:#393A34">}</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                  </span><span class="token punctuation" style="color:#393A34">{</span><span class="token atom">keyfile</span><span class="token punctuation" style="color:#393A34">,</span><span class="token string" style="color:#e3116c">&quot;/path/to/server_key.pem&quot;</span><span class="token punctuation" style="color:#393A34">}</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                  </span><span class="token punctuation" style="color:#393A34">{</span><span class="token atom">verify</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token atom">verify_peer</span><span class="token punctuation" style="color:#393A34">}</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                  </span><span class="token punctuation" style="color:#393A34">{</span><span class="token atom">fail_if_no_peer_cert</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token boolean" style="color:#36acaa">true</span><span class="token punctuation" style="color:#393A34">}</span><span class="token punctuation" style="color:#393A34">]</span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">]</span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">]</span><span class="token punctuation" style="color:#393A34">.</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>How exactly peer verification is configured in client libraries varies from library to library.
<a href="#java-client">Java</a> and <a href="#dotnet-client">.NET</a> client sections cover peer
verification in those clients.</p>
<p>Peer verification is highly recommended in production environments. With careful consideration,
disabling it can make sense in certain environments (e.g. development).</p>
<a id="peer-verification-clients"></a>
<p>Thus it is possible to create an encrypted TLS connection <em>without</em> having to
verify certificates. Client libraries usually support both modes of operation.</p>
<p>When peer verification is enabled, it is common for clients to also check whether
the hostname of the server
they are connecting to matches one of two fields
in the server certificate: the <a href="https://en.wikipedia.org/wiki/Subject_Alternative_Name" target="_blank" rel="noopener noreferrer">SAN (Subject Alternative Name)</a>
or CN (Common Name). When <a href="https://en.wikipedia.org/wiki/Wildcard_certificate" target="_blank" rel="noopener noreferrer">wildcard certificates</a> are used,
the hostname is matched against a pattern. If there is no match, peer verification will also be
failed by the client. Hostname checks are also optional and generally orthogonal to certificate chain
verification performed by the client.</p>
<p>Because of this it is important to know what SAN (Subject Alternative Name) or CN (Common Name) values
were used when generating the certificate. If a certificate is generated on one host and used
on a different host then the <code>$(hostname)</code> value should be replaced with the correct hostname of the target server.</p>
<p><a href="#automated-certificate-generation">tls-gen</a> will use local machine&#x27;s hostname for both values.
Likewise, in the <a href="#manual-certificate-generation">manual certificate/key pair generation section</a> local machine&#x27;s hostname is specified as
<code>...-subj /CN=$(hostname)/...</code> to some OpenSSL CLI tool commands.</p>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="peer-verification-depth">Certificate Chains and Verification Depth<a href="#peer-verification-depth" class="hash-link" aria-label="Direct link to Certificate Chains and Verification Depth" title="Direct link to Certificate Chains and Verification Depth">​</a></h3>
<p>When using a client certificate signed by an intermediate CA, it may be necessary
to configure RabbitMQ server to use a higher verification depth.</p>
<p>The depth is the maximum number of non-self-issued intermediate certificates that
may follow the peer certificate in a valid certification path.
So if depth is 0 the peer (e.g. client) certificate must be signed by the trusted CA directly,
if 1 the path can be &quot;peer, CA, trusted CA&quot;, if it is 2 &quot;peer, CA, CA, trusted CA&quot;, and so on.
The default depth is 1.</p>
<p>The following example demonstrates how to configure certificate validation depth for
RabbitMQ server:</p>
<div class="language-ini codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-ini codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">listeners.ssl.default = 5671</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">ssl_options.cacertfile = /path/to/ca_certificate.pem</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">ssl_options.certfile = /path/to/server_certificate.pem</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">ssl_options.keyfile = /path/to/server_key.pem</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">ssl_options.verify = verify_peer</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">ssl_options.depth  = 2</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">ssl_options.fail_if_no_peer_cert = false</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>The same example in the <a href="/rabbitmq-website/docs/next/configure#config-file">classic config format</a>:</p>
<div class="language-erlang codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-erlang codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token punctuation" style="color:#393A34">[</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token punctuation" style="color:#393A34">{</span><span class="token atom">rabbit</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">[</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">     </span><span class="token punctuation" style="color:#393A34">{</span><span class="token atom">ssl_listeners</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">[</span><span class="token number" style="color:#36acaa">5671</span><span class="token punctuation" style="color:#393A34">]</span><span class="token punctuation" style="color:#393A34">}</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">     </span><span class="token punctuation" style="color:#393A34">{</span><span class="token atom">ssl_options</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">[</span><span class="token punctuation" style="color:#393A34">{</span><span class="token atom">cacertfile</span><span class="token punctuation" style="color:#393A34">,</span><span class="token string" style="color:#e3116c">&quot;/path/to/ca_certificate.pem&quot;</span><span class="token punctuation" style="color:#393A34">}</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                    </span><span class="token punctuation" style="color:#393A34">{</span><span class="token atom">certfile</span><span class="token punctuation" style="color:#393A34">,</span><span class="token string" style="color:#e3116c">&quot;/path/to/server_certificate.pem&quot;</span><span class="token punctuation" style="color:#393A34">}</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                    </span><span class="token punctuation" style="color:#393A34">{</span><span class="token atom">keyfile</span><span class="token punctuation" style="color:#393A34">,</span><span class="token string" style="color:#e3116c">&quot;/path/to/server_key.pem&quot;</span><span class="token punctuation" style="color:#393A34">}</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                    </span><span class="token punctuation" style="color:#393A34">{</span><span class="token atom">depth</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">2</span><span class="token punctuation" style="color:#393A34">}</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                    </span><span class="token punctuation" style="color:#393A34">{</span><span class="token atom">verify</span><span class="token punctuation" style="color:#393A34">,</span><span class="token atom">verify_peer</span><span class="token punctuation" style="color:#393A34">}</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                    </span><span class="token punctuation" style="color:#393A34">{</span><span class="token atom">fail_if_no_peer_cert</span><span class="token punctuation" style="color:#393A34">,</span><span class="token boolean" style="color:#36acaa">false</span><span class="token punctuation" style="color:#393A34">}</span><span class="token punctuation" style="color:#393A34">]</span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">   </span><span class="token punctuation" style="color:#393A34">]</span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">]</span><span class="token punctuation" style="color:#393A34">.</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>When using RabbitMQ plugins such as <a href="/rabbitmq-website/docs/next/federation">Federation</a> or <a href="/rabbitmq-website/docs/next/shovel">Shovel</a> with TLS,
it may be necessary to configure verification depth for the Erlang client that those plugins use under the hood,
as <a href="#erlang-client">explained below</a>.</p>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="java-client">Using TLS in the Java Client<a href="#java-client" class="hash-link" aria-label="Direct link to Using TLS in the Java Client" title="Direct link to Using TLS in the Java Client">​</a></h2>
<p>There are two main parts to enabling TLS in the RabbitMQ Java client:
setting up the key store with a bit of Java security framework plumbing and
implementing the desired peer verification strategy.</p>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="java-client-trust-managers-and-stores">Key Managers, Trust Managers and Stores<a href="#java-client-trust-managers-and-stores" class="hash-link" aria-label="Direct link to Key Managers, Trust Managers and Stores" title="Direct link to Key Managers, Trust Managers and Stores">​</a></h3>
<p>There are three main components in the Java security
framework: <a href="https://docs.oracle.com/javase/8/docs/api/javax/net/ssl/KeyManager.html" target="_blank" rel="noopener noreferrer">Key Manager</a>,
<a href="https://docs.oracle.com/javase/8/docs/api/javax/net/ssl/TrustManager.html" target="_blank" rel="noopener noreferrer">Trust Manager</a> and <a href="https://docs.oracle.com/javase/8/docs/api/java/security/KeyStore.html" target="_blank" rel="noopener noreferrer">Key Store</a>.</p>
<p>A Key Manager is used by a peer (in this case, a client connection) to manage its certificates.
During TLS connection/session negotiation, the key manager will control which
certificates to send to the remote peer.</p>
<p>A Trust Manager is used by a peer to manage remote certificates.
During TLS connection/session negotiation, the trust manager will control which
certificates are trusted from a remote peer. Trust managers can be used
to implement any certificate chain verification logic.</p>
<p>A Key Store is a Java encapsulation of the certificate store concept. All
certificates must either be stored into a Java-specific binary format (JKS)
or to be in the PKCS#12 format. These formats are managed using the
<code>KeyStore</code> class. In the below examples the JKS format is used to add the trusted (server) certificate(s)
to the store, while for the client key/certificate pair, the PKCS#12
key file generated by <a href="#automated-certificate-generation">tls-gen</a> will be used.</p>
<p>All TLS-related settings in the Java client
are configured via the <a href="https://rabbitmq.github.io/rabbitmq-java-client/api/current/com/rabbitmq/client/ConnectionFactory.html" target="_blank" rel="noopener noreferrer">ConnectionFactory</a>.</p>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="java-client-connecting">Connecting with TLS<a href="#java-client-connecting" class="hash-link" aria-label="Direct link to Connecting with TLS" title="Direct link to Connecting with TLS">​</a></h3>
<p>This very basic example will show a simple client connecting to a RabbitMQ
server over TLS without validating the server certificate, and
without presenting any client certificate to the server.</p>
<div class="language-java codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-java codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token keyword" style="color:#00009f">import</span><span class="token plain"> </span><span class="token import namespace" style="opacity:0.7">java</span><span class="token import namespace punctuation" style="opacity:0.7;color:#393A34">.</span><span class="token import namespace" style="opacity:0.7">io</span><span class="token import namespace punctuation" style="opacity:0.7;color:#393A34">.</span><span class="token import operator" style="color:#393A34">*</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">import</span><span class="token plain"> </span><span class="token import namespace" style="opacity:0.7">java</span><span class="token import namespace punctuation" style="opacity:0.7;color:#393A34">.</span><span class="token import namespace" style="opacity:0.7">security</span><span class="token import namespace punctuation" style="opacity:0.7;color:#393A34">.</span><span class="token import operator" style="color:#393A34">*</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">import</span><span class="token plain"> </span><span class="token import namespace" style="opacity:0.7">com</span><span class="token import namespace punctuation" style="opacity:0.7;color:#393A34">.</span><span class="token import namespace" style="opacity:0.7">rabbitmq</span><span class="token import namespace punctuation" style="opacity:0.7;color:#393A34">.</span><span class="token import namespace" style="opacity:0.7">client</span><span class="token import namespace punctuation" style="opacity:0.7;color:#393A34">.</span><span class="token import operator" style="color:#393A34">*</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">public</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">class</span><span class="token plain"> </span><span class="token class-name">Example1</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token keyword" style="color:#00009f">public</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">static</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">void</span><span class="token plain"> </span><span class="token function" style="color:#d73a49">main</span><span class="token punctuation" style="color:#393A34">(</span><span class="token class-name">String</span><span class="token punctuation" style="color:#393A34">[</span><span class="token punctuation" style="color:#393A34">]</span><span class="token plain"> args</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">throws</span><span class="token plain"> </span><span class="token class-name">Exception</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token class-name">ConnectionFactory</span><span class="token plain"> factory </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">new</span><span class="token plain"> </span><span class="token class-name">ConnectionFactory</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        factory</span><span class="token punctuation" style="color:#393A34">.</span><span class="token function" style="color:#d73a49">setHost</span><span class="token punctuation" style="color:#393A34">(</span><span class="token operator" style="color:#393A34">&amp;</span><span class="token plain">quot</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain">localhost</span><span class="token operator" style="color:#393A34">&amp;</span><span class="token plain">quot</span><span class="token punctuation" style="color:#393A34">;</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        factory</span><span class="token punctuation" style="color:#393A34">.</span><span class="token function" style="color:#d73a49">setPort</span><span class="token punctuation" style="color:#393A34">(</span><span class="token number" style="color:#36acaa">5671</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        factory</span><span class="token punctuation" style="color:#393A34">.</span><span class="token function" style="color:#d73a49">useSslProtocol</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token comment" style="color:#999988;font-style:italic">// Tells the library to setup the default Key and Trust managers for you</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token comment" style="color:#999988;font-style:italic">// which do not do any form of remote server trust verification</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token class-name">Connection</span><span class="token plain"> conn </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> factory</span><span class="token punctuation" style="color:#393A34">.</span><span class="token function" style="color:#d73a49">newConnection</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token class-name">Channel</span><span class="token plain"> channel </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> conn</span><span class="token punctuation" style="color:#393A34">.</span><span class="token function" style="color:#d73a49">createChannel</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token comment" style="color:#999988;font-style:italic">// non-durable, exclusive, auto-delete queue</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        channel</span><span class="token punctuation" style="color:#393A34">.</span><span class="token function" style="color:#d73a49">queueDeclare</span><span class="token punctuation" style="color:#393A34">(</span><span class="token operator" style="color:#393A34">&amp;</span><span class="token plain">quot</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain">rabbitmq</span><span class="token operator" style="color:#393A34">-</span><span class="token plain">java</span><span class="token operator" style="color:#393A34">-</span><span class="token plain">test</span><span class="token operator" style="color:#393A34">&amp;</span><span class="token plain">quot</span><span class="token punctuation" style="color:#393A34">;</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token boolean" style="color:#36acaa">false</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token boolean" style="color:#36acaa">true</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token boolean" style="color:#36acaa">true</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">null</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        channel</span><span class="token punctuation" style="color:#393A34">.</span><span class="token function" style="color:#d73a49">basicPublish</span><span class="token punctuation" style="color:#393A34">(</span><span class="token operator" style="color:#393A34">&amp;</span><span class="token plain">quot</span><span class="token punctuation" style="color:#393A34">;</span><span class="token operator" style="color:#393A34">&amp;</span><span class="token plain">quot</span><span class="token punctuation" style="color:#393A34">;</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">&amp;</span><span class="token plain">quot</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain">rabbitmq</span><span class="token operator" style="color:#393A34">-</span><span class="token plain">java</span><span class="token operator" style="color:#393A34">-</span><span class="token plain">test</span><span class="token operator" style="color:#393A34">&amp;</span><span class="token plain">quot</span><span class="token punctuation" style="color:#393A34">;</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">null</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">&amp;</span><span class="token plain">quot</span><span class="token punctuation" style="color:#393A34">;</span><span class="token class-name">Hello</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token class-name">World</span><span class="token operator" style="color:#393A34">&amp;</span><span class="token plain">quot</span><span class="token punctuation" style="color:#393A34">;</span><span class="token punctuation" style="color:#393A34">.</span><span class="token function" style="color:#d73a49">getBytes</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token class-name">GetResponse</span><span class="token plain"> chResponse </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> channel</span><span class="token punctuation" style="color:#393A34">.</span><span class="token function" style="color:#d73a49">basicGet</span><span class="token punctuation" style="color:#393A34">(</span><span class="token operator" style="color:#393A34">&amp;</span><span class="token plain">quot</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain">rabbitmq</span><span class="token operator" style="color:#393A34">-</span><span class="token plain">java</span><span class="token operator" style="color:#393A34">-</span><span class="token plain">test</span><span class="token operator" style="color:#393A34">&amp;</span><span class="token plain">quot</span><span class="token punctuation" style="color:#393A34">;</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token boolean" style="color:#36acaa">false</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token keyword" style="color:#00009f">if</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">chResponse </span><span class="token operator" style="color:#393A34">==</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">null</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            </span><span class="token class-name">System</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">out</span><span class="token punctuation" style="color:#393A34">.</span><span class="token function" style="color:#d73a49">println</span><span class="token punctuation" style="color:#393A34">(</span><span class="token operator" style="color:#393A34">&amp;</span><span class="token plain">quot</span><span class="token punctuation" style="color:#393A34">;</span><span class="token class-name">No</span><span class="token plain"> message retrieved</span><span class="token operator" style="color:#393A34">&amp;</span><span class="token plain">quot</span><span class="token punctuation" style="color:#393A34">;</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">else</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            </span><span class="token keyword" style="color:#00009f">byte</span><span class="token punctuation" style="color:#393A34">[</span><span class="token punctuation" style="color:#393A34">]</span><span class="token plain"> body </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> chResponse</span><span class="token punctuation" style="color:#393A34">.</span><span class="token function" style="color:#d73a49">getBody</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            </span><span class="token class-name">System</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">out</span><span class="token punctuation" style="color:#393A34">.</span><span class="token function" style="color:#d73a49">println</span><span class="token punctuation" style="color:#393A34">(</span><span class="token operator" style="color:#393A34">&amp;</span><span class="token plain">quot</span><span class="token punctuation" style="color:#393A34">;</span><span class="token class-name">Received</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">&amp;</span><span class="token plain">quot</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">+</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">new</span><span class="token plain"> </span><span class="token class-name">String</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">body</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        channel</span><span class="token punctuation" style="color:#393A34">.</span><span class="token function" style="color:#d73a49">close</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        conn</span><span class="token punctuation" style="color:#393A34">.</span><span class="token function" style="color:#d73a49">close</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">}</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>This simple example is an echo client and server. It creates a channel
and publishes to the default direct exchange, then
fetches back what has been published and echoes it out. It uses
an <a href="/rabbitmq-website/docs/next/queues">exclusive, non-durable, auto-delete queue</a> that will be deleted shortly
after the connection is closed.</p>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="java-client-connecting-with-peer-verification">Connecting with Peer Verification Enabled<a href="#java-client-connecting-with-peer-verification" class="hash-link" aria-label="Direct link to Connecting with Peer Verification Enabled" title="Direct link to Connecting with Peer Verification Enabled">​</a></h3>
<p>For a Java client to trust a server, the server certificate must be added
to a trust store which will be used to instantiate a <a href="https://docs.oracle.com/javase/8/docs/api/javax/net/ssl/TrustManager.html" target="_blank" rel="noopener noreferrer">Trust Manager</a>.
The JDK ships with a tool called <code>keytool</code> that manages certificate stores. To import a certificate to
a store use <code>keytool -import</code>:</p>
<div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">keytool </span><span class="token parameter variable" style="color:#36acaa">-import</span><span class="token plain"> </span><span class="token parameter variable" style="color:#36acaa">-alias</span><span class="token plain"> server1 </span><span class="token parameter variable" style="color:#36acaa">-file</span><span class="token plain"> /path/to/server_certificate.pem </span><span class="token parameter variable" style="color:#36acaa">-keystore</span><span class="token plain"> /path/to/rabbitstore</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>The above command will import <code>server/certificate.pem</code> into the <code>rabbitstore</code> file
using the JKS format. The certificate will be referred to as <code>server1</code> in the trust store.
All certificates and keys must have distinct name in their store.</p>
<p><code>keytool</code> will confirm that the certificate is trusted and ask for a password.
The password protects the trust store from any tampering attempt.</p>
<p>The client certificate and key in a <code>PKCS#12</code> file are then used. Note Java understands
natively the <code>PKCS#12</code> format, no conversion is needed.</p>
<p>The below example demonstrates how the key store and the trust store are used with a
<a href="https://docs.oracle.com/javase/8/docs/api/javax/net/ssl/KeyManager.html" target="_blank" rel="noopener noreferrer">Key Manager</a>
and <a href="https://docs.oracle.com/javase/8/docs/api/javax/net/ssl/TrustManager.html" target="_blank" rel="noopener noreferrer">Trust Manager</a>, respectively.</p>
<div class="language-java codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-java codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token keyword" style="color:#00009f">import</span><span class="token plain"> </span><span class="token import namespace" style="opacity:0.7">java</span><span class="token import namespace punctuation" style="opacity:0.7;color:#393A34">.</span><span class="token import namespace" style="opacity:0.7">io</span><span class="token import namespace punctuation" style="opacity:0.7;color:#393A34">.</span><span class="token import operator" style="color:#393A34">*</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">import</span><span class="token plain"> </span><span class="token import namespace" style="opacity:0.7">java</span><span class="token import namespace punctuation" style="opacity:0.7;color:#393A34">.</span><span class="token import namespace" style="opacity:0.7">security</span><span class="token import namespace punctuation" style="opacity:0.7;color:#393A34">.</span><span class="token import operator" style="color:#393A34">*</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">import</span><span class="token plain"> </span><span class="token import namespace" style="opacity:0.7">javax</span><span class="token import namespace punctuation" style="opacity:0.7;color:#393A34">.</span><span class="token import namespace" style="opacity:0.7">net</span><span class="token import namespace punctuation" style="opacity:0.7;color:#393A34">.</span><span class="token import namespace" style="opacity:0.7">ssl</span><span class="token import namespace punctuation" style="opacity:0.7;color:#393A34">.</span><span class="token import operator" style="color:#393A34">*</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">import</span><span class="token plain"> </span><span class="token import namespace" style="opacity:0.7">com</span><span class="token import namespace punctuation" style="opacity:0.7;color:#393A34">.</span><span class="token import namespace" style="opacity:0.7">rabbitmq</span><span class="token import namespace punctuation" style="opacity:0.7;color:#393A34">.</span><span class="token import namespace" style="opacity:0.7">client</span><span class="token import namespace punctuation" style="opacity:0.7;color:#393A34">.</span><span class="token import operator" style="color:#393A34">*</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">public</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">class</span><span class="token plain"> </span><span class="token class-name">Example2</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token keyword" style="color:#00009f">public</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">static</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">void</span><span class="token plain"> </span><span class="token function" style="color:#d73a49">main</span><span class="token punctuation" style="color:#393A34">(</span><span class="token class-name">String</span><span class="token punctuation" style="color:#393A34">[</span><span class="token punctuation" style="color:#393A34">]</span><span class="token plain"> args</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">throws</span><span class="token plain"> </span><span class="token class-name">Exception</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token keyword" style="color:#00009f">char</span><span class="token punctuation" style="color:#393A34">[</span><span class="token punctuation" style="color:#393A34">]</span><span class="token plain"> keyPassphrase </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">&amp;</span><span class="token plain">quot</span><span class="token punctuation" style="color:#393A34">;</span><span class="token class-name">MySecretPassword</span><span class="token operator" style="color:#393A34">&amp;</span><span class="token plain">quot</span><span class="token punctuation" style="color:#393A34">;</span><span class="token punctuation" style="color:#393A34">.</span><span class="token function" style="color:#d73a49">toCharArray</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token class-name">KeyStore</span><span class="token plain"> ks </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token class-name">KeyStore</span><span class="token punctuation" style="color:#393A34">.</span><span class="token function" style="color:#d73a49">getInstance</span><span class="token punctuation" style="color:#393A34">(</span><span class="token operator" style="color:#393A34">&amp;</span><span class="token plain">quot</span><span class="token punctuation" style="color:#393A34">;</span><span class="token constant" style="color:#36acaa">PKCS12</span><span class="token operator" style="color:#393A34">&amp;</span><span class="token plain">quot</span><span class="token punctuation" style="color:#393A34">;</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      ks</span><span class="token punctuation" style="color:#393A34">.</span><span class="token function" style="color:#d73a49">load</span><span class="token punctuation" style="color:#393A34">(</span><span class="token keyword" style="color:#00009f">new</span><span class="token plain"> </span><span class="token class-name">FileInputStream</span><span class="token punctuation" style="color:#393A34">(</span><span class="token operator" style="color:#393A34">&amp;</span><span class="token plain">quot</span><span class="token punctuation" style="color:#393A34">;</span><span class="token operator" style="color:#393A34">/</span><span class="token plain">path</span><span class="token operator" style="color:#393A34">/</span><span class="token keyword" style="color:#00009f">to</span><span class="token operator" style="color:#393A34">/</span><span class="token plain">client_key</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">p12</span><span class="token operator" style="color:#393A34">&amp;</span><span class="token plain">quot</span><span class="token punctuation" style="color:#393A34">;</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> keyPassphrase</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token class-name">KeyManagerFactory</span><span class="token plain"> kmf </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token class-name">KeyManagerFactory</span><span class="token punctuation" style="color:#393A34">.</span><span class="token function" style="color:#d73a49">getInstance</span><span class="token punctuation" style="color:#393A34">(</span><span class="token operator" style="color:#393A34">&amp;</span><span class="token plain">quot</span><span class="token punctuation" style="color:#393A34">;</span><span class="token class-name">SunX509</span><span class="token operator" style="color:#393A34">&amp;</span><span class="token plain">quot</span><span class="token punctuation" style="color:#393A34">;</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      kmf</span><span class="token punctuation" style="color:#393A34">.</span><span class="token function" style="color:#d73a49">init</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">ks</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> keyPassphrase</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token keyword" style="color:#00009f">char</span><span class="token punctuation" style="color:#393A34">[</span><span class="token punctuation" style="color:#393A34">]</span><span class="token plain"> trustPassphrase </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">&amp;</span><span class="token plain">quot</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain">rabbitstore</span><span class="token operator" style="color:#393A34">&amp;</span><span class="token plain">quot</span><span class="token punctuation" style="color:#393A34">;</span><span class="token punctuation" style="color:#393A34">.</span><span class="token function" style="color:#d73a49">toCharArray</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token class-name">KeyStore</span><span class="token plain"> tks </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token class-name">KeyStore</span><span class="token punctuation" style="color:#393A34">.</span><span class="token function" style="color:#d73a49">getInstance</span><span class="token punctuation" style="color:#393A34">(</span><span class="token operator" style="color:#393A34">&amp;</span><span class="token plain">quot</span><span class="token punctuation" style="color:#393A34">;</span><span class="token constant" style="color:#36acaa">JKS</span><span class="token operator" style="color:#393A34">&amp;</span><span class="token plain">quot</span><span class="token punctuation" style="color:#393A34">;</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      tks</span><span class="token punctuation" style="color:#393A34">.</span><span class="token function" style="color:#d73a49">load</span><span class="token punctuation" style="color:#393A34">(</span><span class="token keyword" style="color:#00009f">new</span><span class="token plain"> </span><span class="token class-name">FileInputStream</span><span class="token punctuation" style="color:#393A34">(</span><span class="token operator" style="color:#393A34">&amp;</span><span class="token plain">quot</span><span class="token punctuation" style="color:#393A34">;</span><span class="token operator" style="color:#393A34">/</span><span class="token plain">path</span><span class="token operator" style="color:#393A34">/</span><span class="token keyword" style="color:#00009f">to</span><span class="token operator" style="color:#393A34">/</span><span class="token plain">trustStore</span><span class="token operator" style="color:#393A34">&amp;</span><span class="token plain">quot</span><span class="token punctuation" style="color:#393A34">;</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> trustPassphrase</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token class-name">TrustManagerFactory</span><span class="token plain"> tmf </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token class-name">TrustManagerFactory</span><span class="token punctuation" style="color:#393A34">.</span><span class="token function" style="color:#d73a49">getInstance</span><span class="token punctuation" style="color:#393A34">(</span><span class="token operator" style="color:#393A34">&amp;</span><span class="token plain">quot</span><span class="token punctuation" style="color:#393A34">;</span><span class="token class-name">SunX509</span><span class="token operator" style="color:#393A34">&amp;</span><span class="token plain">quot</span><span class="token punctuation" style="color:#393A34">;</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      tmf</span><span class="token punctuation" style="color:#393A34">.</span><span class="token function" style="color:#d73a49">init</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">tks</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token class-name">SSLContext</span><span class="token plain"> c </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token class-name">SSLContext</span><span class="token punctuation" style="color:#393A34">.</span><span class="token function" style="color:#d73a49">getInstance</span><span class="token punctuation" style="color:#393A34">(</span><span class="token operator" style="color:#393A34">&amp;</span><span class="token plain">quot</span><span class="token punctuation" style="color:#393A34">;</span><span class="token class-name">TLSv1</span><span class="token number" style="color:#36acaa">.2</span><span class="token operator" style="color:#393A34">&amp;</span><span class="token plain">quot</span><span class="token punctuation" style="color:#393A34">;</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      c</span><span class="token punctuation" style="color:#393A34">.</span><span class="token function" style="color:#d73a49">init</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">kmf</span><span class="token punctuation" style="color:#393A34">.</span><span class="token function" style="color:#d73a49">getKeyManagers</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> tmf</span><span class="token punctuation" style="color:#393A34">.</span><span class="token function" style="color:#d73a49">getTrustManagers</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">null</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token class-name">ConnectionFactory</span><span class="token plain"> factory </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">new</span><span class="token plain"> </span><span class="token class-name">ConnectionFactory</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      factory</span><span class="token punctuation" style="color:#393A34">.</span><span class="token function" style="color:#d73a49">setHost</span><span class="token punctuation" style="color:#393A34">(</span><span class="token operator" style="color:#393A34">&amp;</span><span class="token plain">quot</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain">localhost</span><span class="token operator" style="color:#393A34">&amp;</span><span class="token plain">quot</span><span class="token punctuation" style="color:#393A34">;</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      factory</span><span class="token punctuation" style="color:#393A34">.</span><span class="token function" style="color:#d73a49">setPort</span><span class="token punctuation" style="color:#393A34">(</span><span class="token number" style="color:#36acaa">5671</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      factory</span><span class="token punctuation" style="color:#393A34">.</span><span class="token function" style="color:#d73a49">useSslProtocol</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">c</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      factory</span><span class="token punctuation" style="color:#393A34">.</span><span class="token function" style="color:#d73a49">enableHostnameVerification</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token class-name">Connection</span><span class="token plain"> conn </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> factory</span><span class="token punctuation" style="color:#393A34">.</span><span class="token function" style="color:#d73a49">newConnection</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token class-name">Channel</span><span class="token plain"> channel </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> conn</span><span class="token punctuation" style="color:#393A34">.</span><span class="token function" style="color:#d73a49">createChannel</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      channel</span><span class="token punctuation" style="color:#393A34">.</span><span class="token function" style="color:#d73a49">queueDeclare</span><span class="token punctuation" style="color:#393A34">(</span><span class="token operator" style="color:#393A34">&amp;</span><span class="token plain">quot</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain">rabbitmq</span><span class="token operator" style="color:#393A34">-</span><span class="token plain">java</span><span class="token operator" style="color:#393A34">-</span><span class="token plain">test</span><span class="token operator" style="color:#393A34">&amp;</span><span class="token plain">quot</span><span class="token punctuation" style="color:#393A34">;</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token boolean" style="color:#36acaa">false</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token boolean" style="color:#36acaa">true</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token boolean" style="color:#36acaa">true</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">null</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      channel</span><span class="token punctuation" style="color:#393A34">.</span><span class="token function" style="color:#d73a49">basicPublish</span><span class="token punctuation" style="color:#393A34">(</span><span class="token operator" style="color:#393A34">&amp;</span><span class="token plain">quot</span><span class="token punctuation" style="color:#393A34">;</span><span class="token operator" style="color:#393A34">&amp;</span><span class="token plain">quot</span><span class="token punctuation" style="color:#393A34">;</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">&amp;</span><span class="token plain">quot</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain">rabbitmq</span><span class="token operator" style="color:#393A34">-</span><span class="token plain">java</span><span class="token operator" style="color:#393A34">-</span><span class="token plain">test</span><span class="token operator" style="color:#393A34">&amp;</span><span class="token plain">quot</span><span class="token punctuation" style="color:#393A34">;</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">null</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">&amp;</span><span class="token plain">quot</span><span class="token punctuation" style="color:#393A34">;</span><span class="token class-name">Hello</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token class-name">World</span><span class="token operator" style="color:#393A34">&amp;</span><span class="token plain">quot</span><span class="token punctuation" style="color:#393A34">;</span><span class="token punctuation" style="color:#393A34">.</span><span class="token function" style="color:#d73a49">getBytes</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token class-name">GetResponse</span><span class="token plain"> chResponse </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> channel</span><span class="token punctuation" style="color:#393A34">.</span><span class="token function" style="color:#d73a49">basicGet</span><span class="token punctuation" style="color:#393A34">(</span><span class="token operator" style="color:#393A34">&amp;</span><span class="token plain">quot</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain">rabbitmq</span><span class="token operator" style="color:#393A34">-</span><span class="token plain">java</span><span class="token operator" style="color:#393A34">-</span><span class="token plain">test</span><span class="token operator" style="color:#393A34">&amp;</span><span class="token plain">quot</span><span class="token punctuation" style="color:#393A34">;</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token boolean" style="color:#36acaa">false</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token keyword" style="color:#00009f">if</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">chResponse </span><span class="token operator" style="color:#393A34">==</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">null</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">          </span><span class="token class-name">System</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">out</span><span class="token punctuation" style="color:#393A34">.</span><span class="token function" style="color:#d73a49">println</span><span class="token punctuation" style="color:#393A34">(</span><span class="token operator" style="color:#393A34">&amp;</span><span class="token plain">quot</span><span class="token punctuation" style="color:#393A34">;</span><span class="token class-name">No</span><span class="token plain"> message retrieved</span><span class="token operator" style="color:#393A34">&amp;</span><span class="token plain">quot</span><span class="token punctuation" style="color:#393A34">;</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">else</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">          </span><span class="token keyword" style="color:#00009f">byte</span><span class="token punctuation" style="color:#393A34">[</span><span class="token punctuation" style="color:#393A34">]</span><span class="token plain"> body </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> chResponse</span><span class="token punctuation" style="color:#393A34">.</span><span class="token function" style="color:#d73a49">getBody</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">          </span><span class="token class-name">System</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">out</span><span class="token punctuation" style="color:#393A34">.</span><span class="token function" style="color:#d73a49">println</span><span class="token punctuation" style="color:#393A34">(</span><span class="token operator" style="color:#393A34">&amp;</span><span class="token plain">quot</span><span class="token punctuation" style="color:#393A34">;</span><span class="token class-name">Received</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">&amp;</span><span class="token plain">quot</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">+</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">new</span><span class="token plain"> </span><span class="token class-name">String</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">body</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      channel</span><span class="token punctuation" style="color:#393A34">.</span><span class="token function" style="color:#d73a49">close</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      conn</span><span class="token punctuation" style="color:#393A34">.</span><span class="token function" style="color:#d73a49">close</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">}</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>To ensure that the above code works as expected with untrusted certificates, set up
a RabbitMQ node with a certificate that has not been imported
into the key store and watch the connection fail.</p>
<h4 class="anchor anchorWithStickyNavbar_LWe7" id="server-hostname-verification"><a class="anchor" href="#java-client-hostname-verification">Server Hostname Verification</a><a href="#server-hostname-verification" class="hash-link" aria-label="Direct link to server-hostname-verification" title="Direct link to server-hostname-verification">​</a></h4>
<p>Hostname verification must be enabled separately using the
<code>ConnectionFactory#enableHostnameVerification()</code> method. This is done in the example
above, for instance:</p>
<div class="language-java codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-java codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token keyword" style="color:#00009f">import</span><span class="token plain"> </span><span class="token import namespace" style="opacity:0.7">java</span><span class="token import namespace punctuation" style="opacity:0.7;color:#393A34">.</span><span class="token import namespace" style="opacity:0.7">io</span><span class="token import namespace punctuation" style="opacity:0.7;color:#393A34">.</span><span class="token import operator" style="color:#393A34">*</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">import</span><span class="token plain"> </span><span class="token import namespace" style="opacity:0.7">java</span><span class="token import namespace punctuation" style="opacity:0.7;color:#393A34">.</span><span class="token import namespace" style="opacity:0.7">security</span><span class="token import namespace punctuation" style="opacity:0.7;color:#393A34">.</span><span class="token import operator" style="color:#393A34">*</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">import</span><span class="token plain"> </span><span class="token import namespace" style="opacity:0.7">javax</span><span class="token import namespace punctuation" style="opacity:0.7;color:#393A34">.</span><span class="token import namespace" style="opacity:0.7">net</span><span class="token import namespace punctuation" style="opacity:0.7;color:#393A34">.</span><span class="token import namespace" style="opacity:0.7">ssl</span><span class="token import namespace punctuation" style="opacity:0.7;color:#393A34">.</span><span class="token import operator" style="color:#393A34">*</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">import</span><span class="token plain"> </span><span class="token import namespace" style="opacity:0.7">com</span><span class="token import namespace punctuation" style="opacity:0.7;color:#393A34">.</span><span class="token import namespace" style="opacity:0.7">rabbitmq</span><span class="token import namespace punctuation" style="opacity:0.7;color:#393A34">.</span><span class="token import namespace" style="opacity:0.7">client</span><span class="token import namespace punctuation" style="opacity:0.7;color:#393A34">.</span><span class="token import operator" style="color:#393A34">*</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">public</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">class</span><span class="token plain"> </span><span class="token class-name">Example2</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token keyword" style="color:#00009f">public</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">static</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">void</span><span class="token plain"> </span><span class="token function" style="color:#d73a49">main</span><span class="token punctuation" style="color:#393A34">(</span><span class="token class-name">String</span><span class="token punctuation" style="color:#393A34">[</span><span class="token punctuation" style="color:#393A34">]</span><span class="token plain"> args</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">throws</span><span class="token plain"> </span><span class="token class-name">Exception</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token keyword" style="color:#00009f">char</span><span class="token punctuation" style="color:#393A34">[</span><span class="token punctuation" style="color:#393A34">]</span><span class="token plain"> keyPassphrase </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">&amp;</span><span class="token plain">quot</span><span class="token punctuation" style="color:#393A34">;</span><span class="token class-name">MySecretPassword</span><span class="token operator" style="color:#393A34">&amp;</span><span class="token plain">quot</span><span class="token punctuation" style="color:#393A34">;</span><span class="token punctuation" style="color:#393A34">.</span><span class="token function" style="color:#d73a49">toCharArray</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token class-name">KeyStore</span><span class="token plain"> ks </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token class-name">KeyStore</span><span class="token punctuation" style="color:#393A34">.</span><span class="token function" style="color:#d73a49">getInstance</span><span class="token punctuation" style="color:#393A34">(</span><span class="token operator" style="color:#393A34">&amp;</span><span class="token plain">quot</span><span class="token punctuation" style="color:#393A34">;</span><span class="token constant" style="color:#36acaa">PKCS12</span><span class="token operator" style="color:#393A34">&amp;</span><span class="token plain">quot</span><span class="token punctuation" style="color:#393A34">;</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      ks</span><span class="token punctuation" style="color:#393A34">.</span><span class="token function" style="color:#d73a49">load</span><span class="token punctuation" style="color:#393A34">(</span><span class="token keyword" style="color:#00009f">new</span><span class="token plain"> </span><span class="token class-name">FileInputStream</span><span class="token punctuation" style="color:#393A34">(</span><span class="token operator" style="color:#393A34">&amp;</span><span class="token plain">quot</span><span class="token punctuation" style="color:#393A34">;</span><span class="token operator" style="color:#393A34">/</span><span class="token plain">path</span><span class="token operator" style="color:#393A34">/</span><span class="token keyword" style="color:#00009f">to</span><span class="token operator" style="color:#393A34">/</span><span class="token plain">client_key</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">p12</span><span class="token operator" style="color:#393A34">&amp;</span><span class="token plain">quot</span><span class="token punctuation" style="color:#393A34">;</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> keyPassphrase</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token class-name">KeyManagerFactory</span><span class="token plain"> kmf </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token class-name">KeyManagerFactory</span><span class="token punctuation" style="color:#393A34">.</span><span class="token function" style="color:#d73a49">getInstance</span><span class="token punctuation" style="color:#393A34">(</span><span class="token operator" style="color:#393A34">&amp;</span><span class="token plain">quot</span><span class="token punctuation" style="color:#393A34">;</span><span class="token class-name">SunX509</span><span class="token operator" style="color:#393A34">&amp;</span><span class="token plain">quot</span><span class="token punctuation" style="color:#393A34">;</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      kmf</span><span class="token punctuation" style="color:#393A34">.</span><span class="token function" style="color:#d73a49">init</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">ks</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> keyPassphrase</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token keyword" style="color:#00009f">char</span><span class="token punctuation" style="color:#393A34">[</span><span class="token punctuation" style="color:#393A34">]</span><span class="token plain"> trustPassphrase </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">&amp;</span><span class="token plain">quot</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain">rabbitstore</span><span class="token operator" style="color:#393A34">&amp;</span><span class="token plain">quot</span><span class="token punctuation" style="color:#393A34">;</span><span class="token punctuation" style="color:#393A34">.</span><span class="token function" style="color:#d73a49">toCharArray</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token class-name">KeyStore</span><span class="token plain"> tks </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token class-name">KeyStore</span><span class="token punctuation" style="color:#393A34">.</span><span class="token function" style="color:#d73a49">getInstance</span><span class="token punctuation" style="color:#393A34">(</span><span class="token operator" style="color:#393A34">&amp;</span><span class="token plain">quot</span><span class="token punctuation" style="color:#393A34">;</span><span class="token constant" style="color:#36acaa">JKS</span><span class="token operator" style="color:#393A34">&amp;</span><span class="token plain">quot</span><span class="token punctuation" style="color:#393A34">;</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      tks</span><span class="token punctuation" style="color:#393A34">.</span><span class="token function" style="color:#d73a49">load</span><span class="token punctuation" style="color:#393A34">(</span><span class="token keyword" style="color:#00009f">new</span><span class="token plain"> </span><span class="token class-name">FileInputStream</span><span class="token punctuation" style="color:#393A34">(</span><span class="token operator" style="color:#393A34">&amp;</span><span class="token plain">quot</span><span class="token punctuation" style="color:#393A34">;</span><span class="token operator" style="color:#393A34">/</span><span class="token plain">path</span><span class="token operator" style="color:#393A34">/</span><span class="token keyword" style="color:#00009f">to</span><span class="token operator" style="color:#393A34">/</span><span class="token plain">trustStore</span><span class="token operator" style="color:#393A34">&amp;</span><span class="token plain">quot</span><span class="token punctuation" style="color:#393A34">;</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> trustPassphrase</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token class-name">TrustManagerFactory</span><span class="token plain"> tmf </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token class-name">TrustManagerFactory</span><span class="token punctuation" style="color:#393A34">.</span><span class="token function" style="color:#d73a49">getInstance</span><span class="token punctuation" style="color:#393A34">(</span><span class="token operator" style="color:#393A34">&amp;</span><span class="token plain">quot</span><span class="token punctuation" style="color:#393A34">;</span><span class="token class-name">SunX509</span><span class="token operator" style="color:#393A34">&amp;</span><span class="token plain">quot</span><span class="token punctuation" style="color:#393A34">;</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      tmf</span><span class="token punctuation" style="color:#393A34">.</span><span class="token function" style="color:#d73a49">init</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">tks</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token class-name">SSLContext</span><span class="token plain"> c </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token class-name">SSLContext</span><span class="token punctuation" style="color:#393A34">.</span><span class="token function" style="color:#d73a49">getInstance</span><span class="token punctuation" style="color:#393A34">(</span><span class="token operator" style="color:#393A34">&amp;</span><span class="token plain">quot</span><span class="token punctuation" style="color:#393A34">;</span><span class="token class-name">TLSv1</span><span class="token number" style="color:#36acaa">.2</span><span class="token operator" style="color:#393A34">&amp;</span><span class="token plain">quot</span><span class="token punctuation" style="color:#393A34">;</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      c</span><span class="token punctuation" style="color:#393A34">.</span><span class="token function" style="color:#d73a49">init</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">kmf</span><span class="token punctuation" style="color:#393A34">.</span><span class="token function" style="color:#d73a49">getKeyManagers</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> tmf</span><span class="token punctuation" style="color:#393A34">.</span><span class="token function" style="color:#d73a49">getTrustManagers</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">null</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token class-name">ConnectionFactory</span><span class="token plain"> factory </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">new</span><span class="token plain"> </span><span class="token class-name">ConnectionFactory</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      factory</span><span class="token punctuation" style="color:#393A34">.</span><span class="token function" style="color:#d73a49">setHost</span><span class="token punctuation" style="color:#393A34">(</span><span class="token operator" style="color:#393A34">&amp;</span><span class="token plain">quot</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain">localhost</span><span class="token operator" style="color:#393A34">&amp;</span><span class="token plain">quot</span><span class="token punctuation" style="color:#393A34">;</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      factory</span><span class="token punctuation" style="color:#393A34">.</span><span class="token function" style="color:#d73a49">setPort</span><span class="token punctuation" style="color:#393A34">(</span><span class="token number" style="color:#36acaa">5671</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      factory</span><span class="token punctuation" style="color:#393A34">.</span><span class="token function" style="color:#d73a49">useSslProtocol</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">c</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      factory</span><span class="token punctuation" style="color:#393A34">.</span><span class="token function" style="color:#d73a49">enableHostnameVerification</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token comment" style="color:#999988;font-style:italic">// this connection will both perform peer verification</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token comment" style="color:#999988;font-style:italic">// and server hostname verification</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token class-name">Connection</span><span class="token plain"> conn </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> factory</span><span class="token punctuation" style="color:#393A34">.</span><span class="token function" style="color:#d73a49">newConnection</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token comment" style="color:#999988;font-style:italic">// snip ...</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">}</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>This will verify
that the server certificate has been issued for the hostname the
client is connecting to. Unlike certificate chain verification, this feature
is client-specific (not usually performed by the server).</p>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="tls-versions-java-client">Configuring TLS Version in Java Client<a href="#tls-versions-java-client" class="hash-link" aria-label="Direct link to Configuring TLS Version in Java Client" title="Direct link to Configuring TLS Version in Java Client">​</a></h3>
<p>Just like RabbitMQ server can be <a href="#tls-versions">configured to support only specific TLS versions</a>,
it may be necessary to configure preferred TLS version in the Java client. This is done using
the <code>ConnectionFactory#useSslProtocol</code> overloads that accept a protocol version name
or a <code>SSLContext</code>:</p>
<div class="language-java codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-java codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token class-name">ConnectionFactory</span><span class="token plain"> factory </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">new</span><span class="token plain"> </span><span class="token class-name">ConnectionFactory</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">factory</span><span class="token punctuation" style="color:#393A34">.</span><span class="token function" style="color:#d73a49">setHost</span><span class="token punctuation" style="color:#393A34">(</span><span class="token operator" style="color:#393A34">&amp;</span><span class="token plain">quot</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain">localhost</span><span class="token operator" style="color:#393A34">&amp;</span><span class="token plain">quot</span><span class="token punctuation" style="color:#393A34">;</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">factory</span><span class="token punctuation" style="color:#393A34">.</span><span class="token function" style="color:#d73a49">setPort</span><span class="token punctuation" style="color:#393A34">(</span><span class="token number" style="color:#36acaa">5671</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">factory</span><span class="token punctuation" style="color:#393A34">.</span><span class="token function" style="color:#d73a49">useSslProtocol</span><span class="token punctuation" style="color:#393A34">(</span><span class="token string" style="color:#e3116c">&quot;TLSv1.2&quot;</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>Modern releases of the library will attempt to use the latest TLS version
supported by the runtime.</p>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="dotnet-client">Using TLS in the .NET Client<a href="#dotnet-client" class="hash-link" aria-label="Direct link to Using TLS in the .NET Client" title="Direct link to Using TLS in the .NET Client">​</a></h2>
<p>For a client certificate to be understood on the .NET platform, they
can be in a number of formats including DER and PKCS#12 but
not PEM. For the DER format, .NET expects them to
be stored in files with <code>.cer</code> extension. <a href="#automated-certificate-generation">tls-gen</a>
generates both PEM and PKCS#12 files.</p>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="dotnet-peer-verification">.NET Trust Store<a href="#dotnet-peer-verification" class="hash-link" aria-label="Direct link to .NET Trust Store" title="Direct link to .NET Trust Store">​</a></h3>
<p>On the .NET platform, <a href="#peer-verification-trusted-certificates">trusted certificates</a> are managed by putting them
into any of a number of stores. All management of these stores is done
with the &#x27;certmgr&#x27; tool.</p>
<p>N.B.: on some flavours of Windows there are two versions of
the command: one that ships with the operating system and
provides a graphical interface only, and one that ships
with the Windows SDK and provides both a graphical and command line interface.
Either will do the job, but the examples below are based on the latter.</p>
<p>For our case, because we&#x27;re supplying the client certificate/key pair
in a separate PKCS#12 file, all we need to do is to import the
certificate of the root Certificate Authority into
the Root (Windows) or Trust (Mono) store.
All certificates signed by any certificate in that store are automatically trusted.</p>
<p>In contrast to the Java client, which is happy to use a
TLS connection without performing peer verification, the .NET client by default requires this
verification to succeed. To suppress verification, an application can set
the <code>System.Net.Security.SslPolicyErrors.RemoteCertificateNotAvailable</code>
and <code>System.Net.Security.SslPolicyErrors.RemoteCertificateChainErrors</code>
flags in <a href="https://rabbitmq.github.io/rabbitmq-dotnet-client/api/RabbitMQ.Client.SslOption.html">SslOption</a>.</p>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="certmgr">Certificate Management with Certmgr<a href="#certmgr" class="hash-link" aria-label="Direct link to Certificate Management with Certmgr" title="Direct link to Certificate Management with Certmgr">​</a></h3>
<p><code>certmgr</code> is a command line tool that manages certificates in a specified store, for example,
adds and deletes them. These stores can be per-user stores, or
system-wide. Only administrative users can have write access to the system-wide stores.</p>
<p>The following example adds a certificate to the store of user <code>Root</code> (also known as <code>Trust</code> in some .NET implementation)</p>
<div class="language-PowerShell language-powershell codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-powershell codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token comment" style="color:#999988;font-style:italic"># Windows</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">certmgr </span><span class="token operator" style="color:#393A34">-</span><span class="token plain">add </span><span class="token operator" style="color:#393A34">-</span><span class="token plain">all \path\to\cacert</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">cer </span><span class="token operator" style="color:#393A34">-</span><span class="token plain">s Root</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token comment" style="color:#999988;font-style:italic"># Linux with Mono</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">certmgr </span><span class="token parameter variable" style="color:#36acaa">-add</span><span class="token plain"> </span><span class="token parameter variable" style="color:#36acaa">-c</span><span class="token plain"> Trust /path/to/cacert.cer</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>To add a certificate to the system-wide (machine) certificate store instead, run</p>
<div class="language-PowerShell language-powershell codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-powershell codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token comment" style="color:#999988;font-style:italic"># Windows</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">certmgr </span><span class="token operator" style="color:#393A34">-</span><span class="token plain">add </span><span class="token operator" style="color:#393A34">-</span><span class="token plain">all \path\to\cacert</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">cer </span><span class="token operator" style="color:#393A34">-</span><span class="token plain">s </span><span class="token operator" style="color:#393A34">-</span><span class="token plain">r localMachine Root</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<div class="language-bash= codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-bash= codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain"># Linux with Mono</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">certmgr -add -c -m Trust /path/to/cacert.cer</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>After adding to a store, we can view the contents of that store with the <code>-all</code> (<code>-list</code> with Mono) switch:</p>
<div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">certmgr </span><span class="token parameter variable" style="color:#36acaa">-all</span><span class="token plain"> </span><span class="token parameter variable" style="color:#36acaa">-s</span><span class="token plain"> Root</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token comment" style="color:#999988;font-style:italic"># … snip …</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">Self-signed X.509 v3 Certificate</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  Serial Number: AC3F2B74ECDD9EEA00</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  Issuer Name:   </span><span class="token assign-left variable" style="color:#36acaa">CN</span><span class="token operator" style="color:#393A34">=</span><span class="token plain">MyTestCA</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  Subject Name:  </span><span class="token assign-left variable" style="color:#36acaa">CN</span><span class="token operator" style="color:#393A34">=</span><span class="token plain">MyTestCA</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  valid From:    </span><span class="token number" style="color:#36acaa">25</span><span class="token plain">/08/2018 </span><span class="token number" style="color:#36acaa">14</span><span class="token plain">:03:01</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  valid Until:   </span><span class="token number" style="color:#36acaa">24</span><span class="token plain">/09/2018 </span><span class="token number" style="color:#36acaa">14</span><span class="token plain">:03:01</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  Unique Hash:   1F04D1D2C20B97BDD5DB70B9EB2013550697A05E</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">certmgr </span><span class="token parameter variable" style="color:#36acaa">-list</span><span class="token plain"> </span><span class="token parameter variable" style="color:#36acaa">-c</span><span class="token plain"> Trust</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token comment" style="color:#999988;font-style:italic"># … snip …</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">Self-signed X.509 v3 Certificate</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  Serial Number: AC3F2B74ECDD9EEA00</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  Issuer Name:   </span><span class="token assign-left variable" style="color:#36acaa">CN</span><span class="token operator" style="color:#393A34">=</span><span class="token plain">MyTestCA</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  Subject Name:  </span><span class="token assign-left variable" style="color:#36acaa">CN</span><span class="token operator" style="color:#393A34">=</span><span class="token plain">MyTestCA</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  valid From:    </span><span class="token number" style="color:#36acaa">25</span><span class="token plain">/08/2018 </span><span class="token number" style="color:#36acaa">14</span><span class="token plain">:03:01</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  valid Until:   </span><span class="token number" style="color:#36acaa">24</span><span class="token plain">/09/2018 </span><span class="token number" style="color:#36acaa">14</span><span class="token plain">:03:01</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  Unique Hash:   1F04D1D2C20B97BDD5DB70B9EB2013550697A05E</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>According to the above output there is one Self-signed X.509 v3 Certificate in the
trust store. The Unique Hash uniquely identifies this certificate in
this store. To delete this certificate, use the unique hash:</p>
<div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token comment" style="color:#999988;font-style:italic"># Windows</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">certmgr </span><span class="token parameter variable" style="color:#36acaa">-del</span><span class="token plain"> </span><span class="token parameter variable" style="color:#36acaa">-c</span><span class="token plain"> </span><span class="token parameter variable" style="color:#36acaa">-sha1</span><span class="token plain"> 1F04D1D2C20B97BDD5DB70B9EB2013550697A05E </span><span class="token parameter variable" style="color:#36acaa">-s</span><span class="token plain"> Root</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token comment" style="color:#999988;font-style:italic"># … snip …</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">Certificate removed from store.</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token comment" style="color:#999988;font-style:italic"># Linux with Mono</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">certmgr </span><span class="token parameter variable" style="color:#36acaa">-del</span><span class="token plain"> </span><span class="token parameter variable" style="color:#36acaa">-c</span><span class="token plain"> Trust 1F04D1D2C20B97BDD5DB70B9EB2013550697A05E</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token comment" style="color:#999988;font-style:italic"># … snip …</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">Certificate removed from store.</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="dotnet-connection-params">Connection TLS Settings<a href="#dotnet-connection-params" class="hash-link" aria-label="Direct link to Connection TLS Settings" title="Direct link to Connection TLS Settings">​</a></h3>
<p>To create a TLS-enabled connection to RabbitMQ, we need to set some new
fields in the ConnectionFactory&#x27;s Parameters field.
To make things
easier, there is a new Field Parameters.Ssl that acts like a namespace
for all the other fields that we need to set. The fields are:</p>
<table class="plain"><thead><td>Property</td><td>Description</td></thead><tr><td><code>Ssl.CertPath</code></td><td><p>This is the path to the client&#x27;s certificate in
PKCS#12 format if your server expects client side verification. This
is optional.</p></td></tr><tr><td><code>Ssl.CertPassphrase</code></td><td><p>If you are using a client certificate in PKCS#12
format then it&#x27;ll probably have a password, which you specify in
this field.</p></td></tr><tr><td><code>Ssl.Enabled</code></td><td>This is a boolean field that turns TLS support on or
off. It is off by default.</td></tr><tr><td><code>Ssl.ServerName</code></td><td><p>.NET expects this to match the Subject Alternative Name (SAN) or Common Name (CN) on
the certificate that the server sends over.</p></td></tr></table>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="dotnet-tls-versions-dotnet-client">TLS Versions<a href="#dotnet-tls-versions-dotnet-client" class="hash-link" aria-label="Direct link to TLS Versions" title="Direct link to TLS Versions">​</a></h3>
<p>TLS has been around since the mid-90s, and there are multiple TLS versions available,
although older versions are retired by the industry <a href="https://www.cloudflare.com/en-ca/learning/ssl/why-use-tls-1.3/" target="_blank" rel="noopener noreferrer">as newer and more secure ones are developed</a>.</p>
<p>Just like RabbitMQ server can be <a href="#tls-versions">configured to support only specific TLS versions</a>,
it may be necessary to configure preferred TLS version in the .NET client. This is done using
the TLS options accessible via <code>ConnectionFactory#Ssl</code>.</p>
<p>Supported TLS version values are those of the <a href="https://docs.microsoft.com/en-us/dotnet/api/system.security.authentication.sslprotocols?view=netframework-4.8" target="_blank" rel="noopener noreferrer">System.Security.Authentication.SslProtocols enum</a>:</p>
<div class="language-csharp codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-csharp codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token keyword" style="color:#00009f">using</span><span class="token plain"> </span><span class="token namespace" style="opacity:0.7">System</span><span class="token namespace punctuation" style="opacity:0.7;color:#393A34">.</span><span class="token namespace" style="opacity:0.7">Security</span><span class="token namespace punctuation" style="opacity:0.7;color:#393A34">.</span><span class="token namespace" style="opacity:0.7">Authentication</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token comment" style="color:#999988;font-style:italic">// ...</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token class-name">ConnectionFactory</span><span class="token plain"> cf </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">new</span><span class="token plain"> </span><span class="token constructor-invocation class-name">ConnectionFactory</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">cf</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">Ssl</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">Enabled </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token boolean" style="color:#36acaa">true</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">cf</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">Ssl</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">ServerName </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> System</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">Net</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">Dns</span><span class="token punctuation" style="color:#393A34">.</span><span class="token function" style="color:#d73a49">GetHostName</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">cf</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">Ssl</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">CertPath </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;/path/to/client_key.p12&quot;</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">cf</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">Ssl</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">CertPassphrase </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;MySecretPassword&quot;</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token comment" style="color:#999988;font-style:italic">// Use TLSv1.2 for this connection</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">cf</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">Ssl</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">Version </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> SslProtocols</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">Tls12</span><span class="token punctuation" style="color:#393A34">;</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>RabbitMQ .NET client 5.x series uses TLSv1.0 by default.</p>
<p>Starting with RabbitMQ .NET client 6.0
the default changes to <a href="https://docs.microsoft.com/en-us/dotnet/api/system.security.authentication.sslprotocols?view=netframework-4.8#System_Security_Authentication_SslProtocols_None" target="_blank" rel="noopener noreferrer"><code>SslProtocols.None</code></a>,
which means the default is <a href="https://docs.microsoft.com/en-us/dotnet/framework/network-programming/tls?view=netframework-4.6.2" target="_blank" rel="noopener noreferrer">picked by the .NET framework or the operating system</a> depending on <a href="https://docs.microsoft.com/en-us/dotnet/framework/network-programming/tls?view=netframework-4.6.2#configuring-security-via-appcontext-switches-for-net-framework-46-or-later-versions" target="_blank" rel="noopener noreferrer">app context switches</a>.</p>
<p>If a connection that uses <code>SslProtocols.None</code> to pick a suitable TLS version fails, the client
will retry with TLSv1.2 enabled explicitly. This reduces the need for explicit configuration
on the application developer&#x27;s end in environments where automatic TLS version selection is
disabled, not available or otherwise cannot be relied on.</p>
<p>Modern .NET frameworks versions <a href="https://docs.microsoft.com/en-us/dotnet/framework/network-programming/tls?view=netframework-4.6.2" target="_blank" rel="noopener noreferrer">default to TLSv1.2</a>.</p>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="dotnet-example">Code Example<a href="#dotnet-example" class="hash-link" aria-label="Direct link to Code Example" title="Direct link to Code Example">​</a></h3>
<p>This is a more or less direct port of the <a href="#java-client-connecting">Java client example</a>. It
creates a channel and publishes to
the default direct exchange, then reads back what has been
published and echoes it out. Note that we use an
<a href="/rabbitmq-website/docs/next/queues">exclusive, non-durable, auto-delete queue</a> so we don&#x27;t have
to worry about manually cleaning up after ourselves</p>
<div class="language-csharp codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-csharp codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token keyword" style="color:#00009f">using</span><span class="token plain"> </span><span class="token namespace" style="opacity:0.7">System</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">using</span><span class="token plain"> </span><span class="token namespace" style="opacity:0.7">System</span><span class="token namespace punctuation" style="opacity:0.7;color:#393A34">.</span><span class="token namespace" style="opacity:0.7">IO</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">using</span><span class="token plain"> </span><span class="token namespace" style="opacity:0.7">System</span><span class="token namespace punctuation" style="opacity:0.7;color:#393A34">.</span><span class="token namespace" style="opacity:0.7">Text</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">using</span><span class="token plain"> </span><span class="token namespace" style="opacity:0.7">RabbitMQ</span><span class="token namespace punctuation" style="opacity:0.7;color:#393A34">.</span><span class="token namespace" style="opacity:0.7">client</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">namespace</span><span class="token plain"> </span><span class="token namespace" style="opacity:0.7">RabbitMQ</span><span class="token namespace punctuation" style="opacity:0.7;color:#393A34">.</span><span class="token namespace" style="opacity:0.7">client</span><span class="token namespace punctuation" style="opacity:0.7;color:#393A34">.</span><span class="token namespace" style="opacity:0.7">Examples</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token keyword" style="color:#00009f">public</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">class</span><span class="token plain"> </span><span class="token class-name">TestSSL</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token keyword" style="color:#00009f">public</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">static</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">async</span><span class="token plain"> </span><span class="token return-type class-name">Task</span><span class="token return-type class-name punctuation" style="color:#393A34">&lt;</span><span class="token return-type class-name keyword" style="color:#00009f">int</span><span class="token return-type class-name punctuation" style="color:#393A34">&gt;</span><span class="token plain"> </span><span class="token function" style="color:#d73a49">Main</span><span class="token punctuation" style="color:#393A34">(</span><span class="token class-name keyword" style="color:#00009f">string</span><span class="token class-name punctuation" style="color:#393A34">[</span><span class="token class-name punctuation" style="color:#393A34">]</span><span class="token plain"> args</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token class-name">ConnectionFactory</span><span class="token plain"> cf </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">new</span><span class="token plain"> </span><span class="token constructor-invocation class-name">ConnectionFactory</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      cf</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">Ssl</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">Enabled </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token boolean" style="color:#36acaa">true</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      cf</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">Ssl</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">ServerName </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> System</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">Net</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">Dns</span><span class="token punctuation" style="color:#393A34">.</span><span class="token function" style="color:#d73a49">GetHostName</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      cf</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">Ssl</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">CertPath </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;/path/to/client_key.p12&quot;</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      cf</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">Ssl</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">CertPassphrase </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;MySecretPassword&quot;</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token keyword" style="color:#00009f">using</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">(</span><span class="token class-name">IConnection</span><span class="token plain"> conn </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">await</span><span class="token plain"> cf</span><span class="token punctuation" style="color:#393A34">.</span><span class="token function" style="color:#d73a49">CreateConnectionAsync</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token keyword" style="color:#00009f">using</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">(</span><span class="token class-name">IChannel</span><span class="token plain"> ch </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">await</span><span class="token plain"> conn</span><span class="token punctuation" style="color:#393A34">.</span><span class="token function" style="color:#d73a49">CreateChannelAsync</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">          Console</span><span class="token punctuation" style="color:#393A34">.</span><span class="token function" style="color:#d73a49">WriteLine</span><span class="token punctuation" style="color:#393A34">(</span><span class="token string" style="color:#e3116c">&quot;Successfully connected and opened a channel&quot;</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">          </span><span class="token keyword" style="color:#00009f">await</span><span class="token plain"> ch</span><span class="token punctuation" style="color:#393A34">.</span><span class="token function" style="color:#d73a49">QueueDeclareAsync</span><span class="token punctuation" style="color:#393A34">(</span><span class="token string" style="color:#e3116c">&quot;rabbitmq-dotnet-test&quot;</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token boolean" style="color:#36acaa">false</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token boolean" style="color:#36acaa">false</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token boolean" style="color:#36acaa">false</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">null</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">          Console</span><span class="token punctuation" style="color:#393A34">.</span><span class="token function" style="color:#d73a49">WriteLine</span><span class="token punctuation" style="color:#393A34">(</span><span class="token string" style="color:#e3116c">&quot;Successfully declared a queue&quot;</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">          </span><span class="token keyword" style="color:#00009f">await</span><span class="token plain"> ch</span><span class="token punctuation" style="color:#393A34">.</span><span class="token function" style="color:#d73a49">QueueDeleteAsync</span><span class="token punctuation" style="color:#393A34">(</span><span class="token string" style="color:#e3116c">&quot;rabbitmq-dotnet-test&quot;</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">          Console</span><span class="token punctuation" style="color:#393A34">.</span><span class="token function" style="color:#d73a49">WriteLine</span><span class="token punctuation" style="color:#393A34">(</span><span class="token string" style="color:#e3116c">&quot;Successfully deleted the queue&quot;</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token keyword" style="color:#00009f">return</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">0</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">}</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="tls-verification-in-dotnet">TLS Peer Verification in .NET Client<a href="#tls-verification-in-dotnet" class="hash-link" aria-label="Direct link to TLS Peer Verification in .NET Client" title="Direct link to TLS Peer Verification in .NET Client">​</a></h3>
<p>TLS offers peer verification (validation), a way for client and server to
verify each other&#x27;s identity based on peer&#x27;s certificate information.
When peer verification is enabled, typically the <em class="">hostname</em> of the server
you&#x27;re connecting to needs to match the <em class="">CN (Common Name)</em> field on
the server&#x27;s certificate, otherwise the certificate will be
rejected. However, peer verification doesn&#x27;t have to be limited to just CN
and hostname matching in general.</p>
<p>This is why the commands at the start of this guide specify
<code>...-subj /CN=$(hostname)/...</code> which dynamically looks up your
hostname. If you&#x27;re generating certificates on one machine, and using
them on the other then be sure to swap out the <code>$(hostname)</code>
section, and replace it with the correct hostname for your server.</p>
<p>On the .NET platform, <a href="http://msdn.microsoft.com/en-us/library/system.net.security.remotecertificatevalidationcallback(v=vs.110).aspx" target="_blank" rel="noopener noreferrer">RemoteCertificateValidationCallback</a>
controls TLS verification behavior.</p>
<p>In RabbitMQ .NET client, <code>RabbitMQ.client.SslOption.CertificatevalidationCallback</code>
can be used to provide a <a href="http://msdn.microsoft.com/en-us/library/system.net.security.remotecertificatevalidationcallback(v=vs.110).aspx" target="_blank" rel="noopener noreferrer">RemoteCertificateValidationCallback</a>
delegate. The delegate will be used to verify peer (RabbitMQ node) identity using whatever logic fits
the applications.</p>
<p>If this is not specified, the default callback will be
used in conjunction with the AcceptablePolicyErrors
property to determine if the remote server certificate is
valid.</p>
<p>The <code>System.Net.Security.SslPolicyErrors.RemoteCertificateNameMismatch</code>
flag in <code>RabbitMQ.client.SslOption.AcceptablePolicyErrors</code>
can be used to disable peer verification (not recommended in production environments!).</p>
<p><code>RabbitMQ.client.SslOption.CertificateSelectionCallback</code>
can be used to provide
a <a href="http://msdn.microsoft.com/en-us/library/system.net.security.localcertificateselectioncallback(v=vs.110).aspx" target="_blank" rel="noopener noreferrer">LocalCertificateSelectionCallback</a>
that will select the local certificate used for peer verification.</p>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="tls-versions">Limiting TLS Versions Used by the Server<a href="#tls-versions" class="hash-link" aria-label="Direct link to Limiting TLS Versions Used by the Server" title="Direct link to Limiting TLS Versions Used by the Server">​</a></h2>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="tls-versions-why-limit">Why Limit TLS Versions<a href="#tls-versions-why-limit" class="hash-link" aria-label="Direct link to Why Limit TLS Versions" title="Direct link to Why Limit TLS Versions">​</a></h3>
<p>TLS (née SSL) has evolved over time and has multiple versions in use.
Each version builds on the shortcomings of previous versions. Most of the time
the shortcomings resulted in <a href="#major-vulnerabilities">known attacks</a> that affect specific
versions of TLS (and SSL). Disabling older TLS versions is a way to mitigate
many of those attacks (another technique is to <a href="#cipher-suites">disable affected cipher suites</a>).</p>
<p>For the above reasons, recent release series of Erlang only enable latest supported
TLS version by default, as demonstrated in the below table.</p>
<table><thead><tr><td><strong>Erlang Series</strong></td><td><strong>TLS Versions Enabled by Default</strong></td></tr></thead><tbody><tr><td>27.x</td><td><a href="#tls1.3">TLSv1.3</a> and TLSv1.2</td></tr><tr><td>26.x</td><td><a href="#tls1.3">TLSv1.3</a> and TLSv1.2</td></tr></tbody></table>
<p>Users of <a href="/rabbitmq-website/docs/next/which-erlang">older supported Erlang releases</a>
are encouraged to limit supported TLS versions to 1.2 and later versions only, if possible.
Consider TLSv1.0 and TLSv1.1 to be <strong>deprecated by the industry</strong>.</p>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="tls-versions-why-not-limit">Why Not Limit TLS Versions<a href="#tls-versions-why-not-limit" class="hash-link" aria-label="Direct link to Why Not Limit TLS Versions" title="Direct link to Why Not Limit TLS Versions">  ​</a></h3>
<p>Limiting TLS versions to only TLSv1.3 or even only TLSv1.2 means that clients
that <a href="#tls-version-support-in-jdk-and-net">support older TLS versions only</a> won&#x27;t be able to connect.</p>
<p>If support for applications that use such old runtimes is important, the server must
be configured to support older versions of TLS. In most cases, supporting TLSv1.2
should be sufficient.</p>
<a id="tls-versions-server"></a>
<p>To limit enabled TLS protocol versions, use the <code>ssl_options.versions</code> setting.</p>
<p>The example below only accepts TLSv1.3 (the most recent and secure version),
and requires the node to be running on Erlang 26 compiled against a very recent OpenSSL.
Clients that use older runtimes (e.g. JDK, .NET, Python) without TLSv1.3 support
<strong>will not be able to connect</strong> with this setup.</p>
<div class="language-ini codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-ini codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">listeners.ssl.1 = 5671</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">ssl_options.cacertfile = /path/to/ca_certificate.pem</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">ssl_options.certfile   = /path/to/server_certificate.pem</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">ssl_options.keyfile    = /path/to/server_key.pem</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">ssl_options.versions.1 = tlsv1.3</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"># Limits enable cipher suites to only those used by TLSv1.3.</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"># There are no cipher suites supported by both TLSv1.3 and TLSv1.2.</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">ssl_options.ciphers.1  = TLS_AES_256_GCM_SHA384</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">ssl_options.ciphers.2  = TLS_AES_128_GCM_SHA256</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">ssl_options.ciphers.3  = TLS_CHACHA20_POLY1305_SHA256</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">ssl_options.ciphers.4  = TLS_AES_128_CCM_SHA256</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">ssl_options.ciphers.5  = TLS_AES_128_CCM_8_SHA256</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>The example below disables versions older than TLSv1.2:</p>
<div class="language-ini codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-ini codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">listeners.ssl.1 = 5671</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">ssl_options.cacertfile = /path/to/ca_certificate.pem</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">ssl_options.certfile   = /path/to/server_certificate.pem</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">ssl_options.keyfile    = /path/to/server_key.pem</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">ssl_options.versions.1 = tlsv1.2</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="verifying-tls-versions">Verifying Enabled TLS Versions<a href="#verifying-tls-versions" class="hash-link" aria-label="Direct link to Verifying Enabled TLS Versions" title="Direct link to Verifying Enabled TLS Versions">​</a></h3>
<p>To verify provided TLS versions, <a href="https://www.feistyduck.com/library/openssl-cookbook/online/ch-testing-with-open./ssl" target="_blank" rel="noopener noreferrer">use <code>openssl s_client</code></a>
with an <a href="https://www.openssl.org/docs/man1.1.1/man1/openssl-s_client.html" target="_blank" rel="noopener noreferrer">appropriate TLS version flag</a>:</p>
<div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token comment" style="color:#999988;font-style:italic"># connect using TLSv1.3</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">openssl s_client </span><span class="token parameter variable" style="color:#36acaa">-connect</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">127.0</span><span class="token plain">.0.1:5671 </span><span class="token parameter variable" style="color:#36acaa">-tls1_3</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>and look for the following in the output:</p>
<div class="codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">New, TLSv1.3, Cipher is TLS_AES_256_GCM_SHA384</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>In the example below, TLSv1.2 is used:</p>
<div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token comment" style="color:#999988;font-style:italic"># connect using TLSv1.2</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">openssl s_client </span><span class="token parameter variable" style="color:#36acaa">-connect</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">127.0</span><span class="token plain">.0.1:5671 </span><span class="token parameter variable" style="color:#36acaa">-tls1_2</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>The protocol and negotiated cipher suite in the output would
look like so:</p>
<div class="codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">SSL-Session:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    Protocol  : TLSv1.2</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    Cipher    : ECDHE-RSA-AES256-GCM-SHA384</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="tls1.3">TLSv1.3<a href="#tls1.3" class="hash-link" aria-label="Direct link to TLSv1.3" title="Direct link to TLSv1.3">​</a></h3>
<div class="theme-admonition theme-admonition-important admonition_xJq3 alert alert--info"><div class="admonitionHeading_Gvgb"><span class="admonitionIcon_Rf37"><svg viewBox="0 0 14 16"><path fill-rule="evenodd" d="M7 2.3c3.14 0 5.7 2.56 5.7 5.7s-2.56 5.7-5.7 5.7A5.71 5.71 0 0 1 1.3 8c0-3.14 2.56-5.7 5.7-5.7zM7 1C3.14 1 0 4.14 0 8s3.14 7 7 7 7-3.14 7-7-3.14-7-7-7zm1 3H6v5h2V4zm0 6H6v2h2v-2z"></path></svg></span>important</div><div class="admonitionContent_BuS1"><p>TLS 1.3 is a major revision of the suite of standards collectively known as &quot;TLS&quot;.
It intentionally breaks backwards compatibility with all earlier versions.</p><p>While modern versions of most popular programming languages and runtimes have supports TLS 1.3 for a few years now, adopting of this
version requires planning and should be treated as a change that will affect
applications that use TLS.</p><p>If some applications or their runtimes cannot be easily upgraded to use this new version,
TLS 1.3 adoption on the RabbitMQ side might be a non-starter.</p></div></div>
<p><a href="https://wiki.openssl.org/index.php/TLS1.3" target="_blank" rel="noopener noreferrer">TLSv1.3</a> is a major revision to the TLS protocol. It is the most recent
and secure option.</p>
<p>TLSv1.3 support requires the node to be <a href="/rabbitmq-website/docs/next/which-erlang">running on Erlang 27 or 26</a> compiled against a very recent OpenSSL.</p>
<p>Clients that use older runtimes (e.g. JDK, .NET, Python) without TLSv1.3 support
<strong>will not be able to connect</strong> to RabbitMQ nodes that are configured to only accept TLSv1.3 connections.</p>
<p>Because TLSv1.3 shares no cipher suites with earlier TLS versions, when enabling TLSv1.3,
list a set of TLSv1.3-specific cipher suites:</p>
<div class="language-ini codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-ini codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">listeners.ssl.1 = 5671</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">ssl_options.cacertfile = /path/to/ca_certificate.pem</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">ssl_options.certfile   = /path/to/server_certificate.pem</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">ssl_options.keyfile    = /path/to/server_key.pem</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">ssl_options.versions.1 = tlsv1.3</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"># Limits enable cipher suites to only those used by TLSv1.3.</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"># There are no cipher suites supported by both TLSv1.3 and TLSv1.2.</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">ssl_options.ciphers.1  = TLS_AES_256_GCM_SHA384</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">ssl_options.ciphers.2  = TLS_AES_128_GCM_SHA256</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">ssl_options.ciphers.3  = TLS_CHACHA20_POLY1305_SHA256</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">ssl_options.ciphers.4  = TLS_AES_128_CCM_SHA256</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">ssl_options.ciphers.5  = TLS_AES_128_CCM_8_SHA256</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>Explicit cipher suite configuration may also be necessary on the client side.</p>
<p>To verify provided TLS versions, use <code>openssl s_client</code> as
<a href="#verifying-tls-versions">explained above</a>.</p>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="tls-version-support-in-jdk-and-net">TLS Version Support Table for JDK and .NET<a href="#tls-version-support-in-jdk-and-net" class="hash-link" aria-label="Direct link to TLS Version Support Table for JDK and .NET" title="Direct link to TLS Version Support Table for JDK and .NET">​</a></h3>
<p>Disabling TLSv1.0 limits the number of client platforms supported. Below is a table that
explains what TLS versions are supported by what JDK and .NET releases.</p>
<table><thead><td>TLS version</td><td>Minimum JDK version</td><td>Minimum .NET version</td></thead><tr><td>TLS 1.3</td><td>JDK 8 <a href="https://www.oracle.com/java/technologies/javase/8u261-relnotes.html">starting with JDK8u261</a>, JDK 11+</td><td><a href="https://github.com/dotnet/docs/issues/4675">.NET 4.7</a> on <a href="https://docs.microsoft.com/en-us/dotnet/framework/network-programming/tls">Windows versions that support TLSv1.3</a></td></tr><tr><td>TLS 1.2</td><td>JDK 7 (see <a href="http://docs.oracle.com/javase/7/docs/technotes/guides/security/SunProviders.html#SunJSSEProvider">Protocols</a>,
<a href="http://docs.oracle.com/javase/8/docs/technotes/guides/security/enhancements-8.html">JDK 8 recommended</a></td><td>.NET 4.5</td></tr><tr><td>TLS 1.1</td><td>JDK 7 (see <a href="http://docs.oracle.com/javase/7/docs/technotes/guides/security/SunProviders.html#SunJSSEProvider">Protocols</a>,
<a href="http://docs.oracle.com/javase/8/docs/technotes/guides/security/enhancements-8.html">JDK 8 recommended</a></td><td>.NET 4.5</td></tr></table>
<p>Oracle JDK has a <a href="https://java.com/en/jre-jdk-cryptoroadmap.html" target="_blank" rel="noopener noreferrer">public roadmap on cryptography</a> and related standards
that outlines when certain cipher suites or TLS versions will be deprecated or removed.</p>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="key-usage">Public Key Usage Options<a href="#key-usage" class="hash-link" aria-label="Direct link to Public Key Usage Options" title="Direct link to Public Key Usage Options">​</a></h2>
<p>Public keys (certificates) have a number of fields that describe the intended usage scenarios for the key.
The fields limit how the key is allowed to be used by various tools.
For example, a public key can be used to verify certificate signatures (act as a <a href="#certificates-and-keys">Certificate Authority</a> key).</p>
<p>These fields also have effects on what <a href="#cipher-suites">cipher suites</a> will be used by RabbitMQ nodes
and clients during connection negotiation (more specifically, the TLS handshake),
so it is important to explain what the effects are.</p>
<p>This guide will cover them with some intentional oversimplification. Broadly speaking, the fields fall into one of three categories:</p>
<ul>
<li><a href="https://tools.ietf.org/html/rfc5280#section-4.2.1.3" target="_blank" rel="noopener noreferrer">keyUsage</a></li>
<li><a href="https://tools.ietf.org/html/rfc5280#section-4.2.1.9" target="_blank" rel="noopener noreferrer">Basic Constraints</a></li>
<li><a href="https://tools.ietf.org/html/rfc5280#section-4.2.1.12" target="_blank" rel="noopener noreferrer">extendedKeyUsage</a></li>
</ul>
<p>Some fields are boolean values, others are of different types such as a set of options (bits) that can be set or unset.</p>
<p>Data services are largely agnostic to the constraints and key usage options used. However, some are essential
to the use cases described in this guide:</p>
<ul>
<li>Server authentication (provide server node&#x27;s identity to the client)</li>
<li>Client authentication (provide client&#x27;s identity to the server)</li>
<li>Verification of digital signatures</li>
<li>Key encipherment</li>
</ul>
<p>The first two options are used for <a href="#peer-verification">peer verification</a>. They must be set for the server and client certificates,
respectively, at public key generation time. A certificate can have both options set at the same time.</p>
<p><a href="#automated-certificate-generation">tls-gen</a> will make sure that these constraints and extensions are correctly set.
When <a href="#manual-certificate-generation">generating certificates manually</a>, this is a responsibility of
the operator that generates the key pairs, or a key pair provider.</p>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="key-usage-effects-on-cipher-suites">Extensions and Their Effect on Accepted Cipher Suites (Cipher Suite Filtering)<a href="#key-usage-effects-on-cipher-suites" class="hash-link" aria-label="Direct link to Extensions and Their Effect on Accepted Cipher Suites (Cipher Suite Filtering)" title="Direct link to Extensions and Their Effect on Accepted Cipher Suites (Cipher Suite Filtering)">​</a></h3>
<p>Two key extensions are critically important for two major types of <a href="#cipher-suites">cipher suites</a>:</p>
<ul>
<li><code>digitalSignature</code> for ECC (Elliptic Curve Cryptography)-based suites</li>
<li><code>keyEncipherment</code> for RSA-based suites</li>
</ul>
<p>It is highly recommended that both of the above options (bits) are set for certificates that will
be used by both RabbitMQ nodes and client libraries. If those bits are not set, TLS implementations
will leave out an entire class of cipher suites from consideration, potentially resulting in confusing
&quot;no suitable cipher suite found&quot; alerts (error messages) at connection time.</p>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="examining-certificate-extensions">Examining Certificate Extensions<a href="#examining-certificate-extensions" class="hash-link" aria-label="Direct link to Examining Certificate Extensions" title="Direct link to Examining Certificate Extensions">​</a></h3>
<p>To see what constraints and extensions are set for a public key, use the <code>openssl x509</code> command:</p>
<div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">openssl x509 </span><span class="token parameter variable" style="color:#36acaa">-in</span><span class="token plain"> /path/to/certificate.pem </span><span class="token parameter variable" style="color:#36acaa">-text</span><span class="token plain"> </span><span class="token parameter variable" style="color:#36acaa">-noout</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>Its output will include a nested list of extensions and constraints that looks similar to this:</p>
<div class="language-ini codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-ini codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">X509v3 extensions:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    X509v3 Basic Constraints:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        CA:FALSE</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    X509v3 Key Usage:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        Digital Signature, Key Encipherment</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    X509v3 Extended Key Usage:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        TLS Web Client Authentication</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>The above set of extensions says that this is a public key that can be used to authenticate
a client (provide a client identity to a RabbitMQ node), cannot be used as a Certificate Authority
certificate and can be used for key encipherment and digital signature.</p>
<p>For the purpose of this guide, this is a suitable certificate (public key) to be used for client connections.</p>
<p>Below is an example of a public key suitable certificate for server authentication (provides a RabbitMQ node identity)
as well as client authentication (perhaps for the sake of usability):</p>
<div class="language-ini codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-ini codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">X509v3 extensions:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    X509v3 Basic Constraints:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        CA:FALSE</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    X509v3 Key Usage:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        Digital Signature, Key Encipherment</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    X509v3 Extended Key Usage:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        TLS Web Server Authentication, TLS Web Client Authentication</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="cipher-suites">Cipher Suites<a href="#cipher-suites" class="hash-link" aria-label="Direct link to Cipher Suites" title="Direct link to Cipher Suites">​</a></h2>
<p>It is possible to configure what cipher suites will be used by RabbitMQ. Note that not all
suites will be available on all systems. For example, to use Elliptic curve ciphers,
a recent <a href="/rabbitmq-website/docs/next/which-erlang">supported Erlang release</a> must be used.</p>
<p>What cipher suites RabbitMQ nodes and clients used can also be effectively limited by the <a href="#key-usage">public key usage fields</a>
and their values. It is important to make sure that those key usage options are acceptable before proceeding
with cipher suite configuration.</p>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="available-cipher-suites">Listing Cipher Suites Available on a RabbitMQ Node<a href="#available-cipher-suites" class="hash-link" aria-label="Direct link to Listing Cipher Suites Available on a RabbitMQ Node" title="Direct link to Listing Cipher Suites Available on a RabbitMQ Node">​</a></h3>
<p>To list cipher suites supported by the Erlang runtime of a running node, use <code>rabbitmq-diagnostics cipher_suites --format openssl</code>:</p>
<div class="language-ini codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-ini codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">rabbitmq-diagnostics cipher_suites --format openssl -q</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>This will produce a list of cipher suites in the OpenSSL format.</p>
<p>Note that if you use <code>--format erlang</code>:</p>
<div class="language-ini codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-ini codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">rabbitmq-diagnostics cipher_suites --format erlang -q</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>then <code>rabbitmq-diagnostics cipher_suites</code> will list cipher suites in the format
that&#x27;s only accepted in the <a href="/rabbitmq-website/docs/next/configure#erlang-term-config-file">classic config format</a>. The OpenSSL format is accepted
by both config formats. Note that cipher suites are not enquoted in the new style config format
but double quotes are required in the classic format.</p>
<p>The cipher suites listed by the above command are in formats that can be used for inbound and outgoing (e.g. <a href="/rabbitmq-website/docs/next/shovel">Shovel</a>, <a href="/rabbitmq-website/docs/next/federation">Federation</a>)
client TLS connections. They are different from those used by <a href="/rabbitmq-website/docs/next/configure#configuration-encryption">configuration value encryption</a>.</p>
<p>When overriding cipher suites, it is highly recommended
that server-preferred <a href="#cipher-suite-order">cipher suite ordering is enforced</a>.</p>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="configuring-cipher-suites">Configuring Cipher Suites<a href="#configuring-cipher-suites" class="hash-link" aria-label="Direct link to Configuring Cipher Suites" title="Direct link to Configuring Cipher Suites">​</a></h3>
<p>Cipher suites are configured using the <code>ssl_options.ciphers</code> config option (<code>rabbit.ssl_options.ciphers</code>
in the classic config format).</p>
<p>The below example demonstrates how the option is used.</p>
<div class="language-ini codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-ini codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">listeners.ssl.1 = 5671</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">ssl_options.cacertfile = /path/to/ca_certificate.pem</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">ssl_options.certfile   = /path/to/server_certificate.pem</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">ssl_options.keyfile    = /path/to/server_key.pem</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">ssl_options.versions.1 = tlsv1.2</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">ssl_options.verify = verify_peer</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">ssl_options.fail_if_no_peer_cert = false</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">ssl_options.ciphers.1  = ECDHE-ECDSA-AES256-GCM-SHA384</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">ssl_options.ciphers.2  = ECDHE-RSA-AES256-GCM-SHA384</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">ssl_options.ciphers.3  = ECDH-ECDSA-AES256-GCM-SHA384</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">ssl_options.ciphers.4  = ECDH-RSA-AES256-GCM-SHA384</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">ssl_options.ciphers.5  = DHE-RSA-AES256-GCM-SHA384</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">ssl_options.ciphers.6  = DHE-DSS-AES256-GCM-SHA384</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">ssl_options.ciphers.7  = ECDHE-ECDSA-AES128-GCM-SHA256</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">ssl_options.ciphers.8  = ECDHE-RSA-AES128-GCM-SHA256</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">ssl_options.ciphers.9  = ECDH-ECDSA-AES128-GCM-SHA256</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">ssl_options.ciphers.10 = ECDH-RSA-AES128-GCM-SHA256</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">ssl_options.ciphers.11 = DHE-RSA-AES128-GCM-SHA256</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">ssl_options.ciphers.12 = DHE-DSS-AES128-GCM-SHA256</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"># these MUST be disabled if TLSv1.3 is used</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">ssl_options.honor_cipher_order = true</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">ssl_options.honor_ecc_order    = true</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>In the <a href="/rabbitmq-website/docs/next/configure#erlang-term-config-file">classic config format</a>:</p>
<div class="language-erlang codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-erlang codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token comment" style="color:#999988;font-style:italic">%% list allowed ciphers</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">[</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token atom">ssl</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">[</span><span class="token punctuation" style="color:#393A34">{</span><span class="token atom">versions</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">[</span><span class="token quoted-atom atom">&#x27;tlsv1.2&#x27;</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token quoted-atom atom">&#x27;tlsv1.1&#x27;</span><span class="token punctuation" style="color:#393A34">]</span><span class="token punctuation" style="color:#393A34">}</span><span class="token punctuation" style="color:#393A34">]</span><span class="token punctuation" style="color:#393A34">}</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token atom">rabbit</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">[</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">           </span><span class="token punctuation" style="color:#393A34">{</span><span class="token atom">ssl_listeners</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">[</span><span class="token number" style="color:#36acaa">5671</span><span class="token punctuation" style="color:#393A34">]</span><span class="token punctuation" style="color:#393A34">}</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">           </span><span class="token punctuation" style="color:#393A34">{</span><span class="token atom">ssl_options</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">[</span><span class="token punctuation" style="color:#393A34">{</span><span class="token atom">cacertfile</span><span class="token punctuation" style="color:#393A34">,</span><span class="token string" style="color:#e3116c">&quot;/path/to/ca_certificate.pem&quot;</span><span class="token punctuation" style="color:#393A34">}</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                          </span><span class="token punctuation" style="color:#393A34">{</span><span class="token atom">certfile</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain">  </span><span class="token string" style="color:#e3116c">&quot;/path/to/server_certificate.pem&quot;</span><span class="token punctuation" style="color:#393A34">}</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                          </span><span class="token punctuation" style="color:#393A34">{</span><span class="token atom">keyfile</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain">   </span><span class="token string" style="color:#e3116c">&quot;/path/to/server_key.pem&quot;</span><span class="token punctuation" style="color:#393A34">}</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                          </span><span class="token punctuation" style="color:#393A34">{</span><span class="token atom">versions</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">[</span><span class="token quoted-atom atom">&#x27;tlsv1.2&#x27;</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token quoted-atom atom">&#x27;tlsv1.1&#x27;</span><span class="token punctuation" style="color:#393A34">]</span><span class="token punctuation" style="color:#393A34">}</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                          </span><span class="token comment" style="color:#999988;font-style:italic">%% This list is just an example!</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                          </span><span class="token comment" style="color:#999988;font-style:italic">%% Not all cipher suites are available on all machines.</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                          </span><span class="token comment" style="color:#999988;font-style:italic">%% Cipher suite order is important: preferred suites</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                          </span><span class="token comment" style="color:#999988;font-style:italic">%% should be listed first.</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                          </span><span class="token comment" style="color:#999988;font-style:italic">%% Different suites have different security and CPU load characteristics.</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                          </span><span class="token punctuation" style="color:#393A34">{</span><span class="token atom">ciphers</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain">  </span><span class="token punctuation" style="color:#393A34">[</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                            </span><span class="token string" style="color:#e3116c">&quot;ECDHE-ECDSA-AES256-GCM-SHA384&quot;</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                            </span><span class="token string" style="color:#e3116c">&quot;ECDHE-RSA-AES256-GCM-SHA384&quot;</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                            </span><span class="token string" style="color:#e3116c">&quot;ECDH-ECDSA-AES256-GCM-SHA384&quot;</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                            </span><span class="token string" style="color:#e3116c">&quot;ECDH-RSA-AES256-GCM-SHA384&quot;</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                            </span><span class="token string" style="color:#e3116c">&quot;DHE-RSA-AES256-GCM-SHA384&quot;</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                            </span><span class="token string" style="color:#e3116c">&quot;DHE-DSS-AES256-GCM-SHA384&quot;</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                            </span><span class="token string" style="color:#e3116c">&quot;ECDHE-ECDSA-AES128-GCM-SHA256&quot;</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                            </span><span class="token string" style="color:#e3116c">&quot;ECDHE-RSA-AES128-GCM-SHA256&quot;</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                            </span><span class="token string" style="color:#e3116c">&quot;ECDH-ECDSA-AES128-GCM-SHA256&quot;</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                            </span><span class="token string" style="color:#e3116c">&quot;ECDH-RSA-AES128-GCM-SHA256&quot;</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                            </span><span class="token string" style="color:#e3116c">&quot;DHE-RSA-AES128-GCM-SHA256&quot;</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                            </span><span class="token string" style="color:#e3116c">&quot;DHE-DSS-AES128-GCM-SHA256&quot;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                            </span><span class="token punctuation" style="color:#393A34">]</span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                         </span><span class="token punctuation" style="color:#393A34">]</span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">          </span><span class="token punctuation" style="color:#393A34">]</span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">]</span><span class="token punctuation" style="color:#393A34">.</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="cipher-suite-order">Cipher Suite Order<a href="#cipher-suite-order" class="hash-link" aria-label="Direct link to Cipher Suite Order" title="Direct link to Cipher Suite Order">​</a></h3>
<p>During TLS connection negotiation, the server and the client negotiate
what cipher suite will be used. It is possible to force server&#x27;s TLS
implementation to dictate its preference (cipher suite order) to avoid
malicious clients that intentionally negotiate weak cipher suites in
preparation for running an attack on them.
To do so, configure <code>honor_cipher_order</code>
and <code>honor_ecc_order</code> to <code>true</code>:</p>
<div class="language-ini codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-ini codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">listeners.ssl.1        = 5671</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">ssl_options.cacertfile = /path/to/ca_certificate.pem</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">ssl_options.certfile   = /path/to/server_certificate.pem</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">ssl_options.keyfile    = /path/to/server_key.pem</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">ssl_options.versions.1 = tlsv1.2</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">ssl_options.honor_cipher_order = true</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">ssl_options.honor_ecc_order    = true</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>Or, in the classic config format:</p>
<div class="language-erlang codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-erlang codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token comment" style="color:#999988;font-style:italic">%% Enforce server-provided cipher suite order (preference)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">[</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token atom">ssl</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">[</span><span class="token punctuation" style="color:#393A34">{</span><span class="token atom">versions</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">[</span><span class="token quoted-atom atom">&#x27;tlsv1.2&#x27;</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token quoted-atom atom">&#x27;tlsv1.1&#x27;</span><span class="token punctuation" style="color:#393A34">]</span><span class="token punctuation" style="color:#393A34">}</span><span class="token punctuation" style="color:#393A34">]</span><span class="token punctuation" style="color:#393A34">}</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token atom">rabbit</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">[</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">           </span><span class="token punctuation" style="color:#393A34">{</span><span class="token atom">ssl_listeners</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">[</span><span class="token number" style="color:#36acaa">5671</span><span class="token punctuation" style="color:#393A34">]</span><span class="token punctuation" style="color:#393A34">}</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">           </span><span class="token punctuation" style="color:#393A34">{</span><span class="token atom">ssl_options</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">[</span><span class="token punctuation" style="color:#393A34">{</span><span class="token atom">cacertfile</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;/path/to/ca_certificate.pem&quot;</span><span class="token punctuation" style="color:#393A34">}</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                          </span><span class="token punctuation" style="color:#393A34">{</span><span class="token atom">certfile</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain">   </span><span class="token string" style="color:#e3116c">&quot;/path/to/server_certificate.pem&quot;</span><span class="token punctuation" style="color:#393A34">}</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                          </span><span class="token punctuation" style="color:#393A34">{</span><span class="token atom">keyfile</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain">    </span><span class="token string" style="color:#e3116c">&quot;/path/to/server_key.pem&quot;</span><span class="token punctuation" style="color:#393A34">}</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                          </span><span class="token punctuation" style="color:#393A34">{</span><span class="token atom">versions</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain">   </span><span class="token punctuation" style="color:#393A34">[</span><span class="token quoted-atom atom">&#x27;tlsv1.2&#x27;</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token quoted-atom atom">&#x27;tlsv1.1&#x27;</span><span class="token punctuation" style="color:#393A34">]</span><span class="token punctuation" style="color:#393A34">}</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                          </span><span class="token comment" style="color:#999988;font-style:italic">%% ...</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                          </span><span class="token punctuation" style="color:#393A34">{</span><span class="token atom">honor_cipher_order</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain">   </span><span class="token boolean" style="color:#36acaa">true</span><span class="token punctuation" style="color:#393A34">}</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                          </span><span class="token punctuation" style="color:#393A34">{</span><span class="token atom">honor_ecc_order</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain">      </span><span class="token boolean" style="color:#36acaa">true</span><span class="token punctuation" style="color:#393A34">}</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                         </span><span class="token punctuation" style="color:#393A34">]</span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">          </span><span class="token punctuation" style="color:#393A34">]</span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">]</span><span class="token punctuation" style="color:#393A34">.</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="major-vulnerabilities">Known TLS Vulnerabilities and Their Mitigation<a href="#major-vulnerabilities" class="hash-link" aria-label="Direct link to Known TLS Vulnerabilities and Their Mitigation" title="Direct link to Known TLS Vulnerabilities and Their Mitigation">​</a></h2>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="robot">ROBOT<a href="#robot" class="hash-link" aria-label="Direct link to ROBOT" title="Direct link to ROBOT">​</a></h3>
<p><a href="https://robotattack.org/" target="_blank" rel="noopener noreferrer">ROBOT attack</a> affects RabbitMQ installations that rely on RSA
cipher suites and run on Erlang/OTP versions prior to
19.3.6.4 and 20.1.7. To mitigate, <a href="/rabbitmq-website/docs/next/which-erlang">upgrade Erlang/OTP</a> to a patched version
and consider <a href="#cipher-suites">limiting the list of supported cipher suites</a>.</p>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="poodle">POODLE<a href="#poodle" class="hash-link" aria-label="Direct link to POODLE" title="Direct link to POODLE">​</a></h3>
<p><a href="https://templatelab.com/ssl-poodle/" target="_blank" rel="noopener noreferrer">POODLE</a> is a known SSL/TLS attack that originally compromised SSLv3.
Starting with version 3.4.0, RabbitMQ server refuses to accept SSLv3 connections. In December 2014, a modified version of
the POODLE attack that affects TLSv1.0 was <a href="https://www.imperialviolet.org/2014/12/08/poodleagain.html" target="_blank" rel="noopener noreferrer">announced</a>.
It is therefore recommended to either run Erlang 18.0 or later, which
<a href="http://www.erlang.org/news/88" target="_blank" rel="noopener noreferrer">eliminates TLS 1.0 implementation vulnerability to POODLE</a>,
or <a href="#tls-versions">disable TLSv1.0 support</a>.</p>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="beast">BEAST<a href="#beast" class="hash-link" aria-label="Direct link to BEAST" title="Direct link to BEAST">​</a></h3>
<p><a href="http://en.wikipedia.org/wiki/Transport_Layer_Security#BEAST_attack" target="_blank" rel="noopener noreferrer">BEAST attack</a> is a known vulnerability that
affects TLSv1.0. To mitigate it, <a href="#tls-versions">disable TLSv1.0 support</a>.</p>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="tls-evaluation-tools">Evaluating TLS Setup Security<a href="#tls-evaluation-tools" class="hash-link" aria-label="Direct link to Evaluating TLS Setup Security" title="Direct link to Evaluating TLS Setup Security">​</a></h2>
<p>Because TLS has many configurable parameters
and some of them have suboptimal defaults for historical
reasons, TLS setup security evaluation is a recommended practice.
Multiple tools exist that perform various tests on TLS-enabled
server endpoints, for example, testing whether it is prone
to known attacks such as POODLE, BEAST, and others.</p>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="testssl-sh">testssl.sh<a href="#testssl-sh" class="hash-link" aria-label="Direct link to testssl.sh" title="Direct link to testssl.sh">​</a></h3>
<p><a href="https://testssl.sh/" target="_blank" rel="noopener noreferrer">testssl.sh</a> is a mature and extensive TLS endpoint testing
tool. It can be used with protocol endpoints that do not serve HTTPS.</p>
<p>The tool performs many tests (for instance, on some machines it runs
over 350 cipher suite tests alone) and passing every single one may or may not
make sense for every environment. For example, many production deployments
do not use CRLs (Certificate Revocation Lists); most development environments
use self-signed certificates and don&#x27;t have to worry about
the most optimal set of cipher suites enabled; and so on.</p>
<p>To run <code>testssl.sh</code>, provide an endpoint to test in the form of <code>{hostname}:5671</code>:</p>
<div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">./testssl.sh localhost:5671</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="evaluation-of-a-tls-13-setup">Evaluation of a TLS 1.3 Setup<a href="#evaluation-of-a-tls-13-setup" class="hash-link" aria-label="Direct link to Evaluation of a TLS 1.3 Setup" title="Direct link to Evaluation of a TLS 1.3 Setup">​</a></h3>
<p>The following example configuration that accepts TLSv1.3 connections passes key
<code>testssl.sh</code> tests on Erlang 26:</p>
<div class="language-ini codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-ini codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">listeners.ssl.1 = 5671</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">ssl_options.cacertfile = /path/to/ca_certificate.pem</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">ssl_options.certfile   = /path/to/server_certificate.pem</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">ssl_options.keyfile    = /path/to/server_key.pem</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">ssl_options.versions.1 = tlsv1.3</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">ssl_options.verify               = verify_peer</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">ssl_options.fail_if_no_peer_cert = true</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">ssl_options.ciphers.1  = TLS_AES_256_GCM_SHA384</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">ssl_options.ciphers.2  = TLS_AES_128_GCM_SHA256</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">ssl_options.ciphers.3  = TLS_CHACHA20_POLY1305_SHA256</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">ssl_options.ciphers.4  = TLS_AES_128_CCM_SHA256</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">ssl_options.ciphers.5  = TLS_AES_128_CCM_8_SHA256</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">ssl_options.honor_cipher_order   = true</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">ssl_options.honor_ecc_order      = true</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>This TLSv1.3-exclusive setup is reported as not vulnerable:</p>
<div class="language-ini codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-ini codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">  Using &quot;OpenSSL 3.3.1 4 Jun 2024 (Library: OpenSSL 3.3.1 4 Jun 2024)&quot; [~94 ciphers]</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"> on [redacted]:/opt/homebrew/bin/openssl</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"> (built: &quot;Jun  4 12:53:04 2024&quot;, platform: &quot;darwin64-arm64-cc&quot;)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"> Start 2024-08-08 11:56:02                --&gt;&gt; 127.0.0.1:5671 (localhost) &lt;&lt;--</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"> A record via:           /etc/hosts</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"> rDNS (127.0.0.1):       localhost.</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"> Service detected:       Couldn&#x27;t determine what&#x27;s running on port 5671, assuming no HTTP service =&gt; skipping all HTTP checks</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"> Testing protocols via sockets except NPN+ALPN</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"> SSLv2      not offered (OK)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"> SSLv3      not offered (OK)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"> TLS 1      not offered</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"> TLS 1.1    not offered</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"> TLS 1.2    not offered</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"> TLS 1.3    offered (OK): final</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"> NPN/SPDY   not offered</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"> ALPN/HTTP2 not offered</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"> Testing cipher categories</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"> NULL ciphers (no encryption)                      not offered (OK)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"> Anonymous NULL Ciphers (no authentication)        not offered (OK)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"> Export ciphers (w/o ADH+NULL)                     not offered (OK)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"> LOW: 64 Bit + DES, RC[2,4], MD5 (w/o export)      not offered (OK)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"> Triple DES Ciphers / IDEA                         not offered</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"> Obsoleted CBC ciphers (AES, ARIA etc.)            not offered</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"> Strong encryption (AEAD ciphers) with no FS       not offered</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"> Forward Secrecy strong encryption (AEAD ciphers)  offered (OK)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"> Testing server&#x27;s cipher preferences</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">Hexcode  Cipher Suite Name (OpenSSL)       KeyExch.   Encryption  Bits     Cipher Suite Name (IANA/RFC)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">-----------------------------------------------------------------------------------------------------------------------------</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">SSLv2</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"> -</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">SSLv3</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"> -</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">TLSv1</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"> -</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">TLSv1.1</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"> -</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">TLSv1.2</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"> -</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">TLSv1.3 (listed by strength)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"> x1302   TLS_AES_256_GCM_SHA384            ECDH 253   AESGCM      256      TLS_AES_256_GCM_SHA384</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"> x1303   TLS_CHACHA20_POLY1305_SHA256      ECDH 253   ChaCha20    256      TLS_CHACHA20_POLY1305_SHA256</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"> x1301   TLS_AES_128_GCM_SHA256            ECDH 253   AESGCM      128      TLS_AES_128_GCM_SHA256</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"> x1304   TLS_AES_128_CCM_SHA256            ECDH 253   AESCCM      128      TLS_AES_128_CCM_SHA256</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"> x1305   TLS_AES_128_CCM_8_SHA256          ECDH 253   AESCCM8     128      TLS_AES_128_CCM_8_SHA256</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"> Has server cipher order?     no (TLS 1.3 only)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"> (limited sense as client will pick)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"> Testing robust forward secrecy (FS) -- omitting Null Authentication/Encryption, 3DES, RC4</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"> FS is offered (OK)           TLS_AES_256_GCM_SHA384 TLS_CHACHA20_POLY1305_SHA256 TLS_AES_128_GCM_SHA256 TLS_AES_128_CCM_SHA256 TLS_AES_128_CCM_8_SHA256</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"> Elliptic curves offered:     prime256v1 secp384r1 X25519 X448</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"> TLS 1.3 sig_algs offered:    RSA-PSS-RSAE+SHA256 RSA-PSS-RSAE+SHA384 RSA-PSS-RSAE+SHA512</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"> Testing server defaults (Server Hello)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"> TLS extensions (standard)    &quot;key share/#51&quot; &quot;supported versions/#43&quot; &quot;signature algorithms/#13&quot; &quot;certificate authorities/#47&quot;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"> Session Ticket RFC 5077 hint no -- no lifetime advertised</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"> SSL Session ID support       no</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"> Session Resumption           Tickets no, ID: no</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"> TLS clock skew               Random values, no fingerprinting possible</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"> Certificate Compression      none</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"> Client Authentication        optional</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"> CA List for Client Auth      L=$$$$,CN=TLSGenSelfSignedtRootCA 2022-03-22T11:27:45.010198</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"> Signature Algorithm          SHA256 with RSA</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"> Server key size              RSA 2048 bits (exponent is 65537)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"> Server key usage             Digital Signature, Key Encipherment</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"> Server extended key usage    TLS Web Server Authentication</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"> Serial                       01 (OK: length 1)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"> Fingerprints                 SHA1 A4346FA6FDC61FCD4C0199EA14B8AE0F5D5121B1</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                              SHA256 C81025DA6F9BB646239659420D58E73F62CEB7D2AD5AC13FF12A9DE057394953</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"> Common Name (CN)             [redacted]</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"> subjectAltName (SAN)         [redacted] localhost</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"> Trust (hostname)             Ok via SAN (same w/o SNI)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"> Chain of trust               NOT ok (self signed CA in chain)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"> EV cert (experimental)       no</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"> Certificate Validity (UTC)   2779 &gt;= 60 days (2022-03-22 07:27 --&gt; 2032-03-19 07:27)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                              &gt;= 10 years is way too long</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"> ETS/&quot;eTLS&quot;, visibility info  not present</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"> Certificate Revocation List  --</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"> OCSP URI                     --</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                              NOT ok -- neither CRL nor OCSP URI provided</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"> OCSP stapling                not offered</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"> OCSP must staple extension   --</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"> DNS CAA RR (experimental)    not offered</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"> Certificate Transparency     N/A</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"> Certificates provided        2</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"> Issuer                       TLSGenSelfSignedtRootCA 2022-03-22T11:27:45.010198</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"> Intermediate cert validity   #1: ok &gt; 40 days (2032-03-19 07:27). $$$$ &lt;-- $$$$</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"> Intermediate Bad OCSP (exp.) Ok</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"> Testing vulnerabilities</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"> Heartbleed (CVE-2014-0160)                not vulnerable (OK), no heartbeat extension</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"> CCS (CVE-2014-0224)                       not vulnerable (OK)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"> Ticketbleed (CVE-2016-9244), experiment.  (applicable only for HTTPS)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"> ROBOT                                     Server does not support any cipher suites that use RSA key transport</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"> Secure Renegotiation (RFC 5746)           not vulnerable (OK)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"> Secure Client-Initiated Renegotiation     not vulnerable (OK)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"> CRIME, TLS (CVE-2012-4929)                not vulnerable (OK)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"> POODLE, SSL (CVE-2014-3566)               not vulnerable (OK), no SSLv3 support</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"> TLS_FALLBACK_SCSV (RFC 7507)              No fallback possible (OK), TLS 1.3 is the only protocol</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"> SWEET32 (CVE-2016-2183, CVE-2016-6329)    not vulnerable (OK)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"> FREAK (CVE-2015-0204)                     not vulnerable (OK)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"> DROWN (CVE-2016-0800, CVE-2016-0703)      not vulnerable on this host and port (OK)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                                           make sure you don&#x27;t use this certificate elsewhere with SSLv2 enabled services, see</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                                           https://search.censys.io/search?resource=hosts&amp;virtual_hosts=INCLUDE&amp;q=C81025DA6F9BB646239659420D58E73F62CEB7D2AD5AC13FF12A9DE057394953</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"> LOGJAM (CVE-2015-4000), experimental      not vulnerable (OK): no DH EXPORT ciphers, no DH key detected with &lt;= TLS 1.2</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"> BEAST (CVE-2011-3389)                     not vulnerable (OK), no SSL3 or TLS1</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"> LUCKY13 (CVE-2013-0169), experimental     not vulnerable (OK)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"> Winshock (CVE-2014-6321), experimental    not vulnerable (OK)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"> RC4 (CVE-2013-2566, CVE-2015-2808)        not vulnerable (OK)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">Could not determine the protocol, only simulating generic clients.</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"> Running client simulations via sockets</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"> Browser                      Protocol  Cipher Suite Name (OpenSSL)       Forward Secrecy</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">------------------------------------------------------------------------------------------------</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"> Android 8.1 (native)         No connection</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"> Android 9.0 (native)         TLSv1.3   TLS_AES_128_GCM_SHA256            253 bit ECDH (X25519)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"> Android 10.0 (native)        TLSv1.3   TLS_AES_128_GCM_SHA256            253 bit ECDH (X25519)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"> Android 11 (native)          TLSv1.3   TLS_AES_128_GCM_SHA256            253 bit ECDH (X25519)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"> Android 12 (native)          TLSv1.3   TLS_AES_128_GCM_SHA256            253 bit ECDH (X25519)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"> Java 7u25                    No connection</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"> Java 8u161                   No connection</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"> Java 11.0.2 (OpenJDK)        TLSv1.3   TLS_AES_128_GCM_SHA256            256 bit ECDH (P-256)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"> Java 17.0.3 (OpenJDK)        TLSv1.3   TLS_AES_256_GCM_SHA384            253 bit ECDH (X25519)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"> go 1.17.8                    TLSv1.3   TLS_AES_128_GCM_SHA256            253 bit ECDH (X25519)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"> LibreSSL 2.8.3 (Apple)       No connection</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"> OpenSSL 1.0.2e               No connection</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"> OpenSSL 1.1.0l (Debian)      No connection</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"> OpenSSL 1.1.1d (Debian)      TLSv1.3   TLS_AES_256_GCM_SHA384            253 bit ECDH (X25519)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"> OpenSSL 3.0.3 (git)          TLSv1.3   TLS_AES_256_GCM_SHA384            253 bit ECDH (X25519)</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="evaluation-of-a-tls-12-setup-with-restricted-cipher-suites">Evaluation of a TLS 1.2 Setup with Restricted Cipher Suites<a href="#evaluation-of-a-tls-12-setup-with-restricted-cipher-suites" class="hash-link" aria-label="Direct link to Evaluation of a TLS 1.2 Setup with Restricted Cipher Suites" title="Direct link to Evaluation of a TLS 1.2 Setup with Restricted Cipher Suites">​</a></h3>
<p>The following example configuration that accepts TLSv1.2 connections passes key
<code>testssl.sh</code> tests on Erlang 26.2:</p>
<div class="language-ini codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-ini codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">listeners.ssl.default  = 5671</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">ssl_options.cacertfile = /path/to/ca_certificate.pem</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">ssl_options.certfile   = /path/to/server_certificate.pem</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">ssl_options.keyfile    = /path/to/server_key.pem</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">ssl_options.versions.1 = tlsv1.2</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">ssl_options.verify               = verify_peer</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">ssl_options.fail_if_no_peer_cert = false</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">ssl_options.honor_cipher_order   = true</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">ssl_options.honor_ecc_order      = true</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"># These are highly recommended for TLSv1.2 but cannot be used</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"># with TLSv1.3. If TLSv1.3 is enabled, these lines MUST be removed.</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">ssl_options.client_renegotiation = false</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">ssl_options.secure_renegotiate   = true</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">ssl_options.ciphers.1  = ECDHE-ECDSA-AES256-GCM-SHA384</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">ssl_options.ciphers.2  = ECDHE-RSA-AES256-GCM-SHA384</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">ssl_options.ciphers.3  = ECDH-ECDSA-AES256-GCM-SHA384</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">ssl_options.ciphers.4  = ECDH-RSA-AES256-GCM-SHA384</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">ssl_options.ciphers.5  = DHE-RSA-AES256-GCM-SHA384</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">ssl_options.ciphers.6  = DHE-DSS-AES256-GCM-SHA384</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">ssl_options.ciphers.7  = ECDHE-ECDSA-AES128-GCM-SHA256</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">ssl_options.ciphers.8  = ECDHE-RSA-AES128-GCM-SHA256</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">ssl_options.ciphers.9  = ECDH-ECDSA-AES128-GCM-SHA256</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">ssl_options.ciphers.10 = ECDH-RSA-AES128-GCM-SHA256</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">ssl_options.ciphers.11 = DHE-RSA-AES128-GCM-SHA256</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">ssl_options.ciphers.12 = DHE-DSS-AES128-GCM-SHA256</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>This TLSv1.2-enabled setup is reported as not vulnerable to a set of known
high profile vulnerabilities:</p>
<div class="language-ini codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-ini codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain"> Using &quot;OpenSSL 3.3.1 4 Jun 2024 (Library: OpenSSL 3.3.1 4 Jun 2024)&quot; [~94 ciphers]</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"> on [redacted]:/opt/homebrew/bin/openssl</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"> (built: &quot;Jun  4 12:53:04 2024&quot;, platform: &quot;darwin64-arm64-cc&quot;)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"> Start 2024-08-08 13:42:36                --&gt;&gt; 127.0.0.1:5671 (localhost) &lt;&lt;--</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"> A record via:           /etc/hosts</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"> rDNS (127.0.0.1):       localhost.</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"> Service detected:       certificate-based authentication without providing client certificate and private key =&gt; skipping all HTTP checks</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"> Testing protocols via sockets except NPN+ALPN</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"> SSLv2      not offered (OK)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"> SSLv3      not offered (OK)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"> TLS 1      not offered</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"> TLS 1.1    not offered</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"> TLS 1.2    offered (OK)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"> TLS 1.3    not offered and downgraded to a weaker protocol</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"> NPN/SPDY   not offered</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"> ALPN/HTTP2 not offered</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"> Testing cipher categories</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"> NULL ciphers (no encryption)                      not offered (OK)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"> Anonymous NULL Ciphers (no authentication)        not offered (OK)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"> Export ciphers (w/o ADH+NULL)                     not offered (OK)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"> LOW: 64 Bit + DES, RC[2,4], MD5 (w/o export)      not offered (OK)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"> Triple DES Ciphers / IDEA                         not offered</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"> Obsoleted CBC ciphers (AES, ARIA etc.)            not offered</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"> Strong encryption (AEAD ciphers) with no FS       not offered</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"> Forward Secrecy strong encryption (AEAD ciphers)  offered (OK)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"> Testing server&#x27;s cipher preferences</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">Hexcode  Cipher Suite Name (OpenSSL)       KeyExch.   Encryption  Bits     Cipher Suite Name (IANA/RFC)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">-----------------------------------------------------------------------------------------------------------------------------</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">SSLv2</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"> -</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">SSLv3</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"> -</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">TLSv1</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"> -</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">TLSv1.1</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"> -</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">TLSv1.2 (server order)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"> xc030   ECDHE-RSA-AES256-GCM-SHA384       ECDH 253   AESGCM      256      TLS_ECDHE_RSA_WITH_AES_256_GCM_SHA384</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"> x9f     DHE-RSA-AES256-GCM-SHA384         DH 2048    AESGCM      256      TLS_DHE_RSA_WITH_AES_256_GCM_SHA384</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"> xc02f   ECDHE-RSA-AES128-GCM-SHA256       ECDH 253   AESGCM      128      TLS_ECDHE_RSA_WITH_AES_128_GCM_SHA256</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"> x9e     DHE-RSA-AES128-GCM-SHA256         DH 2048    AESGCM      128      TLS_DHE_RSA_WITH_AES_128_GCM_SHA256</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">TLSv1.3</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"> -</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"> Has server cipher order?     yes (OK)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"> Testing robust forward secrecy (FS) -- omitting Null Authentication/Encryption, 3DES, RC4</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"> FS is offered (OK)           ECDHE-RSA-AES256-GCM-SHA384 DHE-RSA-AES256-GCM-SHA384 ECDHE-RSA-AES128-GCM-SHA256 DHE-RSA-AES128-GCM-SHA256</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"> Elliptic curves offered:     prime256v1 secp384r1 secp521r1 brainpoolP256r1 brainpoolP384r1 brainpoolP512r1 X25519 X448</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"> DH group offered:            RFC3526/Oakley Group 14 (2048 bits)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"> TLS 1.2 sig_algs offered:    RSA+SHA256 RSA+SHA384 RSA+SHA512 RSA-PSS-RSAE+SHA256</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"> Testing server defaults (Server Hello)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"> TLS extensions (standard)    &quot;renegotiation info/#65281&quot; &quot;EC point formats/#11&quot; &quot;max fragment length/#1&quot;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"> Session Ticket RFC 5077 hint no -- no lifetime advertised</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"> SSL Session ID support       yes</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"> Session Resumption           Tickets no, Client Auth: ID resumption test not supported</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"> TLS clock skew               -1 sec from localtime</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"> Client Authentication        required</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"> CA List for Client Auth      L=$$$$,CN=TLSGenSelfSignedtRootCA 2022-03-22T11:27:45.010198</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"> Signature Algorithm          SHA256 with RSA</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"> Server key size              RSA 2048 bits (exponent is 65537)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"> Server key usage             Digital Signature, Key Encipherment</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"> Server extended key usage    TLS Web Server Authentication</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"> Serial                       01 (OK: length 1)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"> Fingerprints                 SHA1 A4346FA6FDC61FCD4C0199EA14B8AE0F5D5121B1</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                              SHA256 C81025DA6F9BB646239659420D58E73F62CEB7D2AD5AC13FF12A9DE057394953</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"> Common Name (CN)             [redacted]</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"> subjectAltName (SAN)         [redacted] localhost</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"> Trust (hostname)             Ok via SAN (same w/o SNI)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"> Chain of trust               NOT ok (self signed CA in chain)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"> EV cert (experimental)       no</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"> Certificate Validity (UTC)   2779 &gt;= 60 days (2022-03-22 07:27 --&gt; 2032-03-19 07:27)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                              &gt;= 10 years is way too long</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"> ETS/&quot;eTLS&quot;, visibility info  not present</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"> Certificate Revocation List  --</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"> OCSP URI                     --</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                              NOT ok -- neither CRL nor OCSP URI provided</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"> OCSP stapling                not offered</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"> OCSP must staple extension   --</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"> DNS CAA RR (experimental)    not offered</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"> Certificate Transparency     --</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"> Certificates provided        2</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"> Issuer                       TLSGenSelfSignedtRootCA 2022-03-22T11:27:45.010198</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"> Intermediate cert validity   #1: ok &gt; 40 days (2032-03-19 07:27). $$$$ &lt;-- $$$$</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"> Intermediate Bad OCSP (exp.) Ok</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"> Testing vulnerabilities</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"> Heartbleed (CVE-2014-0160)                not vulnerable (OK), no heartbeat extension</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"> CCS (CVE-2014-0224)                       not vulnerable (OK)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"> Ticketbleed (CVE-2016-9244), experiment.  not vulnerable (OK), no session ticket extension</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"> ROBOT                                     Server does not support any cipher suites that use RSA key transport</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"> Secure Renegotiation (RFC 5746)           supported (OK)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"> Secure Client-Initiated Renegotiation     not having provided client certificate and private key file, the client x509-based authentication prevents this from being tested</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"> CRIME, TLS (CVE-2012-4929)                not vulnerable (OK)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"> BREACH (CVE-2013-3587)                    not having provided client certificate and private key file, the client x509-based authentication prevents this from being tested</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"> POODLE, SSL (CVE-2014-3566)               not vulnerable (OK), no SSLv3 support</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"> TLS_FALLBACK_SCSV (RFC 7507)              No fallback possible (OK), no protocol below TLS 1.2 offered</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"> SWEET32 (CVE-2016-2183, CVE-2016-6329)    not vulnerable (OK)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"> FREAK (CVE-2015-0204)                     not vulnerable (OK)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"> DROWN (CVE-2016-0800, CVE-2016-0703)      not vulnerable on this host and port (OK)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                                           make sure you don&#x27;t use this certificate elsewhere with SSLv2 enabled services, see</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                                           https://search.censys.io/search?resource=hosts&amp;virtual_hosts=INCLUDE&amp;q=C81025DA6F9BB646239659420D58E73F62CEB7D2AD5AC13FF12A9DE057394953</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"> LOGJAM (CVE-2015-4000), experimental      common prime with 2048 bits detected: RFC3526/Oakley Group 14 (2048 bits),</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                                           but no DH EXPORT ciphers</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"> BEAST (CVE-2011-3389)                     not vulnerable (OK), no SSL3 or TLS1</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"> LUCKY13 (CVE-2013-0169), experimental     not vulnerable (OK)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"> Winshock (CVE-2014-6321), experimental    not vulnerable (OK) - CAMELLIA or ECDHE_RSA GCM ciphers found</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"> RC4 (CVE-2013-2566, CVE-2015-2808)        no RC4 ciphers detected (OK)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">Could not determine the protocol, only simulating generic clients.</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"> Running client simulations via sockets</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"> Browser                      Protocol  Cipher Suite Name (OpenSSL)       Forward Secrecy</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">------------------------------------------------------------------------------------------------</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"> Android 8.1 (native)         TLSv1.2   ECDHE-RSA-AES256-GCM-SHA384       253 bit ECDH (X25519)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"> Android 9.0 (native)         TLSv1.2   ECDHE-RSA-AES256-GCM-SHA384       253 bit ECDH (X25519)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"> Android 10.0 (native)        TLSv1.2   ECDHE-RSA-AES256-GCM-SHA384       253 bit ECDH (X25519)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"> Android 11 (native)          TLSv1.2   ECDHE-RSA-AES256-GCM-SHA384       253 bit ECDH (X25519)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"> Android 12 (native)          TLSv1.2   ECDHE-RSA-AES256-GCM-SHA384       253 bit ECDH (X25519)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"> Java 7u25                    No connection</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"> Java 8u161                   TLSv1.2   ECDHE-RSA-AES256-GCM-SHA384       521 bit ECDH (P-521)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"> Java 11.0.2 (OpenJDK)        TLSv1.2   ECDHE-RSA-AES256-GCM-SHA384       521 bit ECDH (P-521)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"> Java 17.0.3 (OpenJDK)        TLSv1.2   ECDHE-RSA-AES256-GCM-SHA384       253 bit ECDH (X25519)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"> go 1.17.8                    TLSv1.2   ECDHE-RSA-AES256-GCM-SHA384       253 bit ECDH (X25519)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"> LibreSSL 2.8.3 (Apple)       TLSv1.2   ECDHE-RSA-AES256-GCM-SHA384       253 bit ECDH (X25519)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"> OpenSSL 1.0.2e               TLSv1.2   ECDHE-RSA-AES256-GCM-SHA384       521 bit ECDH (P-521)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"> OpenSSL 1.1.0l (Debian)      TLSv1.2   ECDHE-RSA-AES256-GCM-SHA384       253 bit ECDH (X25519)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"> OpenSSL 1.1.1d (Debian)      TLSv1.2   ECDHE-RSA-AES256-GCM-SHA384       253 bit ECDH (X25519)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"> OpenSSL 3.0.3 (git)          TLSv1.2   ECDHE-RSA-AES256-GCM-SHA384       253 bit ECDH (X25519)</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="rotation">TLS Certificate and Private Key Rotation<a href="#rotation" class="hash-link" aria-label="Direct link to TLS Certificate and Private Key Rotation" title="Direct link to TLS Certificate and Private Key Rotation">​</a></h2>
<p>Server TLS certificates (public keys) and private keys have expiration dates and will need to be replaced
(rotated) every so often.</p>
<p>The replacement process involves the following steps:</p>
<ol>
<li>Replace the files on disk</li>
<li>Clear the certificate and private key store cache on the node</li>
</ol>
<p>Without the second step, the new certificate/key pair will be used by the node after a period of time,
as the TLS implementation in the runtimes purges its certificate store cache.</p>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="replacing-certificate-and-private-key-files-on-disk">Replacing Certificate and Private Key Files on Disk<a href="#replacing-certificate-and-private-key-files-on-disk" class="hash-link" aria-label="Direct link to Replacing Certificate and Private Key Files on Disk" title="Direct link to Replacing Certificate and Private Key Files on Disk">​</a></h3>
<p>Simply replace the server certificate, server private key and (if needed) the <a href="#peer-verification">certificate authority</a>
bundle files with their new versions.</p>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="clearing-the-certificate-and-private-key-store-cache">Clearing the Certificate and Private Key Store Cache<a href="#clearing-the-certificate-and-private-key-store-cache" class="hash-link" aria-label="Direct link to Clearing the Certificate and Private Key Store Cache" title="Direct link to Clearing the Certificate and Private Key Store Cache">​</a></h3>
<div class="tabs-container tabList__CuJ"><ul role="tablist" aria-orientation="horizontal" class="tabs"><li role="tab" tabindex="0" aria-selected="true" class="tabs__item tabItem_LNqP tabs__item--active">bash</li><li role="tab" tabindex="-1" aria-selected="false" class="tabs__item tabItem_LNqP">PowerShell</li><li role="tab" tabindex="-1" aria-selected="false" class="tabs__item tabItem_LNqP">cmd</li></ul><div class="margin-top--md"><div role="tabpanel" class="tabItem_Ymn6"><div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">rabbitmqctl </span><span class="token builtin class-name">eval</span><span class="token plain"> </span><span class="token parameter variable" style="color:#36acaa">-n</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">[</span><span class="token plain">target-node@hostname</span><span class="token punctuation" style="color:#393A34">]</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&#x27;ssl:clear_pem_cache().&#x27;</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div></div><div role="tabpanel" class="tabItem_Ymn6" hidden=""><div class="language-PowerShell language-powershell codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-powershell codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">rabbitmqctl</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">bat eval </span><span class="token operator" style="color:#393A34">-</span><span class="token plain">n </span><span class="token namespace" style="opacity:0.7">[target-node@hostname]</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&#x27;ssl:clear_pem_cache().&#x27;</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div></div><div role="tabpanel" class="tabItem_Ymn6" hidden=""><div class="language-batch codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-batch codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token command keyword" style="color:#00009f">rabbitmqctl</span><span class="token command">.bat eval </span><span class="token command parameter attr-name" style="color:#00a4db">-n</span><span class="token command"> [target-node@hostname] </span><span class="token command string" style="color:#e3116c">&quot;ssl:clear_pem_cache().&quot;</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div></div></div></div>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="trust-store-plugin">The Trust Store Plugin<a href="#trust-store-plugin" class="hash-link" aria-label="Direct link to The Trust Store Plugin" title="Direct link to The Trust Store Plugin">​</a></h2>
<p><a href="https://github.com/rabbitmq/rabbitmq-server/tree/main/deps/rabbitmq_trust_store" target="_blank" rel="noopener noreferrer"><code>rabbitmq_trust_store</code></a> is a plugin that
targets environments where <a href="#peer-verification">peer verification</a> is heavily used and the list of trusted certificates is fairly dynamic.
That is, that the trusted leaf client certificates changes fairly often and it makes more sense to whitelist
them than to use certificate revocation or intermediate certificates.</p>
<p>The trust store plugin supports two sources of trusted leaf client certificates:</p>
<ul>
<li>A local directory with certificates</li>
<li>A set of HTTPS endpoints that follows a certain convention</li>
</ul>
<p>Please refer to the <a href="https://github.com/rabbitmq/rabbitmq-server/tree/main/deps/rabbitmq_trust_store" target="_blank" rel="noopener noreferrer">doc guide</a> of the plugin
to learn more about how both options can be set up.</p>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="erlang-client">Using TLS in the Erlang Client<a href="#erlang-client" class="hash-link" aria-label="Direct link to Using TLS in the Erlang Client" title="Direct link to Using TLS in the Erlang Client">​</a></h2>
<p>Enabling TLS in the RabbitMQ Erlang client is similar to configuring other
settings related to networking. The <code>#amqp_params_network</code> record
provides a field, <code>ssl_options</code>, for all the <a href="http://erlang.org/doc/man/./ssl" target="_blank" rel="noopener noreferrer">standard Erlang TLS options</a>.</p>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="erlang-ssl">Erlang TLS Options<a href="#erlang-ssl" class="hash-link" aria-label="Direct link to Erlang TLS Options" title="Direct link to Erlang TLS Options">​</a></h3>
<p>The three important options which must be supplied are:</p>
<ul>
<li>The <code>cacertfile</code> option specifies the certificates of the root
Certificate Authorities that we wish to implicitly trust.</li>
<li>The <code>certfile</code> is the client&#x27;s own certificate in PEM format</li>
<li>The <code>keyfile</code> is the client&#x27;s private key file in PEM format</li>
</ul>
<p><code>server_name_indication</code> - set this option to the host name of the server
to which a TLS connection will be made to enable &quot;Server Name Indication&quot; verification
of the certificate presented by the server. This ensures that the server certificate&#x27;s
<code>CN=</code> value will be verified during TLS connection establishment. You can
override this behavior by setting <code>server_name_indication</code> to a different
host name or to the special value <code>disable</code> to disable this
verification. Note that, by default, SNI is <b>not</b> enabled. This default
will change in a future RabbitMQ Erlang client release.</p>
<p><code>verify</code> - set this option to <code>verify_peer</code> to enable X509
certificate chain verification. The <code>depth</code> option configures certificate
verification depth. Note that, by default, <code>verify</code> is set to
<code>verify_none</code>, which disables certificate chain verification. This default
will change in a future RabbitMQ Erlang client release.</p>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="erlang-code-example">Code Example<a href="#erlang-code-example" class="hash-link" aria-label="Direct link to Code Example" title="Direct link to Code Example">​</a></h3>
<div class="language-erlang codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-erlang codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token variable" style="color:#36acaa">SslOpts</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">[</span><span class="token punctuation" style="color:#393A34">{</span><span class="token atom">cacertfile</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> &amp;</span><span class="token atom">quot</span><span class="token punctuation" style="color:#393A34">;</span><span class="token operator" style="color:#393A34">/</span><span class="token atom">path</span><span class="token operator" style="color:#393A34">/</span><span class="token atom">to</span><span class="token operator" style="color:#393A34">/</span><span class="token atom">ca_certificate</span><span class="token punctuation" style="color:#393A34">.</span><span class="token atom">pem</span><span class="token plain">&amp;</span><span class="token atom">quot</span><span class="token punctuation" style="color:#393A34">;</span><span class="token punctuation" style="color:#393A34">}</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">           </span><span class="token punctuation" style="color:#393A34">{</span><span class="token atom">certfile</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> &amp;</span><span class="token atom">quot</span><span class="token punctuation" style="color:#393A34">;</span><span class="token operator" style="color:#393A34">/</span><span class="token atom">path</span><span class="token operator" style="color:#393A34">/</span><span class="token atom">to</span><span class="token operator" style="color:#393A34">/</span><span class="token atom">client</span><span class="token operator" style="color:#393A34">/</span><span class="token atom">certificate</span><span class="token punctuation" style="color:#393A34">.</span><span class="token atom">pem</span><span class="token plain">&amp;</span><span class="token atom">quot</span><span class="token punctuation" style="color:#393A34">;</span><span class="token punctuation" style="color:#393A34">}</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">           </span><span class="token punctuation" style="color:#393A34">{</span><span class="token atom">keyfile</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> &amp;</span><span class="token atom">quot</span><span class="token punctuation" style="color:#393A34">;</span><span class="token operator" style="color:#393A34">/</span><span class="token atom">path</span><span class="token operator" style="color:#393A34">/</span><span class="token atom">to</span><span class="token operator" style="color:#393A34">/</span><span class="token atom">client</span><span class="token operator" style="color:#393A34">/</span><span class="token atom">private_key</span><span class="token punctuation" style="color:#393A34">.</span><span class="token atom">pem</span><span class="token plain">&amp;</span><span class="token atom">quot</span><span class="token punctuation" style="color:#393A34">;</span><span class="token punctuation" style="color:#393A34">}</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">           </span><span class="token comment" style="color:#999988;font-style:italic">%% only necessary with intermediate CAs</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">           </span><span class="token comment" style="color:#999988;font-style:italic">%% {depth, 2},</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">           </span><span class="token comment" style="color:#999988;font-style:italic">%% Note: it is recommended to set &#x27;verify&#x27; to</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">           </span><span class="token comment" style="color:#999988;font-style:italic">%% to &#x27;verify_peer&#x27; to ensure that X509</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">           </span><span class="token comment" style="color:#999988;font-style:italic">%% certificate chain validation is enabled</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">           </span><span class="token comment" style="color:#999988;font-style:italic">%%</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">           </span><span class="token comment" style="color:#999988;font-style:italic">%% Do not set &#x27;verify&#x27; or set it to verify_none</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">           </span><span class="token comment" style="color:#999988;font-style:italic">%% if x509 certificate chain validation is</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">           </span><span class="token comment" style="color:#999988;font-style:italic">%% not desired</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">           </span><span class="token punctuation" style="color:#393A34">{</span><span class="token atom">verify</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token atom">verify_peer</span><span class="token punctuation" style="color:#393A34">}</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">           </span><span class="token comment" style="color:#999988;font-style:italic">%% If Server Name Indication validation is desired,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">           </span><span class="token comment" style="color:#999988;font-style:italic">%% set the following option to the host name to which</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">           </span><span class="token comment" style="color:#999988;font-style:italic">%% the connection is made. If necessary, this option</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">           </span><span class="token comment" style="color:#999988;font-style:italic">%% may be set to another host name to match the server</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">           </span><span class="token comment" style="color:#999988;font-style:italic">%% certificate&#x27;s CN= value.</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">           </span><span class="token comment" style="color:#999988;font-style:italic">%% Do not set this option or set it to the atom &#x27;disable&#x27;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">           </span><span class="token comment" style="color:#999988;font-style:italic">%% to disable SNI validation</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">           </span><span class="token punctuation" style="color:#393A34">{</span><span class="token atom">server_name_indication</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;my.rmq-server.net&quot;</span><span class="token punctuation" style="color:#393A34">}</span><span class="token punctuation" style="color:#393A34">]</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token variable" style="color:#36acaa">Params</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">#</span><span class="token atom">amqp_params_network</span><span class="token punctuation" style="color:#393A34">{</span><span class="token atom">host</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;my.rmq-server.net&quot;</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                              </span><span class="token atom">port</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">5671</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                              </span><span class="token atom">ssl_options</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token variable" style="color:#36acaa">SslOpts</span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">{</span><span class="token atom">ok</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token variable" style="color:#36acaa">Conn</span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token atom">amqp_connection</span><span class="token punctuation" style="color:#393A34">:</span><span class="token function" style="color:#d73a49">start</span><span class="token punctuation" style="color:#393A34">(</span><span class="token variable" style="color:#36acaa">Params</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">,</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>You can now go ahead and use Conn as a normal connection.</p>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="manual-certificate-generation">Manually Generating a CA, Certificates and Private Keys<a href="#manual-certificate-generation" class="hash-link" aria-label="Direct link to Manually Generating a CA, Certificates and Private Keys" title="Direct link to Manually Generating a CA, Certificates and Private Keys">​</a></h2>
<p>This section of the guide explains how to generate a Certificate Authority and
use it to generate and sign two certificate/key pairs, one for the server and one for
client libraries. Note that the process can be <a href="#automated-certificate-generation">automated using
existing tools</a>, which is recommended. This section is intended for those who would like to improve their understanding
of the process, OpenSSL command line tools and some important aspects of OpenSSL configuration.</p>
<p>This guide assumes a UNIX-like operating system (Linux, MacOS, a BSD variant and so on)
and a recent version of OpenSSL available in <code>PATH</code>.</p>
<p>First let&#x27;s create a directory for our test Certificate Authority:</p>
<div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token function" style="color:#d73a49">mkdir</span><span class="token plain"> testca</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token builtin class-name">cd</span><span class="token plain"> testca</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token function" style="color:#d73a49">mkdir</span><span class="token plain"> certs private</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token function" style="color:#d73a49">chmod</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">700</span><span class="token plain"> private</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token builtin class-name">echo</span><span class="token plain"> 01 </span><span class="token operator" style="color:#393A34">&gt;</span><span class="token plain"> serial</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token function" style="color:#d73a49">touch</span><span class="token plain"> index.txt</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>Now add the following OpenSSL configuration file, <code>openssl.cnf</code>, within the newly created <code>testca</code>
directory:</p>
<div class="language-ini codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-ini codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">[ ca ]</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">default_ca = testca</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">[ testca ]</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">dir = .</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">certificate = $dir/ca_certificate.pem</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">database = $dir/index.txt</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">new_certs_dir = $dir/certs</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">private_key = $dir/private/ca_private_key.pem</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">serial = $dir/serial</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">default_crl_days = 7</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">default_days = 365</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">default_md = sha256</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">policy = testca_policy</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">x509_extensions = certificate_extensions</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">[ testca_policy ]</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">commonName = supplied</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">stateOrProvinceName = optional</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">countryName = optional</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">emailAddress = optional</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">organizationName = optional</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">organizationalUnitName = optional</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">domainComponent = optional</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">[ certificate_extensions ]</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">basicConstraints = CA:false</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">[ req ]</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">default_bits = 2048</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">default_keyfile = ./private/ca_private_key.pem</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">default_md = sha256</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">prompt = yes</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">distinguished_name = root_ca_distinguished_name</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">x509_extensions = root_ca_extensions</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">[ root_ca_distinguished_name ]</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">commonName = hostname</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">[ root_ca_extensions ]</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">basicConstraints = CA:true</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">keyUsage = keyCertSign, cRLSign</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">[ client_ca_extensions ]</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">basicConstraints = CA:false</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">keyUsage = digitalSignature,keyEncipherment</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">extendedKeyUsage = 1.3.6.1.5.5.7.3.2</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">[ server_ca_extensions ]</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">basicConstraints = CA:false</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">keyUsage = digitalSignature,keyEncipherment</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">extendedKeyUsage = 1.3.6.1.5.5.7.3.1</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>Next we need to generate the key and certificates that our test
Certificate Authority will use. Still within the <code>testca</code>
directory:</p>
<div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">openssl req </span><span class="token parameter variable" style="color:#36acaa">-x509</span><span class="token plain"> </span><span class="token parameter variable" style="color:#36acaa">-config</span><span class="token plain"> openssl.cnf </span><span class="token parameter variable" style="color:#36acaa">-newkey</span><span class="token plain"> rsa:2048 </span><span class="token parameter variable" style="color:#36acaa">-days</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">365</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">\</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token parameter variable" style="color:#36acaa">-out</span><span class="token plain"> ca_certificate.pem </span><span class="token parameter variable" style="color:#36acaa">-outform</span><span class="token plain"> PEM </span><span class="token parameter variable" style="color:#36acaa">-subj</span><span class="token plain"> /CN</span><span class="token operator" style="color:#393A34">=</span><span class="token plain">MyTestCA/ </span><span class="token parameter variable" style="color:#36acaa">-nodes</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">openssl x509 </span><span class="token parameter variable" style="color:#36acaa">-in</span><span class="token plain"> ca_certificate.pem </span><span class="token parameter variable" style="color:#36acaa">-out</span><span class="token plain"> ca_certificate.cer </span><span class="token parameter variable" style="color:#36acaa">-outform</span><span class="token plain"> DER</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>This is all that is needed to generate a test Certificate
Authority. The root certificate is in <code>ca_certificate.pem</code>
and is also in <code>testca/ca_certificate.cer</code>. These two files contain the
same information, but in different formats, PEM and DER.
Most software uses the former but some tools require the latter.</p>
<p>Having set up our Certificate Authority, we now need to generate
private keys and certificates for the clients and the server.
RabbitMQ broker uses certificates and private keys in the PEM format.
Some client libraries use the PEM format, others will require conversion
to a different format (e.g. PKCS#12).</p>
<p>Java and .NET clients use a certificate format called PKCS#12 and custom certificate stores.
Certificate store contains both the client&#x27;s certificate and key. The PKCS store is usually password protected, and so that
a password must be provided.</p>
<p>The process for creating server and client certificates is very
similar. First the server:</p>
<div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token builtin class-name">cd</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">..</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token function" style="color:#d73a49">ls</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token comment" style="color:#999988;font-style:italic"># =&gt; testca</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token function" style="color:#d73a49">mkdir</span><span class="token plain"> server</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token builtin class-name">cd</span><span class="token plain"> server</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">openssl genrsa </span><span class="token parameter variable" style="color:#36acaa">-out</span><span class="token plain"> private_key.pem </span><span class="token number" style="color:#36acaa">2048</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">openssl req </span><span class="token parameter variable" style="color:#36acaa">-new</span><span class="token plain"> </span><span class="token parameter variable" style="color:#36acaa">-key</span><span class="token plain"> private_key.pem </span><span class="token parameter variable" style="color:#36acaa">-out</span><span class="token plain"> req.pem </span><span class="token parameter variable" style="color:#36acaa">-outform</span><span class="token plain"> PEM </span><span class="token punctuation" style="color:#393A34">\</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token parameter variable" style="color:#36acaa">-subj</span><span class="token plain"> /CN</span><span class="token operator" style="color:#393A34">=</span><span class="token variable" style="color:#36acaa">$(</span><span class="token variable function" style="color:#d73a49">hostname</span><span class="token variable" style="color:#36acaa">)</span><span class="token plain">/O</span><span class="token operator" style="color:#393A34">=</span><span class="token plain">server/ </span><span class="token parameter variable" style="color:#36acaa">-nodes</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token builtin class-name">cd</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">..</span><span class="token plain">/testca</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">openssl ca </span><span class="token parameter variable" style="color:#36acaa">-config</span><span class="token plain"> openssl.cnf </span><span class="token parameter variable" style="color:#36acaa">-in</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">..</span><span class="token plain">/server/req.pem </span><span class="token parameter variable" style="color:#36acaa">-out</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">\</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token punctuation" style="color:#393A34">..</span><span class="token plain">/server/server_certificate.pem </span><span class="token parameter variable" style="color:#36acaa">-notext</span><span class="token plain"> </span><span class="token parameter variable" style="color:#36acaa">-batch</span><span class="token plain"> </span><span class="token parameter variable" style="color:#36acaa">-extensions</span><span class="token plain"> server_ca_extensions</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token builtin class-name">cd</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">..</span><span class="token plain">/server</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">openssl pkcs12 </span><span class="token parameter variable" style="color:#36acaa">-export</span><span class="token plain"> </span><span class="token parameter variable" style="color:#36acaa">-out</span><span class="token plain"> server_certificate.p12 </span><span class="token parameter variable" style="color:#36acaa">-in</span><span class="token plain"> server_certificate.pem </span><span class="token parameter variable" style="color:#36acaa">-inkey</span><span class="token plain"> private_key.pem </span><span class="token punctuation" style="color:#393A34">\</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token parameter variable" style="color:#36acaa">-passout</span><span class="token plain"> pass:MySecretPassword</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>And now the client:</p>
<div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token builtin class-name">cd</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">..</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token function" style="color:#d73a49">ls</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token comment" style="color:#999988;font-style:italic"># =&gt; server testca</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token function" style="color:#d73a49">mkdir</span><span class="token plain"> client</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token builtin class-name">cd</span><span class="token plain"> client</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">openssl genrsa </span><span class="token parameter variable" style="color:#36acaa">-out</span><span class="token plain"> private_key.pem </span><span class="token number" style="color:#36acaa">2048</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">openssl req </span><span class="token parameter variable" style="color:#36acaa">-new</span><span class="token plain"> </span><span class="token parameter variable" style="color:#36acaa">-key</span><span class="token plain"> private_key.pem </span><span class="token parameter variable" style="color:#36acaa">-out</span><span class="token plain"> req.pem </span><span class="token parameter variable" style="color:#36acaa">-outform</span><span class="token plain"> PEM </span><span class="token punctuation" style="color:#393A34">\</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token parameter variable" style="color:#36acaa">-subj</span><span class="token plain"> /CN</span><span class="token operator" style="color:#393A34">=</span><span class="token variable" style="color:#36acaa">$(</span><span class="token variable function" style="color:#d73a49">hostname</span><span class="token variable" style="color:#36acaa">)</span><span class="token plain">/O</span><span class="token operator" style="color:#393A34">=</span><span class="token plain">client/ </span><span class="token parameter variable" style="color:#36acaa">-nodes</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token builtin class-name">cd</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">..</span><span class="token plain">/testca</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">openssl ca </span><span class="token parameter variable" style="color:#36acaa">-config</span><span class="token plain"> openssl.cnf </span><span class="token parameter variable" style="color:#36acaa">-in</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">..</span><span class="token plain">/client/req.pem </span><span class="token parameter variable" style="color:#36acaa">-out</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">\</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token punctuation" style="color:#393A34">..</span><span class="token plain">/client/client_certificate.pem </span><span class="token parameter variable" style="color:#36acaa">-notext</span><span class="token plain"> </span><span class="token parameter variable" style="color:#36acaa">-batch</span><span class="token plain"> </span><span class="token parameter variable" style="color:#36acaa">-extensions</span><span class="token plain"> client_ca_extensions</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token builtin class-name">cd</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">..</span><span class="token plain">/client</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">openssl pkcs12 </span><span class="token parameter variable" style="color:#36acaa">-export</span><span class="token plain"> </span><span class="token parameter variable" style="color:#36acaa">-out</span><span class="token plain"> client_certificate.p12 </span><span class="token parameter variable" style="color:#36acaa">-in</span><span class="token plain"> client_certificate.pem </span><span class="token parameter variable" style="color:#36acaa">-inkey</span><span class="token plain"> private_key.pem </span><span class="token punctuation" style="color:#393A34">\</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token parameter variable" style="color:#36acaa">-passout</span><span class="token plain"> pass:MySecretPassword</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>The two examples above generate private keys that are 2048 bits in size.
It is possible to use longer (and thus more secure but also slower to generate)
keys by providing a different value to <code>openssl genrsa</code>, e.g.:</p>
<div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">openssl genrsa </span><span class="token parameter variable" style="color:#36acaa">-out</span><span class="token plain"> private_key.pem </span><span class="token number" style="color:#36acaa">4096</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>Another option would be to generate a key using <a href="https://blog.cloudflare.com/a-relatively-easy-to-understand-primer-on-Elliptic-curve-cryptography/" target="_blank" rel="noopener noreferrer">Elliptic Curve Cryptography</a>. Instead of <code>openssl genrsa</code> use
<code>openssl ecparam</code> like so:</p>
<div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">openssl ecparam </span><span class="token parameter variable" style="color:#36acaa">-out</span><span class="token plain"> private_key.pem </span><span class="token parameter variable" style="color:#36acaa">-genkey</span><span class="token plain"> </span><span class="token parameter variable" style="color:#36acaa">-name</span><span class="token plain"> prime256v1</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p><code>prime256v1</code> in the example above is an Elliptic curve name.
Different versions of OpenSSL will have a different set of curves available,
list them with <code>openssl ecparam -list_curves</code>.</p></div><footer class="theme-doc-footer docusaurus-mt-lg"><div class="row margin-top--sm theme-doc-footer-edit-meta-row"><div class="col"><a href="https://github.com/rabbitmq/rabbitmq-website/tree/main/docs/ssl/index.md" target="_blank" rel="noopener noreferrer" class="theme-edit-this-page"><svg fill="currentColor" height="20" width="20" viewBox="0 0 40 40" class="iconEdit_Z9Sw" aria-hidden="true"><g><path d="m34.5 11.7l-3 3.1-6.3-6.3 3.1-3q0.5-0.5 1.2-0.5t1.1 0.5l3.9 3.9q0.5 0.4 0.5 1.1t-0.5 1.2z m-29.5 17.1l18.4-18.5 6.3 6.3-18.4 18.4h-6.3v-6.2z"></path></g></svg>Edit this page</a></div><div class="col lastUpdated_JAkA"></div></div></footer></article><nav class="pagination-nav docusaurus-mt-lg" aria-label="Docs pages"><a class="pagination-nav__link pagination-nav__link--prev" href="/rabbitmq-website/docs/next/nettick"><div class="pagination-nav__sublabel">Previous</div><div class="pagination-nav__label">Net Tick Time</div></a><a class="pagination-nav__link pagination-nav__link--next" href="/rabbitmq-website/docs/next/troubleshooting-networking"><div class="pagination-nav__sublabel">Next</div><div class="pagination-nav__label">Troubleshooting Connectivity</div></a></nav></div></div><div class="col col--3"><div class="tableOfContents_bqdL thin-scrollbar theme-doc-toc-desktop"><ul class="table-of-contents table-of-contents__left-border"><li><a href="#overview" class="table-of-contents__link toc-highlight">Table of Contents</a></li><li><a href="#basics" class="table-of-contents__link toc-highlight">Where to Learn the Basics of TLS</a></li><li><a href="#protocols" class="table-of-contents__link toc-highlight">TLS and Messaging Protocols</a></li><li><a href="#tls-connectivity-options" class="table-of-contents__link toc-highlight">Common Approaches to TLS for client Connections with RabbitMQ</a></li><li><a href="#erlang-otp-requirements" class="table-of-contents__link toc-highlight">Erlang/OTP Requirements for TLS Support</a></li><li><a href="#known-compatibility-issues" class="table-of-contents__link toc-highlight">Known Incompatibilities and Limitations</a></li><li><a href="#certificates-and-keys" class="table-of-contents__link toc-highlight">TLS Basics: Certificate Authorities, Certificates, Keys</a><ul><li><a href="#two-primary-objectives-of-tls" class="table-of-contents__link toc-highlight">Two Primary Objectives of TLS</a></li><li><a href="#certificates-private-keys-and-certificate-authorities" class="table-of-contents__link toc-highlight">Certificates, Private Keys, and Certificate Authorities</a></li></ul></li><li><a href="#automated-certificate-generation" class="table-of-contents__link toc-highlight">The Short Route to Generating a CA, Certificates, and Keys</a><ul><li><a href="#automated-certificate-generation-transcript" class="table-of-contents__link toc-highlight">Using tls-gen&#39;s Basic Profile</a></li></ul></li><li><a href="#enabling-tls" class="table-of-contents__link toc-highlight">Enabling TLS Support in RabbitMQ</a><ul><li><a href="#enabling-tls-paths" class="table-of-contents__link toc-highlight">Certificate and Private Key File Paths</a></li><li><a href="#enabling-tls-verify-configuration" class="table-of-contents__link toc-highlight">How to Verify that TLS is Enabled</a></li><li><a href="#private-key-passwords" class="table-of-contents__link toc-highlight">Providing Private Key Password</a></li></ul></li><li><a href="#peer-verification" class="table-of-contents__link toc-highlight">TLS Peer Verification: Who Do You Say You Are?</a><ul><li><a href="#peer-verification-how-it-works" class="table-of-contents__link toc-highlight">How Peer Verification Works</a></li><li><a href="#mutual-peer-verification-mutual-tls-authentication-or-mtls" class="table-of-contents__link toc-highlight">Mutual Peer Verification (Mutual TLS Authentication or mTLS)</a></li><li><a href="#when-peer-verification-fails" class="table-of-contents__link toc-highlight">When Peer Verification Fails</a></li><li><a href="#peer-verification-trusted-certificates" class="table-of-contents__link toc-highlight">Trusted Certificates</a></li><li><a href="#peer-verification-configuration" class="table-of-contents__link toc-highlight">Enabling Peer Verification</a></li><li><a href="#peer-verification-depth" class="table-of-contents__link toc-highlight">Certificate Chains and Verification Depth</a></li></ul></li><li><a href="#java-client" class="table-of-contents__link toc-highlight">Using TLS in the Java Client</a><ul><li><a href="#java-client-trust-managers-and-stores" class="table-of-contents__link toc-highlight">Key Managers, Trust Managers and Stores</a></li><li><a href="#java-client-connecting" class="table-of-contents__link toc-highlight">Connecting with TLS</a></li><li><a href="#java-client-connecting-with-peer-verification" class="table-of-contents__link toc-highlight">Connecting with Peer Verification Enabled</a></li><li><a href="#tls-versions-java-client" class="table-of-contents__link toc-highlight">Configuring TLS Version in Java Client</a></li></ul></li><li><a href="#dotnet-client" class="table-of-contents__link toc-highlight">Using TLS in the .NET Client</a><ul><li><a href="#dotnet-peer-verification" class="table-of-contents__link toc-highlight">.NET Trust Store</a></li><li><a href="#certmgr" class="table-of-contents__link toc-highlight">Certificate Management with Certmgr</a></li><li><a href="#dotnet-connection-params" class="table-of-contents__link toc-highlight">Connection TLS Settings</a></li><li><a href="#dotnet-tls-versions-dotnet-client" class="table-of-contents__link toc-highlight">TLS Versions</a></li><li><a href="#dotnet-example" class="table-of-contents__link toc-highlight">Code Example</a></li><li><a href="#tls-verification-in-dotnet" class="table-of-contents__link toc-highlight">TLS Peer Verification in .NET Client</a></li></ul></li><li><a href="#tls-versions" class="table-of-contents__link toc-highlight">Limiting TLS Versions Used by the Server</a><ul><li><a href="#tls-versions-why-limit" class="table-of-contents__link toc-highlight">Why Limit TLS Versions</a></li><li><a href="#tls-versions-why-not-limit" class="table-of-contents__link toc-highlight">Why Not Limit TLS Versions</a></li><li><a href="#verifying-tls-versions" class="table-of-contents__link toc-highlight">Verifying Enabled TLS Versions</a></li><li><a href="#tls1.3" class="table-of-contents__link toc-highlight">TLSv1.3</a></li><li><a href="#tls-version-support-in-jdk-and-net" class="table-of-contents__link toc-highlight">TLS Version Support Table for JDK and .NET</a></li></ul></li><li><a href="#key-usage" class="table-of-contents__link toc-highlight">Public Key Usage Options</a><ul><li><a href="#key-usage-effects-on-cipher-suites" class="table-of-contents__link toc-highlight">Extensions and Their Effect on Accepted Cipher Suites (Cipher Suite Filtering)</a></li><li><a href="#examining-certificate-extensions" class="table-of-contents__link toc-highlight">Examining Certificate Extensions</a></li></ul></li><li><a href="#cipher-suites" class="table-of-contents__link toc-highlight">Cipher Suites</a><ul><li><a href="#available-cipher-suites" class="table-of-contents__link toc-highlight">Listing Cipher Suites Available on a RabbitMQ Node</a></li><li><a href="#configuring-cipher-suites" class="table-of-contents__link toc-highlight">Configuring Cipher Suites</a></li><li><a href="#cipher-suite-order" class="table-of-contents__link toc-highlight">Cipher Suite Order</a></li></ul></li><li><a href="#major-vulnerabilities" class="table-of-contents__link toc-highlight">Known TLS Vulnerabilities and Their Mitigation</a><ul><li><a href="#robot" class="table-of-contents__link toc-highlight">ROBOT</a></li><li><a href="#poodle" class="table-of-contents__link toc-highlight">POODLE</a></li><li><a href="#beast" class="table-of-contents__link toc-highlight">BEAST</a></li></ul></li><li><a href="#tls-evaluation-tools" class="table-of-contents__link toc-highlight">Evaluating TLS Setup Security</a><ul><li><a href="#testssl-sh" class="table-of-contents__link toc-highlight">testssl.sh</a></li><li><a href="#evaluation-of-a-tls-13-setup" class="table-of-contents__link toc-highlight">Evaluation of a TLS 1.3 Setup</a></li><li><a href="#evaluation-of-a-tls-12-setup-with-restricted-cipher-suites" class="table-of-contents__link toc-highlight">Evaluation of a TLS 1.2 Setup with Restricted Cipher Suites</a></li></ul></li><li><a href="#rotation" class="table-of-contents__link toc-highlight">TLS Certificate and Private Key Rotation</a><ul><li><a href="#replacing-certificate-and-private-key-files-on-disk" class="table-of-contents__link toc-highlight">Replacing Certificate and Private Key Files on Disk</a></li><li><a href="#clearing-the-certificate-and-private-key-store-cache" class="table-of-contents__link toc-highlight">Clearing the Certificate and Private Key Store Cache</a></li></ul></li><li><a href="#trust-store-plugin" class="table-of-contents__link toc-highlight">The Trust Store Plugin</a></li><li><a href="#erlang-client" class="table-of-contents__link toc-highlight">Using TLS in the Erlang Client</a><ul><li><a href="#erlang-ssl" class="table-of-contents__link toc-highlight">Erlang TLS Options</a></li><li><a href="#erlang-code-example" class="table-of-contents__link toc-highlight">Code Example</a></li></ul></li><li><a href="#manual-certificate-generation" class="table-of-contents__link toc-highlight">Manually Generating a CA, Certificates and Private Keys</a></li></ul></div></div></div></div></main></div></div></div><footer class="footer footer--dark"><div class="container container-fluid"><div class="row footer__links"><div class="col footer__col"><div class="footer__title">Learn about RabbitMQ</div><ul class="footer__items clean-list"><li class="footer__item"><a class="footer__link-item" href="/rabbitmq-website/tutorials">Getting Started</a></li><li class="footer__item"><a class="footer__link-item" href="/rabbitmq-website/docs">Documentation</a></li><li class="footer__item"><a class="footer__link-item" href="/rabbitmq-website/blog">Blog</a></li></ul></div><div class="col footer__col"><div class="footer__title">Reach out to the RabbitMQ team</div><ul class="footer__items clean-list"><li class="footer__item"><a href="https://github.com/rabbitmq" target="_blank" rel="noopener noreferrer" class="footer__link-item">GitHub<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_nPIU"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a></li><li class="footer__item"><a href="https://github.com/rabbitmq/rabbitmq-server/discussions" target="_blank" rel="noopener noreferrer" class="footer__link-item">GitHub Discussions<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_nPIU"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a></li><li class="footer__item"><a class="footer__link-item" href="/rabbitmq-website/contact?utm_source=rmq_release-information_tableheader&amp;utm_medium=rmq_website&amp;utm_campaign=tanzu">Long Term Commercial Support</a></li><li class="footer__item"><a class="footer__link-item" href="/rabbitmq-website/contact">Contact Us</a></li><li class="footer__item"><a href="https://www.rabbitmq.com/discord" target="_blank" rel="noopener noreferrer" class="footer__link-item">Discord<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_nPIU"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a></li></ul></div><div class="col footer__col"><div class="footer__title">Broadcom</div><ul class="footer__items clean-list"><li class="footer__item"><a href="https://tanzu.vmware.com/" target="_blank" rel="noopener noreferrer" class="footer__link-item">VMware Tanzu<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_nPIU"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a></li><li class="footer__item"><a href="https://www.vmware.com/help/legal.html" target="_blank" rel="noopener noreferrer" class="footer__link-item">Terms of Use<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_nPIU"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a></li><li class="footer__item"><a href="https://www.vmware.com/help/privacy.html" target="_blank" rel="noopener noreferrer" class="footer__link-item">Privacy<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_nPIU"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a></li><li class="footer__item"><a class="footer__link-item" href="/rabbitmq-website/trademark-guidelines">Trademark Guidelines</a></li><li class="footer__item"><a href="https://www.vmware.com/help/privacy/california-privacy-rights.html" target="_blank" rel="noopener noreferrer" class="footer__link-item">Your California Privacy Rights<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_nPIU"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a></li><li class="footer__item"><a class="footer__link-item ot-sdk-show-settings">Cookie Settings</a></li></ul></div></div><div class="footer__bottom text--center"><div class="footer__copyright">Copyright © 2005-2025 Broadcom. All Rights Reserved. The term "Broadcom" refers to Broadcom Inc. and/or its subsidiaries.</div></div></div></footer></div>
</body>
</html>
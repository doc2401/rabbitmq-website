<!doctype html>
<html lang="en" dir="ltr" class="docs-wrapper plugin-docs plugin-id-default docs-version-3.13 docs-doc-page docs-doc-id-prometheus/index" data-has-hydrated="false">
<head>
<meta charset="UTF-8">
<meta name="generator" content="Docusaurus v3.7.0">
<title data-rh="true">Monitoring with Prometheus and Grafana | RabbitMQ</title><meta data-rh="true" name="viewport" content="width=device-width,initial-scale=1"><meta data-rh="true" name="twitter:card" content="summary_large_image"><meta data-rh="true" property="og:image" content="https://www.rabbitmq.com/rabbitmq-website/img/rabbitmq-social-media-card.svg"><meta data-rh="true" name="twitter:image" content="https://www.rabbitmq.com/rabbitmq-website/img/rabbitmq-social-media-card.svg"><meta data-rh="true" property="og:url" content="https://www.rabbitmq.com/rabbitmq-website/docs/3.13/prometheus"><meta data-rh="true" property="og:locale" content="en"><meta data-rh="true" name="docusaurus_locale" content="en"><meta data-rh="true" name="docsearch:language" content="en"><meta data-rh="true" name="docusaurus_version" content="3.13"><meta data-rh="true" name="docusaurus_tag" content="docs-default-3.13"><meta data-rh="true" name="docsearch:version" content="3.13"><meta data-rh="true" name="docsearch:docusaurus_tag" content="docs-default-3.13"><meta data-rh="true" property="og:title" content="Monitoring with Prometheus and Grafana | RabbitMQ"><meta data-rh="true" name="description" content="Overview"><meta data-rh="true" property="og:description" content="Overview"><link data-rh="true" rel="icon" href="/rabbitmq-website/img/rabbitmq-logo.svg"><link data-rh="true" rel="canonical" href="https://www.rabbitmq.com/rabbitmq-website/docs/3.13/prometheus"><link data-rh="true" rel="alternate" href="https://www.rabbitmq.com/rabbitmq-website/docs/3.13/prometheus" hreflang="en"><link data-rh="true" rel="alternate" href="https://www.rabbitmq.com/rabbitmq-website/docs/3.13/prometheus" hreflang="x-default"><link data-rh="true" rel="preconnect" href="https://H10VQIW16Y-dsn.algolia.net" crossorigin="anonymous"><link rel="alternate" type="application/rss+xml" href="/rabbitmq-website/blog/rss.xml" title="RabbitMQ RSS Feed">
<link rel="alternate" type="application/atom+xml" href="/rabbitmq-website/blog/atom.xml" title="RabbitMQ Atom Feed">




<link rel="search" type="application/opensearchdescription+xml" title="RabbitMQ" href="/rabbitmq-website/opensearch.xml">







<link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Raleway:400,700">
<script src="https://cdn.cookielaw.org/scripttemplates/otSDKStub.js" data-domain-script="018ee308-473e-754f-b0c2-cbe82d25512f"></script>
<script>function OptanonWrapper(){}</script>
<script>function setGTM(e,t,o,n,r){e[n]=e[n]||[],e[n].push({"gtm.start":(new Date).getTime(),event:"gtm.js"});var i=t.getElementsByTagName(o)[0],a=t.createElement(o),s="dataLayer"!=n?"&l="+n:"";a.async=!0,a.src="https://www.googletagmanager.com/gtm.js?id="+r+s,i.parentNode.insertBefore(a,i)}var timer;function waitForOnetrustActiveGroups(){document.cookie.indexOf("OptanonConsent")>-1&&document.cookie.indexOf("groups=")>-1?(clearTimeout(timer),setGTM(window,document,"script","dataLayer","GTM-TT84L8K")):timer=setTimeout(waitForOnetrustActiveGroups,250)}document.cookie.indexOf("OptanonConsent")>-1&&document.cookie.indexOf("groups=")>-1?setGTM(window,document,"script","dataLayer","GTM-TT84L8K"):waitForOnetrustActiveGroups()</script><link rel="stylesheet" href="/rabbitmq-website/styles.css">
<script src="/rabbitmq-website/runtime~main.js" defer="defer"></script>
<script src="/rabbitmq-website/main.js" defer="defer"></script>
</head>
<body class="navigation-with-keyboard">
<script>!function(){function t(t){document.documentElement.setAttribute("data-theme",t)}var e=function(){try{return new URLSearchParams(window.location.search).get("docusaurus-theme")}catch(t){}}()||function(){try{return window.localStorage.getItem("theme")}catch(t){}}();null!==e?t(e):window.matchMedia("(prefers-color-scheme: dark)").matches?t("dark"):(window.matchMedia("(prefers-color-scheme: light)").matches,t("light"))}(),function(){try{const n=new URLSearchParams(window.location.search).entries();for(var[t,e]of n)if(t.startsWith("docusaurus-data-")){var a=t.replace("docusaurus-data-","data-");document.documentElement.setAttribute(a,e)}}catch(t){}}(),document.documentElement.setAttribute("data-announcement-bar-initially-dismissed",function(){try{return"true"===localStorage.getItem("docusaurus.announcement.dismiss")}catch(t){}return!1}())</script><div id="__docusaurus"><div role="region" aria-label="Skip to main content"><a class="skipToContent_fXgn" href="#__docusaurus_skipToContent_fallback">Skip to main content</a></div><div class="announcementBar_mb4j" style="background-color:var(--ifm-color-primary-contrast-background);color:var(--ifm-font-color-base)" role="banner"><div class="announcementBarPlaceholder_vyr4"></div><div class="content_knG7 announcementBarContent_xLdY"><strong style="font-size: var(--ifm-h4-font-size);"><a href="https://github.com/rabbitmq/rabbitmq-server/releases/tag/v4.1.0">RabbitMQ 4.1.0 is out</a></strong></div><button type="button" aria-label="Close" class="clean-btn close closeButton_CVFx announcementBarClose_gvF7"><svg viewBox="0 0 15 15" width="14" height="14"><g stroke="currentColor" stroke-width="3.1"><path d="M.75.75l13.5 13.5M14.25.75L.75 14.25"></path></g></svg></button></div><nav aria-label="Main" class="navbar navbar--fixed-top"><div class="navbar__inner"><div class="navbar__items"><button aria-label="Toggle navigation bar" aria-expanded="false" class="navbar__toggle clean-btn" type="button"><svg width="30" height="30" viewBox="0 0 30 30" aria-hidden="true"><path stroke="currentColor" stroke-linecap="round" stroke-miterlimit="10" stroke-width="2" d="M4 7h22M4 15h22M4 23h22"></path></svg></button><a class="navbar__brand" href="/rabbitmq-website/"><div class="navbar__logo"><img src="/rabbitmq-website/img/rabbitmq-logo-with-name.svg" alt="RabbitMQ" class="themedComponent_mlkZ themedComponent--light_NVdE"><img src="/rabbitmq-website/img/rabbitmq-logo-with-name.svg" alt="RabbitMQ" class="themedComponent_mlkZ themedComponent--dark_xIcU"></div></a><a class="navbar__item navbar__link" href="/rabbitmq-website/tutorials">Getting Started</a><a aria-current="page" class="navbar__item navbar__link navbar__link--active" href="/rabbitmq-website/docs/3.13">Docs</a><a class="navbar__item navbar__link" href="/rabbitmq-website/blog">Blog</a><a class="navbar__item navbar__link" href="/rabbitmq-website/contact">Support</a></div><div class="navbar__items navbar__items--right"><div class="navbar__item dropdown dropdown--hoverable dropdown--right"><a aria-current="page" class="navbar__link active" aria-haspopup="true" aria-expanded="false" role="button" href="/rabbitmq-website/docs/3.13/prometheus">3.13</a><ul class="dropdown__menu"><li class=""><strong>Release series</strong></li><li><a class="dropdown__link" href="/rabbitmq-website/docs/next/prometheus">Next</a></li><li><a class="dropdown__link" href="/rabbitmq-website/docs/prometheus">4.1</a></li><li><a class="dropdown__link" href="/rabbitmq-website/docs/4.0/prometheus">4.0</a></li><li><a aria-current="page" class="dropdown__link dropdown__link--active" href="/rabbitmq-website/docs/3.13/prometheus">3.13</a></li><li><a href="https://v3-12.rabbitmq.com/documentation.html" target="_blank" rel="noopener noreferrer" class="dropdown__link">3.12<svg width="12" height="12" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_nPIU"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a></li><li><a class="dropdown__link" href="/rabbitmq-website/release-information">Release Information</a></li></ul></div><a href="https://github.com/rabbitmq/rabbitmq-website" target="_blank" rel="noopener noreferrer" class="navbar__item navbar__link">GitHub<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_nPIU"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a><div class="toggle_vylO colorModeToggle_DEke"><button class="clean-btn toggleButton_gllP toggleButtonDisabled_aARS" type="button" disabled="" title="Switch between dark and light mode (currently light mode)" aria-label="Switch between dark and light mode (currently light mode)" aria-live="polite" aria-pressed="false"><svg viewBox="0 0 24 24" width="24" height="24" class="lightToggleIcon_pyhR"><path fill="currentColor" d="M12,9c1.65,0,3,1.35,3,3s-1.35,3-3,3s-3-1.35-3-3S10.35,9,12,9 M12,7c-2.76,0-5,2.24-5,5s2.24,5,5,5s5-2.24,5-5 S14.76,7,12,7L12,7z M2,13l2,0c0.55,0,1-0.45,1-1s-0.45-1-1-1l-2,0c-0.55,0-1,0.45-1,1S1.45,13,2,13z M20,13l2,0c0.55,0,1-0.45,1-1 s-0.45-1-1-1l-2,0c-0.55,0-1,0.45-1,1S19.45,13,20,13z M11,2v2c0,0.55,0.45,1,1,1s1-0.45,1-1V2c0-0.55-0.45-1-1-1S11,1.45,11,2z M11,20v2c0,0.55,0.45,1,1,1s1-0.45,1-1v-2c0-0.55-0.45-1-1-1C11.45,19,11,19.45,11,20z M5.99,4.58c-0.39-0.39-1.03-0.39-1.41,0 c-0.39,0.39-0.39,1.03,0,1.41l1.06,1.06c0.39,0.39,1.03,0.39,1.41,0s0.39-1.03,0-1.41L5.99,4.58z M18.36,16.95 c-0.39-0.39-1.03-0.39-1.41,0c-0.39,0.39-0.39,1.03,0,1.41l1.06,1.06c0.39,0.39,1.03,0.39,1.41,0c0.39-0.39,0.39-1.03,0-1.41 L18.36,16.95z M19.42,5.99c0.39-0.39,0.39-1.03,0-1.41c-0.39-0.39-1.03-0.39-1.41,0l-1.06,1.06c-0.39,0.39-0.39,1.03,0,1.41 s1.03,0.39,1.41,0L19.42,5.99z M7.05,18.36c0.39-0.39,0.39-1.03,0-1.41c-0.39-0.39-1.03-0.39-1.41,0l-1.06,1.06 c-0.39,0.39-0.39,1.03,0,1.41s1.03,0.39,1.41,0L7.05,18.36z"></path></svg><svg viewBox="0 0 24 24" width="24" height="24" class="darkToggleIcon_wfgR"><path fill="currentColor" d="M9.37,5.51C9.19,6.15,9.1,6.82,9.1,7.5c0,4.08,3.32,7.4,7.4,7.4c0.68,0,1.35-0.09,1.99-0.27C17.45,17.19,14.93,19,12,19 c-3.86,0-7-3.14-7-7C5,9.07,6.81,6.55,9.37,5.51z M12,3c-4.97,0-9,4.03-9,9s4.03,9,9,9s9-4.03,9-9c0-0.46-0.04-0.92-0.1-1.36 c-0.98,1.37-2.58,2.26-4.4,2.26c-2.98,0-5.4-2.42-5.4-5.4c0-1.81,0.89-3.42,2.26-4.4C12.92,3.04,12.46,3,12,3L12,3z"></path></svg></button></div><div class="navbarSearchContainer_Bca1"><button type="button" class="DocSearch DocSearch-Button" aria-label="Search (Command+K)"><span class="DocSearch-Button-Container"><svg width="20" height="20" class="DocSearch-Search-Icon" viewBox="0 0 20 20" aria-hidden="true"><path d="M14.386 14.386l4.0877 4.0877-4.0877-4.0877c-2.9418 2.9419-7.7115 2.9419-10.6533 0-2.9419-2.9418-2.9419-7.7115 0-10.6533 2.9418-2.9419 7.7115-2.9419 10.6533 0 2.9419 2.9418 2.9419 7.7115 0 10.6533z" stroke="currentColor" fill="none" fill-rule="evenodd" stroke-linecap="round" stroke-linejoin="round"></path></svg><span class="DocSearch-Button-Placeholder">Search</span></span><span class="DocSearch-Button-Keys"></span></button></div></div></div><div role="presentation" class="navbar-sidebar__backdrop"></div></nav><div id="__docusaurus_skipToContent_fallback" class="main-wrapper mainWrapper_z2l0"><div class="docsWrapper_hBAB"><button aria-label="Scroll back to top" class="clean-btn theme-back-to-top-button backToTopButton_sjWU" type="button"></button><div class="docRoot_UBD9"><aside class="theme-doc-sidebar-container docSidebarContainer_YfHR"><div class="sidebarViewport_aRkj"><div class="sidebar_njMd"><nav aria-label="Docs sidebar" class="menu thin-scrollbar menu_SIkG menuWithAnnouncementBar_GW3s"><ul class="theme-doc-sidebar-menu menu__list"><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/rabbitmq-website/docs/3.13">Introduction</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/rabbitmq-website/docs/3.13/whats-new">What&#x27;s New</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/rabbitmq-website/tutorials">Getting Started</a></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist" href="/rabbitmq-website/docs/3.13/download">Install and Upgrade</a><button aria-label="Expand sidebar category &#x27;Install and Upgrade&#x27;" aria-expanded="false" type="button" class="clean-btn menu__caret"></button></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist" href="/rabbitmq-website/docs/3.13/use-rabbitmq">How to Use RabbitMQ</a><button aria-label="Expand sidebar category &#x27;How to Use RabbitMQ&#x27;" aria-expanded="false" type="button" class="clean-btn menu__caret"></button></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist" href="/rabbitmq-website/docs/3.13/manage-rabbitmq">How to Manage RabbitMQ</a><button aria-label="Expand sidebar category &#x27;How to Manage RabbitMQ&#x27;" aria-expanded="false" type="button" class="clean-btn menu__caret"></button></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--active" href="/rabbitmq-website/docs/3.13/monitoring">How to Monitor RabbitMQ</a><button aria-label="Collapse sidebar category &#x27;How to Monitor RabbitMQ&#x27;" aria-expanded="true" type="button" class="clean-btn menu__caret"></button></div><ul style="display:block;overflow:visible;height:auto" class="menu__list"><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link menu__link--active" aria-current="page" tabindex="0" href="/rabbitmq-website/docs/3.13/prometheus">Prometheus and Grafana</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/rabbitmq-website/docs/3.13/event-exchange">Event Exchange Plugin</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/rabbitmq-website/docs/3.13/firehose">Firehose Tracing</a></li></ul></li></ul></nav></div></div></aside><main class="docMainContainer_TBSr"><div class="container padding-top--md padding-bottom--lg"><div class="row"><div class="col docItemCol_VOVn"><div class="theme-doc-version-banner alert alert--warning margin-bottom--md" role="alert"><div>This is documentation for <!-- -->RabbitMQ<!-- --> <b>3.13</b>, which is no longer actively maintained.</div><div class="margin-top--md">For up-to-date documentation, see the <b><a href="/rabbitmq-website/docs/prometheus">latest version</a></b> (<!-- -->4.1<!-- -->).</div></div><div class="docItemContainer_Djhp"><article><nav class="theme-doc-breadcrumbs breadcrumbsContainer_Z_bl" aria-label="Breadcrumbs"><ul class="breadcrumbs" itemscope="" itemtype="https://schema.org/BreadcrumbList"><li class="breadcrumbs__item"><a aria-label="Home page" class="breadcrumbs__link" href="/rabbitmq-website/"><svg viewBox="0 0 24 24" class="breadcrumbHomeIcon_YNFT"><path d="M10 19v-5h4v5c0 .55.45 1 1 1h3c.55 0 1-.45 1-1v-7h1.7c.46 0 .68-.57.33-.87L12.67 3.6c-.38-.34-.96-.34-1.34 0l-8.36 7.53c-.34.3-.13.87.33.87H5v7c0 .55.45 1 1 1h3c.55 0 1-.45 1-1z" fill="currentColor"></path></svg></a></li><li itemscope="" itemprop="itemListElement" itemtype="https://schema.org/ListItem" class="breadcrumbs__item"><a class="breadcrumbs__link" itemprop="item" href="/rabbitmq-website/docs/3.13/monitoring"><span itemprop="name">How to Monitor RabbitMQ</span></a><meta itemprop="position" content="1"></li><li itemscope="" itemprop="itemListElement" itemtype="https://schema.org/ListItem" class="breadcrumbs__item breadcrumbs__item--active"><span class="breadcrumbs__link" itemprop="name">Prometheus and Grafana</span><meta itemprop="position" content="2"></li></ul></nav><span class="theme-doc-version-badge badge badge--secondary">Version: 3.13</span><div class="tocCollapsible_ETCw theme-doc-toc-mobile tocMobile_ITEo"><button type="button" class="clean-btn tocCollapsibleButton_TO0P">On this page</button></div><div class="theme-doc-markdown markdown"><header><h1>Monitoring with Prometheus and Grafana</h1></header>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="overview">Overview<a href="#overview" class="hash-link" aria-label="Direct link to Overview" title="Direct link to Overview">​</a></h2>
<p>This guide covers RabbitMQ monitoring with two popular tools:
<a href="https://prometheus.io/docs/introduction/overview/" target="_blank" rel="noopener noreferrer">Prometheus</a>, a monitoring toolkit;
and <a href="https://grafana.com/grafana" target="_blank" rel="noopener noreferrer">Grafana</a>, a metrics visualisation system.</p>
<p>These tools together form a powerful toolkit for long-term metric collection and monitoring of RabbitMQ clusters.
While <a href="/rabbitmq-website/docs/3.13/management">RabbitMQ management UI</a> also provides access to a subset of metrics, it by
design doesn&#x27;t try to be a long term metric collection solution.</p>
<p>Please read through the main <a href="/rabbitmq-website/docs/3.13/monitoring">guide on monitoring</a> first. Monitoring principles and
available metrics are mostly relevant when Prometheus and Grafana are used.</p>
<p>Some key topics covered by this guide are</p>
<ul>
<li><a href="#overview-prometheus">Prometheus support basics</a></li>
<li><a href="#overview-grafana">Grafana support basics</a></li>
<li><a href="#quick-start">Quick Start</a> for local experimentation</li>
<li><a href="#installation">Installation steps</a> for production systems</li>
<li>Two types of scraping endpoint responses: <a href="#metric-aggregation">Aggregated vs. Individual Entity Metrics</a></li>
</ul>
<p>Grafana dashboards follow a number of conventions to make the system more observable
and anti-patterns easier to spot. Its design decisions are explained in a number of sections:</p>
<ul>
<li><a href="#rabbitmq-overview-dashboard">RabbitMQ Overview Dashboard</a></li>
<li><a href="#health-indicators">Health indicators</a> on the Overview dashboard</li>
<li><a href="#graph-colour-labelling">Graph colour labelling</a> conventions</li>
<li><a href="#graph-thresholds">Graph thresholds</a></li>
<li><a href="#graph-documentation">Relevant documentation</a> for each graph (metric)</li>
<li><a href="#spot-anti-patterns">Spotting Anti-patterns</a></li>
<li><a href="#other-dashboards">Other available dashboards</a></li>
<li><a href="#tls">TLS support</a> for Prometheus scraping endpoint</li>
</ul>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="overview-prometheus">Built-in Prometheus Support<a href="#overview-prometheus" class="hash-link" aria-label="Direct link to Built-in Prometheus Support" title="Direct link to Built-in Prometheus Support">​</a></h3>
<p>RabbitMQ ships with built-in Prometheus &amp; Grafana support.</p>
<p>Support for Prometheus metric collector ships in the <code>rabbitmq_prometheus</code> plugin.
The plugin exposes all RabbitMQ metrics on a dedicated TCP port, in Prometheus text format.</p>
<p>These metrics provide deep insights into the state of RabbitMQ nodes and <a href="/rabbitmq-website/docs/3.13/runtime">the runtime</a>.
They make reasoning about the behaviour of RabbitMQ, applications that use it and various infrastructure
elements a lot more informed.</p>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="overview-grafana">Grafana Support<a href="#overview-grafana" class="hash-link" aria-label="Direct link to Grafana Support" title="Direct link to Grafana Support">​</a></h3>
<p>Collected metrics are not very useful unless they are visualised. Team RabbitMQ provides a <a href="https://grafana.com/orgs/rabbitmq" target="_blank" rel="noopener noreferrer">prebuilt set of Grafana dashboards</a>
that visualise a large number of available RabbitMQ and <a href="/rabbitmq-website/docs/3.13/runtime">runtime</a> metrics in context-specific ways.</p>
<p>There is a number of dashboards available:</p>
<ul>
<li>an overview dashboard</li>
<li>runtime <a href="/rabbitmq-website/docs/3.13/runtime#allocators">memory allocators</a> dashboard</li>
<li>an <a href="/rabbitmq-website/docs/3.13/clustering#cluster-membership">inter-node communication</a>
(Erlang distribution) dashboard</li>
<li>a Raft metric dashboard</li>
</ul>
<p>and others. Each is meant to provide an insight into a specific
part of the system. When used together, they are able to explain RabbitMQ and application behaviour in detail.</p>
<p>Note that the Grafana dashboards are opinionated and use a number of conventions, for example, to
<a href="#health-indicators">spot system health issues quicker</a> or make <a href="#graph-colour-labelling">cross-graph referencing</a> possible.
Like all Grafana dashboards, they are also highly customizable. The conventions they assume are considered to be
good practices and are thus recommended.</p>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="overview-example">An Example<a href="#overview-example" class="hash-link" aria-label="Direct link to An Example" title="Direct link to An Example">​</a></h3>
<p>When RabbitMQ is integrated with Prometheus and Grafana, this is what the
RabbitMQ Overview dashboard looks like:</p>
<p><img decoding="async" loading="lazy" alt="RabbitMQ Overview Dashboard" src="/rabbitmq-website/assets/images/rabbitmq-overview-dashboard-a8d225500f0a2331742b3be17b8f1027.png" width="1280" height="712" class="img_ev3q"></p>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="quick-start">Quick Start<a href="#quick-start" class="hash-link" aria-label="Direct link to Quick Start" title="Direct link to Quick Start">​</a></h2>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="before-we-start">Before We Start<a href="#before-we-start" class="hash-link" aria-label="Direct link to Before We Start" title="Direct link to Before We Start">​</a></h3>
<p>This section explains how to set up a RabbitMQ cluster with Prometheus and Grafana dashboards, as well
as some applications that will produce some activity and meaningful metrics.</p>
<p>With this setup you will be able to interact with RabbitMQ, Prometheus
&amp; Grafana running locally. You will also be able to try out different
load profiles to see how it all fits together, make sense of the dashboards,
panels and so on.</p>
<p>This is merely an example; the <code>rabbitmq_prometheus</code> plugin and our Grafana dashboards do not require
the use of Docker Compose demonstrated below.</p>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="prerequisites">Prerequisites<a href="#prerequisites" class="hash-link" aria-label="Direct link to Prerequisites" title="Direct link to Prerequisites">​</a></h3>
<p>The instructions below assume a host machine that has a certain set of tools
installed:</p>
<ul>
<li>A terminal to run the commands</li>
<li><a href="https://git-scm.com/" target="_blank" rel="noopener noreferrer">Git</a> to clone the repository</li>
<li><a href="https://www.docker.com/products/docker-desktop" target="_blank" rel="noopener noreferrer">Docker Desktop</a> to use Docker Compose locally</li>
<li>A Web browser to browse the dashboards</li>
</ul>
<p>Their installation is out of scope of this guide. Use</p>
<div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token function" style="color:#d73a49">git</span><span class="token plain"> version</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token function" style="color:#d73a49">docker</span><span class="token plain"> info </span><span class="token operator" style="color:#393A34">&amp;&amp;</span><span class="token plain"> </span><span class="token function" style="color:#d73a49">docker-compose</span><span class="token plain"> version</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>on the command line to verify that the necessary tools are available.</p>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="clone-a-repository-with-manifests">Clone a Repository with Manifests<a href="#clone-a-repository-with-manifests" class="hash-link" aria-label="Direct link to Clone a Repository with Manifests" title="Direct link to Clone a Repository with Manifests">​</a></h3>
<p>First step is to clone a Git repository, <a href="https://github.com/rabbitmq/rabbitmq-server" target="_blank" rel="noopener noreferrer">rabbitmq-server</a>, with the manifests and other components required to run
a RabbitMQ cluster, Prometheus and a set of applications:</p>
<div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token function" style="color:#d73a49">git</span><span class="token plain"> clone https://github.com/rabbitmq/rabbitmq-server.git</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token builtin class-name">cd</span><span class="token plain"> rabbitmq-server/deps/rabbitmq_prometheus/docker</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="run-docker-compose">Run Docker Compose<a href="#run-docker-compose" class="hash-link" aria-label="Direct link to Run Docker Compose" title="Direct link to Run Docker Compose">​</a></h3>
<p>Next use Docker Compose manifests to run a pre-configured RabbitMQ cluster, a Prometheus instance and a basic
workload that will produce the metrics displayed in the RabbitMQ overview dashboard:</p>
<div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token function" style="color:#d73a49">docker-compose</span><span class="token plain"> </span><span class="token parameter variable" style="color:#36acaa">-f</span><span class="token plain"> docker-compose-metrics.yml up </span><span class="token parameter variable" style="color:#36acaa">-d</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token function" style="color:#d73a49">docker-compose</span><span class="token plain"> </span><span class="token parameter variable" style="color:#36acaa">-f</span><span class="token plain"> docker-compose-overview.yml up </span><span class="token parameter variable" style="color:#36acaa">-d</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>The <code>docker-compose</code> commands above can also be executed with a <code>make</code> target:</p>
<div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token function" style="color:#d73a49">make</span><span class="token plain"> metrics overview</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>When the above commands succeed, there will be a functional RabbitMQ cluster and a Prometheus
instance collecting metrics from it running in a set of containers.</p>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="access-rabbitmq-overview-grafana-dashboard">Access RabbitMQ Overview Grafana Dashboard<a href="#access-rabbitmq-overview-grafana-dashboard" class="hash-link" aria-label="Direct link to Access RabbitMQ Overview Grafana Dashboard" title="Direct link to Access RabbitMQ Overview Grafana Dashboard">​</a></h3>
<p>Now navigate to <a href="http://localhost:3000/dashboards" target="_blank" rel="noopener noreferrer"><a href="http://localhost:3000/dashboards" target="_blank" rel="noopener noreferrer">http://localhost:3000/dashboards</a></a> in a Web browser.
It will bring up a login page. Use <code>admin</code> for both the username and the password. On the very first login
Grafana will suggest changing your password. For the sake of this example, we suggest that this step is skipped.</p>
<p>Navigate to the <strong>RabbitMQ-Overview</strong> dashboard that will look like this:</p>
<p><img decoding="async" loading="lazy" alt="RabbitMQ Overview Dashboard Localhost" src="/rabbitmq-website/assets/images/rabbitmq-overview-dashboard-localhost-4aa683ff06f18af42f393a9302e5c660.png" width="1280" height="709" class="img_ev3q"></p>
<p>Congratulations! You now have a 3-nodes RabbitMQ cluster integrated with
Prometheus &amp; Grafana running locally. This is a perfect time to learn more
about the available dashboards.</p>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="rabbitmq-overview-dashboard">RabbitMQ Overview Dashboard<a href="#rabbitmq-overview-dashboard" class="hash-link" aria-label="Direct link to RabbitMQ Overview Dashboard" title="Direct link to RabbitMQ Overview Dashboard">​</a></h2>
<p>All metrics available in the <a href="/rabbitmq-website/docs/3.13/management">management UI</a> Overview
page are available in the Overview Grafana dashboard. They are grouped by object type,
with a focus on RabbitMQ nodes and message rates.</p>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="health-indicators">Health Indicators<a href="#health-indicators" class="hash-link" aria-label="Direct link to Health Indicators" title="Direct link to Health Indicators">​</a></h3>
<p><a href="https://grafana.com/docs/features/panels/singlestat/" target="_blank" rel="noopener noreferrer">Single stat metrics</a> at the top of the dashboard capture the health of a single
RabbitMQ cluster. In this case, there&#x27;s a single RabbitMQ cluster,
<strong>rabbitmq-overview</strong>, as seen in the <strong>Cluster</strong> drop-down menu just below the
dashboard title.</p>
<p>The panels on all RabbitMQ Grafana dashboards use different colours to capture the following
metric states:</p>
<ul>
<li><strong>Green</strong> means the value of the metric is within a healthy range</li>
<li><strong>Blue</strong> means under-utilisation or some form of degradation</li>
<li><strong>Red</strong> means the value of the metric is below or above the range that is considered healthy</li>
</ul>
<p><img decoding="async" loading="lazy" alt="RabbitMQ Overview Dashboard Single-stat" src="/rabbitmq-website/assets/images/rabbitmq-overview-dashboard-single-stat-5cc70eca35c4e241d5f8bf47fcf3949e.png" width="1730" height="252" class="img_ev3q"></p>
<p>Default ranges for the <a href="https://grafana.com/docs/features/panels/singlestat/" target="_blank" rel="noopener noreferrer">single stat metrics</a> <strong>will not be optimal for all</strong>
RabbitMQ deployments. For example, in environments with many consumers and/or
high prefetch values, it may be perfectly fine to have over 1,000
unacknowledged messages. The default thresholds can be easily adjusted to suit
the workload and system at hand. The users are encouraged to revisit these ranges and tweak
them as they see fit for their workloads, monitoring and operational practices, and tolerance
for false positives.</p>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="graphs">Metrics and Graphs<a href="#graphs" class="hash-link" aria-label="Direct link to Metrics and Graphs" title="Direct link to Metrics and Graphs">​</a></h3>
<p>Most RabbitMQ and runtime metrics are represented as graphs in Grafana: they are values that change over time.
This is the simplest and clearest way of visualising how some aspect of the system changes.
Time-based charting makes it easy to understand the change in key metrics: message rates, memory used by every node in
the cluster, or the number of concurrent connections. All metrics except for health
indicators are <strong>node-specific</strong>, that is, they represent values of a metric on a single node.</p>
<p>Some metrics, such as the panels grouped under <strong>CONNECTIONS</strong>, are stacked to
capture the state of the <strong>cluster as a whole</strong>. These metrics are
collected on individual nodes and grouped visually, which makes it easy to notice when,
for example, one node serves a disproportionate number of connections.</p>
<p>We would refer to such a RabbitMQ cluster as <strong>unbalanced</strong>, meaning that at least in some ways,
a minority of nodes perform the majority of work.</p>
<p>In the example below, connections are spread out evenly across all nodes most of the time:</p>
<p><img decoding="async" loading="lazy" alt="RabbitMQ Overview Dashboard CONNECTIONS" src="/rabbitmq-website/assets/images/rabbitmq-overview-dashboard-connections-53fa5677fef29f500115f6a6e70379a5.png" width="1872" height="474" class="img_ev3q"></p>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="graph-colour-labelling">Colour Labelling in Graphs<a href="#graph-colour-labelling" class="hash-link" aria-label="Direct link to Colour Labelling in Graphs" title="Direct link to Colour Labelling in Graphs">​</a></h3>
<p>All metrics on all graphs are associated with specific node names. For example,
all metrics drawn in green are for the node that contains <code>0</code> in its name, e.g.
<code>rabbit@rmq0</code>. This makes it easy to correlate metrics of a specific node across graphs.
Metrics for the first node, which is assumed to contain <code>0</code> in
its name, will always appear as green across all graphs.</p>
<p>It is important to remember this aspect when using the RabbitMQ Overview dashboard.
<strong>If a different node naming convention is used, the colours will appear inconsistent across graphs</strong>:
green may represent e.g. <code>rabbit@foo</code> in one graph, and e.g. <code>rabbit@bar</code> in another graph.</p>
<p>When this is the case, the panels must be updated to use a different node naming scheme.</p>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="graph-thresholds">Thresholds in Graphs<a href="#graph-thresholds" class="hash-link" aria-label="Direct link to Thresholds in Graphs" title="Direct link to Thresholds in Graphs">​</a></h3>
<p>Most metrics have pre-configured thresholds. They define expected operating boundaries for the metric.
On the graphs they appear as semi-transparent
orange or red areas, as seen in the example below.</p>
<p><img decoding="async" loading="lazy" alt="RabbitMQ Overview Dashboard Single-stat" src="/rabbitmq-website/assets/images/rabbitmq-overview-dashboard-memory-threshold-2cdaed085151fba857d56b665de950b0.png" width="2298" height="642" class="img_ev3q"></p>
<p>Metric values in the <strong>orange</strong> area signal that some pre-defined threshold has been
exceeded. This may be acceptable, especially if the metric recovers. A metric that
comes close to the orange area is considered to be in healthy state.</p>
<p>Metric values in the <strong>red</strong> area need attention and may identify some form of service degradation.
For example, metrics in the red area can indicate that an <a href="/rabbitmq-website/docs/3.13/alarms">alarm</a> in effect
or when the node is <a href="/rabbitmq-website/docs/3.13/networking">out of file descriptors</a> and cannot accept any more connections or open new files.</p>
<p>In the example above, we have a RabbitMQ cluster that runs at optimal memory
capacity, which is just above the warning threshold. If there is a spike in published messages that should
be stored in RAM, the amount of memory used by the node go up and the metric on the graph will
go down (as it indicates the amount of <strong>available</strong> memory).</p>
<p>Because the system has more memory available than is allocated to the RabbitMQ node it hosts, we
notice the dip below <strong>0 B</strong>. This emphasizes the importance of leaving spare
memory available for the OS, housekeeping tasks that cause short-lived memory usage spikes,
and other processes. When a RabbitMQ node exhausts all memory that it is allowed to use, a <a href="/rabbitmq-website/docs/3.13/alarms">memory alarm</a> is
triggered and publishers across the entire cluster will be blocked.</p>
<p>On the right side of the graph we can see that consumers catch up and the amount of memory used goes down.
That clears the memory alarm on the node and, as a result, publishers become unblocked. This and related metrics
across cluster then should return to their optimal state.</p>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="graph-thresholds-are-system-specific">There is No &quot;Right&quot; Threshold for Many Metrics<a href="#graph-thresholds-are-system-specific" class="hash-link" aria-label="Direct link to There is No &quot;Right&quot; Threshold for Many Metrics" title="Direct link to There is No &quot;Right&quot; Threshold for Many Metrics">​</a></h3>
<p>Note that the thresholds used by the Grafana dashboards have to have a default value. No matter
what value is picked by dashboard developers, they <strong>will not be suitable for all environments and workloads</strong>.</p>
<p>Some workloads may require higher thresholds, others may choose to lower them. While the defaults should be
adequate in many cases, the <strong>operator must review and adjust the thresholds</strong> to suit their specific
requirements.</p>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="graph-documentation">Relevant Documentation for Graphs<a href="#graph-documentation" class="hash-link" aria-label="Direct link to Relevant Documentation for Graphs" title="Direct link to Relevant Documentation for Graphs">​</a></h3>
<p>Most metrics have a help icon in the top-left corner of the panel.</p>
<p><img decoding="async" loading="lazy" alt="RabbitMQ Overview Dashboard Single-stat" src="/rabbitmq-website/assets/images/rabbitmq-overview-dashboard-disk-documentation-7e1bad8883b9b0b8515c6da4fb78260f.png" width="1390" height="560" class="img_ev3q"></p>
<p>Some, like the available disk space metric, link to dedicated pages in <a href="/rabbitmq-website/docs/3.13/prometheus">RabbitMQ documentation</a>.
These pages contain information relevant to the metric. Getting familiar with the linked guides
is highly recommended and will help the operator understand what the metric means better.</p>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="spot-anti-patterns">Using Graphs to Spot Anti-patterns<a href="#spot-anti-patterns" class="hash-link" aria-label="Direct link to Using Graphs to Spot Anti-patterns" title="Direct link to Using Graphs to Spot Anti-patterns">​</a></h3>
<p>Any metric drawn in red hints at an anti-pattern in the system. Such graphs try to highlight sub-optimal
uses of RabbitMQ. A <strong>red graphs with non-zero metrics should be investigated</strong>. Such metrics might indicate
an issue in RabbitMQ configuration or sub-optimal actions by clients (<a href="/rabbitmq-website/docs/3.13/publishers">publishers</a> or <a href="/rabbitmq-website/docs/3.13/consumers">consumers</a>).</p>
<p>In the example below we can see the usage of greatly inefficient <a href="/rabbitmq-website/docs/3.13/consumers#polling">polling consumers</a> that keep polling, even though
most or even all polling operation return no messages. Like any polling-based algorithm, it is wasteful
and should be avoided where possible.</p>
<p>It is a lot more and efficient to have RabbitMQ <a href="/rabbitmq-website/docs/3.13/consumers">push messages to the consumer</a>.</p>
<p><img decoding="async" loading="lazy" alt="RabbitMQ Overview Dashboard Antipatterns" src="/rabbitmq-website/assets/images/rabbitmq-overview-dashboard-antipattern-adfbd0bee0be0676b0eb349851c40cc6.png" width="1396" height="402" class="img_ev3q"></p>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="example-workloads">Example Workloads<a href="#example-workloads" class="hash-link" aria-label="Direct link to Example Workloads" title="Direct link to Example Workloads">​</a></h3>
<p>The <a href="https://github.com/rabbitmq/rabbitmq-server/tree/main/deps/rabbitmq_prometheus/docker" target="_blank" rel="noopener noreferrer">Prometheus plugin repository</a> contains example workloads that use <a href="https://rabbitmq.github.io/rabbitmq-perf-test/stable/htmlsingle/" target="_blank" rel="noopener noreferrer">PerfTest</a>
to simulate different workloads.
Their goal is to exercise all metrics in the RabbitMQ Overview dashboard. These examples are meant to be
edited and extended as developers and operators see fit when exploring various metrics, their thresholds and behaviour.</p>
<p>To deploy a workload app, run <code>docker-compose -f docker-compose-overview.yml up -d</code>.
The same command will redeploy the app after the file has been updated.</p>
<p>To delete all workload containers, run <code>docker-compose -f docker-compose-overview.yml down</code> or</p>
<div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">gmake down</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="other-dashboards">More Dashboards: Raft and Erlang Runtime<a href="#other-dashboards" class="hash-link" aria-label="Direct link to More Dashboards: Raft and Erlang Runtime" title="Direct link to More Dashboards: Raft and Erlang Runtime">​</a></h2>
<p>There are two more Grafana dashboards available: <strong>RabbitMQ-Raft</strong> and <strong>Erlang-Distribution</strong>. They collect and
visualise metrics related to the Raft consensus algorithm (used by <a href="/rabbitmq-website/docs/3.13/quorum-queues">Quorum Queues</a> and other features) as well
as more nitty-gritty <a href="/rabbitmq-website/docs/3.13/runtime">runtime metrics</a> such as inter-node communication buffers.</p>
<p>The dashboards have corresponding RabbitMQ clusters and PerfTest instances which are started and stopped the same
as the Overview one. Feel free to experiment with the other workloads
that are included in <a href="https://github.com/rabbitmq/rabbitmq-server/tree/main/deps/rabbitmq_prometheus/docker" target="_blank" rel="noopener noreferrer">the same <code>docker</code> directory</a>.</p>
<p>For example, the <code>docker-compose-dist-tls.yml</code> Compose manifest is meant to stress
the <a href="/rabbitmq-website/docs/3.13/clustering">inter-node communication links</a>. This workload uses a lot of system resources.
<code>docker-compose-qq.yml</code> contains a quorum queue workload.</p>
<p>To stop and delete all containers used by the workloads, run <code>docker-compose -f [file] down</code> or</p>
<div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token function" style="color:#d73a49">make</span><span class="token plain"> down</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="installation">Installation<a href="#installation" class="hash-link" aria-label="Direct link to Installation" title="Direct link to Installation">​</a></h2>
<p>Unlike the <a href="#quick-start">Quick Start</a> above, this section covers monitoring setup geared towards production usage.</p>
<p>We will assume that the following tools are provisioned and running:</p>
<ul>
<li>A <a href="/rabbitmq-website/docs/3.13/cluster-formation">3-node RabbitMQ 3.11 cluster</a></li>
<li>Prometheus, including network connectivity with all RabbitMQ cluster nodes</li>
<li>Grafana, including configuration that lists the above Prometheus instance as one of the data sources</li>
</ul>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="rabbitmq-configuration">RabbitMQ Configuration<a href="#rabbitmq-configuration" class="hash-link" aria-label="Direct link to RabbitMQ Configuration" title="Direct link to RabbitMQ Configuration">​</a></h3>
<h4 class="anchor anchorWithStickyNavbar_LWe7" id="cluster-name">Cluster Name<a href="#cluster-name" class="hash-link" aria-label="Direct link to Cluster Name" title="Direct link to Cluster Name">​</a></h4>
<p>First step is to give the RabbitMQ cluster a descriptive name so that it can be distinguished from other
clusters.</p>
<p>To find the current name of the cluster, use</p>
<div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">rabbitmq-diagnostics </span><span class="token parameter variable" style="color:#36acaa">-q</span><span class="token plain"> cluster_status</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>This command can be executed against any cluster node. If the current cluster name is distinctive and appropriate,
skip the rest of this paragraph.
To change the name of the cluster, run the following command (the name used here is just an example):</p>
<div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">rabbitmqctl </span><span class="token parameter variable" style="color:#36acaa">-q</span><span class="token plain"> set_cluster_name testing-prometheus</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="enable-rabbitmq_prometheus">Enable <code>rabbitmq_prometheus</code><a href="#enable-rabbitmq_prometheus" class="hash-link" aria-label="Direct link to enable-rabbitmq_prometheus" title="Direct link to enable-rabbitmq_prometheus">​</a></h3>
<p>Next, enable the <strong>rabbitmq_prometheus</strong> <a href="/rabbitmq-website/docs/3.13/plugins">plugin</a> on all nodes:</p>
<div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">rabbitmq-plugins </span><span class="token builtin class-name">enable</span><span class="token plain"> rabbitmq_prometheus</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>The output will look similar to this:</p>
<div class="language-ini codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-ini codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">rabbitmq-plugins enable rabbitmq_prometheus</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">Enabling plugins on node rabbit@ed9618ea17c9:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">rabbitmq_prometheus</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">The following plugins have been configured:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  rabbitmq_management_agent</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  rabbitmq_prometheus</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  rabbitmq_web_dispatch</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">Applying plugin configuration to rabbit@ed9618ea17c9...</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">The following plugins have been enabled:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  rabbitmq_management_agent</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  rabbitmq_prometheus</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  rabbitmq_web_dispatch</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">started 3 plugins.</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>To confirm that RabbitMQ now exposes metrics in Prometheus format, get the
first couple of lines with <code>curl</code> or similar:</p>
<div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token function" style="color:#d73a49">curl</span><span class="token plain"> </span><span class="token parameter variable" style="color:#36acaa">-s</span><span class="token plain"> localhost:15692/metrics </span><span class="token operator" style="color:#393A34">|</span><span class="token plain"> </span><span class="token function" style="color:#d73a49">head</span><span class="token plain"> </span><span class="token parameter variable" style="color:#36acaa">-n</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">3</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token comment" style="color:#999988;font-style:italic"># TYPE erlang_mnesia_held_locks gauge</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token comment" style="color:#999988;font-style:italic"># HELP erlang_mnesia_held_locks Number of held locks.</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">erlang_mnesia_held_locks</span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain">node</span><span class="token operator" style="color:#393A34">=</span><span class="token string" style="color:#e3116c">&quot;rabbit@65f1a10aaffa&quot;</span><span class="token plain">,cluster</span><span class="token operator" style="color:#393A34">=</span><span class="token string" style="color:#e3116c">&quot;rabbit@65f1a10aaffa&quot;</span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">0</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>Notice that RabbitMQ exposes the metrics on a dedicated TCP port, <code>15692</code> by
default.</p>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="prometheus-configuration">Prometheus Configuration<a href="#prometheus-configuration" class="hash-link" aria-label="Direct link to Prometheus Configuration" title="Direct link to Prometheus Configuration">​</a></h3>
<p>Once RabbitMQ is configured to expose metrics to Prometheus, Prometheus should be made
aware of where it should scrape RabbitMQ metrics from. There are a number of ways of doing this.
Please refer to the official <a href="https://prometheus.io/docs/prometheus/latest/configuration/configuration/" target="_blank" rel="noopener noreferrer">Prometheus configuration documentation</a>.
There&#x27;s also a <a href="https://prometheus.io/docs/introduction/first_steps/" target="_blank" rel="noopener noreferrer">first steps with Prometheus</a> guide
for beginners.</p>
<h4 class="anchor anchorWithStickyNavbar_LWe7" id="metric-collection-and-scraping-intervals">Metric Collection and Scraping Intervals<a href="#metric-collection-and-scraping-intervals" class="hash-link" aria-label="Direct link to Metric Collection and Scraping Intervals" title="Direct link to Metric Collection and Scraping Intervals">​</a></h4>
<p>Prometheus will periodically scrape (read) metrics from the systems it
monitors, every 60 seconds by default. RabbitMQ metrics are updated
periodically, too, every 5 seconds by default. Since <a href="/rabbitmq-website/docs/3.13/management#statistics-interval">this value is
configurable</a>, check the metrics update
interval by running the following command on any of the nodes:</p>
<div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">rabbitmq-diagnostics environment </span><span class="token operator" style="color:#393A34">|</span><span class="token plain"> </span><span class="token function" style="color:#d73a49">grep</span><span class="token plain"> collect_statistics_interval</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token comment" style="color:#999988;font-style:italic"># =&gt; {collect_statistics_interval,5000}</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>The returned value will be <strong>in milliseconds</strong>.</p>
<p>For production systems, we recommend a minimum value of <code>15s</code> for Prometheus
scrape interval and a <code>10000</code> (10s) value for RabbitMQ&#x27;s
<code>collect_statistics_interval</code>.  With these values, Prometheus doesn&#x27;t scrape
RabbitMQ too frequently, and RabbitMQ doesn&#x27;t update metrics unnecessarily. If
you configure a different value for Prometheus scrape interval, remember to set an
appropriate interval when visualising metrics in Grafana with <code>rate()</code> - <a href="https://www.robustperception.io/what-range-should-i-use-with-rate" target="_blank" rel="noopener noreferrer">4x the scrape interval is considered safe</a>.</p>
<p>When using RabbitMQ&#x27;s Management UI default 5 second auto-refresh, keeping
the default <code>collect_statistics_interval</code> setting is optimal. Both intervals are <code>5000</code> ms
(5 seconds) by default for this reason.</p>
<p>To confirm that Prometheus is scraping RabbitMQ metrics from all nodes, ensure
that all RabbitMQ endpoints are <strong>Up</strong> on the Prometheus Targets page, as shown
below:</p>
<p><img decoding="async" loading="lazy" alt="Prometheus RabbitMQ Targets" src="/rabbitmq-website/assets/images/prometheus-targets-db12520edde03c4b41f9ce06728a9748.png" width="2402" height="1076" class="img_ev3q"></p>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="port">Network Interface and Port<a href="#port" class="hash-link" aria-label="Direct link to Network Interface and Port" title="Direct link to Network Interface and Port">​</a></h3>
<p>The port is configured using the <code>prometheus.tcp.port</code> key:</p>
<div class="language-ini codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-ini codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">prometheus.tcp.port = 15692</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>It is possible to configure what interface the Prometheus plugin API endpoint will use, similarly
to <a href="/rabbitmq-website/docs/3.13/networking#interfaces">messaging protocol listeners</a>, using
the <code>prometheus.tcp.ip</code> key:</p>
<div class="language-ini codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-ini codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">prometheus.tcp.ip = 0.0.0.0</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>To check what interface and port is used by a running node, use
<code>rabbitmq-diagnostics</code>:</p>
<div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">rabbitmq-diagnostics </span><span class="token parameter variable" style="color:#36acaa">-s</span><span class="token plain"> listeners</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token comment" style="color:#999988;font-style:italic"># =&gt; Interface: [::], port: 15692, protocol: http/prometheus, purpose: Prometheus exporter API over HTTP</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>or <a href="/rabbitmq-website/docs/3.13/troubleshooting-networking#ports">tools such as <code>lsof</code>, <code>ss</code> or <code>netstat</code></a>.</p>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="metric-aggregation">Aggregated and Per-Object Metrics<a href="#metric-aggregation" class="hash-link" aria-label="Direct link to Aggregated and Per-Object Metrics" title="Direct link to Aggregated and Per-Object Metrics">​</a></h3>
<p>RabbitMQ can return Prometheus metrics in two modes:</p>
<ol>
<li>Aggregated: metrics are aggregated by name. This mode has lower performance overhead with the output size
constant, even as the number of objects (e.g. connections and queues) grows.</li>
<li>Per-object: individual metric for <strong>each object-metric pair</strong>. With a large number of stats-emitting entities,
e.g. a lot of connections and queues, this can result in very large payloads and a lot of CPU resources spent serialising
data to output.</li>
</ol>
<p>Metric aggregation is a more predictable and practical option for larger deployments.
It scales very well with respect to the number of metric-emitting objects in the system
(connections, channels, queues, consumers, etc) by keeping response size and time small.
It is also predictably easy to visualise.</p>
<p>The downside of metric aggregation is that it loses data fidelity. Per-object metrics
and alerting are not possible with aggregation. Individual object metrics, while very useful
in some cases, are also hard to visualise. Consider what a chart with 200K connections
charted on it would look like and whether an operator would be able to make sense of it.</p>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="default-endpoint">Prometheus endpoints: <code>/metrics</code><a href="#default-endpoint" class="hash-link" aria-label="Direct link to default-endpoint" title="Direct link to default-endpoint">​</a></h3>
<p>By default, Prometheus (and other Prometheus-compatible solutions), expects metrics to be available on a path of <code>/metrics</code>.
RabbitMQ returns aggregated metrics on this endpoint by default.</p>
<p>If you prefer to return per-object (unaggregated) metrics on the <code>/metrics</code> endpoint, set <code>prometheus.return_per_object_metrics</code> to <code>true</code>:</p>
<div class="language-ini codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-ini codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain"># can result in a really excessive output produced,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"># only suitable for environments with a relatively small</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"># number of metrics-emitting objects such as connections and queues</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">prometheus.return_per_object_metrics = true</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="per-object-endpoint">Prometheus endpoints: <code>/metrics/per-object</code><a href="#per-object-endpoint" class="hash-link" aria-label="Direct link to per-object-endpoint" title="Direct link to per-object-endpoint">​</a></h3>
<p>RabbitMQ offers a dedicated endpoint</p>
<div class="codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">GET /metrics/per-object</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>which always returns per-object metrics,
regardless of the value of <code>prometheus.return_per_object_metrics</code>.
You can therefore keep the default value of <code>prometheus.return_per_object_metrics</code>,
which is <code>false</code>, and still scrape per-object metrics when necessary, by setting <code>metrics_path = /metrics/per-object</code> in the Prometheus target configuration (check <a href="https://prometheus.io/docs/prometheus/latest/configuration/configuration/#scrape_config" target="_blank" rel="noopener noreferrer">Prometheus Documentation</a> for additional information).</p>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="detailed-endpoint">Prometheus endpoints: <code>/metrics/detailed</code><a href="#detailed-endpoint" class="hash-link" aria-label="Direct link to detailed-endpoint" title="Direct link to detailed-endpoint">​</a></h3>
<p>As mentioned earlier, using per-object metrics in environments with a lot of entitites is very computationally expensive.
For example, <code>/metrics/per-object</code> returns all metrics for all entities in the system, even if many of them are not used
by most clients (such as monitoring tools).</p>
<p>This is why there is a separate endpoint for per-object metrics that allows the caller to query only the metrics they need:</p>
<div class="codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">GET /metrics/detailed</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>By default it does not return any metrics. All required metric groups and virtual host filters must be be provided as query
parameters. For example,</p>
<div class="codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">GET /metrics/detailed?vhost=vhost-1&amp;vhost=vhost-2&amp;family=queue_coarse_metrics&amp;family=queue_consumer_count</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>will only return requested metrics and leave out, for example, all channel metrics that this client is not
interested in.</p>
<p>This endpoint supports the following parameters:</p>
<ul>
<li>Zero or more <code>family</code> values. Only the requested metric families will be returned. The full list is documented below;</li>
<li>Zero or more <code>vhost</code>s: if provided, queue related metrics (<code>queue_coarse_metrics</code>, <code>queue_consumer_count</code> and <code>queue_metrics</code>) will be returned only for the queues in the provided virtual hosts</li>
</ul>
<p>The returned metrics use a different prefix: <code>rabbitmq_detailed_</code> (instead of <code>rabbitmq_</code> used by other  endpoints).
This means the endpoint can be used together with <code>GET /metrics</code> and tools that rely on other endpoints won&#x27;t be affected.</p>
<p>Since it queries and serves less data in almost all cases, this endpoint puts less load on the system.
For example,</p>
<div class="codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">GET /metrics/detailed?family=queue_coarse_metrics&amp;family=queue_consumer_count</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>provides just enough metrics to determine how many messages are enqueued and how many consumers those queues have.
In some environments this query is <strong>up to 60 times more efficient</strong> than querying <code>GET /metrics/per-object</code> to get
only a couple of metrics from the response.</p>
<h4 class="anchor anchorWithStickyNavbar_LWe7" id="generic-metrics">Generic metrics<a href="#generic-metrics" class="hash-link" aria-label="Direct link to Generic metrics" title="Direct link to Generic metrics">​</a></h4>
<p>These are some generic metrics, which do not refer to any specific
queue/connection/etc.</p>
<h5 class="anchor anchorWithStickyNavbar_LWe7" id="connectionchannelqueue-churn">Connection/channel/queue churn<a href="#connectionchannelqueue-churn" class="hash-link" aria-label="Direct link to Connection/channel/queue churn" title="Direct link to Connection/channel/queue churn">​</a></h5>
<p>Grouped under <code>connection_churn_metrics</code>:</p>
<table><thead><tr><th>Metric</th><th>Description</th></tr></thead><tbody><tr><td>rabbitmq_detailed_connections_opened_total</td><td>Total number of connections opened</td></tr><tr><td>rabbitmq_detailed_connections_closed_total</td><td>Total number of connections closed or terminated</td></tr><tr><td>rabbitmq_detailed_channels_opened_total</td><td>Total number of channels opened</td></tr><tr><td>rabbitmq_detailed_channels_closed_total</td><td>Total number of channels closed</td></tr><tr><td>rabbitmq_detailed_queues_declared_total</td><td>Total number of queues declared</td></tr><tr><td>rabbitmq_detailed_queues_created_total</td><td>Total number of queues created</td></tr><tr><td>rabbitmq_detailed_queues_deleted_total</td><td>Total number of queues deleted</td></tr></tbody></table>
<h5 class="anchor anchorWithStickyNavbar_LWe7" id="erlang-vmdisk-io-via-rabbitmq">Erlang VM/Disk IO via RabbitMQ<a href="#erlang-vmdisk-io-via-rabbitmq" class="hash-link" aria-label="Direct link to Erlang VM/Disk IO via RabbitMQ" title="Direct link to Erlang VM/Disk IO via RabbitMQ">​</a></h5>
<p>Grouped under <code>node_coarse_metrics</code>:</p>
<table><thead><tr><th>Metric</th><th>Description</th></tr></thead><tbody><tr><td>rabbitmq_detailed_process_open_fds</td><td>Open file descriptors</td></tr><tr><td>rabbitmq_detailed_process_open_tcp_sockets</td><td>Open TCP sockets</td></tr><tr><td>rabbitmq_detailed_process_resident_memory_bytes</td><td>Memory used in bytes</td></tr><tr><td>rabbitmq_detailed_disk_space_available_bytes</td><td>Disk space available in bytes</td></tr><tr><td>rabbitmq_detailed_erlang_processes_used</td><td>Erlang processes used</td></tr><tr><td>rabbitmq_detailed_erlang_gc_runs_total</td><td>Total number of Erlang garbage collector runs</td></tr><tr><td>rabbitmq_detailed_erlang_gc_reclaimed_bytes_total</td><td>Total number of bytes of memory reclaimed by Erlang garbage collector</td></tr><tr><td>rabbitmq_detailed_erlang_scheduler_context_switches_total</td><td>Total number of Erlang scheduler context switches</td></tr></tbody></table>
<p>Grouped under <code>node_metrics</code>:</p>
<table><thead><tr><th>Metric</th><th>Description</th></tr></thead><tbody><tr><td>rabbitmq_detailed_process_max_fds</td><td>Open file descriptors limit</td></tr><tr><td>rabbitmq_detailed_process_max_tcp_sockets</td><td>Open TCP sockets limit</td></tr><tr><td>rabbitmq_detailed_resident_memory_limit_bytes</td><td>Memory high watermark in bytes</td></tr><tr><td>rabbitmq_detailed_disk_space_available_limit_bytes</td><td>Free disk space low watermark in bytes</td></tr><tr><td>rabbitmq_detailed_erlang_processes_limit</td><td>Erlang processes limit</td></tr><tr><td>rabbitmq_detailed_erlang_scheduler_run_queue</td><td>Erlang scheduler run queue</td></tr><tr><td>rabbitmq_detailed_erlang_net_ticktime_seconds</td><td>Inter-node heartbeat interval</td></tr><tr><td>rabbitmq_detailed_erlang_uptime_seconds</td><td>Node uptime</td></tr></tbody></table>
<p>Grouped under <code>node_persister_metrics</code>:</p>
<table><thead><tr><th>Metric</th><th>Description</th></tr></thead><tbody><tr><td>rabbitmq_detailed_io_read_ops_total</td><td>Total number of I/O read operations</td></tr><tr><td>rabbitmq_detailed_io_read_bytes_total</td><td>Total number of I/O bytes read</td></tr><tr><td>rabbitmq_detailed_io_write_ops_total</td><td>Total number of I/O write operations</td></tr><tr><td>rabbitmq_detailed_io_write_bytes_total</td><td>Total number of I/O bytes written</td></tr><tr><td>rabbitmq_detailed_io_sync_ops_total</td><td>Total number of I/O sync operations</td></tr><tr><td>rabbitmq_detailed_io_seek_ops_total</td><td>Total number of I/O seek operations</td></tr><tr><td>rabbitmq_detailed_io_reopen_ops_total</td><td>Total number of times files have been reopened</td></tr><tr><td>rabbitmq_detailed_schema_db_ram_tx_total</td><td>Total number of Schema DB memory transactions</td></tr><tr><td>rabbitmq_detailed_schema_db_disk_tx_total</td><td>Total number of Schema DB disk transactions</td></tr><tr><td>rabbitmq_detailed_msg_store_read_total</td><td>Total number of Message Store read operations</td></tr><tr><td>rabbitmq_detailed_msg_store_write_total</td><td>Total number of Message Store write operations</td></tr><tr><td>rabbitmq_detailed_queue_index_read_ops_total</td><td>Total number of Queue Index read operations</td></tr><tr><td>rabbitmq_detailed_queue_index_write_ops_total</td><td>Total number of Queue Index write operations</td></tr><tr><td>rabbitmq_detailed_io_read_time_seconds_total</td><td>Total I/O read time</td></tr><tr><td>rabbitmq_detailed_io_write_time_seconds_total</td><td>Total I/O write time</td></tr><tr><td>rabbitmq_detailed_io_sync_time_seconds_total</td><td>Total I/O sync time</td></tr><tr><td>rabbitmq_detailed_io_seek_time_seconds_total</td><td>Total I/O seek time</td></tr></tbody></table>
<h5 class="anchor anchorWithStickyNavbar_LWe7" id="raft-related-quorum-queues-streams-metrics">Raft-related (Quorum queues, streams) metrics<a href="#raft-related-quorum-queues-streams-metrics" class="hash-link" aria-label="Direct link to Raft-related (Quorum queues, streams) metrics" title="Direct link to Raft-related (Quorum queues, streams) metrics">​</a></h5>
<p>Grouped under <code>ra_metrics</code>:</p>
<table><thead><tr><th>Metric</th><th>Description</th></tr></thead><tbody><tr><td>rabbitmq_detailed_raft_term_total</td><td>Current Raft term number</td></tr><tr><td>rabbitmq_detailed_raft_log_snapshot_index</td><td>Raft log snapshot index</td></tr><tr><td>rabbitmq_detailed_raft_log_last_applied_index</td><td>Raft log last applied index</td></tr><tr><td>rabbitmq_detailed_raft_log_commit_index</td><td>Raft log commit index</td></tr><tr><td>rabbitmq_detailed_raft_log_last_written_index</td><td>Raft log last written index</td></tr><tr><td>rabbitmq_detailed_raft_entry_commit_latency_seconds</td><td>Time taken for a log entry to be committed</td></tr></tbody></table>
<h5 class="anchor anchorWithStickyNavbar_LWe7" id="auth-metrics">Auth metrics<a href="#auth-metrics" class="hash-link" aria-label="Direct link to Auth metrics" title="Direct link to Auth metrics">​</a></h5>
<p>Grouped under <code>auth_attempt_metrics</code>:</p>
<table><thead><tr><th>Metric</th><th>Description</th></tr></thead><tbody><tr><td>rabbitmq_detailed_auth_attempts_total</td><td>Total number of authorization attempts</td></tr><tr><td>rabbitmq_detailed_auth_attempts_succeeded_total</td><td>Total number of successful authentication attempts</td></tr><tr><td>rabbitmq_detailed_auth_attempts_failed_total</td><td>Total number of failed authentication attempts</td></tr></tbody></table>
<p>Grouped under <code>auth_attempt_detailed_metrics</code>. When aggregated, these add up to the same numbers as <code>auth_attempt_metrics</code>.</p>
<table><thead><tr><th>Metric</th><th>Description</th></tr></thead><tbody><tr><td>rabbitmq_detailed_auth_attempts_detailed_total</td><td>Total number of authorization attempts with source info</td></tr><tr><td>rabbitmq_detailed_auth_attempts_detailed_succeeded_total</td><td>Total number of successful authorization attempts with source info</td></tr><tr><td>rabbitmq_detailed_auth_attempts_detailed_failed_total</td><td>Total number of failed authorization attempts with source info</td></tr></tbody></table>
<h4 class="anchor anchorWithStickyNavbar_LWe7" id="queue-metrics">Queue metrics<a href="#queue-metrics" class="hash-link" aria-label="Direct link to Queue metrics" title="Direct link to Queue metrics">​</a></h4>
<p>Each metric in this group points to a single queue via its label.
So the size of the response here is directly proportional to the number of queues hosted
on the node.</p>
<p>The metrics below are listed from the least expensive to collect to the most expensive.</p>
<h5 class="anchor anchorWithStickyNavbar_LWe7" id="queue-coarse-metrics">Queue coarse metrics<a href="#queue-coarse-metrics" class="hash-link" aria-label="Direct link to Queue coarse metrics" title="Direct link to Queue coarse metrics">​</a></h5>
<p>Grouped under <code>queue_coarse_metrics</code>:</p>
<table><thead><tr><th>Metric</th><th>Description</th></tr></thead><tbody><tr><td>rabbitmq_detailed_queue_messages_ready</td><td>Messages ready to be delivered to consumers</td></tr><tr><td>rabbitmq_detailed_queue_messages_unacked</td><td>Messages delivered to consumers but not yet acknowledged</td></tr><tr><td>rabbitmq_detailed_queue_messages</td><td>Sum of ready and unacknowledged messages - total queue depth</td></tr><tr><td>rabbitmq_detailed_queue_process_reductions_total</td><td>Total number of queue process reductions</td></tr></tbody></table>
<h5 class="anchor anchorWithStickyNavbar_LWe7" id="per-queue-consumer-count">Per-queue consumer count<a href="#per-queue-consumer-count" class="hash-link" aria-label="Direct link to Per-queue consumer count" title="Direct link to Per-queue consumer count">​</a></h5>
<p>Grouped under <code>queue_consumer_count</code>. This is a subset of <code>queue_metrics</code> which is skipped if <code>queue_metrics</code> are requested:</p>
<table><thead><tr><th>Metric</th><th>Description</th></tr></thead><tbody><tr><td>rabbitmq_detailed_queue_consumers</td><td>Consumers on a queue</td></tr></tbody></table>
<p>This metric is useful for quickly detecting issues with consumers (e.g. when there are no consumers online).
This is why it is exposed separately.</p>
<h5 class="anchor anchorWithStickyNavbar_LWe7" id="detailed-queue-metrics">Detailed queue metrics<a href="#detailed-queue-metrics" class="hash-link" aria-label="Direct link to Detailed queue metrics" title="Direct link to Detailed queue metrics">​</a></h5>
<p>Grouped under <code>queue_metrics</code>. This group contains all the metrics for every queue, and can be relatively expensive to produce:</p>
<table><thead><tr><th>Metric</th><th>Description</th></tr></thead><tbody><tr><td>rabbitmq_detailed_queue_consumers</td><td>Consumers on a queue</td></tr><tr><td>rabbitmq_detailed_queue_consumer_capacity</td><td>Consumer capacity</td></tr><tr><td>rabbitmq_detailed_queue_consumer_utilisation</td><td>Same as consumer capacity</td></tr><tr><td>rabbitmq_detailed_queue_process_memory_bytes</td><td>Memory in bytes used by the Erlang queue process</td></tr><tr><td>rabbitmq_detailed_queue_messages_ram</td><td>Ready and unacknowledged messages stored in memory</td></tr><tr><td>rabbitmq_detailed_queue_messages_ram_bytes</td><td>Size of ready and unacknowledged messages stored in memory</td></tr><tr><td>rabbitmq_detailed_queue_messages_ready_ram</td><td>Ready messages stored in memory</td></tr><tr><td>rabbitmq_detailed_queue_messages_unacked_ram</td><td>Unacknowledged messages stored in memory</td></tr><tr><td>rabbitmq_detailed_queue_messages_persistent</td><td>Persistent messages</td></tr><tr><td>rabbitmq_detailed_queue_messages_persistent_bytes</td><td>Size in bytes of persistent messages</td></tr><tr><td>rabbitmq_detailed_queue_messages_bytes</td><td>Size in bytes of ready and unacknowledged messages</td></tr><tr><td>rabbitmq_detailed_queue_messages_ready_bytes</td><td>Size in bytes of ready messages</td></tr><tr><td>rabbitmq_detailed_queue_messages_unacked_bytes</td><td>Size in bytes of all unacknowledged messages</td></tr><tr><td>rabbitmq_detailed_queue_messages_paged_out</td><td>Messages paged out to disk</td></tr><tr><td>rabbitmq_detailed_queue_messages_paged_out_bytes</td><td>Size in bytes of messages paged out to disk</td></tr><tr><td>rabbitmq_detailed_queue_head_message_timestamp</td><td>Timestamp of the first message in the queue, if any</td></tr><tr><td>rabbitmq_detailed_queue_disk_reads_total</td><td>Total number of times queue read messages from disk</td></tr><tr><td>rabbitmq_detailed_queue_disk_writes_total</td><td>Total number of times queue wrote messages to disk</td></tr><tr><td>rabbitmq_detailed_stream_segments</td><td>Total number of stream segment files</td></tr></tbody></table>
<h4 class="anchor anchorWithStickyNavbar_LWe7" id="connectionchannel-metrics">Connection/channel metrics<a href="#connectionchannel-metrics" class="hash-link" aria-label="Direct link to Connection/channel metrics" title="Direct link to Connection/channel metrics">​</a></h4>
<p>All of those include the Erlang process ID of the channel in their label. This data is not particularly useful
and is only present to distinguish metrics of separate channels.</p>
<p>These metrics are the most expensive to produce.</p>
<h5 class="anchor anchorWithStickyNavbar_LWe7" id="connection-metrics">Connection metrics<a href="#connection-metrics" class="hash-link" aria-label="Direct link to Connection metrics" title="Direct link to Connection metrics">​</a></h5>
<p>Grouped under <code>connection_coarse_metrics</code>:</p>
<table><thead><tr><th>Metric</th><th>Description</th></tr></thead><tbody><tr><td>rabbitmq_detailed_connection_incoming_bytes_total</td><td>Total number of bytes received on a connection</td></tr><tr><td>rabbitmq_detailed_connection_outgoing_bytes_total</td><td>Total number of bytes sent on a connection</td></tr><tr><td>rabbitmq_detailed_connection_process_reductions_total</td><td>Total number of connection process reductions</td></tr></tbody></table>
<p>Grouped under <code>connection_metrics</code>:</p>
<table><thead><tr><th>Metric</th><th>Description</th></tr></thead><tbody><tr><td>rabbitmq_detailed_connection_incoming_packets_total</td><td>Total number of packets received on a connection</td></tr><tr><td>rabbitmq_detailed_connection_outgoing_packets_total</td><td>Total number of packets sent on a connection</td></tr><tr><td>rabbitmq_detailed_connection_pending_packets</td><td>Number of packets waiting to be sent on a connection</td></tr><tr><td>rabbitmq_detailed_connection_channels</td><td>Channels on a connection</td></tr></tbody></table>
<h5 class="anchor anchorWithStickyNavbar_LWe7" id="general-channel-metrics">General channel metrics<a href="#general-channel-metrics" class="hash-link" aria-label="Direct link to General channel metrics" title="Direct link to General channel metrics">​</a></h5>
<p>Grouped under <code>channel_metrics</code>:</p>
<table><thead><tr><th>Metric</th><th>Description</th></tr></thead><tbody><tr><td>rabbitmq_detailed_channel_consumers</td><td>Consumers on a channel</td></tr><tr><td>rabbitmq_detailed_channel_messages_unacked</td><td>Delivered but not yet acknowledged messages</td></tr><tr><td>rabbitmq_detailed_channel_messages_unconfirmed</td><td>Published but not yet confirmed messages</td></tr><tr><td>rabbitmq_detailed_channel_messages_uncommitted</td><td>Messages received in a transaction but not yet committed</td></tr><tr><td>rabbitmq_detailed_channel_acks_uncommitted</td><td>Message acknowledgements in a transaction not yet committed</td></tr><tr><td>rabbitmq_detailed_consumer_prefetch</td><td>Limit of unacknowledged messages for each consumer</td></tr><tr><td>rabbitmq_detailed_channel_prefetch</td><td>Total limit of unacknowledged messages for all consumers on a channel</td></tr></tbody></table>
<p>Grouped under <code>channel_process_metrics</code>:</p>
<table><thead><tr><th>Metric</th><th>Description</th></tr></thead><tbody><tr><td>rabbitmq_detailed_channel_process_reductions_total</td><td>Total number of channel process reductions</td></tr></tbody></table>
<h5 class="anchor anchorWithStickyNavbar_LWe7" id="channel-metrics-with-queueexchange-breakdowns">Channel metrics with queue/exchange breakdowns<a href="#channel-metrics-with-queueexchange-breakdowns" class="hash-link" aria-label="Direct link to Channel metrics with queue/exchange breakdowns" title="Direct link to Channel metrics with queue/exchange breakdowns">​</a></h5>
<p>Grouped under <code>channel_exchange_metrics</code>:</p>
<table><thead><tr><th>Metric</th><th>Description</th></tr></thead><tbody><tr><td>rabbitmq_detailed_channel_messages_published_total</td><td>Total number of messages published to an exchange on a channel</td></tr><tr><td>rabbitmq_detailed_channel_messages_confirmed_total</td><td>Total number of messages published to an exchange and confirmed on the channel</td></tr><tr><td>rabbitmq_detailed_channel_messages_unroutable_returned_total</td><td>Total number of messages published as mandatory to an exchange and returned to the publisher as unroutable</td></tr><tr><td>rabbitmq_detailed_channel_messages_unroutable_dropped_total</td><td>Total number of messages published as non-mandatory to an exchange and dropped as unroutable</td></tr></tbody></table>
<p>Grouped under <code>channel_queue_metrics</code>:</p>
<table><thead><tr><th>Metric</th><th>Description</th></tr></thead><tbody><tr><td>rabbitmq_detailed_channel_get_ack_total</td><td>Total number of messages fetched with basic.get in manual acknowledgement mode</td></tr><tr><td>rabbitmq_detailed_channel_get_total</td><td>Total number of messages fetched with basic.get in automatic acknowledgement mode</td></tr><tr><td>rabbitmq_detailed_channel_messages_delivered_ack_total</td><td>Total number of messages delivered to consumers in manual acknowledgement mode</td></tr><tr><td>rabbitmq_detailed_channel_messages_delivered_total</td><td>Total number of messages delivered to consumers in automatic acknowledgement mode</td></tr><tr><td>rabbitmq_detailed_channel_messages_redelivered_total</td><td>Total number of messages redelivered to consumers</td></tr><tr><td>rabbitmq_detailed_channel_messages_acked_total</td><td>Total number of messages acknowledged by consumers</td></tr><tr><td>rabbitmq_detailed_channel_get_empty_total</td><td>Total number of times basic.get operations fetched no message</td></tr></tbody></table>
<p>Grouped under <code>channel_queue_exchange_metrics</code>:</p>
<table><thead><tr><th>Metric</th><th>Description</th></tr></thead><tbody><tr><td>rabbitmq_detailed_queue_messages_published_total</td><td>Total number of messages published to queues</td></tr></tbody></table>
<h4 class="anchor anchorWithStickyNavbar_LWe7" id="virtual-hosts-and-exchange-metrics">Virtual hosts and exchange metrics<a href="#virtual-hosts-and-exchange-metrics" class="hash-link" aria-label="Direct link to Virtual hosts and exchange metrics" title="Direct link to Virtual hosts and exchange metrics">​</a></h4>
<p>These additional metrics can be useful when virtual hosts or exchanges are
created in a shared cluster. <strong>These metrics are cluster-wide and not node-local</strong>.
Therefore these metrics <strong>must not be aggregated</strong> across cluster nodes.</p>
<p>Grouped under <code>vhost_status</code>:</p>
<table><thead><tr><th>Metric</th><th>Description</th></tr></thead><tbody><tr><td>rabbitmq_cluster_vhost_status</td><td>Whether a given vhost is running</td></tr></tbody></table>
<p>Grouped under <code>exchange_names</code>:</p>
<table><thead><tr><th>Metric</th><th>Description</th></tr></thead><tbody><tr><td>rabbitmq_cluster_exchange_name</td><td>Enumerates exchanges without any additional info. This value is cluster-wide. A cheaper alternative to <code>exchange_bindings</code></td></tr></tbody></table>
<p>Grouped under <code>exchange_bindings</code>:</p>
<table><thead><tr><th>Metric</th><th>Description</th></tr></thead><tbody><tr><td>rabbitmq_cluster_exchange_bindings</td><td>Number of bindings for an exchange. This value is cluster-wide.</td></tr></tbody></table>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="timeout-configuration">Scraping Endpoint Timeouts<a href="#timeout-configuration" class="hash-link" aria-label="Direct link to Scraping Endpoint Timeouts" title="Direct link to Scraping Endpoint Timeouts">​</a></h3>
<p>In some environments there aren&#x27;t many stats-emitting entities (queues, connections, channels), in others
the scraping HTTP endpoint may have to return a sizeable data set to the client (e.g. many thousands of rows).
In those cases the amount of time it takes to process the request can exceed certain
timeouts in the embedded HTTP server and the HTTP client used by Prometheus.</p>
<p>It is possible to bump plugin side HTTP request timeouts using the <code>prometheus.tcp.idle_timeout</code>,
<code>prometheus.tcp.inactivity_timeout</code>, <code>prometheus.tcp.request_timeout</code> settings.</p>
<ul>
<li><code>prometheus.tcp.inactivity_timeout</code> controls HTTP(S) client&#x27;s TCP connection inactivity timeout.
When it is reached, the connection will be closed by the HTTP server.</li>
<li><code>prometheus.tcp.request_timeout</code> controls the window of time in which the client has to send an HTTP
request.</li>
<li><code>prometheus.tcp.idle_timeout</code> controls the window of time in which the client has to send more data (if any)
within the context of an HTTP request.</li>
</ul>
<p>If a load balancer or proxy is used between the Prometheus node and the RabbitMQ nodes it scrapes,
the <code>inactivity_timeout</code> and <code>idle_timeout</code> values should be at least as large, and often greater than,
the timeout and inactivity values used by the load balancer.</p>
<p>Here is an example configuration snippet that modifies the timeouts:</p>
<div class="language-ini codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-ini codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">prometheus.tcp.idle_timeout = 120000</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">prometheus.tcp.inactivity_timeout = 120000</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">prometheus.tcp.request_timeout = 120000</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="grafana-configuration">Grafana Configuration<a href="#grafana-configuration" class="hash-link" aria-label="Direct link to Grafana Configuration" title="Direct link to Grafana Configuration">​</a></h3>
<p>The last component in this setup is Grafana. If this is your first time integrating Grafana with
Prometheus, please follow the <a href="https://prometheus.io/docs/visualization/grafana/" target="_blank" rel="noopener noreferrer">official integration guide</a>.</p>
<p>After Grafana is integrated with the Prometheus instance that reads and stores
RabbitMQ metrics, it is time to import the Grafana dashboards that Team RabbitMQ
maintains. Please refer to the <a href="https://grafana.com/docs/reference/export_import/#importing-a-dashboard" target="_blank" rel="noopener noreferrer">the official Grafana tutorial</a>
on importing dashboards in Grafana.</p>
<p>Grafana dashboards for RabbitMQ and Erlang are open source and publicly from the <a href="https://github.com/rabbitmq/rabbitmq-server/tree/main/deps/rabbitmq_prometheus/docker/grafana/dashboards" target="_blank" rel="noopener noreferrer">rabbitmq-server</a> GitHub repository.</p>
<p>To import <strong>RabbitMQ-Overview</strong> dashboard to Grafana:</p>
<ol>
<li>Go to the <a href="https://grafana.com/orgs/rabbitmq" target="_blank" rel="noopener noreferrer">Grafana website</a> to view the list of official RabbitMQ Grafana
dashboards.</li>
<li>Select <strong>RabbitMQ-Overview</strong> <a href="https://grafana.com/grafana/dashboards/10991" target="_blank" rel="noopener noreferrer">dashboard</a>.</li>
<li>Click the <strong>Download JSON</strong> link or copy the dashboard ID.</li>
<li>Copy paste the file contents in Grafana, then click <strong>Load</strong>, as seen below:<!-- -->
<ul>
<li>Alternatively, paste the dashboard ID in the field <strong>Grafana.com Dashboard</strong>.</li>
</ul>
</li>
</ol>
<p><img decoding="async" loading="lazy" alt="Grafana Import Dashboard" src="/rabbitmq-website/assets/images/grafana-import-dashboard-7cc67028b12dce2f7444802284d10e51.png" width="1800" height="1134" class="img_ev3q"></p>
<p>Repeat the process for all other Grafana dashboards that you would like to use with
this RabbitMQ deployment.</p>
<p>Finally, switch the default data source used by Grafana to <code>prometheus</code>.</p>
<p>Congratulations! Your RabbitMQ is now monitored with Prometheus &amp; Grafana!</p>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="tls">Securing Prometheus Scraping Endpoint with TLS<a href="#tls" class="hash-link" aria-label="Direct link to Securing Prometheus Scraping Endpoint with TLS" title="Direct link to Securing Prometheus Scraping Endpoint with TLS">​</a></h2>
<p>The Prometheus metrics can be secured with TLS similar to the other listeners.
For example, in the <a href="/rabbitmq-website/docs/3.13/configure#configuration-files">configuration file</a></p>
<div class="language-ini codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-ini codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">prometheus.ssl.port       = 15691</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">prometheus.ssl.cacertfile = /full/path/to/ca_certificate.pem</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">prometheus.ssl.certfile   = /full/path/to/server_certificate.pem</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">prometheus.ssl.keyfile    = /full/path/to/server_key.pem</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">prometheus.ssl.password   = password-if-keyfile-is-encrypted</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">## To enforce TLS (disable the non-TLS port):</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"># prometheus.tcp.listener = none</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>To enable TLS with <a href="/rabbitmq-website/docs/3.13/ssl#peer-verification">peer verification</a>, use a config similar to</p>
<div class="language-ini codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-ini codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">prometheus.ssl.port       = 15691</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">prometheus.ssl.cacertfile = /full/path/to/ca_certificate.pem</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">prometheus.ssl.certfile   = /full/path/to/server_certificate.pem</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">prometheus.ssl.keyfile    = /full/path/to/server_key.pem</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">prometheus.ssl.password   = password-if-keyfile-is-encrypted</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">prometheus.ssl.verify     = verify_peer</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">prometheus.ssl.depth      = 2</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">prometheus.ssl.fail_if_no_peer_cert = true</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">## To enforce TLS (disable the non-TLS port):</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"># prometheus.tcp.listener = none</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="3rd-party-plugin">Using Prometheus with RabbitMQ 3.7<a href="#3rd-party-plugin" class="hash-link" aria-label="Direct link to Using Prometheus with RabbitMQ 3.7" title="Direct link to Using Prometheus with RabbitMQ 3.7">​</a></h2>
<p>RabbitMQ versions prior to 3.8 used a separate plugin,
<a href="https://github.com/deadtrickster/prometheus_rabbitmq_exporter" target="_blank" rel="noopener noreferrer">prometheus_rabbitmq_exporter</a>,
to expose metrics to Prometheus.</p></div><footer class="theme-doc-footer docusaurus-mt-lg"><div class="row margin-top--sm theme-doc-footer-edit-meta-row"><div class="col"><a href="https://github.com/rabbitmq/rabbitmq-website/tree/main/versioned_docs/version-3.13/prometheus/index.md" target="_blank" rel="noopener noreferrer" class="theme-edit-this-page"><svg fill="currentColor" height="20" width="20" viewBox="0 0 40 40" class="iconEdit_Z9Sw" aria-hidden="true"><g><path d="m34.5 11.7l-3 3.1-6.3-6.3 3.1-3q0.5-0.5 1.2-0.5t1.1 0.5l3.9 3.9q0.5 0.4 0.5 1.1t-0.5 1.2z m-29.5 17.1l18.4-18.5 6.3 6.3-18.4 18.4h-6.3v-6.2z"></path></g></svg>Edit this page</a></div><div class="col lastUpdated_JAkA"></div></div></footer></article><nav class="pagination-nav docusaurus-mt-lg" aria-label="Docs pages"><a class="pagination-nav__link pagination-nav__link--prev" href="/rabbitmq-website/docs/3.13/monitoring"><div class="pagination-nav__sublabel">Previous</div><div class="pagination-nav__label">Monitoring</div></a><a class="pagination-nav__link pagination-nav__link--next" href="/rabbitmq-website/docs/3.13/event-exchange"><div class="pagination-nav__sublabel">Next</div><div class="pagination-nav__label">Event Exchange Plugin</div></a></nav></div></div><div class="col col--3"><div class="tableOfContents_bqdL thin-scrollbar theme-doc-toc-desktop"><ul class="table-of-contents table-of-contents__left-border"><li><a href="#overview" class="table-of-contents__link toc-highlight">Overview</a><ul><li><a href="#overview-prometheus" class="table-of-contents__link toc-highlight">Built-in Prometheus Support</a></li><li><a href="#overview-grafana" class="table-of-contents__link toc-highlight">Grafana Support</a></li><li><a href="#overview-example" class="table-of-contents__link toc-highlight">An Example</a></li></ul></li><li><a href="#quick-start" class="table-of-contents__link toc-highlight">Quick Start</a><ul><li><a href="#before-we-start" class="table-of-contents__link toc-highlight">Before We Start</a></li><li><a href="#prerequisites" class="table-of-contents__link toc-highlight">Prerequisites</a></li><li><a href="#clone-a-repository-with-manifests" class="table-of-contents__link toc-highlight">Clone a Repository with Manifests</a></li><li><a href="#run-docker-compose" class="table-of-contents__link toc-highlight">Run Docker Compose</a></li><li><a href="#access-rabbitmq-overview-grafana-dashboard" class="table-of-contents__link toc-highlight">Access RabbitMQ Overview Grafana Dashboard</a></li></ul></li><li><a href="#rabbitmq-overview-dashboard" class="table-of-contents__link toc-highlight">RabbitMQ Overview Dashboard</a><ul><li><a href="#health-indicators" class="table-of-contents__link toc-highlight">Health Indicators</a></li><li><a href="#graphs" class="table-of-contents__link toc-highlight">Metrics and Graphs</a></li><li><a href="#graph-colour-labelling" class="table-of-contents__link toc-highlight">Colour Labelling in Graphs</a></li><li><a href="#graph-thresholds" class="table-of-contents__link toc-highlight">Thresholds in Graphs</a></li><li><a href="#graph-thresholds-are-system-specific" class="table-of-contents__link toc-highlight">There is No &quot;Right&quot; Threshold for Many Metrics</a></li><li><a href="#graph-documentation" class="table-of-contents__link toc-highlight">Relevant Documentation for Graphs</a></li><li><a href="#spot-anti-patterns" class="table-of-contents__link toc-highlight">Using Graphs to Spot Anti-patterns</a></li><li><a href="#example-workloads" class="table-of-contents__link toc-highlight">Example Workloads</a></li></ul></li><li><a href="#other-dashboards" class="table-of-contents__link toc-highlight">More Dashboards: Raft and Erlang Runtime</a></li><li><a href="#installation" class="table-of-contents__link toc-highlight">Installation</a><ul><li><a href="#rabbitmq-configuration" class="table-of-contents__link toc-highlight">RabbitMQ Configuration</a></li><li><a href="#enable-rabbitmq_prometheus" class="table-of-contents__link toc-highlight">Enable <code>rabbitmq_prometheus</code></a></li><li><a href="#prometheus-configuration" class="table-of-contents__link toc-highlight">Prometheus Configuration</a></li><li><a href="#port" class="table-of-contents__link toc-highlight">Network Interface and Port</a></li><li><a href="#metric-aggregation" class="table-of-contents__link toc-highlight">Aggregated and Per-Object Metrics</a></li><li><a href="#default-endpoint" class="table-of-contents__link toc-highlight">Prometheus endpoints: <code>/metrics</code></a></li><li><a href="#per-object-endpoint" class="table-of-contents__link toc-highlight">Prometheus endpoints: <code>/metrics/per-object</code></a></li><li><a href="#detailed-endpoint" class="table-of-contents__link toc-highlight">Prometheus endpoints: <code>/metrics/detailed</code></a></li><li><a href="#timeout-configuration" class="table-of-contents__link toc-highlight">Scraping Endpoint Timeouts</a></li><li><a href="#grafana-configuration" class="table-of-contents__link toc-highlight">Grafana Configuration</a></li></ul></li><li><a href="#tls" class="table-of-contents__link toc-highlight">Securing Prometheus Scraping Endpoint with TLS</a></li><li><a href="#3rd-party-plugin" class="table-of-contents__link toc-highlight">Using Prometheus with RabbitMQ 3.7</a></li></ul></div></div></div></div></main></div></div></div><footer class="footer footer--dark"><div class="container container-fluid"><div class="row footer__links"><div class="col footer__col"><div class="footer__title">Learn about RabbitMQ</div><ul class="footer__items clean-list"><li class="footer__item"><a class="footer__link-item" href="/rabbitmq-website/tutorials">Getting Started</a></li><li class="footer__item"><a class="footer__link-item" href="/rabbitmq-website/docs">Documentation</a></li><li class="footer__item"><a class="footer__link-item" href="/rabbitmq-website/blog">Blog</a></li></ul></div><div class="col footer__col"><div class="footer__title">Reach out to the RabbitMQ team</div><ul class="footer__items clean-list"><li class="footer__item"><a href="https://github.com/rabbitmq" target="_blank" rel="noopener noreferrer" class="footer__link-item">GitHub<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_nPIU"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a></li><li class="footer__item"><a href="https://github.com/rabbitmq/rabbitmq-server/discussions" target="_blank" rel="noopener noreferrer" class="footer__link-item">GitHub Discussions<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_nPIU"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a></li><li class="footer__item"><a class="footer__link-item" href="/rabbitmq-website/contact?utm_source=rmq_release-information_tableheader&amp;utm_medium=rmq_website&amp;utm_campaign=tanzu">Long Term Commercial Support</a></li><li class="footer__item"><a class="footer__link-item" href="/rabbitmq-website/contact">Contact Us</a></li><li class="footer__item"><a href="https://www.rabbitmq.com/discord" target="_blank" rel="noopener noreferrer" class="footer__link-item">Discord<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_nPIU"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a></li></ul></div><div class="col footer__col"><div class="footer__title">Broadcom</div><ul class="footer__items clean-list"><li class="footer__item"><a href="https://tanzu.vmware.com/" target="_blank" rel="noopener noreferrer" class="footer__link-item">VMware Tanzu<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_nPIU"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a></li><li class="footer__item"><a href="https://www.vmware.com/help/legal.html" target="_blank" rel="noopener noreferrer" class="footer__link-item">Terms of Use<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_nPIU"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a></li><li class="footer__item"><a href="https://www.vmware.com/help/privacy.html" target="_blank" rel="noopener noreferrer" class="footer__link-item">Privacy<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_nPIU"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a></li><li class="footer__item"><a class="footer__link-item" href="/rabbitmq-website/trademark-guidelines">Trademark Guidelines</a></li><li class="footer__item"><a href="https://www.vmware.com/help/privacy/california-privacy-rights.html" target="_blank" rel="noopener noreferrer" class="footer__link-item">Your California Privacy Rights<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_nPIU"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a></li><li class="footer__item"><a class="footer__link-item ot-sdk-show-settings">Cookie Settings</a></li></ul></div></div><div class="footer__bottom text--center"><div class="footer__copyright">Copyright © 2005-2025 Broadcom. All Rights Reserved. The term "Broadcom" refers to Broadcom Inc. and/or its subsidiaries.</div></div></div></footer></div>
</body>
</html>
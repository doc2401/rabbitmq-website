<!doctype html>
<html lang="en" dir="ltr" class="docs-wrapper plugin-docs plugin-id-default docs-version-3.13 docs-doc-page docs-doc-id-migrate-mcq-to-qq" data-has-hydrated="false">
<head>
<meta charset="UTF-8">
<meta name="generator" content="Docusaurus v3.7.0">
<title data-rh="true">Migrate your RabbitMQ Mirrored Classic Queues to Quorum Queues | RabbitMQ</title><meta data-rh="true" name="viewport" content="width=device-width,initial-scale=1"><meta data-rh="true" name="twitter:card" content="summary_large_image"><meta data-rh="true" property="og:image" content="https://www.rabbitmq.com/rabbitmq-website/img/rabbitmq-social-media-card.svg"><meta data-rh="true" name="twitter:image" content="https://www.rabbitmq.com/rabbitmq-website/img/rabbitmq-social-media-card.svg"><meta data-rh="true" property="og:url" content="https://www.rabbitmq.com/rabbitmq-website/docs/3.13/migrate-mcq-to-qq"><meta data-rh="true" property="og:locale" content="en"><meta data-rh="true" name="docusaurus_locale" content="en"><meta data-rh="true" name="docsearch:language" content="en"><meta data-rh="true" name="docusaurus_version" content="3.13"><meta data-rh="true" name="docusaurus_tag" content="docs-default-3.13"><meta data-rh="true" name="docsearch:version" content="3.13"><meta data-rh="true" name="docsearch:docusaurus_tag" content="docs-default-3.13"><meta data-rh="true" property="og:title" content="Migrate your RabbitMQ Mirrored Classic Queues to Quorum Queues | RabbitMQ"><meta data-rh="true" name="description" content="&lt;!--"><meta data-rh="true" property="og:description" content="&lt;!--"><link data-rh="true" rel="icon" href="/rabbitmq-website/img/rabbitmq-logo.svg"><link data-rh="true" rel="canonical" href="https://www.rabbitmq.com/rabbitmq-website/docs/3.13/migrate-mcq-to-qq"><link data-rh="true" rel="alternate" href="https://www.rabbitmq.com/rabbitmq-website/docs/3.13/migrate-mcq-to-qq" hreflang="en"><link data-rh="true" rel="alternate" href="https://www.rabbitmq.com/rabbitmq-website/docs/3.13/migrate-mcq-to-qq" hreflang="x-default"><link data-rh="true" rel="preconnect" href="https://H10VQIW16Y-dsn.algolia.net" crossorigin="anonymous"><link rel="alternate" type="application/rss+xml" href="/rabbitmq-website/blog/rss.xml" title="RabbitMQ RSS Feed">
<link rel="alternate" type="application/atom+xml" href="/rabbitmq-website/blog/atom.xml" title="RabbitMQ Atom Feed">




<link rel="search" type="application/opensearchdescription+xml" title="RabbitMQ" href="/rabbitmq-website/opensearch.xml">







<link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Raleway:400,700">
<script src="https://cdn.cookielaw.org/scripttemplates/otSDKStub.js" data-domain-script="018ee308-473e-754f-b0c2-cbe82d25512f"></script>
<script>function OptanonWrapper(){}</script>
<script>function setGTM(e,t,o,n,r){e[n]=e[n]||[],e[n].push({"gtm.start":(new Date).getTime(),event:"gtm.js"});var i=t.getElementsByTagName(o)[0],a=t.createElement(o),s="dataLayer"!=n?"&l="+n:"";a.async=!0,a.src="https://www.googletagmanager.com/gtm.js?id="+r+s,i.parentNode.insertBefore(a,i)}var timer;function waitForOnetrustActiveGroups(){document.cookie.indexOf("OptanonConsent")>-1&&document.cookie.indexOf("groups=")>-1?(clearTimeout(timer),setGTM(window,document,"script","dataLayer","GTM-TT84L8K")):timer=setTimeout(waitForOnetrustActiveGroups,250)}document.cookie.indexOf("OptanonConsent")>-1&&document.cookie.indexOf("groups=")>-1?setGTM(window,document,"script","dataLayer","GTM-TT84L8K"):waitForOnetrustActiveGroups()</script><link rel="stylesheet" href="/rabbitmq-website/styles.css">
<script src="/rabbitmq-website/runtime~main.js" defer="defer"></script>
<script src="/rabbitmq-website/main.js" defer="defer"></script>
</head>
<body class="navigation-with-keyboard">
<script>!function(){function t(t){document.documentElement.setAttribute("data-theme",t)}var e=function(){try{return new URLSearchParams(window.location.search).get("docusaurus-theme")}catch(t){}}()||function(){try{return window.localStorage.getItem("theme")}catch(t){}}();null!==e?t(e):window.matchMedia("(prefers-color-scheme: dark)").matches?t("dark"):(window.matchMedia("(prefers-color-scheme: light)").matches,t("light"))}(),function(){try{const n=new URLSearchParams(window.location.search).entries();for(var[t,e]of n)if(t.startsWith("docusaurus-data-")){var a=t.replace("docusaurus-data-","data-");document.documentElement.setAttribute(a,e)}}catch(t){}}(),document.documentElement.setAttribute("data-announcement-bar-initially-dismissed",function(){try{return"true"===localStorage.getItem("docusaurus.announcement.dismiss")}catch(t){}return!1}())</script><div id="__docusaurus"><div role="region" aria-label="Skip to main content"><a class="skipToContent_fXgn" href="#__docusaurus_skipToContent_fallback">Skip to main content</a></div><div class="announcementBar_mb4j" style="background-color:var(--ifm-color-primary-contrast-background);color:var(--ifm-font-color-base)" role="banner"><div class="announcementBarPlaceholder_vyr4"></div><div class="content_knG7 announcementBarContent_xLdY"><strong style="font-size: var(--ifm-h4-font-size);"><a href="https://github.com/rabbitmq/rabbitmq-server/releases/tag/v4.1.0">RabbitMQ 4.1.0 is out</a></strong></div><button type="button" aria-label="Close" class="clean-btn close closeButton_CVFx announcementBarClose_gvF7"><svg viewBox="0 0 15 15" width="14" height="14"><g stroke="currentColor" stroke-width="3.1"><path d="M.75.75l13.5 13.5M14.25.75L.75 14.25"></path></g></svg></button></div><nav aria-label="Main" class="navbar navbar--fixed-top"><div class="navbar__inner"><div class="navbar__items"><button aria-label="Toggle navigation bar" aria-expanded="false" class="navbar__toggle clean-btn" type="button"><svg width="30" height="30" viewBox="0 0 30 30" aria-hidden="true"><path stroke="currentColor" stroke-linecap="round" stroke-miterlimit="10" stroke-width="2" d="M4 7h22M4 15h22M4 23h22"></path></svg></button><a class="navbar__brand" href="/rabbitmq-website/"><div class="navbar__logo"><img src="/rabbitmq-website/img/rabbitmq-logo-with-name.svg" alt="RabbitMQ" class="themedComponent_mlkZ themedComponent--light_NVdE"><img src="/rabbitmq-website/img/rabbitmq-logo-with-name.svg" alt="RabbitMQ" class="themedComponent_mlkZ themedComponent--dark_xIcU"></div></a><a class="navbar__item navbar__link" href="/rabbitmq-website/tutorials">Getting Started</a><a aria-current="page" class="navbar__item navbar__link navbar__link--active" href="/rabbitmq-website/docs/3.13">Docs</a><a class="navbar__item navbar__link" href="/rabbitmq-website/blog">Blog</a><a class="navbar__item navbar__link" href="/rabbitmq-website/contact">Support</a></div><div class="navbar__items navbar__items--right"><div class="navbar__item dropdown dropdown--hoverable dropdown--right"><a aria-current="page" class="navbar__link active" aria-haspopup="true" aria-expanded="false" role="button" href="/rabbitmq-website/docs/3.13/migrate-mcq-to-qq">3.13</a><ul class="dropdown__menu"><li class=""><strong>Release series</strong></li><li><a class="dropdown__link" href="/rabbitmq-website/docs/next">Next</a></li><li><a class="dropdown__link" href="/rabbitmq-website/docs">4.1</a></li><li><a class="dropdown__link" href="/rabbitmq-website/docs/4.0">4.0</a></li><li><a aria-current="page" class="dropdown__link dropdown__link--active" href="/rabbitmq-website/docs/3.13/migrate-mcq-to-qq">3.13</a></li><li><a href="https://v3-12.rabbitmq.com/documentation.html" target="_blank" rel="noopener noreferrer" class="dropdown__link">3.12<svg width="12" height="12" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_nPIU"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a></li><li><a class="dropdown__link" href="/rabbitmq-website/release-information">Release Information</a></li></ul></div><a href="https://github.com/rabbitmq/rabbitmq-website" target="_blank" rel="noopener noreferrer" class="navbar__item navbar__link">GitHub<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_nPIU"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a><div class="toggle_vylO colorModeToggle_DEke"><button class="clean-btn toggleButton_gllP toggleButtonDisabled_aARS" type="button" disabled="" title="Switch between dark and light mode (currently light mode)" aria-label="Switch between dark and light mode (currently light mode)" aria-live="polite" aria-pressed="false"><svg viewBox="0 0 24 24" width="24" height="24" class="lightToggleIcon_pyhR"><path fill="currentColor" d="M12,9c1.65,0,3,1.35,3,3s-1.35,3-3,3s-3-1.35-3-3S10.35,9,12,9 M12,7c-2.76,0-5,2.24-5,5s2.24,5,5,5s5-2.24,5-5 S14.76,7,12,7L12,7z M2,13l2,0c0.55,0,1-0.45,1-1s-0.45-1-1-1l-2,0c-0.55,0-1,0.45-1,1S1.45,13,2,13z M20,13l2,0c0.55,0,1-0.45,1-1 s-0.45-1-1-1l-2,0c-0.55,0-1,0.45-1,1S19.45,13,20,13z M11,2v2c0,0.55,0.45,1,1,1s1-0.45,1-1V2c0-0.55-0.45-1-1-1S11,1.45,11,2z M11,20v2c0,0.55,0.45,1,1,1s1-0.45,1-1v-2c0-0.55-0.45-1-1-1C11.45,19,11,19.45,11,20z M5.99,4.58c-0.39-0.39-1.03-0.39-1.41,0 c-0.39,0.39-0.39,1.03,0,1.41l1.06,1.06c0.39,0.39,1.03,0.39,1.41,0s0.39-1.03,0-1.41L5.99,4.58z M18.36,16.95 c-0.39-0.39-1.03-0.39-1.41,0c-0.39,0.39-0.39,1.03,0,1.41l1.06,1.06c0.39,0.39,1.03,0.39,1.41,0c0.39-0.39,0.39-1.03,0-1.41 L18.36,16.95z M19.42,5.99c0.39-0.39,0.39-1.03,0-1.41c-0.39-0.39-1.03-0.39-1.41,0l-1.06,1.06c-0.39,0.39-0.39,1.03,0,1.41 s1.03,0.39,1.41,0L19.42,5.99z M7.05,18.36c0.39-0.39,0.39-1.03,0-1.41c-0.39-0.39-1.03-0.39-1.41,0l-1.06,1.06 c-0.39,0.39-0.39,1.03,0,1.41s1.03,0.39,1.41,0L7.05,18.36z"></path></svg><svg viewBox="0 0 24 24" width="24" height="24" class="darkToggleIcon_wfgR"><path fill="currentColor" d="M9.37,5.51C9.19,6.15,9.1,6.82,9.1,7.5c0,4.08,3.32,7.4,7.4,7.4c0.68,0,1.35-0.09,1.99-0.27C17.45,17.19,14.93,19,12,19 c-3.86,0-7-3.14-7-7C5,9.07,6.81,6.55,9.37,5.51z M12,3c-4.97,0-9,4.03-9,9s4.03,9,9,9s9-4.03,9-9c0-0.46-0.04-0.92-0.1-1.36 c-0.98,1.37-2.58,2.26-4.4,2.26c-2.98,0-5.4-2.42-5.4-5.4c0-1.81,0.89-3.42,2.26-4.4C12.92,3.04,12.46,3,12,3L12,3z"></path></svg></button></div><div class="navbarSearchContainer_Bca1"><button type="button" class="DocSearch DocSearch-Button" aria-label="Search (Command+K)"><span class="DocSearch-Button-Container"><svg width="20" height="20" class="DocSearch-Search-Icon" viewBox="0 0 20 20" aria-hidden="true"><path d="M14.386 14.386l4.0877 4.0877-4.0877-4.0877c-2.9418 2.9419-7.7115 2.9419-10.6533 0-2.9419-2.9418-2.9419-7.7115 0-10.6533 2.9418-2.9419 7.7115-2.9419 10.6533 0 2.9419 2.9418 2.9419 7.7115 0 10.6533z" stroke="currentColor" fill="none" fill-rule="evenodd" stroke-linecap="round" stroke-linejoin="round"></path></svg><span class="DocSearch-Button-Placeholder">Search</span></span><span class="DocSearch-Button-Keys"></span></button></div></div></div><div role="presentation" class="navbar-sidebar__backdrop"></div></nav><div id="__docusaurus_skipToContent_fallback" class="main-wrapper mainWrapper_z2l0"><div class="docsWrapper_hBAB"><button aria-label="Scroll back to top" class="clean-btn theme-back-to-top-button backToTopButton_sjWU" type="button"></button><div class="docRoot_UBD9"><aside class="theme-doc-sidebar-container docSidebarContainer_YfHR"><div class="sidebarViewport_aRkj"><div class="sidebar_njMd"><nav aria-label="Docs sidebar" class="menu thin-scrollbar menu_SIkG menuWithAnnouncementBar_GW3s"><ul class="theme-doc-sidebar-menu menu__list"><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/rabbitmq-website/docs/3.13">Introduction</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/rabbitmq-website/docs/3.13/whats-new">What&#x27;s New</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/rabbitmq-website/tutorials">Getting Started</a></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist" href="/rabbitmq-website/docs/3.13/download">Install and Upgrade</a><button aria-label="Expand sidebar category &#x27;Install and Upgrade&#x27;" aria-expanded="false" type="button" class="clean-btn menu__caret"></button></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--active" href="/rabbitmq-website/docs/3.13/use-rabbitmq">How to Use RabbitMQ</a><button aria-label="Collapse sidebar category &#x27;How to Use RabbitMQ&#x27;" aria-expanded="true" type="button" class="clean-btn menu__caret"></button></div><ul style="display:block;overflow:visible;height:auto" class="menu__list"><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-2 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist" tabindex="0" href="/rabbitmq-website/docs/3.13/publishers">Publishing Messages</a><button aria-label="Expand sidebar category &#x27;Publishing Messages&#x27;" aria-expanded="false" type="button" class="clean-btn menu__caret"></button></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-2 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist" tabindex="0" href="/rabbitmq-website/docs/3.13/consumers">Consuming Messages</a><button aria-label="Expand sidebar category &#x27;Consuming Messages&#x27;" aria-expanded="false" type="button" class="clean-btn menu__caret"></button></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-2 menu__list-item"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--active" tabindex="0" href="/rabbitmq-website/docs/3.13/queues">Queues</a><button aria-label="Collapse sidebar category &#x27;Queues&#x27;" aria-expanded="true" type="button" class="clean-btn menu__caret"></button></div><ul style="display:block;overflow:visible;height:auto" class="menu__list"><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class="menu__link" tabindex="0" href="/rabbitmq-website/docs/3.13/quorum-queues">Quorum Queues</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class="menu__link" tabindex="0" href="/rabbitmq-website/docs/3.13/classic-queues">Classic Queues</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class="menu__link" tabindex="0" href="/rabbitmq-website/docs/3.13/ha">Mirrored Classic Queues</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class="menu__link menu__link--active" aria-current="page" tabindex="0" href="/rabbitmq-website/docs/3.13/migrate-mcq-to-qq">Migrate Mirrored Classic Queues to Quorum Queues</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class="menu__link" tabindex="0" href="/rabbitmq-website/docs/3.13/ttl">Time-to-Live and Expiration</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class="menu__link" tabindex="0" href="/rabbitmq-website/docs/3.13/maxlength">Queue Length</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class="menu__link" tabindex="0" href="/rabbitmq-website/docs/3.13/lazy-queues">Lazy Queues</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class="menu__link" tabindex="0" href="/rabbitmq-website/docs/3.13/dlx">Dead Lettering</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class="menu__link" tabindex="0" href="/rabbitmq-website/docs/3.13/priority">Priority Queues</a></li></ul></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/rabbitmq-website/docs/3.13/streams">Streams</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/rabbitmq-website/docs/3.13/channels">Channels</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/rabbitmq-website/docs/3.13/reliability">Reliability and Data Safety</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/rabbitmq-website/docs/3.13/confirms">Consumer Acknowledgements and Publisher Confirms</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/rabbitmq-website/docs/3.13/distributed">Network Distribution</a></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-2 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist" tabindex="0" href="/rabbitmq-website/docs/3.13/plugins">Plugins</a><button aria-label="Expand sidebar category &#x27;Plugins&#x27;" aria-expanded="false" type="button" class="clean-btn menu__caret"></button></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-2 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist" tabindex="0" href="/rabbitmq-website/docs/3.13/protocols">Protocols</a><button aria-label="Expand sidebar category &#x27;Protocols&#x27;" aria-expanded="false" type="button" class="clean-btn menu__caret"></button></div></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/rabbitmq-website/client-libraries">Client Libraries</a></li></ul></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist" href="/rabbitmq-website/docs/3.13/manage-rabbitmq">How to Manage RabbitMQ</a><button aria-label="Expand sidebar category &#x27;How to Manage RabbitMQ&#x27;" aria-expanded="false" type="button" class="clean-btn menu__caret"></button></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist" href="/rabbitmq-website/docs/3.13/monitoring">How to Monitor RabbitMQ</a><button aria-label="Expand sidebar category &#x27;How to Monitor RabbitMQ&#x27;" aria-expanded="false" type="button" class="clean-btn menu__caret"></button></div></li></ul></nav></div></div></aside><main class="docMainContainer_TBSr"><div class="container padding-top--md padding-bottom--lg"><div class="row"><div class="col docItemCol_VOVn"><div class="theme-doc-version-banner alert alert--warning margin-bottom--md" role="alert"><div>This is documentation for <!-- -->RabbitMQ<!-- --> <b>3.13</b>, which is no longer actively maintained.</div><div class="margin-top--md">For up-to-date documentation, see the <b><a href="/rabbitmq-website/docs">latest version</a></b> (<!-- -->4.1<!-- -->).</div></div><div class="docItemContainer_Djhp"><article><nav class="theme-doc-breadcrumbs breadcrumbsContainer_Z_bl" aria-label="Breadcrumbs"><ul class="breadcrumbs" itemscope="" itemtype="https://schema.org/BreadcrumbList"><li class="breadcrumbs__item"><a aria-label="Home page" class="breadcrumbs__link" href="/rabbitmq-website/"><svg viewBox="0 0 24 24" class="breadcrumbHomeIcon_YNFT"><path d="M10 19v-5h4v5c0 .55.45 1 1 1h3c.55 0 1-.45 1-1v-7h1.7c.46 0 .68-.57.33-.87L12.67 3.6c-.38-.34-.96-.34-1.34 0l-8.36 7.53c-.34.3-.13.87.33.87H5v7c0 .55.45 1 1 1h3c.55 0 1-.45 1-1z" fill="currentColor"></path></svg></a></li><li itemscope="" itemprop="itemListElement" itemtype="https://schema.org/ListItem" class="breadcrumbs__item"><a class="breadcrumbs__link" itemprop="item" href="/rabbitmq-website/docs/3.13/use-rabbitmq"><span itemprop="name">How to Use RabbitMQ</span></a><meta itemprop="position" content="1"></li><li itemscope="" itemprop="itemListElement" itemtype="https://schema.org/ListItem" class="breadcrumbs__item"><a class="breadcrumbs__link" itemprop="item" href="/rabbitmq-website/docs/3.13/queues"><span itemprop="name">Queues</span></a><meta itemprop="position" content="2"></li><li itemscope="" itemprop="itemListElement" itemtype="https://schema.org/ListItem" class="breadcrumbs__item breadcrumbs__item--active"><span class="breadcrumbs__link" itemprop="name">Migrate Mirrored Classic Queues to Quorum Queues</span><meta itemprop="position" content="3"></li></ul></nav><span class="theme-doc-version-badge badge badge--secondary">Version: 3.13</span><div class="tocCollapsible_ETCw theme-doc-toc-mobile tocMobile_ITEo"><button type="button" class="clean-btn tocCollapsibleButton_TO0P">On this page</button></div><div class="theme-doc-markdown markdown"><header><h1>Migrate your RabbitMQ Mirrored Classic Queues to Quorum Queues</h1></header>
<p>Which is better: mirrored classic queues or quorum queues? <a href="/rabbitmq-website/docs/3.13/quorum-queues">Quorum queues</a> are the much better choice and they will be <a href="https://blog.rabbitmq.com/posts/2021/08/4.0-deprecation-announcements/" target="_blank" rel="noopener noreferrer">the only option starting with RabbitMQ version 4.0</a>.
This information explains why, the reasons why you should migrate from mirrored classic queues to quorum queues, the ways to handle features during the migration, and includes procedures for some of the migration routes you can take.</p>
<p>You should migrate to mirrored classic queues for the following reasons:</p>
<ul>
<li>Classic mirrored queues were deprecated in RabbitMQ version 3.9. They will be removed completely in RabbitMQ version 4.0</li>
<li>Quorum queues can sustain much higher throughput levels in almost all use cases. A quorum queue can sustain a 30000 message throughput (using 1kb messages), while offering high levels of data safety, and replicating data to all 3 nodes in a cluster. Classic mirrored queues only offer a third of that throughput and provide much lower levels of data safety</li>
<li>Quorum queues are more reliable, faster for most workloads, and require little maintenance</li>
</ul>
<p>However, before migrating to quorum queues, a few things must be considered:</p>
<ul>
<li>
<p>While quorum queues are a better queue type when compared to mirrored classic queues, they are not 100% compatible feature wise with mirrored classic queues. When you are deciding about whether to migrate from mirrored classic queues to quorum queues,
it is recommended to review the <a href="/rabbitmq-website/docs/3.13/quorum-queues">quorum queue documentation</a> first, you can review the <a href="/rabbitmq-website/docs/3.13/quorum-queues#feature-matrix">feature matrix table</a> which provides a comparison of both queue types (mirrored classic queues beside quorum queues)</p>
</li>
<li>
<p>The level of complexity involved in migrating from mirrored classic queues to quorum queues depends on the features that are currently being used by the mirrored classic queues. Some features require a change in the way queues are being used (refer to <a href="#mcq-changes-way-queue-is-used">Mirrored Classic Queue Features that require Changes in the Way the Queue is Used</a>), while other features simply require removing the feature from the source code or moving it to policy (refer to <a href="#mcq-features-to-remove">Mirrored Classic Queue Features that can be removed from Source Code or moved to a Policy</a>).</p>
</li>
<li>
<p>It is also important to note that migrated applications should be thoroughly tested against quorum queues because the behaviour can differ under the load and in edge cases.</p>
</li>
</ul>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="how-to-detect-policies-that-enable-classic-queue-mirroring">How to Detect Policies that Enable Classic Queue Mirroring<a href="#how-to-detect-policies-that-enable-classic-queue-mirroring" class="hash-link" aria-label="Direct link to How to Detect Policies that Enable Classic Queue Mirroring" title="Direct link to How to Detect Policies that Enable Classic Queue Mirroring">​</a></h2>
<p>In order to prepare for migration away from classic mirrored queues, it may be necessary to first
understand whether there are any policies in the cluster that enable use this deprecated feature.</p>
<p>There are two <code>rabbitmq-diagnostics</code> commands that help with this:</p>
<ul>
<li><code>rabbitmq-diagnostics check_if_cluster_has_classic_queue_mirroring_policy</code>, a <a href="/rabbitmq-website/docs/3.13/monitoring#health-checks">health check</a></li>
<li><code>rabbitmq-diagnostics list_policies_with_classic_queue_mirroring</code> that lists the problematic policies</li>
</ul>
<div class="tabs-container tabList__CuJ"><ul role="tablist" aria-orientation="horizontal" class="tabs"><li role="tab" tabindex="0" aria-selected="true" class="tabs__item tabItem_LNqP tabs__item--active">bash</li><li role="tab" tabindex="-1" aria-selected="false" class="tabs__item tabItem_LNqP">PowerShell</li></ul><div class="margin-top--md"><div role="tabpanel" class="tabItem_Ymn6"><div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token comment" style="color:#999988;font-style:italic"># exits with a non-zero code if any policies in the cluster</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token comment" style="color:#999988;font-style:italic"># enable classic queue mirroring</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">rabbitmq-diagnostics check_if_cluster_has_classic_queue_mirroring_policy</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token comment" style="color:#999988;font-style:italic"># lists policies that enable classic queue mirroring</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">rabbitmq-diagnostics list_policies_with_classic_queue_mirroring </span><span class="token parameter variable" style="color:#36acaa">-s</span><span class="token plain"> </span><span class="token parameter variable" style="color:#36acaa">--formatter</span><span class="token operator" style="color:#393A34">=</span><span class="token plain">pretty_table</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div></div><div role="tabpanel" class="tabItem_Ymn6" hidden=""><div class="language-PowerShell language-powershell codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-powershell codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token comment" style="color:#999988;font-style:italic"># exits with a non-zero code if any policies in the cluster</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token comment" style="color:#999988;font-style:italic"># enabling classic queue mirroring</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">rabbitmq-diagnostics</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">bat check_if_cluster_has_classic_queue_mirroring_policy</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token comment" style="color:#999988;font-style:italic"># lists policies that enable classic queue mirroring</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">rabbitmq-diagnostics</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">bat list_policies_with_classic_queue_mirroring </span><span class="token operator" style="color:#393A34">-</span><span class="token plain">s </span><span class="token operator" style="color:#393A34">--</span><span class="token plain">formatter=pretty_table</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div></div></div></div>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="deciding-which-migration-route-to-take-compatibility-considerations">Deciding which Migration Route to take: Compatibility Considerations<a href="#deciding-which-migration-route-to-take-compatibility-considerations" class="hash-link" aria-label="Direct link to Deciding which Migration Route to take: Compatibility Considerations" title="Direct link to Deciding which Migration Route to take: Compatibility Considerations">​</a></h2>
<p>Incompatible features can be either referenced in policies or in the source code. RabbitMQ strictly validates arguments for queue declaration and consumption. Therefore, for migration, you must clean up all information about incompatible features in the source code. For some features, changes in the way that queues are used is required, refer to <a href="#mcq-changes-way-queue-is-used">Mirrored Classic Queue Features that require Changes in the Way the Queue is Used</a>. For other features, it is as simple as just removing corresponding strings from the source code or moving the feature to a policy, refer to <a href="#mcq-features-to-remove">Mirrored Classic Queue Features that can be removed from Source Code or moved to a Policy</a>,</p>
<p>The general policies and arguments related to mirroring are:<code>ha-mode</code>, <code>ha-params</code> <code>ha-sync-mode</code>, <code>ha-promote-on-shutdown</code>, <code>ha-promote-on-failure</code>, and <code>queue-master-locator</code>.</p>
<p>There are several migration paths available:</p>
<ul>
<li><a href="/rabbitmq-website/docs/3.13/blue-green-upgrade">Blue-Green Deployment</a></li>
<li><a href="#migrate-the-queues-by-virtual-host">Migrating the Queues by Virtual Host</a> is probably the most efficient migration path you can take if it is an option for you. If all the incompatible features are cleaned up or moved to policies, the existing code should work with both mirrored classic queues and quorum queues. You only need to change the connection parameters to connect to the new virtual host that you created for the quorum queues</li>
<li><a href="#migrate-in-place">Migrating in Place</a> means you re-use the same virtual host. You must be able to stop all consumers and producers for a given queue while the migration is in progress</li>
</ul>
<p>Before deciding which migration method you can use, you must first find the mirrored classic queues and the features they are using.</p>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="find-mcq">Finding the Mirrored Classic Queues for Migration<a href="#find-mcq" class="hash-link" aria-label="Direct link to Finding the Mirrored Classic Queues for Migration" title="Direct link to Finding the Mirrored Classic Queues for Migration">​</a></h2>
<p>To find the mirrored classic queues that must be migrated, run the following script (which uses <code>rabbitmqctl</code> to count all the queues across all the virtual hosts as tab-separated values).</p>
<p>Note, the following command uses <code>effective_policy_definition</code> parameters, which are only available since RabbitMQ version 3.10.13/3.11.5. If it&#x27;s not available, you can use <code>rabbitmqctl</code> from any RabbitMQ version later than 3.10.13/3.11.5, or manually match the policy name to it&#x27;s definition.</p>
<div class="tabs-container tabList__CuJ"><ul role="tablist" aria-orientation="horizontal" class="tabs"><li role="tab" tabindex="0" aria-selected="true" class="tabs__item tabItem_LNqP tabs__item--active">bash</li></ul><div class="margin-top--md"><div role="tabpanel" class="tabItem_Ymn6"><div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token shebang important">#!/bin/sh</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token builtin class-name">printf</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;%s</span><span class="token string entity" style="color:#36acaa">\t</span><span class="token string" style="color:#e3116c">%s</span><span class="token string entity" style="color:#36acaa">\t</span><span class="token string" style="color:#e3116c">%s</span><span class="token string entity" style="color:#36acaa">\n</span><span class="token string" style="color:#e3116c">&quot;</span><span class="token plain"> vhost queue_name mirrors</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">for</span><span class="token plain"> </span><span class="token for-or-select variable" style="color:#36acaa">vhost</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">in</span><span class="token plain"> </span><span class="token variable" style="color:#36acaa">$(</span><span class="token variable" style="color:#36acaa">rabbitmqctl </span><span class="token variable parameter variable" style="color:#36acaa">-q</span><span class="token variable" style="color:#36acaa"> list_vhosts </span><span class="token variable operator" style="color:#393A34">|</span><span class="token variable" style="color:#36acaa"> </span><span class="token variable function" style="color:#d73a49">tail</span><span class="token variable" style="color:#36acaa"> </span><span class="token variable parameter variable" style="color:#36acaa">-n</span><span class="token variable" style="color:#36acaa"> +2</span><span class="token variable" style="color:#36acaa">)</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">do</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  rabbitmqctl </span><span class="token parameter variable" style="color:#36acaa">-q</span><span class="token plain"> list_queues </span><span class="token parameter variable" style="color:#36acaa">-p</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;</span><span class="token string variable" style="color:#36acaa">$vhost</span><span class="token string" style="color:#e3116c">&quot;</span><span class="token plain"> name durable policy effective_policy_definition arguments mirror_pids </span><span class="token builtin class-name">type</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">|</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">	</span><span class="token function" style="color:#d73a49">sed</span><span class="token plain"> </span><span class="token parameter variable" style="color:#36acaa">-n</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&#x27;/\t\[[^\t]\+\tclassic$/{s/\t\[[^\t]\+\tclassic$//; p}&#x27;</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">|</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">	</span><span class="token function" style="color:#d73a49">xargs</span><span class="token plain"> </span><span class="token parameter variable" style="color:#36acaa">-x</span><span class="token plain"> </span><span class="token parameter variable" style="color:#36acaa">-r</span><span class="token plain"> </span><span class="token parameter variable" style="color:#36acaa">-L1</span><span class="token plain"> </span><span class="token parameter variable" style="color:#36acaa">-d</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&#x27;\n&#x27;</span><span class="token plain"> </span><span class="token builtin class-name">printf</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;%s</span><span class="token string entity" style="color:#36acaa">\t</span><span class="token string" style="color:#e3116c">%s</span><span class="token string entity" style="color:#36acaa">\n</span><span class="token string" style="color:#e3116c">&quot;</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;</span><span class="token string variable" style="color:#36acaa">$vhost</span><span class="token string" style="color:#e3116c">&quot;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">done</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div></div></div></div>
<p>All mirrored classic queues that include <code>ha-mode</code> in their effective policy definition must be migrated to a different type of queue. All these queues are listed as mirrored classic queues in the Management UI and CLI. Find the policies that apply it by running the following script:</p>
<div class="tabs-container tabList__CuJ"><ul role="tablist" aria-orientation="horizontal" class="tabs"><li role="tab" tabindex="0" aria-selected="true" class="tabs__item tabItem_LNqP tabs__item--active">bash</li></ul><div class="margin-top--md"><div role="tabpanel" class="tabItem_Ymn6"><div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token shebang important">#!/bin/sh</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token builtin class-name">printf</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;%s</span><span class="token string entity" style="color:#36acaa">\t</span><span class="token string" style="color:#e3116c">%s</span><span class="token string entity" style="color:#36acaa">\t</span><span class="token string" style="color:#e3116c">%s</span><span class="token string entity" style="color:#36acaa">\t</span><span class="token string" style="color:#e3116c">%s</span><span class="token string entity" style="color:#36acaa">\t</span><span class="token string" style="color:#e3116c">%s</span><span class="token string entity" style="color:#36acaa">\t</span><span class="token string" style="color:#e3116c">%s</span><span class="token string entity" style="color:#36acaa">\n</span><span class="token string" style="color:#e3116c">&quot;</span><span class="token plain"> vhost policy_name pattern apply_to definition priority</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">for</span><span class="token plain"> </span><span class="token for-or-select variable" style="color:#36acaa">vhost</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">in</span><span class="token plain"> </span><span class="token variable" style="color:#36acaa">$(</span><span class="token variable" style="color:#36acaa">rabbitmqctl </span><span class="token variable parameter variable" style="color:#36acaa">-q</span><span class="token variable" style="color:#36acaa"> list_vhosts </span><span class="token variable operator" style="color:#393A34">|</span><span class="token variable" style="color:#36acaa"> </span><span class="token variable function" style="color:#d73a49">tail</span><span class="token variable" style="color:#36acaa"> </span><span class="token variable parameter variable" style="color:#36acaa">-n</span><span class="token variable" style="color:#36acaa"> +2</span><span class="token variable" style="color:#36acaa">)</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">do</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  rabbitmqctl </span><span class="token parameter variable" style="color:#36acaa">-q</span><span class="token plain"> list_policies </span><span class="token parameter variable" style="color:#36acaa">-p</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;</span><span class="token string variable" style="color:#36acaa">$vhost</span><span class="token string" style="color:#e3116c">&quot;</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">|</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token function" style="color:#d73a49">grep</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&#x27;ha-mode&#x27;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">done</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div></div></div></div>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="mcq-changes-way-queue-is-used">Mirrored Classic Queue Features that require Changes in the Way the Queue is Used<a href="#mcq-changes-way-queue-is-used" class="hash-link" aria-label="Direct link to Mirrored Classic Queue Features that require Changes in the Way the Queue is Used" title="Direct link to Mirrored Classic Queue Features that require Changes in the Way the Queue is Used">​</a></h2>
<p>When one or more of the following features are used by mirrored classic queues, straightforward migration to quorum queues is not possible. The way the application interacts with a broker needs to be changed. This information explains how to find whether some of these features are being used in a running system, and the changes you must make to make migration easier.</p>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="priority-queues">Priority Queues<a href="#priority-queues" class="hash-link" aria-label="Direct link to Priority Queues" title="Direct link to Priority Queues">​</a></h3>
<p>To find out if a classic mirrored queue uses the &quot;priority&quot; feature, you can check for the <code>x-max-priority</code> string in
the list of queues output that is provided by running the command in <a href="#find-mcq">Finding the Mirrored Classic Queues for Migration</a> or you can also search for the <code>x-max-priority</code> string in the source code. For more information on how the priority is implemented, go to <a href="/rabbitmq-website/docs/3.13/priority">Priority Queue Support</a>.</p>
<p>Priority queues are not created using a policy, therefore no policy changes are required when migrating them. Classic mirrored queues create a separate queue for every priority behind the scenes. To migrate a single mirrored classic queue that uses the &quot;priority&quot; feature, you must create the required number amount of quorum queues. Once the quorum queues are created, adjust the publishing and consumption of these new quorum queues accordingly.</p>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="queue-length-limit-overflow-set-to-reject-publish-dlx">Queue Length Limit overflow set to <code>reject-publish-dlx</code><a href="#queue-length-limit-overflow-set-to-reject-publish-dlx" class="hash-link" aria-label="Direct link to queue-length-limit-overflow-set-to-reject-publish-dlx" title="Direct link to queue-length-limit-overflow-set-to-reject-publish-dlx">​</a></h3>
<p>The queue length exceeded with <code>overflow</code> set to <a href="/rabbitmq-website/docs/3.13/maxlength#overflow-behaviour"><code>reject-publish-dlx</code></a> is not supported by quorum queues. The <code>reject-publish-dlx</code> value is not supported.</p>
<p>With mirrored classic queues, publishing to a full queue with <code>reject-publish-dlx</code> resulted in RabbitMQ republishing a rejected message to a dead letter exchange. With quorum queues, to apply the same logic, you must change <code>reject-publish-dlx</code> to <code>reject-publish</code>. Then, handle negative acknowledgements: after getting a negative acknowledgement, the application must publish the message again to a different exchange.</p>
<p>To find out if <code>overflow</code> set to <code>reject-publish-dlx</code> is configured for the mirrored classic queues you want to migrate, check for the <code>reject-publish-dlx</code> string in the list of queues output that is provided by running the command in <a href="#find-mcq">Finding the Mirrored Classic Queues for Migration</a> or you can also search for the <code>reject-publish-dlx</code> string in the source code.</p>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="global-qos-for-consumers">Global QoS for Consumers<a href="#global-qos-for-consumers" class="hash-link" aria-label="Direct link to Global QoS for Consumers" title="Direct link to Global QoS for Consumers">​</a></h3>
<p>Global <a href="/rabbitmq-website/docs/3.13/quorum-queues#global-qos">QoS prefetch</a> where a channel sets a single prefetch limit for all consumers using that channel is not supported by quorum queues. If this functionality is required, try achieving the same results using alternative methods, for example, one solution might be to use a lower per-consumer QoS (given the known application load pattern).</p>
<p>To find out if this feature is used, run the following command on a running system and check for non-empty output:</p>
<div class="tabs-container tabList__CuJ"><ul role="tablist" aria-orientation="horizontal" class="tabs"><li role="tab" tabindex="0" aria-selected="true" class="tabs__item tabItem_LNqP tabs__item--active">bash</li></ul><div class="margin-top--md"><div role="tabpanel" class="tabItem_Ymn6"><div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">rabbitmqctl list_channels pid name global_prefetch_count </span><span class="token operator" style="color:#393A34">|</span><span class="token plain"> </span><span class="token function" style="color:#d73a49">sed</span><span class="token plain"> </span><span class="token parameter variable" style="color:#36acaa">-n</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&#x27;/\t0$/!p&#x27;</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div></div></div></div>
<p>A list of channel PIDs that have global QoS turned on are returned. Then, run the following command to map the channel PID to a queue name to verify if it is a mirrored classic queue.</p>
<div class="tabs-container tabList__CuJ"><ul role="tablist" aria-orientation="horizontal" class="tabs"><li role="tab" tabindex="0" aria-selected="true" class="tabs__item tabItem_LNqP tabs__item--active">bash</li></ul><div class="margin-top--md"><div role="tabpanel" class="tabItem_Ymn6"><div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">rabbitmqctl list_consumers queue_name channel_pid</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div></div></div></div>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="x-cancel-on-ha-failover-for-consumers"><code>x-cancel-on-ha-failover</code> for Consumers<a href="#x-cancel-on-ha-failover-for-consumers" class="hash-link" aria-label="Direct link to x-cancel-on-ha-failover-for-consumers" title="Direct link to x-cancel-on-ha-failover-for-consumers">​</a></h3>
<p>Classic mirrored queues consumers can be <a href="/rabbitmq-website/docs/3.13/ha#cancellation">automatically cancelled</a> when a queue
leader fails over. This can cause loss of information about which messages were sent to which consumer, and result in the same messages being sent again (duplicate messages).</p>
<p>Some of the cases for duplicate messages are covered by <code>x-cancel-on-ha-failover</code> and others are not. Most of the cases covered by <code>x-cancel-on-ha-failover</code> do not exist with quorum queues but those that are not covered are still there. Therefore, your application must be able to handle duplicates, which it should be able to do anyway.</p>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="mcq-features-to-remove">Mirrored Classic Queue Features that can be removed from Source Code or moved to a Policy<a href="#mcq-features-to-remove" class="hash-link" aria-label="Direct link to Mirrored Classic Queue Features that can be removed from Source Code or moved to a Policy" title="Direct link to Mirrored Classic Queue Features that can be removed from Source Code or moved to a Policy">​</a></h2>
<p>The following features are ignored when quorum queues are
used. The best way to handle these features is to remove them from the source
code, or move them to a policy.</p>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="lazy-queues">Lazy Queues<a href="#lazy-queues" class="hash-link" aria-label="Direct link to Lazy Queues" title="Direct link to Lazy Queues">​</a></h3>
<p>Quorum queues do not support lazy mode (<code>x-queue-mode=lazy</code>).</p>
<p>To migrate mirrored lazy classic queues, remove the <code>x-queue-mode=lazy</code> declaration argument or remove it from the policy if it is set via a policy. For more information about the lazy mode, see <a href="/rabbitmq-website/docs/3.13/lazy-queues">Lazy Queues</a>.</p>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="transient-queues">Transient Queues<a href="#transient-queues" class="hash-link" aria-label="Direct link to Transient Queues" title="Direct link to Transient Queues">​</a></h3>
<p><a href="/rabbitmq-website/docs/3.13/queues#durability">Transient queues</a> are deleted on a node/cluster boot.</p>
<p>The plan is to remove transient queues in future RabbitMQ releases.
The only option for transient queues then will be exclusive queues. This only affects the durability of queue definitions. Messages can still be marked transient.</p>
<p>You must make a decision about transient queues before migration, is the content of the
queue important enough to get availability guarantees of quorum queues, or is it better to downgrade the transient queue to a classic non-mirrored queue (classic mirrored queues are being removed but classic non-mirrored queues will still be available).</p>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="exclusive-queues">Exclusive Queues<a href="#exclusive-queues" class="hash-link" aria-label="Direct link to Exclusive Queues" title="Direct link to Exclusive Queues">​</a></h3>
<p>You do not need to complete any migration tasks for <a href="/rabbitmq-website/docs/3.13/queues#exclusive-queues">exclusive queues</a>. Exclusive queues are not mirrored even if the policy indicates that they are. Also, it is not possible to create an exclusive quorum queue.</p>
<p>For exclusive queues, however, you must decide whether to leave the queue as exclusive or change it to a replicated queue during migration. Be careful not to make exclusive queue declarations with an explicit <code>x-queue-type: quorum</code> argument.</p>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="general-prerequisites-before-migrating-from-mirrored-classic-queues-to-quorum-queues">General Prerequisites before Migrating from Mirrored Classic Queues to Quorum Queues<a href="#general-prerequisites-before-migrating-from-mirrored-classic-queues-to-quorum-queues" class="hash-link" aria-label="Direct link to General Prerequisites before Migrating from Mirrored Classic Queues to Quorum Queues" title="Direct link to General Prerequisites before Migrating from Mirrored Classic Queues to Quorum Queues">​</a></h2>
<ol>
<li>A RabbitMQ cluster with an odd number of nodes. A minimum of 3 nodes in the RabbitMQ cluster is required for high availability.</li>
<li>The Management plugin should be running on at least one node. It is used to export/import definitions for a single host,
which simplifies definitions cleanup. (<code>rabbitmqadmin</code> CLI command is also using the plugin behind the scenes).</li>
<li>To quickly move (shovel) the backlog of original queues to the new queues, enable the . The <a href="/rabbitmq-website/docs/3.13/shovel">Shovel plugin</a> can be used to move the backlog of original messages to the new queues. Shovels can be created programmatically using a HTTP API extension or using the RabbitMQ Management UI.</li>
</ol>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="migrate-the-queues-by-virtual-host">Migrate Mirrored Classic Queues to Quorum Queues by Virtual Host<a href="#migrate-the-queues-by-virtual-host" class="hash-link" aria-label="Direct link to Migrate Mirrored Classic Queues to Quorum Queues by Virtual Host" title="Direct link to Migrate Mirrored Classic Queues to Quorum Queues by Virtual Host">​</a></h2>
<p>This procedure to migrate from mirrored classic queues to quorum queues
is similar to a <a href="/rabbitmq-website/docs/3.13/blue-green-upgrade">blue-green cluster upgrade</a>,
except you are migrating to a new virtual host on the same
RabbitMQ cluster. The steps in the following sections use a new virtual host on the existing cluster to provide an empty namespace to create the new quorum queues using the old queue names.</p>
<p>You will use the <a href="/rabbitmq-website/docs/3.13/federation">Federation Plugin</a> to seamlessly migrate from the old virtual host to the new one.</p>
<p><strong>Important</strong>: You can set the default queue type for the new virtual host. Setting it to
<code>quorum</code> creates all the queues without an explicit type as
quorum queues (except for exclusive, non-durable, or auto-delete queues).</p>
<p>If all incompatible features were cleaned up from the source code, and
there is no explicit <code>x-queue-type</code> arguments in the source code, then
the same code should work for both the old
virtual host with classic mirrored queues and the new virtual
host with quorum queues. The only change you need to make is to update the virtual host connection parameters to connect to the new virtual host.</p>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="create-the-destination-virtual-host">Create the Destination Virtual Host<a href="#create-the-destination-virtual-host" class="hash-link" aria-label="Direct link to Create the Destination Virtual Host" title="Direct link to Create the Destination Virtual Host">​</a></h3>
<p><a href="/rabbitmq-website/docs/3.13/vhosts#creating">Create the new virtual host</a> with the correct default queue type (quorum) in the existing cluster. The queue type should be selected from the <strong>queue type</strong> drop down list when the new virtual host is being added via management UI.</p>
<p>Alternatively, it can also be created using the CLI interface by specifying the default queue type and adding the permissions.
Ensure all required users have access and can connect to the new virtual host by following the steps in the <a href="/rabbitmq-website/docs/3.13/access-control#user-management">Access Control guide</a>.</p>
<div class="tabs-container tabList__CuJ"><ul role="tablist" aria-orientation="horizontal" class="tabs"><li role="tab" tabindex="0" aria-selected="true" class="tabs__item tabItem_LNqP tabs__item--active">bash</li><li role="tab" tabindex="-1" aria-selected="false" class="tabs__item tabItem_LNqP">PowerShell</li></ul><div class="margin-top--md"><div role="tabpanel" class="tabItem_Ymn6"><div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">rabbitmqctl add_vhost NEW_VHOST --default-queue-type quorum</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">rabbitmqctl set_permissions </span><span class="token parameter variable" style="color:#36acaa">-p</span><span class="token plain"> NEW_VHOST USERNAME </span><span class="token string" style="color:#e3116c">&#x27;.*&#x27;</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&#x27;.*&#x27;</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&#x27;.*&#x27;</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div></div><div role="tabpanel" class="tabItem_Ymn6" hidden=""><div class="language-PowerShell language-powershell codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-powershell codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">rabbitmqctl</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">bat add_vhost NEW_VHOST </span><span class="token operator" style="color:#393A34">--</span><span class="token plain">default-queue-</span><span class="token function" style="color:#d73a49">type</span><span class="token plain"> quorum</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">rabbitmqctl</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">bat set_permissions </span><span class="token operator" style="color:#393A34">-</span><span class="token plain">p NEW_VHOST USERNAME </span><span class="token string" style="color:#e3116c">&#x27;.*&#x27;</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&#x27;.*&#x27;</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&#x27;.*&#x27;</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div></div></div></div>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="create-the-federation-upstream">Create the Federation Upstream<a href="#create-the-federation-upstream" class="hash-link" aria-label="Direct link to Create the Federation Upstream" title="Direct link to Create the Federation Upstream">​</a></h3>
<p>A new <a href="/rabbitmq-website/docs/3.13/blue-green-upgrade#setup-federation">federation upstream</a> should be created for the NEW_VHOST with the
URI pointing to the OLD_VHOST: <code>amqp:///OLD_VHOST</code>. (Note that the
default vhost URI is <code>amqp:///%2f</code>).</p>
<p>The federation upstream can be created using the management UI or the CLI:</p>
<div class="tabs-container tabList__CuJ"><ul role="tablist" aria-orientation="horizontal" class="tabs"><li role="tab" tabindex="0" aria-selected="true" class="tabs__item tabItem_LNqP tabs__item--active">bash</li><li role="tab" tabindex="-1" aria-selected="false" class="tabs__item tabItem_LNqP">PowerShell</li></ul><div class="margin-top--md"><div role="tabpanel" class="tabItem_Ymn6"><div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">rabbitmqctl set_parameter federation-upstream quorum-migration-upstream </span><span class="token punctuation" style="color:#393A34">\</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token parameter variable" style="color:#36acaa">--vhost</span><span class="token plain"> NEW_VHOST </span><span class="token punctuation" style="color:#393A34">\</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token string" style="color:#e3116c">&#x27;{&quot;uri&quot;:&quot;amqp:///OLD_VHOST&quot;, &quot;trust-user-id&quot;:true}&#x27;</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div></div><div role="tabpanel" class="tabItem_Ymn6" hidden=""><div class="language-PowerShell language-powershell codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-powershell codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">rabbitmqctl</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">bat set_parameter federation-upstream quorum-migration-upstream ^</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token operator" style="color:#393A34">--</span><span class="token plain">vhost NEW_VHOST ^</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token string" style="color:#e3116c">&quot;{&quot;</span><span class="token string" style="color:#e3116c">&quot;uri&quot;</span><span class="token string" style="color:#e3116c">&quot;:&quot;</span><span class="token string" style="color:#e3116c">&quot;amqp:///OLD_VHOST&quot;</span><span class="token string" style="color:#e3116c">&quot;, &quot;</span><span class="token string" style="color:#e3116c">&quot;trust-user-id&quot;</span><span class="token string" style="color:#e3116c">&quot;:true}&quot;</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div></div></div></div>
<p>When this form of URI with an empty hostname is used, there is no
need to specify credentials. Connection is only possible within
the bounds of a single cluster.</p>
<p>If the <code>user-id</code> in messages is being used for any purpose, it can also be
preserved as shown in the previous CLI example.</p>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="moving-definitions">Moving Definitions<a href="#moving-definitions" class="hash-link" aria-label="Direct link to Moving Definitions" title="Direct link to Moving Definitions">​</a></h3>
<p>Export the <a href="/rabbitmq-website/docs/3.13/definitions">definitions</a> from the source virtual host to a file
using the following CLI command:</p>
<div class="tabs-container tabList__CuJ"><ul role="tablist" aria-orientation="horizontal" class="tabs"><li role="tab" tabindex="0" aria-selected="true" class="tabs__item tabItem_LNqP tabs__item--active">bash</li><li role="tab" tabindex="-1" aria-selected="false" class="tabs__item tabItem_LNqP">PowerShell</li></ul><div class="margin-top--md"><div role="tabpanel" class="tabItem_Ymn6"><div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token comment" style="color:#999988;font-style:italic"># exports definitions of a specific virtual host</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">rabbitmqctl export_definitions </span><span class="token parameter variable" style="color:#36acaa">--vhost</span><span class="token operator" style="color:#393A34">=</span><span class="token string" style="color:#e3116c">&quot;{original_vhost}&quot;</span><span class="token plain"> /path/to/original_vhost.json</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div></div><div role="tabpanel" class="tabItem_Ymn6" hidden=""><div class="language-PowerShell language-powershell codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-powershell codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token comment" style="color:#999988;font-style:italic"># exports definitions of a specific virtual host</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">rabbitmqctl</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">bat export_definitions </span><span class="token operator" style="color:#393A34">--</span><span class="token plain">vhost=</span><span class="token string" style="color:#e3116c">&#x27;{original_vhost}&#x27;</span><span class="token plain"> \path\to\original_vhost</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">json</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div></div></div></div>
<p>Alternatively, definitions can be exported in the management UI on the <strong>Overview</strong> page. Don&#x27;t forget to
select the specific virtual host in the top right corner!</p>
<p>Make the following changes to this file before loading it back into the NEW_VHOST:</p>
<ol>
<li>Remove the <code>x-queue-type</code> declarations for queues that you want to have
as classic mirrored queues in the old virtual host, and as quorum ones in the
new virtual host.</li>
<li>Other changes that must be applied to queue definitions:<!-- -->
<ul>
<li>Remove the <code>x-max-priority</code> argument.</li>
<li>Change the <code>x-overlow</code> argument when it is set to <code>reject-publish-dlx</code>. Change it to <code>reject-publish</code>.</li>
<li>Remove the <code>x-queue-mode</code> argument.</li>
<li>Change the <code>durable</code> attribute to <code>true</code>.</li>
</ul>
</li>
<li>Change the following keys in the policies:<!-- -->
<ul>
<li>Remove everything starting with <code>ha-</code>: <code>ha-mode</code>, <code>ha-params</code>,
<code>ha-sync-mode</code>, <code>ha-sync-batch-size</code>, <code>ha-promote-on-shutdown</code>, and
<code>ha-promote-on-failure</code></li>
<li>Remove the <code>queue-mode</code>.</li>
<li>Change <code>overflow</code> when it is set to <code>reject-publish-dlx</code>. Change it to <code>reject-publish</code>.</li>
</ul>
</li>
<li>Policies that are empty after the previous step should be dropped.</li>
<li>Federation with the old virtual host should be added to any remaining
policies, pointing to the federation upstream created earlier:
<code>&quot;federation-upstream-set&quot;:&quot;quorum-migration-upstream&quot;</code>.</li>
<li>If there is no catch-all policy (applying to queues with pattern <code>.*</code>), you must create this policy and point it to the federation upstream. This ensures that every queue in the old virtual host will be federated.</li>
<li>Policies that apply federation rules to exchanges must be removed for the period of the migration to avoid duplicate messages.</li>
</ol>
<p>Now the modified schema can be loaded into the new virtual host from the Management
UI or by running the following command from the CLI:</p>
<div class="tabs-container tabList__CuJ"><ul role="tablist" aria-orientation="horizontal" class="tabs"><li role="tab" tabindex="0" aria-selected="true" class="tabs__item tabItem_LNqP tabs__item--active">bash</li><li role="tab" tabindex="-1" aria-selected="false" class="tabs__item tabItem_LNqP">PowerShell</li></ul><div class="margin-top--md"><div role="tabpanel" class="tabItem_Ymn6"><div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token comment" style="color:#999988;font-style:italic"># imports definitions of a specific virtual host</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">rabbitmqctl import_definitions /path/to/updated_definitions.json</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div></div><div role="tabpanel" class="tabItem_Ymn6" hidden=""><div class="language-PowerShell language-powershell codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-powershell codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token comment" style="color:#999988;font-style:italic"># imports definitions of a specific virtual host</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">rabbitmqctl</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">bat import_definitions \path\to\updated_vhost</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">json</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div></div></div></div>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="point-consumers-to-use-quorum-queues-in-the-new-virtual-host">Point Consumers to use Quorum Queues in the New Virtual Host<a href="#point-consumers-to-use-quorum-queues-in-the-new-virtual-host" class="hash-link" aria-label="Direct link to Point Consumers to use Quorum Queues in the New Virtual Host" title="Direct link to Point Consumers to use Quorum Queues in the New Virtual Host">​</a></h3>
<p>Consumers of the migrated queues can now access the new queues by updating the connection parameters to connect to the new virtual host. The federation links start to pull in messages from the original queues.</p>
<p>As with a blue-green cluster, after all consumers are migrated, you might need to also <a href="#shovel-remaining-messages">add shovels to move the backlog of the original queues to the new queues</a> more efficiently than federation. For more information, refer to <a href="/rabbitmq-website/docs/3.13/blue-green-upgrade#drain-messages">Drain Messages</a>.</p>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="update-the-producers-to-use-the-exchanges-in-the-new-virtual-host">Update the Producers to Use the Exchanges in the new Virtual Host<a href="#update-the-producers-to-use-the-exchanges-in-the-new-virtual-host" class="hash-link" aria-label="Direct link to Update the Producers to Use the Exchanges in the new Virtual Host" title="Direct link to Update the Producers to Use the Exchanges in the new Virtual Host">​</a></h3>
<p>Once the original queues are empty (or nearly empty if you do not require full message ordering), the producers should be stopped and reconfigured to use the new queue declarations and virtual host like the consumers, and restarted. Federated exchanges in the old virtual host should also be stopped and equivalent exchanges should be added in the new virtual host. The original queues can be removed once they are empty and no messages are passing through them.</p>
<p>Under sufficient system load, messages from the old virtual host will
not be picked up. If message ordering is important, then ordering should
be completed in these steps: stop producers, shovel remaining messages to the new
virtual host, and start consumers on the new virtual host.</p>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="shovel-remaining-messages">Shovel Remaining Messages to the New Virtual Host<a href="#shovel-remaining-messages" class="hash-link" aria-label="Direct link to Shovel Remaining Messages to the New Virtual Host" title="Direct link to Shovel Remaining Messages to the New Virtual Host">​</a></h3>
<p>For every non-empty queue in the old virtual host, a shovel needs to be configured. For example:</p>
<div class="tabs-container tabList__CuJ"><ul role="tablist" aria-orientation="horizontal" class="tabs"><li role="tab" tabindex="0" aria-selected="true" class="tabs__item tabItem_LNqP tabs__item--active">bash</li><li role="tab" tabindex="-1" aria-selected="false" class="tabs__item tabItem_LNqP">PowerShell</li></ul><div class="margin-top--md"><div role="tabpanel" class="tabItem_Ymn6"><div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">rabbitmqctl set_parameter shovel migrate-QUEUE_TO_MIGRATE </span><span class="token punctuation" style="color:#393A34">\</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token string" style="color:#e3116c">&#x27;{&quot;src-protocol&quot;: &quot;amqp091&quot;, &quot;src-uri&quot;: &quot;amqp:///OLD_VHOST&quot;, &quot;src-queue&quot;: &quot;QUEUE_TO_MIGRATE&quot;,</span><br></span><span class="token-line" style="color:#393A34"><span class="token string" style="color:#e3116c">    &quot;dest-protocol&quot;: &quot;amqp091&quot;, &quot;dest-uri&quot;: &quot;amqp:///NEW_VHOST&quot;, &quot;dest-queue&quot;: &quot;QUEUE_TO_MIGRATE&quot;}&#x27;</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div></div><div role="tabpanel" class="tabItem_Ymn6" hidden=""><div class="language-PowerShell language-powershell codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-powershell codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">rabbitmqctl</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">bat set_parameter shovel migrate-QUEUE_TO_MIGRATE ^</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token string" style="color:#e3116c">&quot;{&quot;</span><span class="token string" style="color:#e3116c">&quot;src-protocol&quot;</span><span class="token string" style="color:#e3116c">&quot;: &quot;</span><span class="token string" style="color:#e3116c">&quot;amqp091&quot;</span><span class="token string" style="color:#e3116c">&quot;, &quot;</span><span class="token string" style="color:#e3116c">&quot;src-uri&quot;</span><span class="token string" style="color:#e3116c">&quot;: &quot;</span><span class="token string" style="color:#e3116c">&quot;amqp:///OLD_VHOST&quot;</span><span class="token string" style="color:#e3116c">&quot;, &quot;</span><span class="token string" style="color:#e3116c">&quot;src-queue&quot;</span><span class="token string" style="color:#e3116c">&quot;: &quot;</span><span class="token string" style="color:#e3116c">&quot;QUEUE_TO_MIGRATE&quot;</span><span class="token string" style="color:#e3116c">&quot;,</span><br></span><span class="token-line" style="color:#393A34"><span class="token string" style="color:#e3116c">    &quot;</span><span class="token string" style="color:#e3116c">&quot;dest-protocol&quot;</span><span class="token string" style="color:#e3116c">&quot;: &quot;</span><span class="token string" style="color:#e3116c">&quot;amqp091&quot;</span><span class="token string" style="color:#e3116c">&quot;, &quot;</span><span class="token string" style="color:#e3116c">&quot;dest-uri&quot;</span><span class="token string" style="color:#e3116c">&quot;: &quot;</span><span class="token string" style="color:#e3116c">&quot;amqp:///NEW_VHOST&quot;</span><span class="token string" style="color:#e3116c">&quot;, &quot;</span><span class="token string" style="color:#e3116c">&quot;dest-queue&quot;</span><span class="token string" style="color:#e3116c">&quot;: &quot;</span><span class="token string" style="color:#e3116c">&quot;QUEUE_TO_MIGRATE&quot;</span><span class="token string" style="color:#e3116c">&quot;}&quot;</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div></div></div></div>
<p>After the queue is drained, the shovel can be deleted:</p>
<div class="tabs-container tabList__CuJ"><ul role="tablist" aria-orientation="horizontal" class="tabs"><li role="tab" tabindex="0" aria-selected="true" class="tabs__item tabItem_LNqP tabs__item--active">bash</li><li role="tab" tabindex="-1" aria-selected="false" class="tabs__item tabItem_LNqP">PowerShell</li></ul><div class="margin-top--md"><div role="tabpanel" class="tabItem_Ymn6"><div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">rabbitmqctl delete_shovel migrate-QUEUE_TO_MIGRATE</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div></div><div role="tabpanel" class="tabItem_Ymn6" hidden=""><div class="language-PowerShell language-powershell codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-powershell codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">rabbitmqctl</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">bat delete_shovel shovel migrate-QUEUE_TO_MIGRATE</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div></div></div></div>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="migrate-in-place">Migrate Mirrored Classic Queues to Quorum Queues in Place<a href="#migrate-in-place" class="hash-link" aria-label="Direct link to Migrate Mirrored Classic Queues to Quorum Queues in Place" title="Direct link to Migrate Mirrored Classic Queues to Quorum Queues in Place">​</a></h2>
<p>Migrating this way trades uptime so that you can
complete the migration in an existing virtual host and cluster.</p>
<p>For each queue (or some group of queues) being migrated, it should be
possible to stop all the consumers and producers for the duration of the
migration.</p>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="preparing-producers-and-consumers">Preparing Producers and Consumers<a href="#preparing-producers-and-consumers" class="hash-link" aria-label="Direct link to Preparing Producers and Consumers" title="Direct link to Preparing Producers and Consumers">​</a></h3>
<p>All incompatible features should be cleaned up. In addition, every place where queues are being declared, it would be better to make the
<code>x-queue-type</code> argument configurable without changing the application code.</p>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="the-migration-steps">The Migration Steps<a href="#the-migration-steps" class="hash-link" aria-label="Direct link to The Migration Steps" title="Direct link to The Migration Steps">​</a></h3>
<ol>
<li>Stop the consumers and producers.</li>
<li>Shovel the messages to a new temporary queue.</li>
<li>Delete the old queue.</li>
<li>Create a new quorum queue with the same name as the original queue.</li>
<li>Shovel the contents of the temporary queue to the new quorum queue.</li>
<li>Configure the consumers to use <code>x-queue-type</code> of <code>quorum</code> and they can be started.</li>
</ol></div><footer class="theme-doc-footer docusaurus-mt-lg"><div class="row margin-top--sm theme-doc-footer-edit-meta-row"><div class="col"><a href="https://github.com/rabbitmq/rabbitmq-website/tree/main/versioned_docs/version-3.13/migrate-mcq-to-qq.md" target="_blank" rel="noopener noreferrer" class="theme-edit-this-page"><svg fill="currentColor" height="20" width="20" viewBox="0 0 40 40" class="iconEdit_Z9Sw" aria-hidden="true"><g><path d="m34.5 11.7l-3 3.1-6.3-6.3 3.1-3q0.5-0.5 1.2-0.5t1.1 0.5l3.9 3.9q0.5 0.4 0.5 1.1t-0.5 1.2z m-29.5 17.1l18.4-18.5 6.3 6.3-18.4 18.4h-6.3v-6.2z"></path></g></svg>Edit this page</a></div><div class="col lastUpdated_JAkA"></div></div></footer></article><nav class="pagination-nav docusaurus-mt-lg" aria-label="Docs pages"><a class="pagination-nav__link pagination-nav__link--prev" href="/rabbitmq-website/docs/3.13/ha"><div class="pagination-nav__sublabel">Previous</div><div class="pagination-nav__label">Mirrored Classic Queues</div></a><a class="pagination-nav__link pagination-nav__link--next" href="/rabbitmq-website/docs/3.13/ttl"><div class="pagination-nav__sublabel">Next</div><div class="pagination-nav__label">Time-to-Live and Expiration</div></a></nav></div></div><div class="col col--3"><div class="tableOfContents_bqdL thin-scrollbar theme-doc-toc-desktop"><ul class="table-of-contents table-of-contents__left-border"><li><a href="#how-to-detect-policies-that-enable-classic-queue-mirroring" class="table-of-contents__link toc-highlight">How to Detect Policies that Enable Classic Queue Mirroring</a></li><li><a href="#deciding-which-migration-route-to-take-compatibility-considerations" class="table-of-contents__link toc-highlight">Deciding which Migration Route to take: Compatibility Considerations</a></li><li><a href="#find-mcq" class="table-of-contents__link toc-highlight">Finding the Mirrored Classic Queues for Migration</a></li><li><a href="#mcq-changes-way-queue-is-used" class="table-of-contents__link toc-highlight">Mirrored Classic Queue Features that require Changes in the Way the Queue is Used</a><ul><li><a href="#priority-queues" class="table-of-contents__link toc-highlight">Priority Queues</a></li><li><a href="#queue-length-limit-overflow-set-to-reject-publish-dlx" class="table-of-contents__link toc-highlight">Queue Length Limit overflow set to <code>reject-publish-dlx</code></a></li><li><a href="#global-qos-for-consumers" class="table-of-contents__link toc-highlight">Global QoS for Consumers</a></li><li><a href="#x-cancel-on-ha-failover-for-consumers" class="table-of-contents__link toc-highlight"><code>x-cancel-on-ha-failover</code> for Consumers</a></li></ul></li><li><a href="#mcq-features-to-remove" class="table-of-contents__link toc-highlight">Mirrored Classic Queue Features that can be removed from Source Code or moved to a Policy</a><ul><li><a href="#lazy-queues" class="table-of-contents__link toc-highlight">Lazy Queues</a></li><li><a href="#transient-queues" class="table-of-contents__link toc-highlight">Transient Queues</a></li><li><a href="#exclusive-queues" class="table-of-contents__link toc-highlight">Exclusive Queues</a></li></ul></li><li><a href="#general-prerequisites-before-migrating-from-mirrored-classic-queues-to-quorum-queues" class="table-of-contents__link toc-highlight">General Prerequisites before Migrating from Mirrored Classic Queues to Quorum Queues</a></li><li><a href="#migrate-the-queues-by-virtual-host" class="table-of-contents__link toc-highlight">Migrate Mirrored Classic Queues to Quorum Queues by Virtual Host</a><ul><li><a href="#create-the-destination-virtual-host" class="table-of-contents__link toc-highlight">Create the Destination Virtual Host</a></li><li><a href="#create-the-federation-upstream" class="table-of-contents__link toc-highlight">Create the Federation Upstream</a></li><li><a href="#moving-definitions" class="table-of-contents__link toc-highlight">Moving Definitions</a></li><li><a href="#point-consumers-to-use-quorum-queues-in-the-new-virtual-host" class="table-of-contents__link toc-highlight">Point Consumers to use Quorum Queues in the New Virtual Host</a></li><li><a href="#update-the-producers-to-use-the-exchanges-in-the-new-virtual-host" class="table-of-contents__link toc-highlight">Update the Producers to Use the Exchanges in the new Virtual Host</a></li><li><a href="#shovel-remaining-messages" class="table-of-contents__link toc-highlight">Shovel Remaining Messages to the New Virtual Host</a></li></ul></li><li><a href="#migrate-in-place" class="table-of-contents__link toc-highlight">Migrate Mirrored Classic Queues to Quorum Queues in Place</a><ul><li><a href="#preparing-producers-and-consumers" class="table-of-contents__link toc-highlight">Preparing Producers and Consumers</a></li><li><a href="#the-migration-steps" class="table-of-contents__link toc-highlight">The Migration Steps</a></li></ul></li></ul></div></div></div></div></main></div></div></div><footer class="footer footer--dark"><div class="container container-fluid"><div class="row footer__links"><div class="col footer__col"><div class="footer__title">Learn about RabbitMQ</div><ul class="footer__items clean-list"><li class="footer__item"><a class="footer__link-item" href="/rabbitmq-website/tutorials">Getting Started</a></li><li class="footer__item"><a class="footer__link-item" href="/rabbitmq-website/docs">Documentation</a></li><li class="footer__item"><a class="footer__link-item" href="/rabbitmq-website/blog">Blog</a></li></ul></div><div class="col footer__col"><div class="footer__title">Reach out to the RabbitMQ team</div><ul class="footer__items clean-list"><li class="footer__item"><a href="https://github.com/rabbitmq" target="_blank" rel="noopener noreferrer" class="footer__link-item">GitHub<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_nPIU"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a></li><li class="footer__item"><a href="https://github.com/rabbitmq/rabbitmq-server/discussions" target="_blank" rel="noopener noreferrer" class="footer__link-item">GitHub Discussions<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_nPIU"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a></li><li class="footer__item"><a class="footer__link-item" href="/rabbitmq-website/contact?utm_source=rmq_release-information_tableheader&amp;utm_medium=rmq_website&amp;utm_campaign=tanzu">Long Term Commercial Support</a></li><li class="footer__item"><a class="footer__link-item" href="/rabbitmq-website/contact">Contact Us</a></li><li class="footer__item"><a href="https://www.rabbitmq.com/discord" target="_blank" rel="noopener noreferrer" class="footer__link-item">Discord<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_nPIU"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a></li></ul></div><div class="col footer__col"><div class="footer__title">Broadcom</div><ul class="footer__items clean-list"><li class="footer__item"><a href="https://tanzu.vmware.com/" target="_blank" rel="noopener noreferrer" class="footer__link-item">VMware Tanzu<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_nPIU"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a></li><li class="footer__item"><a href="https://www.vmware.com/help/legal.html" target="_blank" rel="noopener noreferrer" class="footer__link-item">Terms of Use<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_nPIU"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a></li><li class="footer__item"><a href="https://www.vmware.com/help/privacy.html" target="_blank" rel="noopener noreferrer" class="footer__link-item">Privacy<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_nPIU"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a></li><li class="footer__item"><a class="footer__link-item" href="/rabbitmq-website/trademark-guidelines">Trademark Guidelines</a></li><li class="footer__item"><a href="https://www.vmware.com/help/privacy/california-privacy-rights.html" target="_blank" rel="noopener noreferrer" class="footer__link-item">Your California Privacy Rights<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_nPIU"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a></li><li class="footer__item"><a class="footer__link-item ot-sdk-show-settings">Cookie Settings</a></li></ul></div></div><div class="footer__bottom text--center"><div class="footer__copyright">Copyright © 2005-2025 Broadcom. All Rights Reserved. The term "Broadcom" refers to Broadcom Inc. and/or its subsidiaries.</div></div></div></footer></div>
</body>
</html>
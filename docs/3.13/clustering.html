<!doctype html>
<html lang="en" dir="ltr" class="docs-wrapper plugin-docs plugin-id-default docs-version-3.13 docs-doc-page docs-doc-id-clustering" data-has-hydrated="false">
<head>
<meta charset="UTF-8">
<meta name="generator" content="Docusaurus v3.7.0">
<title data-rh="true">Clustering Guide | RabbitMQ</title><meta data-rh="true" name="viewport" content="width=device-width,initial-scale=1"><meta data-rh="true" name="twitter:card" content="summary_large_image"><meta data-rh="true" property="og:image" content="https://www.rabbitmq.com/rabbitmq-website/img/rabbitmq-social-media-card.svg"><meta data-rh="true" name="twitter:image" content="https://www.rabbitmq.com/rabbitmq-website/img/rabbitmq-social-media-card.svg"><meta data-rh="true" property="og:url" content="https://www.rabbitmq.com/rabbitmq-website/docs/3.13/clustering"><meta data-rh="true" property="og:locale" content="en"><meta data-rh="true" name="docusaurus_locale" content="en"><meta data-rh="true" name="docsearch:language" content="en"><meta data-rh="true" name="docusaurus_version" content="3.13"><meta data-rh="true" name="docusaurus_tag" content="docs-default-3.13"><meta data-rh="true" name="docsearch:version" content="3.13"><meta data-rh="true" name="docsearch:docusaurus_tag" content="docs-default-3.13"><meta data-rh="true" property="og:title" content="Clustering Guide | RabbitMQ"><meta data-rh="true" name="description" content="&lt;!--"><meta data-rh="true" property="og:description" content="&lt;!--"><link data-rh="true" rel="icon" href="/rabbitmq-website/img/rabbitmq-logo.svg"><link data-rh="true" rel="canonical" href="https://www.rabbitmq.com/rabbitmq-website/docs/3.13/clustering"><link data-rh="true" rel="alternate" href="https://www.rabbitmq.com/rabbitmq-website/docs/3.13/clustering" hreflang="en"><link data-rh="true" rel="alternate" href="https://www.rabbitmq.com/rabbitmq-website/docs/3.13/clustering" hreflang="x-default"><link data-rh="true" rel="preconnect" href="https://H10VQIW16Y-dsn.algolia.net" crossorigin="anonymous"><link rel="alternate" type="application/rss+xml" href="/rabbitmq-website/blog/rss.xml" title="RabbitMQ RSS Feed">
<link rel="alternate" type="application/atom+xml" href="/rabbitmq-website/blog/atom.xml" title="RabbitMQ Atom Feed">




<link rel="search" type="application/opensearchdescription+xml" title="RabbitMQ" href="/rabbitmq-website/opensearch.xml">







<link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Raleway:400,700">
<script src="https://cdn.cookielaw.org/scripttemplates/otSDKStub.js" data-domain-script="018ee308-473e-754f-b0c2-cbe82d25512f"></script>
<script>function OptanonWrapper(){}</script>
<script>function setGTM(e,t,o,n,r){e[n]=e[n]||[],e[n].push({"gtm.start":(new Date).getTime(),event:"gtm.js"});var i=t.getElementsByTagName(o)[0],a=t.createElement(o),s="dataLayer"!=n?"&l="+n:"";a.async=!0,a.src="https://www.googletagmanager.com/gtm.js?id="+r+s,i.parentNode.insertBefore(a,i)}var timer;function waitForOnetrustActiveGroups(){document.cookie.indexOf("OptanonConsent")>-1&&document.cookie.indexOf("groups=")>-1?(clearTimeout(timer),setGTM(window,document,"script","dataLayer","GTM-TT84L8K")):timer=setTimeout(waitForOnetrustActiveGroups,250)}document.cookie.indexOf("OptanonConsent")>-1&&document.cookie.indexOf("groups=")>-1?setGTM(window,document,"script","dataLayer","GTM-TT84L8K"):waitForOnetrustActiveGroups()</script><link rel="stylesheet" href="/rabbitmq-website/styles.css">
<script src="/rabbitmq-website/runtime~main.js" defer="defer"></script>
<script src="/rabbitmq-website/main.js" defer="defer"></script>
</head>
<body class="navigation-with-keyboard">
<script>!function(){function t(t){document.documentElement.setAttribute("data-theme",t)}var e=function(){try{return new URLSearchParams(window.location.search).get("docusaurus-theme")}catch(t){}}()||function(){try{return window.localStorage.getItem("theme")}catch(t){}}();null!==e?t(e):window.matchMedia("(prefers-color-scheme: dark)").matches?t("dark"):(window.matchMedia("(prefers-color-scheme: light)").matches,t("light"))}(),function(){try{const n=new URLSearchParams(window.location.search).entries();for(var[t,e]of n)if(t.startsWith("docusaurus-data-")){var a=t.replace("docusaurus-data-","data-");document.documentElement.setAttribute(a,e)}}catch(t){}}(),document.documentElement.setAttribute("data-announcement-bar-initially-dismissed",function(){try{return"true"===localStorage.getItem("docusaurus.announcement.dismiss")}catch(t){}return!1}())</script><div id="__docusaurus"><div role="region" aria-label="Skip to main content"><a class="skipToContent_fXgn" href="#__docusaurus_skipToContent_fallback">Skip to main content</a></div><div class="announcementBar_mb4j" style="background-color:var(--ifm-color-primary-contrast-background);color:var(--ifm-font-color-base)" role="banner"><div class="announcementBarPlaceholder_vyr4"></div><div class="content_knG7 announcementBarContent_xLdY"><strong style="font-size: var(--ifm-h4-font-size);"><a href="https://github.com/rabbitmq/rabbitmq-server/releases/tag/v4.1.0">RabbitMQ 4.1.0 is out</a></strong></div><button type="button" aria-label="Close" class="clean-btn close closeButton_CVFx announcementBarClose_gvF7"><svg viewBox="0 0 15 15" width="14" height="14"><g stroke="currentColor" stroke-width="3.1"><path d="M.75.75l13.5 13.5M14.25.75L.75 14.25"></path></g></svg></button></div><nav aria-label="Main" class="navbar navbar--fixed-top"><div class="navbar__inner"><div class="navbar__items"><button aria-label="Toggle navigation bar" aria-expanded="false" class="navbar__toggle clean-btn" type="button"><svg width="30" height="30" viewBox="0 0 30 30" aria-hidden="true"><path stroke="currentColor" stroke-linecap="round" stroke-miterlimit="10" stroke-width="2" d="M4 7h22M4 15h22M4 23h22"></path></svg></button><a class="navbar__brand" href="/rabbitmq-website/"><div class="navbar__logo"><img src="/rabbitmq-website/img/rabbitmq-logo-with-name.svg" alt="RabbitMQ" class="themedComponent_mlkZ themedComponent--light_NVdE"><img src="/rabbitmq-website/img/rabbitmq-logo-with-name.svg" alt="RabbitMQ" class="themedComponent_mlkZ themedComponent--dark_xIcU"></div></a><a class="navbar__item navbar__link" href="/rabbitmq-website/tutorials">Getting Started</a><a aria-current="page" class="navbar__item navbar__link navbar__link--active" href="/rabbitmq-website/docs/3.13">Docs</a><a class="navbar__item navbar__link" href="/rabbitmq-website/blog">Blog</a><a class="navbar__item navbar__link" href="/rabbitmq-website/contact">Support</a></div><div class="navbar__items navbar__items--right"><div class="navbar__item dropdown dropdown--hoverable dropdown--right"><a aria-current="page" class="navbar__link active" aria-haspopup="true" aria-expanded="false" role="button" href="/rabbitmq-website/docs/3.13/clustering">3.13</a><ul class="dropdown__menu"><li class=""><strong>Release series</strong></li><li><a class="dropdown__link" href="/rabbitmq-website/docs/next/clustering">Next</a></li><li><a class="dropdown__link" href="/rabbitmq-website/docs/clustering">4.1</a></li><li><a class="dropdown__link" href="/rabbitmq-website/docs/4.0/clustering">4.0</a></li><li><a aria-current="page" class="dropdown__link dropdown__link--active" href="/rabbitmq-website/docs/3.13/clustering">3.13</a></li><li><a href="https://v3-12.rabbitmq.com/documentation.html" target="_blank" rel="noopener noreferrer" class="dropdown__link">3.12<svg width="12" height="12" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_nPIU"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a></li><li><a class="dropdown__link" href="/rabbitmq-website/release-information">Release Information</a></li></ul></div><a href="https://github.com/rabbitmq/rabbitmq-website" target="_blank" rel="noopener noreferrer" class="navbar__item navbar__link">GitHub<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_nPIU"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a><div class="toggle_vylO colorModeToggle_DEke"><button class="clean-btn toggleButton_gllP toggleButtonDisabled_aARS" type="button" disabled="" title="Switch between dark and light mode (currently light mode)" aria-label="Switch between dark and light mode (currently light mode)" aria-live="polite" aria-pressed="false"><svg viewBox="0 0 24 24" width="24" height="24" class="lightToggleIcon_pyhR"><path fill="currentColor" d="M12,9c1.65,0,3,1.35,3,3s-1.35,3-3,3s-3-1.35-3-3S10.35,9,12,9 M12,7c-2.76,0-5,2.24-5,5s2.24,5,5,5s5-2.24,5-5 S14.76,7,12,7L12,7z M2,13l2,0c0.55,0,1-0.45,1-1s-0.45-1-1-1l-2,0c-0.55,0-1,0.45-1,1S1.45,13,2,13z M20,13l2,0c0.55,0,1-0.45,1-1 s-0.45-1-1-1l-2,0c-0.55,0-1,0.45-1,1S19.45,13,20,13z M11,2v2c0,0.55,0.45,1,1,1s1-0.45,1-1V2c0-0.55-0.45-1-1-1S11,1.45,11,2z M11,20v2c0,0.55,0.45,1,1,1s1-0.45,1-1v-2c0-0.55-0.45-1-1-1C11.45,19,11,19.45,11,20z M5.99,4.58c-0.39-0.39-1.03-0.39-1.41,0 c-0.39,0.39-0.39,1.03,0,1.41l1.06,1.06c0.39,0.39,1.03,0.39,1.41,0s0.39-1.03,0-1.41L5.99,4.58z M18.36,16.95 c-0.39-0.39-1.03-0.39-1.41,0c-0.39,0.39-0.39,1.03,0,1.41l1.06,1.06c0.39,0.39,1.03,0.39,1.41,0c0.39-0.39,0.39-1.03,0-1.41 L18.36,16.95z M19.42,5.99c0.39-0.39,0.39-1.03,0-1.41c-0.39-0.39-1.03-0.39-1.41,0l-1.06,1.06c-0.39,0.39-0.39,1.03,0,1.41 s1.03,0.39,1.41,0L19.42,5.99z M7.05,18.36c0.39-0.39,0.39-1.03,0-1.41c-0.39-0.39-1.03-0.39-1.41,0l-1.06,1.06 c-0.39,0.39-0.39,1.03,0,1.41s1.03,0.39,1.41,0L7.05,18.36z"></path></svg><svg viewBox="0 0 24 24" width="24" height="24" class="darkToggleIcon_wfgR"><path fill="currentColor" d="M9.37,5.51C9.19,6.15,9.1,6.82,9.1,7.5c0,4.08,3.32,7.4,7.4,7.4c0.68,0,1.35-0.09,1.99-0.27C17.45,17.19,14.93,19,12,19 c-3.86,0-7-3.14-7-7C5,9.07,6.81,6.55,9.37,5.51z M12,3c-4.97,0-9,4.03-9,9s4.03,9,9,9s9-4.03,9-9c0-0.46-0.04-0.92-0.1-1.36 c-0.98,1.37-2.58,2.26-4.4,2.26c-2.98,0-5.4-2.42-5.4-5.4c0-1.81,0.89-3.42,2.26-4.4C12.92,3.04,12.46,3,12,3L12,3z"></path></svg></button></div><div class="navbarSearchContainer_Bca1"><button type="button" class="DocSearch DocSearch-Button" aria-label="Search (Command+K)"><span class="DocSearch-Button-Container"><svg width="20" height="20" class="DocSearch-Search-Icon" viewBox="0 0 20 20" aria-hidden="true"><path d="M14.386 14.386l4.0877 4.0877-4.0877-4.0877c-2.9418 2.9419-7.7115 2.9419-10.6533 0-2.9419-2.9418-2.9419-7.7115 0-10.6533 2.9418-2.9419 7.7115-2.9419 10.6533 0 2.9419 2.9418 2.9419 7.7115 0 10.6533z" stroke="currentColor" fill="none" fill-rule="evenodd" stroke-linecap="round" stroke-linejoin="round"></path></svg><span class="DocSearch-Button-Placeholder">Search</span></span><span class="DocSearch-Button-Keys"></span></button></div></div></div><div role="presentation" class="navbar-sidebar__backdrop"></div></nav><div id="__docusaurus_skipToContent_fallback" class="main-wrapper mainWrapper_z2l0"><div class="docsWrapper_hBAB"><button aria-label="Scroll back to top" class="clean-btn theme-back-to-top-button backToTopButton_sjWU" type="button"></button><div class="docRoot_UBD9"><aside class="theme-doc-sidebar-container docSidebarContainer_YfHR"><div class="sidebarViewport_aRkj"><div class="sidebar_njMd"><nav aria-label="Docs sidebar" class="menu thin-scrollbar menu_SIkG menuWithAnnouncementBar_GW3s"><ul class="theme-doc-sidebar-menu menu__list"><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/rabbitmq-website/docs/3.13">Introduction</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/rabbitmq-website/docs/3.13/whats-new">What&#x27;s New</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/rabbitmq-website/tutorials">Getting Started</a></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist" href="/rabbitmq-website/docs/3.13/download">Install and Upgrade</a><button aria-label="Expand sidebar category &#x27;Install and Upgrade&#x27;" aria-expanded="false" type="button" class="clean-btn menu__caret"></button></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist" href="/rabbitmq-website/docs/3.13/use-rabbitmq">How to Use RabbitMQ</a><button aria-label="Expand sidebar category &#x27;How to Use RabbitMQ&#x27;" aria-expanded="false" type="button" class="clean-btn menu__caret"></button></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--active" href="/rabbitmq-website/docs/3.13/manage-rabbitmq">How to Manage RabbitMQ</a><button aria-label="Collapse sidebar category &#x27;How to Manage RabbitMQ&#x27;" aria-expanded="true" type="button" class="clean-btn menu__caret"></button></div><ul style="display:block;overflow:visible;height:auto" class="menu__list"><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/rabbitmq-website/docs/3.13/cli">CLI</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/rabbitmq-website/docs/3.13/configure">Configuration</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/rabbitmq-website/docs/3.13/relocate">File and Directory Locations</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/rabbitmq-website/docs/3.13/logging">Logging</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/rabbitmq-website/docs/3.13/vhosts">Virtual Hosts</a></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-2 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist" tabindex="0" href="/rabbitmq-website/docs/3.13/access-control"> Authentication and Authorization</a><button aria-label="Expand sidebar category &#x27; Authentication and Authorization&#x27;" aria-expanded="false" type="button" class="clean-btn menu__caret"></button></div></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/rabbitmq-website/docs/3.13/parameters">Policies and Runtime Parameters</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/rabbitmq-website/docs/3.13/definitions">Schema Definitions</a></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-2 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist" tabindex="0" href="/rabbitmq-website/docs/3.13/networking">Networking</a><button aria-label="Expand sidebar category &#x27;Networking&#x27;" aria-expanded="false" type="button" class="clean-btn menu__caret"></button></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-2 menu__list-item"><div class="menu__list-item-collapsible menu__list-item-collapsible--active"><a class="menu__link menu__link--sublist menu__link--active" aria-current="page" tabindex="0" href="/rabbitmq-website/docs/3.13/clustering">Clustering</a><button aria-label="Collapse sidebar category &#x27;Clustering&#x27;" aria-expanded="true" type="button" class="clean-btn menu__caret"></button></div><ul style="display:block;overflow:visible;height:auto" class="menu__list"><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class="menu__link" tabindex="0" href="/rabbitmq-website/docs/3.13/cluster-formation">Cluster Formation</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class="menu__link" tabindex="0" href="/rabbitmq-website/docs/3.13/partitions">Network Partitions</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class="menu__link" tabindex="0" href="/rabbitmq-website/docs/3.13/clustering-ssl">Using TLS for Inter-node Traffic</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class="menu__link" tabindex="0" href="/rabbitmq-website/docs/3.13/ec2">RabbitMQ on Amazon EC2</a></li></ul></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-2 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret" role="button" aria-expanded="false" tabindex="0" href="/rabbitmq-website/docs/3.13/memory-use">Resource Management</a></div></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/rabbitmq-website/docs/3.13/backup">Backup and Restore</a></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-2 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret" role="button" aria-expanded="false" tabindex="0" href="/rabbitmq-website/docs/3.13/runtime">Tuning</a></div></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/rabbitmq-website/docs/3.13/production-checklist">Deployment Guidelines</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/rabbitmq-website/kubernetes/operator/operator-overview">RabbitMQ on Kubernetes</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/rabbitmq-website/docs/3.13/troubleshooting">Troubleshooting RabbitMQ</a></li></ul></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist" href="/rabbitmq-website/docs/3.13/monitoring">How to Monitor RabbitMQ</a><button aria-label="Expand sidebar category &#x27;How to Monitor RabbitMQ&#x27;" aria-expanded="false" type="button" class="clean-btn menu__caret"></button></div></li></ul></nav></div></div></aside><main class="docMainContainer_TBSr"><div class="container padding-top--md padding-bottom--lg"><div class="row"><div class="col docItemCol_VOVn"><div class="theme-doc-version-banner alert alert--warning margin-bottom--md" role="alert"><div>This is documentation for <!-- -->RabbitMQ<!-- --> <b>3.13</b>, which is no longer actively maintained.</div><div class="margin-top--md">For up-to-date documentation, see the <b><a href="/rabbitmq-website/docs/clustering">latest version</a></b> (<!-- -->4.1<!-- -->).</div></div><div class="docItemContainer_Djhp"><article><nav class="theme-doc-breadcrumbs breadcrumbsContainer_Z_bl" aria-label="Breadcrumbs"><ul class="breadcrumbs" itemscope="" itemtype="https://schema.org/BreadcrumbList"><li class="breadcrumbs__item"><a aria-label="Home page" class="breadcrumbs__link" href="/rabbitmq-website/"><svg viewBox="0 0 24 24" class="breadcrumbHomeIcon_YNFT"><path d="M10 19v-5h4v5c0 .55.45 1 1 1h3c.55 0 1-.45 1-1v-7h1.7c.46 0 .68-.57.33-.87L12.67 3.6c-.38-.34-.96-.34-1.34 0l-8.36 7.53c-.34.3-.13.87.33.87H5v7c0 .55.45 1 1 1h3c.55 0 1-.45 1-1z" fill="currentColor"></path></svg></a></li><li itemscope="" itemprop="itemListElement" itemtype="https://schema.org/ListItem" class="breadcrumbs__item"><a class="breadcrumbs__link" itemprop="item" href="/rabbitmq-website/docs/3.13/manage-rabbitmq"><span itemprop="name">How to Manage RabbitMQ</span></a><meta itemprop="position" content="1"></li><li itemscope="" itemprop="itemListElement" itemtype="https://schema.org/ListItem" class="breadcrumbs__item breadcrumbs__item--active"><span class="breadcrumbs__link" itemprop="name">Clustering</span><meta itemprop="position" content="2"></li></ul></nav><span class="theme-doc-version-badge badge badge--secondary">Version: 3.13</span><div class="tocCollapsible_ETCw theme-doc-toc-mobile tocMobile_ITEo"><button type="button" class="clean-btn tocCollapsibleButton_TO0P">On this page</button></div><div class="theme-doc-markdown markdown"><header><h1>Clustering Guide</h1></header>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="overview">Overview<a href="#overview" class="hash-link" aria-label="Direct link to Overview" title="Direct link to Overview">​</a></h2>
<p>This guide covers fundamental topics related to RabbitMQ clustering:</p>
<ul>
<li>How RabbitMQ nodes are identified: <a href="#node-names">node names</a></li>
<li><a href="#cluster-formation-requirements">Requirements</a> for clustering</li>
<li>What data is and isn&#x27;t <a href="#cluster-membership">replicated between cluster nodes</a></li>
<li>What clustering <a href="#clustering-and-clients">means for clients</a></li>
<li><a href="#cluster-formation">How clusters are formed</a></li>
<li>How nodes <a href="#erlang-cookie">authenticate to each other</a> (and with CLI tools)</li>
<li>Why it&#x27;s important to <a href="#node-count">use an odd number of nodes</a> and <strong>two-cluster nodes are strongly discouraged</strong></li>
<li><a href="#replica-placement">Queue and stream leader replica placement</a> strategies</li>
<li><a href="#restarting">Node restarts</a> and how nodes rejoin their cluster</li>
<li><a href="#restarting-readiness-probes">Node readiness probes</a> and how they can affect rolling cluster restarts</li>
<li>How to <a href="#removing-nodes">remove a cluster node</a></li>
<li>How to <a href="#resetting-nodes">reset a cluster node</a> to a pristine (blank) state</li>
</ul>
<p>and more. <a href="/rabbitmq-website/docs/3.13/cluster-formation">Cluster Formation and Peer Discovery</a> is a closely related guide
that focuses on peer discovery and cluster formation automation-related topics. For queue contents
(message) replication, see the <a href="/rabbitmq-website/docs/3.13/quorum-queues">Quorum Queues</a> guide.</p>
<p><a href="https://docs.vmware.com/en/VMware-RabbitMQ-for-Kubernetes/index.html" target="_blank" rel="noopener noreferrer">VMware Tanzu RabbitMQ</a> provides an <a href="https://docs.vmware.com/en/VMware-Tanzu-RabbitMQ-for-Kubernetes/3.13/tanzu-rabbitmq-kubernetes/clustering-compression-rabbitmq.html" target="_blank" rel="noopener noreferrer">Intra-cluster Compression</a> feature.</p>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="what-is-a-cluster">What is a Cluster?<a href="#what-is-a-cluster" class="hash-link" aria-label="Direct link to What is a Cluster?" title="Direct link to What is a Cluster?">​</a></h2>
<p>A RabbitMQ cluster is a logical grouping of one or more (three, five, seven, or more) nodes,
each sharing users, virtual hosts, queues, streams, exchanges, bindings, runtime parameters and other distributed state.</p>
<p>For a cluster to be formed, nodes must be configured in a certain way and satisfy
a number of <a href="#cluster-formation-requirements">requirements</a> such as open port access.</p>
<p>After cluster formation, all nodes in a cluster are aware of other cluster members.</p>
<p>Client applications can be aware or not be aware of the fact that there are multiple cluster nodes,
and connect to any of them, or, depending on the protocol used, a subset of them. For example,
RabbitMQ Stream Protocol clients <a href="https://www.rabbitmq.com/blog/2021/07/23/connecting-to-streams" target="_blank" rel="noopener noreferrer">can connect to multiple nodes at once</a>.
This is covered in more details <a href="#clustering-and-clients">later in this guide</a>.</p>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="cluster-formation">Cluster Formation<a href="#cluster-formation" class="hash-link" aria-label="Direct link to Cluster Formation" title="Direct link to Cluster Formation">​</a></h2>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="cluster-formation-options">Ways of Forming a Cluster<a href="#cluster-formation-options" class="hash-link" aria-label="Direct link to Ways of Forming a Cluster" title="Direct link to Ways of Forming a Cluster">​</a></h3>
<p>A RabbitMQ cluster can be formed in a number of ways:</p>
<ul>
<li>Declaratively by listing cluster nodes in <a href="/rabbitmq-website/docs/3.13/configure">config file</a></li>
<li>Declaratively using DNS-based discovery</li>
<li>Declaratively using <a href="https://github.com/rabbitmq/rabbitmq-server/tree/main/deps/rabbitmq_peer_discovery_aws" target="_blank" rel="noopener noreferrer">AWS (EC2) instance discovery</a> (via a plugin)</li>
<li>Declaratively using <a href="https://github.com/rabbitmq/rabbitmq-server/tree/main/deps/rabbitmq_peer_discovery_k8s" target="_blank" rel="noopener noreferrer">Kubernetes discovery</a> (via a plugin)</li>
<li>Declaratively using <a href="https://github.com/rabbitmq/rabbitmq-server/tree/main/deps/rabbitmq_peer_discovery_consul" target="_blank" rel="noopener noreferrer">Consul-based discovery</a> (via a plugin)</li>
<li>Declaratively using <a href="https://github.com/rabbitmq/rabbitmq-server/tree/main/deps/rabbitmq_peer_discovery_etcd" target="_blank" rel="noopener noreferrer">etcd-based discovery</a> (via a plugin)</li>
<li>Manually with <code>rabbitmqctl</code></li>
</ul>
<p>These mechanisms are covered in more details in the <a href="/rabbitmq-website/docs/3.13/cluster-formation">Cluster Formation guide</a>.</p>
<p>The composition of a cluster can be altered dynamically.
All RabbitMQ brokers start out as running on a single
node. These nodes can be joined into clusters, and
subsequently turned back into individual brokers again.</p>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="node-names">Node Names (Identifiers)<a href="#node-names" class="hash-link" aria-label="Direct link to Node Names (Identifiers)" title="Direct link to Node Names (Identifiers)">​</a></h3>
<p>RabbitMQ nodes are identified by node names. A node name consists of two parts,
a prefix (usually <code>rabbit</code>) and hostname. For example, <code>rabbit@node1.messaging.svc.local</code>
is a node name with the prefix of <code>rabbit</code> and hostname of <code>node1.messaging.svc.local</code>.</p>
<p>Node names in a cluster must be unique. If more than one node is running on a given host
(this is usually the case in development and QA environments), they must use
different prefixes, e.g. <code>rabbit1@hostname</code> and <code>rabbit2@hostname</code>.</p>
<p>In a cluster, nodes identify and contact each other using node names. This means
that the hostname part of every node name <a href="#hostname-resolution-requirement">must resolve</a>.
<a href="/rabbitmq-website/docs/3.13/cli">CLI tools</a> also identify and address nodes using node names.</p>
<p>When a node starts up, it checks whether it has been assigned a node name. This is done
via the <code>RABBITMQ_NODENAME</code> <a href="/rabbitmq-website/docs/3.13/configure#supported-environment-variables">environment variable</a>.
If no value was explicitly configured,
the node resolves its hostname and prepends <code>rabbit</code> to it to compute its node name.</p>
<p>If a system uses fully qualified domain names (FQDNs) for hostnames, RabbitMQ nodes
and CLI tools must be configured to use so called long node names.
For server nodes this is done by setting the <code>RABBITMQ_USE_LONGNAME</code> <a href="/rabbitmq-website/docs/3.13/configure#supported-environment-variables">environment variable</a>
to <code>true</code>.</p>
<p>For CLI tools, either <code>RABBITMQ_USE_LONGNAME</code> must be set or the <code>--longnames</code> option
must be specified.</p>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="cluster-formation-requirements">Cluster Formation Requirements<a href="#cluster-formation-requirements" class="hash-link" aria-label="Direct link to Cluster Formation Requirements" title="Direct link to Cluster Formation Requirements">​</a></h2>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="hostname-resolution-requirement">Hostname Resolution<a href="#hostname-resolution-requirement" class="hash-link" aria-label="Direct link to Hostname Resolution" title="Direct link to Hostname Resolution">​</a></h3>
<p>RabbitMQ nodes address each other using a <strong>node name</strong>, a combination
of a prefix and domain name, either short or fully-qualified (FQDNs).</p>
<p>Therefore every cluster member <strong>must be able to resolve hostnames
of every other cluster member</strong>, its own hostname, as well
as machines on which command line tools such as <code>rabbitmqctl</code>
might be used.</p>
<p>Nodes will perform hostname resolution early on node boot.
In container-based environments it is important that hostname
resolution is ready before the container is started.
For Kubernetes users, this means the <a href="https://kubernetes.io/docs/concepts/workloads/controllers/statefulset/#stable-network-id" target="_blank" rel="noopener noreferrer">DNS cache interval for CoreDNS</a>
to a value in the 5-10 second range.</p>
<p>Hostname resolution can use any of the standard OS-provided
methods:</p>
<ul>
<li>DNS records</li>
<li>Local host files (e.g. <code>/etc/hosts</code>)</li>
</ul>
<p>In more restrictive environments, where DNS record or
hosts file modification is restricted, impossible or
undesired, <a href="http://erlang.org/doc/apps/erts/inet_cfg.html">Erlang
VM can be configured to use alternative hostname
resolution methods</a>, such as an alternative DNS server,
a local file, a non-standard hosts file location, or a mix
of methods.  Those methods can work in concert with the
standard OS hostname resolution methods.</p>
<p>To use FQDNs, see <code>RABBITMQ_USE_LONGNAME</code> in the <a href="/rabbitmq-website/docs/3.13/configure#supported-environment-variables">Configuration guide</a>.
See <a href="#node-names">Node Names</a> above.</p>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="ports">Ports That Must Be Opened for Clustering and Replication<a href="#ports" class="hash-link" aria-label="Direct link to Ports That Must Be Opened for Clustering and Replication" title="Direct link to Ports That Must Be Opened for Clustering and Replication">​</a></h2>
<p>RabbitMQ nodes <a href="/rabbitmq-website/docs/3.13/networking#ports">bind to ports</a> (open server TCP sockets) in order to accept client and CLI tool connections.
Other processes and tools such as SELinux may prevent RabbitMQ from binding to a port. When that happens,
the node will fail to start.</p>
<p>CLI tools, client libraries and RabbitMQ nodes also open connections (client TCP sockets).
Firewalls can prevent nodes and CLI tools from communicating with each other.
The following ports are most relevant to inter-node communication in a cluster:</p>
<ul>
<li>4369: <a href="/rabbitmq-website/docs/3.13/networking#epmd">epmd</a>, a helper discovery daemon used by RabbitMQ nodes and CLI tools</li>
<li>6000 through 6500: used by <a href="/rabbitmq-website/docs/3.13/stream">RabbitMQ Stream</a> replication</li>
<li>25672: used for inter-node and CLI tools communication (Erlang distribution server port)
and is allocated from a dynamic range (limited to a single port by default,
computed as AMQP port + 20000). Unless external connections on these ports are really necessary (e.g.
the cluster uses <a href="/rabbitmq-website/docs/3.13/federation">federation</a> or CLI tools are used on machines outside the subnet),
these ports should not be publicly exposed. See <a href="/rabbitmq-website/docs/3.13/networking">networking guide</a> for details.</li>
<li>35672-35682: used by CLI tools (Erlang distribution client ports) for communication with nodes
and is allocated from a dynamic range (computed as server distribution port + 10000 through
server distribution port + 10010).</li>
</ul>
<p>It is possible to <a href="/rabbitmq-website/docs/3.13/configure">configure RabbitMQ</a>
to use different ports and specific network interfaces.
See <a href="/rabbitmq-website/docs/3.13/networking">RabbitMQ Networking guide</a> to learn more.</p>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="cluster-membership">Nodes in a Cluster<a href="#cluster-membership" class="hash-link" aria-label="Direct link to Nodes in a Cluster" title="Direct link to Nodes in a Cluster">​</a></h2>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="overview-what-is-replicated">What is Replicated?<a href="#overview-what-is-replicated" class="hash-link" aria-label="Direct link to What is Replicated?" title="Direct link to What is Replicated?">​</a></h3>
<p>All data/state required for the operation of a RabbitMQ
broker is replicated across all nodes. An exception to this
are message queues, which by default reside on one node,
though they are visible and reachable from all nodes. To
replicate queues across nodes in a cluster, use a queue type
that supports replication. This topic is covered in
the <a href="/rabbitmq-website/docs/3.13/quorum-queues">Quorum Queues</a> guide.</p>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="peer-equality">Nodes are Equal Peers<a href="#peer-equality" class="hash-link" aria-label="Direct link to Nodes are Equal Peers" title="Direct link to Nodes are Equal Peers">​</a></h3>
<p>Some distributed systems
have leader and follower nodes. This is generally not true for RabbitMQ.
All nodes in a RabbitMQ cluster are equal peers: there are no special nodes in RabbitMQ core.
This topic becomes more nuanced when <a href="/rabbitmq-website/docs/3.13/quorum-queues">quorum queues</a> and plugins
are taken into consideration but for most intents and purposes,
all cluster nodes should be considered equal.</p>
<p>Many <a href="/rabbitmq-website/docs/3.13/cli">CLI tool</a> operations can be executed against any node.
An <a href="/rabbitmq-website/docs/3.13/management">HTTP API</a> client can target any cluster node.</p>
<p>Individual plugins can designate (elect)
certain nodes to be &quot;special&quot; for a period of time. For example, <a href="/rabbitmq-website/docs/3.13/federation">federation links</a>
are colocated on a particular cluster node. Should that node fail, the links will
be restarted on a different node.</p>
<p>In older (long maintained) versions, <a href="/rabbitmq-website/docs/3.13/management">RabbitMQ management plugin</a> used
a dedicated node for stats collection and aggregation.</p>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="erlang-cookie">How CLI Tools Authenticate to Nodes (and Nodes to Each Other): the Erlang Cookie<a href="#erlang-cookie" class="hash-link" aria-label="Direct link to How CLI Tools Authenticate to Nodes (and Nodes to Each Other): the Erlang Cookie" title="Direct link to How CLI Tools Authenticate to Nodes (and Nodes to Each Other): the Erlang Cookie">​</a></h3>
<p>RabbitMQ nodes and CLI tools (e.g. <code>rabbitmqctl</code>) use a
cookie to determine whether they are allowed to communicate with
each other. For two nodes to be able to communicate they must have
the same shared secret called the Erlang cookie. The cookie is
just a string of alphanumeric characters up to 255 characters in size.
It is usually stored in a local file. The file must be only
accessible to the owner (e.g. have UNIX permissions of <code>600</code> or similar).
Every cluster node must have the same cookie.</p>
<p>If the file does not exist, Erlang VM will try to create
one with a randomly generated value when the RabbitMQ server
starts up. Using such generated cookie files are appropriate in development
environments only. Since each node will generate its own value independently,
this strategy is not really viable in a <a href="/rabbitmq-website/docs/3.13/clustering">clustered environment</a>.</p>
<p>Erlang cookie generation should be done at cluster deployment stage, ideally using automation
and orchestration tools.</p>
<p>In distributed deployment</p>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="cookie-file-locations">Cookie File Locations<a href="#cookie-file-locations" class="hash-link" aria-label="Direct link to Cookie File Locations" title="Direct link to Cookie File Locations">​</a></h3>
<h4 class="anchor anchorWithStickyNavbar_LWe7" id="linux-macos-bsd">Linux, MacOS, *BSD<a href="#linux-macos-bsd" class="hash-link" aria-label="Direct link to Linux, MacOS, *BSD" title="Direct link to Linux, MacOS, *BSD">​</a></h4>
<p>On UNIX systems, the cookie will be typically
located in <code>/var/lib/rabbitmq/.erlang.cookie</code> (used by the server)
and <code>$HOME/.erlang.cookie</code> (used by CLI tools). Note that since the value
of <code>$HOME</code> varies from user to user, it&#x27;s necessary to place a copy of
the cookie file for each user that will be using the CLI tools.
This applies to both non-privileged users and <code>root</code>.</p>
<p>RabbitMQ nodes will log its effective user&#x27;s home directory location early on boot.</p>
<h4 class="anchor anchorWithStickyNavbar_LWe7" id="community-docker-image-and-kubernetes">Community Docker Image and Kubernetes<a href="#community-docker-image-and-kubernetes" class="hash-link" aria-label="Direct link to Community Docker Image and Kubernetes" title="Direct link to Community Docker Image and Kubernetes">​</a></h4>
<p><a href="https://github.com/docker-library/rabbitmq/" target="_blank" rel="noopener noreferrer">Docker community RabbitMQ image</a> uses <code>RABBITMQ_ERLANG_COOKIE</code> environment variable value
to populate the cookie file.</p>
<p>Configuration management and container orchestration tools that use this image
must make sure that every RabbitMQ node container in a cluster uses the same value.</p>
<p>In the context of Kubernetes, the value must be specified in the pod template specification of
the <a href="https://kubernetes.io/docs/concepts/workloads/controllers/statefulset/" target="_blank" rel="noopener noreferrer">stateful set</a>.
For instance, this can be seen in the <a href="https://github.com/rabbitmq/diy-kubernetes-examples" target="_blank" rel="noopener noreferrer">RabbitMQ on Kubernetes examples repository</a>.</p>
<h4 class="anchor anchorWithStickyNavbar_LWe7" id="windows">Windows<a href="#windows" class="hash-link" aria-label="Direct link to Windows" title="Direct link to Windows">​</a></h4>
<p>On Windows, the cookie location depends on a few factors:</p>
<ul>
<li>Whether the <code>HOMEDRIVE</code> and <code>HOMEPATH</code> environment variables are both set</li>
<li>Erlang version: prior to 20.2 (these are no longer supported by any <a href="/rabbitmq-website/release-information">maintained release series of RabbitMQ</a>) or 20.2 and later</li>
</ul>
<h5 class="anchor anchorWithStickyNavbar_LWe7" id="erlang-202-or-later">Erlang 20.2 or later<a href="#erlang-202-or-later" class="hash-link" aria-label="Direct link to Erlang 20.2 or later" title="Direct link to Erlang 20.2 or later">​</a></h5>
<p>With Erlang versions starting with 20.2, the cookie file locations are:</p>
<ul>
<li><code>%HOMEDRIVE%%HOMEPATH%\.erlang.cookie</code> (usually <code>C:\Users\%USERNAME%\.erlang.cookie</code> for user <code>%USERNAME%</code>) if both the <code>HOMEDRIVE</code> and <code>HOMEPATH</code> environment variables are set</li>
<li><code>%USERPROFILE%\.erlang.cookie</code> (usually <code>C:\Users\%USERNAME%\.erlang.cookie</code>) if <code>HOMEDRIVE</code> and <code>HOMEPATH</code> are not both set</li>
<li>For the RabbitMQ Windows service - <code>%USERPROFILE%\.erlang.cookie</code> (usually <code>C:\WINDOWS\system32\config\systemprofile</code>)</li>
</ul>
<p>If the Windows service is used, the cookie should be copied from
<code>C:\Windows\system32\config\systemprofile\.erlang.cookie</code> to the expected
location for users running commands like <code>rabbitmqctl.bat</code>.</p>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="overriding-using-cli-and-runtime-command-line-arguments">Overriding Using CLI and Runtime Command Line Arguments<a href="#overriding-using-cli-and-runtime-command-line-arguments" class="hash-link" aria-label="Direct link to Overriding Using CLI and Runtime Command Line Arguments" title="Direct link to Overriding Using CLI and Runtime Command Line Arguments">​</a></h3>
<p>As an alternative, the option &quot;<code>-setcookie &lt;value&gt;</code>&quot; can be added
to <code>RABBITMQ_SERVER_ADDITIONAL_ERL_ARGS</code> <a href="./configure">environment variable value</a>
to override the cookie value used by a RabbitMQ node:</p>
<div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token assign-left variable" style="color:#36acaa">RABBITMQ_SERVER_ADDITIONAL_ERL_ARGS</span><span class="token operator" style="color:#393A34">=</span><span class="token string" style="color:#e3116c">&quot;-setcookie cookie-value&quot;</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>CLI tools can take a cookie value using a command line flag:</p>
<div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">rabbitmq-diagnostics status --erlang-cookie </span><span class="token string" style="color:#e3116c">&quot;cookie-value&quot;</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>Both are <strong>the least secure options</strong> and generally <strong>not recommended</strong>.</p>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="cookie-file-troubleshooting">Troubleshooting<a href="#cookie-file-troubleshooting" class="hash-link" aria-label="Direct link to Troubleshooting" title="Direct link to Troubleshooting">​</a></h3>
<p>When a node starts, it will <a href="/rabbitmq-website/docs/3.13/logging">log</a> the home directory location of its effective user:</p>
<div class="codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">node           : rabbit@cdbf4de5f22d</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">home dir       : /var/lib/rabbitmq</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>Unless any <a href="/rabbitmq-website/docs/3.13/relocate">server directories</a> were overridden, that&#x27;s the directory where
the cookie file will be looked for, and created by the node on first boot if it does not already exist.</p>
<p>In the example above, the cookie file location will be <code>/var/lib/rabbitmq/.erlang.cookie</code>.</p>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="peer-authentication-failures">Authentication Failures<a href="#peer-authentication-failures" class="hash-link" aria-label="Direct link to Authentication Failures" title="Direct link to Authentication Failures">​</a></h3>
<p>When the cookie is misconfigured (for example, not identical), RabbitMQ nodes will log errors
such as &quot;Connection attempt from disallowed node&quot;, &quot;&quot;, &quot;Could not auto-cluster&quot;.</p>
<p>For example, when a CLI tool connects and tries to authenticate using a mismatching secret value:</p>
<div class="codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">2020-06-15 13:03:33 [error] &lt;0.1187.0&gt; ** Connection attempt from node &#x27;rabbitmqcli-99391-rabbit@warp10&#x27; rejected. Invalid challenge reply. **</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>When a CLI tool such as <code>rabbitmqctl</code> fails to authenticate with RabbitMQ,
the message usually says</p>
<div class="codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">* epmd reports node &#x27;rabbit&#x27; running on port 25672</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">* TCP connection succeeded but Erlang distribution failed</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">* suggestion: hostname mismatch?</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">* suggestion: is the cookie set correctly?</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">* suggestion: is the Erlang distribution using TLS?</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>An incorrectly placed cookie file or cookie value mismatch are most common scenarios for such failures.</p>
<p>When a recent Erlang/OTP version is used, authentication failures contain
more information and cookie mismatches can be identified better:</p>
<div class="language-ini codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-ini codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">* connected to epmd (port 4369) on warp10</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">* epmd reports node &#x27;rabbit&#x27; running on port 25672</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">* TCP connection succeeded but Erlang distribution failed</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">* Authentication failed (rejected by the remote node), please check the Erlang cookie</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>See the <a href="/rabbitmq-website/docs/3.13/cli">CLI Tools guide</a> for more information.</p>
<h4 class="anchor anchorWithStickyNavbar_LWe7" id="hostname-resolution">Hostname Resolution<a href="#hostname-resolution" class="hash-link" aria-label="Direct link to Hostname Resolution" title="Direct link to Hostname Resolution">​</a></h4>
<p>Since hostname resolution is a <a href="#hostname-resolution-requirement">prerequisite for successful inter-node communication</a>,
starting with <a href="/rabbitmq-website/release-information">RabbitMQ <code>3.8.6</code></a>, CLI tools provide two commands that help verify
that hostname resolution on a node works as expected. The commands are not meant to replace
<a href="https://en.wikipedia.org/wiki/Dig_(command)" target="_blank" rel="noopener noreferrer"><code>dig</code></a> and other specialised DNS tools but rather
provide a way to perform most basic checks while taking <a href="https://erlang.org/doc/apps/erts/inet_cfg.html" target="_blank" rel="noopener noreferrer">Erlang runtime hostname resolver features</a>
into account.</p>
<p>The commands are covered in the <a href="/rabbitmq-website/docs/3.13/networking#dns-verify-resolution">Networking guide</a>.</p>
<h4 class="anchor anchorWithStickyNavbar_LWe7" id="cli-tools">CLI Tools<a href="#cli-tools" class="hash-link" aria-label="Direct link to CLI Tools" title="Direct link to CLI Tools">​</a></h4>
<p>Starting with <a href="/rabbitmq-website/release-information">version <code>3.8.6</code></a>, <code>rabbitmq-diagnostics</code> includes a command
that provides relevant information on the Erlang cookie file used by CLI tools:</p>
<div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">rabbitmq-diagnostics erlang_cookie_sources</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>The command will report on the effective user, user home directory and the expected location
of the cookie file:</p>
<div class="codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">Cookie File</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">Effective user: antares</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">Effective home directory: /home/cli-user</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">Cookie file path: /home/cli-user/.erlang.cookie</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">Cookie file exists? true</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">Cookie file type: regular</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">Cookie file access: read</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">Cookie file size: 20</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">Cookie CLI Switch</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">--erlang-cookie value set? false</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">--erlang-cookie value length: 0</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">Env variable  (Deprecated)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">RABBITMQ_ERLANG_COOKIE value set? false</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">RABBITMQ_ERLANG_COOKIE value length: 0</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="node-count">Node Counts and Quorum<a href="#node-count" class="hash-link" aria-label="Direct link to Node Counts and Quorum" title="Direct link to Node Counts and Quorum">​</a></h2>
<p>Because several features (e.g. <a href="/rabbitmq-website/docs/3.13/quorum-queues">quorum queues</a>, <a href="/rabbitmq-website/docs/3.13/mqtt">client tracking in MQTT</a>)
require a consensus between cluster members, odd numbers of cluster nodes are highly recommended:
1, 3, 5, 7 and so on.</p>
<p>Two node clusters are <strong>highly recommended against</strong> since it&#x27;s impossible for cluster nodes to identify
a majority and form a consensus in case of connectivity loss. For example, when the two nodes lose connectivity
MQTT client connections won&#x27;t be accepted, quorum queues would lose their availability, and so on.</p>
<p>From the consensus point of view, four or six node clusters would have the same availability
characteristics as three and five node clusters.</p>
<p>The <a href="/rabbitmq-website/docs/3.13/quorum-queues">Quorum Queues guide</a> covers this topic in more detail.</p>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="clustering-and-clients">Clustering and Clients<a href="#clustering-and-clients" class="hash-link" aria-label="Direct link to Clustering and Clients" title="Direct link to Clustering and Clients">​</a></h2>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="messaging-protocols">Messaging Protocols<a href="#messaging-protocols" class="hash-link" aria-label="Direct link to Messaging Protocols" title="Direct link to Messaging Protocols">​</a></h3>
<p>Assuming all cluster members
are available, a messaging (AMQP 0-9-1, AMQP 1.0, MQTT, STOMP) client can connect to any node and
perform any operation. Nodes will route operations to the
<a href="/rabbitmq-website/docs/3.13/quorum-queues">quorum queue leader</a> transparently to clients.</p>
<p>With all supported messaging protocols a client is only connected to one node
at a time.</p>
<p>In case of a node failure, clients should be able to reconnect
to a different node, recover their topology and continue operation. For
this reason, most client libraries accept a list of endpoints (hostnames or IP addresses)
as a connection option. The list of hosts will be used during initial connection
as well as connection recovery, if the client supports it. See documentation guides
for individual clients to learn more.</p>
<p>With <a href="/rabbitmq-website/docs/3.13/quorum-queues">quorum queues</a> and <a href="/rabbitmq-website/docs/3.13/streams">streams</a>, clients will only be able to perform
operations on queues that have a quorum of replicas online.</p>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="stream-clients">Stream Clients<a href="#stream-clients" class="hash-link" aria-label="Direct link to Stream Clients" title="Direct link to Stream Clients">​</a></h3>
<p>RabbitMQ Stream protocol clients <strong>behave differently from messaging protocols clients</strong>: they are
more cluster topology-aware. For publishing, they can connect to any node, and that node
will forward all relevant operations to the node that hosts the leader replica of the stream.</p>
<p>However, stream consumers should connect to one of the nodes hosting the replicas of
the target stream. The protocol includes a topology discovery operation, so well-behaved client
libraries will select one of the suitable nodes. This won&#x27;t be the case when a load balancer is used,
however.</p>
<p>See <a href="/rabbitmq-website/blog/2021/07/23/connecting-to-streams#well-behaved-clients">Connecting to Streams</a>
to learn more.</p>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="replica-placement">Queue and Stream Leader Replica Placement<a href="#replica-placement" class="hash-link" aria-label="Direct link to Queue and Stream Leader Replica Placement" title="Direct link to Queue and Stream Leader Replica Placement">​</a></h3>
<p>Every queue and stream in RabbitMQ has a primary replica (in case of classic queues,
it is the only replica). That replica is called
<em>the leader</em>. All publishing operations on queues and streams go through the leader
replica first and then are replicated to the followers (secondary replicas). This is necessary to
guarantee FIFO ordering of messages.</p>
<p>To avoid some nodes in a cluster hosting a significant majority of queue leader
replicas and thus handling most of the load, queue leaders should
be reasonably evenly distributed across cluster nodes.</p>
<p>Queue leader distribution can be controlled in three ways:</p>
<ol>
<li>a policy, by setting <code>queue-leader-locator</code></li>
<li><a href="/rabbitmq-website/docs/3.13/configure#configuration-files">the configuration file</a>, by setting <code>queue_leader_locator</code></li>
<li><a href="/rabbitmq-website/docs/3.13/queues#optional-arguments">optional queue argument</a>, by setting the <code>x-queue-leader-locator</code> (<a href="/rabbitmq-website/docs/3.13/parameters">not recommended</a>)</li>
</ol>
<p>There are two options available:</p>
<ul>
<li><code>client-local</code>, the default, will always pick the node the client is connected to</li>
<li><code>balanced</code>, which takes into account the number of queues/leaders already running
on each node in the cluster; when there are relatively few
queues in the cluster, it picks the node with the least number of them; when there
are many (more than 1000 by default), it just picks a random node (calculating the
exact number can be slow with many queues, and a random choice is generally just as good)</li>
</ul>
<div class="theme-admonition theme-admonition-tip admonition_xJq3 alert alert--success"><div class="admonitionHeading_Gvgb"><span class="admonitionIcon_Rf37"><svg viewBox="0 0 12 16"><path fill-rule="evenodd" d="M6.5 0C3.48 0 1 2.19 1 5c0 .92.55 2.25 1 3 1.34 2.25 1.78 2.78 2 4v1h5v-1c.22-1.22.66-1.75 2-4 .45-.75 1-2.08 1-3 0-2.81-2.48-5-5.5-5zm3.64 7.48c-.25.44-.47.8-.67 1.11-.86 1.41-1.25 2.06-1.45 3.23-.02.05-.02.11-.02.17H5c0-.06 0-.13-.02-.17-.2-1.17-.59-1.83-1.45-3.23-.2-.31-.42-.67-.67-1.11C2.44 6.78 2 5.65 2 5c0-2.2 2.02-4 4.5-4 1.22 0 2.36.42 3.22 1.19C10.55 2.94 11 3.94 11 5c0 .66-.44 1.78-.86 2.48zM4 14h5c-.23 1.14-1.3 2-2.5 2s-2.27-.86-2.5-2z"></path></svg></span>tip</div><div class="admonitionContent_BuS1"><p>Using <code>client-local</code> strategy is usually a good choice if the connections that declare queues
are evenly distributed between nodes. In such case, even though the queue/leaders are placed locally
(where the connection is), they are well balanced within the cluster. Otherwise, prefer the <code>balanced</code> strategy.
The disadvantage of the <code>balanced</code> strategy is that the connection that declared the queue may not have
the best possible performance when using this queues,
if a different node is picked. For example, <a href="/rabbitmq-website/docs/3.13/queues#temporary-queues">for short-lived queues</a>, <code>client-local</code> is probably
a better choice. <a href="/rabbitmq-website/docs/3.13/queues#exclusive-queues">Exclusive queues</a> are always declared locally.</p></div></div>
<p>The following example sets the <code>queue_leader_locator</code> setting in <code>rabbitmq.conf</code> to ensure a balanced queue distribution:</p>
<div class="language-ini codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-ini codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">queue_leader_locator = balanced</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>The client-provided queue argument takes precedence when both are used.</p>
<p>Note that all Raft-based features, namely quorum queues and streams, use this value as a suggestion.
Raft leader election algorithm involves a degree of randomness, therefore the selected recommended
node will have a replica placed on it but it will not always be the leader replica.</p>
<div class="theme-admonition theme-admonition-note admonition_xJq3 alert alert--secondary"><div class="admonitionHeading_Gvgb"><span class="admonitionIcon_Rf37"><svg viewBox="0 0 14 16"><path fill-rule="evenodd" d="M6.3 5.69a.942.942 0 0 1-.28-.7c0-.28.09-.52.28-.7.19-.18.42-.28.7-.28.28 0 .52.09.7.28.18.19.28.42.28.7 0 .28-.09.52-.28.7a1 1 0 0 1-.7.3c-.28 0-.52-.11-.7-.3zM8 7.99c-.02-.25-.11-.48-.31-.69-.2-.19-.42-.3-.69-.31H6c-.27.02-.48.13-.69.31-.2.2-.3.44-.31.69h1v3c.02.27.11.5.31.69.2.2.42.31.69.31h1c.27 0 .48-.11.69-.31.2-.19.3-.42.31-.69H8V7.98v.01zM7 2.3c-3.14 0-5.7 2.54-5.7 5.68 0 3.14 2.56 5.7 5.7 5.7s5.7-2.55 5.7-5.7c0-3.15-2.56-5.69-5.7-5.69v.01zM7 .98c3.86 0 7 3.14 7 7s-3.14 7-7 7-7-3.12-7-7 3.14-7 7-7z"></path></svg></span>note</div><div class="admonitionContent_BuS1"><p>For backwards compatibility, <code>queue-master-locator</code> (policy argument), <code>x-queue-master-locator</code>
(queue argument) and <code>queue_master_locator</code> (configuration option) are still supported by classic queues.
However, these are deprecated in favour of the options listed above.</p><p>These options allow different values: <code>client-local</code>, <code>random</code> and <code>min-masters</code>. The latter two
are now mapped to <code>balanced</code> internally.</p></div></div>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="clustering-and-observability">Clustering and Observability<a href="#clustering-and-observability" class="hash-link" aria-label="Direct link to Clustering and Observability" title="Direct link to Clustering and Observability">​</a></h2>
<p>Client connections, channels and queues will be distributed across cluster nodes.
Operators need to be able to inspect and <a href="/rabbitmq-website/docs/3.13/monitoring">monitor</a> such resources
across all cluster nodes.</p>
<p>RabbitMQ <a href="/rabbitmq-website/docs/3.13/cli">CLI tools</a> such as <code>rabbitmq-diagnostics</code> and <code>rabbitmqctl</code>
provide commands that inspect resources and cluster-wide state. Some commands focus on the state of a single node
(e.g. <code>rabbitmq-diagnostics environment</code> and <code>rabbitmq-diagnostics status</code>), others
inspect cluster-wide state. Some examples of the latter include <code>rabbitmqctl list_connections</code>,
<code>rabbitmqctl list_mqtt_connections</code>, <code>rabbitmqctl list_stomp_connections</code>, <code>rabbitmqctl list_users</code>,
<code>rabbitmqctl list_vhosts</code> and so on.</p>
<p>Such &quot;cluster-wide&quot; commands will often contact one node
first, discover cluster members and contact them all to
retrieve and combine their respective state. For example,
<code>rabbitmqctl list_connections</code> will contact all
nodes, retrieve their AMQP 0-9-1 and AMQP 1.0 connections,
and display them all to the user.  The user doesn&#x27;t have
to manually contact all nodes. Assuming a non-changing
state of the cluster (e.g. no connections are closed or
opened), two CLI commands executed against two different
nodes one after another will produce identical or
semantically identical results. &quot;Node-local&quot; commands, however, will not produce
identical results since two nodes rarely have identical state: at the very least their
node names will be different!</p>
<p><a href="/rabbitmq-website/docs/3.13/management">Management UI</a> works similarly: a node that has to respond to an HTTP API request
will fan out to other cluster members and aggregate their responses. In a cluster with multiple nodes that have management plugin
enabled, the operator can use any node to access management UI. The same goes for monitoring tools that use
the HTTP API to collect data about the state of the cluster. There is no need to issue a request to every cluster node in turn.</p>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="clustering-dealing-with-failure">Node Failure Handling<a href="#clustering-dealing-with-failure" class="hash-link" aria-label="Direct link to Node Failure Handling" title="Direct link to Node Failure Handling">​</a></h3>
<p>RabbitMQ brokers tolerate the failure of individual
nodes. Nodes can be started and stopped at will,
as long as they can contact a cluster member node
known at the time of shutdown.</p>
<p><a href="/rabbitmq-website/docs/3.13/quorum-queues">Quorum queue</a> allows queue contents to be replicated
across multiple cluster nodes with parallel replication and a predictable <a href="/rabbitmq-website/docs/3.13/quorum-queues#leader-election">leader election</a>
and <a href="/rabbitmq-website/docs/3.13/quorum-queues#data-safety">data safety</a> behavior as long as a majority of replicas are online.</p>
<p>Non-replicated classic queues can also be used in clusters. Their behaviour in case of node failure
depends on <a href="/rabbitmq-website/docs/3.13/queues#durability">queue durability</a>.</p>
<p>RabbitMQ clustering has several modes of dealing with <a href="/rabbitmq-website/docs/3.13/partitions">network partitions</a>,
primarily consistency oriented. Clustering is meant to be used across LAN. It is
not recommended to run clusters that span WAN.
The <a href="/rabbitmq-website/docs/3.13/shovel">Shovel</a> or
<a href="/rabbitmq-website/docs/3.13/federation">Federation</a>
plugins are better solutions for connecting brokers across a
WAN. Note that <a href="/rabbitmq-website/docs/3.13/distributed">Shovel and Federation are not equivalent to clustering</a>.</p>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="clustering-and-stats">Metrics and Statistics<a href="#clustering-and-stats" class="hash-link" aria-label="Direct link to Metrics and Statistics" title="Direct link to Metrics and Statistics">​</a></h3>
<p>Every node stores and aggregates its own metrics and stats, and provides an API for
other nodes to access it. Some stats are cluster-wide, others are specific to individual nodes.
Node that responds to an <a href="/rabbitmq-website/docs/3.13/management">HTTP API</a> request contacts its peers
to retrieve their data and then produces an aggregated result.</p>
<p>In older (long unmaintained) versions <a href="/rabbitmq-website/docs/3.13/management">RabbitMQ management plugin</a> used
a dedicated node for stats collection and aggregation.</p>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="manual-transcript">Clustering Transcript with <code>rabbitmqctl</code><a href="#manual-transcript" class="hash-link" aria-label="Direct link to manual-transcript" title="Direct link to manual-transcript">​</a></h2>
<p>The following several sections provide a transcript of manually setting up and manipulating
a RabbitMQ cluster across three machines: <code>rabbit1</code>, <code>rabbit2</code>,
<code>rabbit3</code>. It is recommended that the example is studied before
<a href="/rabbitmq-website/docs/3.13/cluster-formation">more automation-friendly</a> cluster formation
options are used.</p>
<p>We assume that the user is logged into all three machines,
that RabbitMQ has been installed on the machines, and that
the rabbitmq-server and rabbitmqctl scripts are in the
user&#x27;s PATH.</p>
<p>This transcript can be modified to run on a single host, as
explained more details below.</p>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="starting">Starting Independent Nodes<a href="#starting" class="hash-link" aria-label="Direct link to Starting Independent Nodes" title="Direct link to Starting Independent Nodes">​</a></h2>
<p>Clusters are set up by re-configuring existing RabbitMQ
nodes into a cluster configuration. Hence the first step
is to start RabbitMQ on all nodes in the normal way:</p>
<div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token comment" style="color:#999988;font-style:italic"># on rabbit1</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">rabbitmq-server </span><span class="token parameter variable" style="color:#36acaa">-detached</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token comment" style="color:#999988;font-style:italic"># on rabbit2</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">rabbitmq-server </span><span class="token parameter variable" style="color:#36acaa">-detached</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token comment" style="color:#999988;font-style:italic"># on rabbit3</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">rabbitmq-server </span><span class="token parameter variable" style="color:#36acaa">-detached</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>This creates three <i>independent</i> RabbitMQ brokers,
one on each node, as confirmed by the <i>cluster_status</i>
command:</p>
<div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token comment" style="color:#999988;font-style:italic"># on rabbit1</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">rabbitmqctl cluster_status</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token comment" style="color:#999988;font-style:italic"># =&gt; Cluster status of node rabbit@rabbit1 ...</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token comment" style="color:#999988;font-style:italic"># =&gt; [{nodes,[{disc,[rabbit@rabbit1]}]},{running_nodes,[rabbit@rabbit1]}]</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token comment" style="color:#999988;font-style:italic"># =&gt; ...done.</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token comment" style="color:#999988;font-style:italic"># on rabbit2</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">rabbitmqctl cluster_status</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token comment" style="color:#999988;font-style:italic"># =&gt; Cluster status of node rabbit@rabbit2 ...</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token comment" style="color:#999988;font-style:italic"># =&gt; [{nodes,[{disc,[rabbit@rabbit2]}]},{running_nodes,[rabbit@rabbit2]}]</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token comment" style="color:#999988;font-style:italic"># =&gt; ...done.</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token comment" style="color:#999988;font-style:italic"># on rabbit3</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">rabbitmqctl cluster_status</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token comment" style="color:#999988;font-style:italic"># =&gt; Cluster status of node rabbit@rabbit3 ...</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token comment" style="color:#999988;font-style:italic"># =&gt; [{nodes,[{disc,[rabbit@rabbit3]}]},{running_nodes,[rabbit@rabbit3]}]</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token comment" style="color:#999988;font-style:italic"># =&gt; ...done.</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>The node name of a RabbitMQ broker started from the
<code>rabbitmq-server</code> shell script is
<code>rabbit@<i>shorthostname</i></code>, where the short
node name is lower-case (as in <code>rabbit@rabbit1</code>,
above). On Windows, if <code>rabbitmq-server.bat</code>
batch file is used, the short node name is upper-case (as
in <code>rabbit@RABBIT1</code>). When you type node names,
case matters, and these strings must match exactly.</p>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="creating">Creating a Cluster<a href="#creating" class="hash-link" aria-label="Direct link to Creating a Cluster" title="Direct link to Creating a Cluster">​</a></h2>
<p>In order to link up our three nodes in a cluster, we tell
two of the nodes, say <code>rabbit@rabbit2</code> and
<code>rabbit@rabbit3</code>, to join the cluster of the
third, say <code>rabbit@rabbit1</code>. Prior to that both
newly joining members must be <a href="/rabbitmq-website/docs/3.13/man/rabbitmqctl.8#reset">reset</a>.</p>
<p>We first join <code>rabbit@rabbit2</code> in a cluster
with <code>rabbit@rabbit1</code>. To do that, on
<code>rabbit@rabbit2</code> we stop the RabbitMQ
application and join the <code>rabbit@rabbit1</code>
cluster, then restart the RabbitMQ application. Note that
a node must be <a href="/rabbitmq-website/docs/3.13/man/rabbitmqctl.8#reset">reset</a> before it can join an existing cluster.
Resetting the node <strong>removes all resources and data that were previously
present on that node</strong>. This means that a node cannot be made a member
of a cluster and keep its existing data at the same time. When that&#x27;s desired,
using the <a href="/rabbitmq-website/docs/3.13/blue-green-upgrade">Blue/Green deployment strategy</a> or <a href="/rabbitmq-website/docs/3.13/backup">backup and restore</a>
are the available options.</p>
<div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token comment" style="color:#999988;font-style:italic"># on rabbit2</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">rabbitmqctl stop_app</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token comment" style="color:#999988;font-style:italic"># =&gt; Stopping node rabbit@rabbit2 ...done.</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">rabbitmqctl reset</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token comment" style="color:#999988;font-style:italic"># =&gt; Resetting node rabbit@rabbit2 ...</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">rabbitmqctl join_cluster rabbit@rabbit1</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token comment" style="color:#999988;font-style:italic"># =&gt; Clustering node rabbit@rabbit2 with [rabbit@rabbit1] ...done.</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">rabbitmqctl start_app</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token comment" style="color:#999988;font-style:italic"># =&gt; Starting node rabbit@rabbit2 ...done.</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>We can see that the two nodes are joined in a cluster by
running the <i>cluster_status</i> command on either of the nodes:</p>
<div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token comment" style="color:#999988;font-style:italic"># on rabbit1</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">rabbitmqctl cluster_status</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token comment" style="color:#999988;font-style:italic"># =&gt; Cluster status of node rabbit@rabbit1 ...</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token comment" style="color:#999988;font-style:italic"># =&gt; [{nodes,[{disc,[rabbit@rabbit1,rabbit@rabbit2]}]},</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token comment" style="color:#999988;font-style:italic"># =&gt;  {running_nodes,[rabbit@rabbit2,rabbit@rabbit1]}]</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token comment" style="color:#999988;font-style:italic"># =&gt; ...done.</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token comment" style="color:#999988;font-style:italic"># on rabbit2</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">rabbitmqctl cluster_status</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token comment" style="color:#999988;font-style:italic"># =&gt; Cluster status of node rabbit@rabbit2 ...</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token comment" style="color:#999988;font-style:italic"># =&gt; [{nodes,[{disc,[rabbit@rabbit1,rabbit@rabbit2]}]},</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token comment" style="color:#999988;font-style:italic"># =&gt;  {running_nodes,[rabbit@rabbit1,rabbit@rabbit2]}]</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token comment" style="color:#999988;font-style:italic"># =&gt; ...done.</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>Now we join <code>rabbit@rabbit3</code> to the same
cluster. The steps are identical to the ones above, except
this time we&#x27;ll cluster to <code>rabbit2</code> to
demonstrate that the node chosen to cluster to does not
matter - it is enough to provide one online node and the
node will be clustered to the cluster that the specified
node belongs to.</p>
<div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token comment" style="color:#999988;font-style:italic"># on rabbit3</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">rabbitmqctl stop_app</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token comment" style="color:#999988;font-style:italic"># =&gt; Stopping node rabbit@rabbit3 ...done.</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token comment" style="color:#999988;font-style:italic"># on rabbit3</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">rabbitmqctl reset</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token comment" style="color:#999988;font-style:italic"># =&gt; Resetting node rabbit@rabbit3 ...</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">rabbitmqctl join_cluster rabbit@rabbit2</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token comment" style="color:#999988;font-style:italic"># =&gt; Clustering node rabbit@rabbit3 with rabbit@rabbit2 ...done.</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">rabbitmqctl start_app</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token comment" style="color:#999988;font-style:italic"># =&gt; Starting node rabbit@rabbit3 ...done.</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>We can see that the three nodes are joined in a cluster by
running the <code>cluster_status</code> command on any of the nodes:</p>
<div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token comment" style="color:#999988;font-style:italic"># on rabbit1</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">rabbitmqctl cluster_status</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token comment" style="color:#999988;font-style:italic"># =&gt; Cluster status of node rabbit@rabbit1 ...</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token comment" style="color:#999988;font-style:italic"># =&gt; [{nodes,[{disc,[rabbit@rabbit1,rabbit@rabbit2,rabbit@rabbit3]}]},</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token comment" style="color:#999988;font-style:italic"># =&gt;  {running_nodes,[rabbit@rabbit3,rabbit@rabbit2,rabbit@rabbit1]}]</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token comment" style="color:#999988;font-style:italic"># =&gt; ...done.</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token comment" style="color:#999988;font-style:italic"># on rabbit2</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">rabbitmqctl cluster_status</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token comment" style="color:#999988;font-style:italic"># =&gt; Cluster status of node rabbit@rabbit2 ...</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token comment" style="color:#999988;font-style:italic"># =&gt; [{nodes,[{disc,[rabbit@rabbit1,rabbit@rabbit2,rabbit@rabbit3]}]},</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token comment" style="color:#999988;font-style:italic"># =&gt;  {running_nodes,[rabbit@rabbit3,rabbit@rabbit1,rabbit@rabbit2]}]</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token comment" style="color:#999988;font-style:italic"># =&gt; ...done.</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token comment" style="color:#999988;font-style:italic"># on rabbit3</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">rabbitmqctl cluster_status</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token comment" style="color:#999988;font-style:italic"># =&gt; Cluster status of node rabbit@rabbit3 ...</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token comment" style="color:#999988;font-style:italic"># =&gt; [{nodes,[{disc,[rabbit@rabbit3,rabbit@rabbit2,rabbit@rabbit1]}]},</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token comment" style="color:#999988;font-style:italic"># =&gt;  {running_nodes,[rabbit@rabbit2,rabbit@rabbit1,rabbit@rabbit3]}]</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token comment" style="color:#999988;font-style:italic"># =&gt; ...done.</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>By following the above steps we can add new nodes to the
cluster at any time, while the cluster is running.</p>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="restarting">Restarting Cluster Nodes<a href="#restarting" class="hash-link" aria-label="Direct link to Restarting Cluster Nodes" title="Direct link to Restarting Cluster Nodes">​</a></h2>
<div class="theme-admonition theme-admonition-important admonition_xJq3 alert alert--info"><div class="admonitionHeading_Gvgb"><span class="admonitionIcon_Rf37"><svg viewBox="0 0 14 16"><path fill-rule="evenodd" d="M7 2.3c3.14 0 5.7 2.56 5.7 5.7s-2.56 5.7-5.7 5.7A5.71 5.71 0 0 1 1.3 8c0-3.14 2.56-5.7 5.7-5.7zM7 1C3.14 1 0 4.14 0 8s3.14 7 7 7 7-3.14 7-7-3.14-7-7-7zm1 3H6v5h2V4zm0 6H6v2h2v-2z"></path></svg></span>important</div><div class="admonitionContent_BuS1"><p>Users running RabbitMQ on Kubernetes must also consult
<a href="#restarting-readiness-probes">the following section</a> that explains how to avoid a well known
cluster restart deadlock scenario specific to Kubernetes.</p></div></div>
<p>Nodes that have been joined to a cluster can be stopped at
any time. They can also fail or be terminated by the OS.</p>
<p>In general, if the majority of nodes is still online after a node
is stopped, this does not affect the rest of the cluster, although
client connection distribution, queue replica placement, and load distribution
of the cluster will change.</p>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="restarting-schema-sync">Schema Syncing from Online Peers<a href="#restarting-schema-sync" class="hash-link" aria-label="Direct link to Schema Syncing from Online Peers" title="Direct link to Schema Syncing from Online Peers">​</a></h3>
<p>A restarted node will sync the schema
and other information from its peers on boot. Before this process
completes, the node <strong>won&#x27;t be fully started and functional</strong>.</p>
<p>It is therefore important to understand the process node go through when
they are stopped and restarted.</p>
<div class="theme-admonition theme-admonition-important admonition_xJq3 alert alert--info"><div class="admonitionHeading_Gvgb"><span class="admonitionIcon_Rf37"><svg viewBox="0 0 14 16"><path fill-rule="evenodd" d="M7 2.3c3.14 0 5.7 2.56 5.7 5.7s-2.56 5.7-5.7 5.7A5.71 5.71 0 0 1 1.3 8c0-3.14 2.56-5.7 5.7-5.7zM7 1C3.14 1 0 4.14 0 8s3.14 7 7 7 7-3.14 7-7-3.14-7-7-7zm1 3H6v5h2V4zm0 6H6v2h2v-2z"></path></svg></span>important</div><div class="admonitionContent_BuS1"><p>Upon restart the node will try to contact that peer 10 times by
default, with 30 second response timeouts. This means that by default, all cluster
members must come online within 5 minutes.</p><p>In environments where nodes are deployed and verified sequentially,
such as Kubernetes with the <code>OrderedReady</code> pod management policy,
the restart can run into deadlock unless <a href="#restarting-readiness-probes">a number of recommendations is followed</a>.</p></div></div>
<p>A stopping node picks an online cluster member (only disc
nodes will be considered) to sync with after restart. Upon
restart the node will try to contact that peer 10 times by
default, with 30 second response timeouts.</p>
<p>In case the peer becomes available in that time interval, the node
successfully starts, syncs what it needs from the peer and
keeps going.</p>
<p>If the peer does not become available, the restarted
node will <strong>give up and voluntarily stop</strong>. Such condition can be
identified by the timeout (<code>timeout_waiting_for_tables</code>) warning messages in the logs
that eventually lead to node startup failure:</p>
<div class="codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">2020-07-27 21:10:51.361 [warning] &lt;0.269.0&gt; Error while waiting for Mnesia tables: {timeout_waiting_for_tables,[rabbit@node2,rabbit@node1],[rabbit_durable_queue]}</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">2020-07-27 21:10:51.361 [info] &lt;0.269.0&gt; Waiting for Mnesia tables for 30000 ms, 1 retries left</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">2020-07-27 21:11:21.362 [warning] &lt;0.269.0&gt; Error while waiting for Mnesia tables: {timeout_waiting_for_tables,[rabbit@node2,rabbit@node1],[rabbit_durable_queue]}</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">2020-07-27 21:11:21.362 [info] &lt;0.269.0&gt; Waiting for Mnesia tables for 30000 ms, 0 retries left</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<div class="codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">2020-07-27 21:15:51.380 [info] &lt;0.269.0&gt; Waiting for Mnesia tables for 30000 ms, 1 retries left</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">2020-07-27 21:16:21.381 [warning] &lt;0.269.0&gt; Error while waiting for Mnesia tables: {timeout_waiting_for_tables,[rabbit@node2,rabbit@node1],[rabbit_user,rabbit_user_permission, …]}</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">2020-07-27 21:16:21.381 [info] &lt;0.269.0&gt; Waiting for Mnesia tables for 30000 ms, 0 retries left</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">2020-07-27 21:16:51.393 [info] &lt;0.44.0&gt; Application mnesia exited with reason: stopped</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<div class="codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">2020-07-27 21:16:51.397 [error] &lt;0.269.0&gt; BOOT FAILED</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">2020-07-27 21:16:51.397 [error] &lt;0.269.0&gt; ===========</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">2020-07-27 21:16:51.397 [error] &lt;0.269.0&gt; Timeout contacting cluster nodes: [rabbit@node1].</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>When a node has no online peers during shutdown, it will start without
attempts to sync with any known peers. It does not start as a standalone
node, however, and peers will be able to rejoin it.</p>
<p>When the entire cluster is brought down therefore, the last node to go down
is the only one that didn&#x27;t have any running peers at the time of shutdown.
That node can start without contacting any peers first.
Since nodes will try to contact a known peer for up to 5 minutes (by default), nodes
can be restarted in any order in that period of time. In this case
they will rejoin each other one by one successfully. This window of time
can be adjusted using two configuration settings:</p>
<div class="language-ini codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-ini codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain"># wait for 60 seconds instead of 30</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">mnesia_table_loading_retry_timeout = 60000</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"># retry 15 times instead of 10</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">mnesia_table_loading_retry_limit = 15</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>By adjusting these settings and tweaking the time window in which
known peer has to come back it is possible to account for cluster-wide
redeployment scenarios that can be longer than 5 minutes to complete.</p>
<p>During <a href="/rabbitmq-website/docs/3.13/upgrade">upgrades</a>, sometimes the last node to stop
must be the first node to be started after the upgrade. That node will be designated to perform
a cluster-wide schema migration that other nodes can sync from and apply when they
rejoin.</p>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="restarting-readiness-probes">Node Restarts, Kubernetes Pod Management and Health Checks (Readiness Probes)<a href="#restarting-readiness-probes" class="hash-link" aria-label="Direct link to Node Restarts, Kubernetes Pod Management and Health Checks (Readiness Probes)" title="Direct link to Node Restarts, Kubernetes Pod Management and Health Checks (Readiness Probes)">​</a></h3>
<div class="theme-admonition theme-admonition-important admonition_xJq3 alert alert--info"><div class="admonitionHeading_Gvgb"><span class="admonitionIcon_Rf37"><svg viewBox="0 0 14 16"><path fill-rule="evenodd" d="M7 2.3c3.14 0 5.7 2.56 5.7 5.7s-2.56 5.7-5.7 5.7A5.71 5.71 0 0 1 1.3 8c0-3.14 2.56-5.7 5.7-5.7zM7 1C3.14 1 0 4.14 0 8s3.14 7 7 7 7-3.14 7-7-3.14-7-7-7zm1 3H6v5h2V4zm0 6H6v2h2v-2z"></path></svg></span>important</div><div class="admonitionContent_BuS1"><p>Use the <code>Parallel</code> pod management policy when running RabbitMQ on Kubernetes.</p></div></div>
<p>In some environments, node restarts are controlled with a designated <a href="/rabbitmq-website/docs/3.13/monitoring#health-checks">health check</a>.
The checks verify that one node has started and the deployment process can proceed to the next one.
If the check does not pass, the deployment of the node is considered to be incomplete and the deployment process
will typically wait and retry for a period of time. One popular example of such environment is Kubernetes
where an operator-defined <a href="https://kubernetes.io/docs/concepts/workloads/pods/pod-lifecycle/#pod-readiness-gate" target="_blank" rel="noopener noreferrer">readiness probe</a>
can prevent a deployment from proceeding when the <a href="https://kubernetes.io/docs/concepts/workloads/controllers/statefulset/#deployment-and-scaling-guarantees" target="_blank" rel="noopener noreferrer"><code>OrderedReady</code> pod management policy</a> is used. Using the <code>Parallel</code> pod management policy helps avoid this problem.</p>
<p>Given the <a href="#restarting-schema-sync">peer syncing behavior described above</a>, such a health check can prevent a cluster-wide restart
from completing in time. Checks that explicitly or implicitly assume a fully booted node that&#x27;s rejoined
its cluster peers will fail and block further node deployments.</p>
<p><a href="/rabbitmq-website/docs/3.13/monitoring#health-checks">Most health check</a>, even relatively basic ones, implicitly assume that the node has
finished booting. They are not suitable for nodes that are <a href="#restarting-schema-sync">awaiting schema table sync</a> from a peer.</p>
<p>One very common example of such check is</p>
<div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token comment" style="color:#999988;font-style:italic"># will exit with an error for the nodes that are currently waiting for</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token comment" style="color:#999988;font-style:italic"># a peer to sync schema tables from</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">rabbitmq-diagnostics check_running</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>One health check that does not expect a node to be fully booted and have schema tables synced is</p>
<div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token comment" style="color:#999988;font-style:italic"># a very basic check that will succeed for the nodes that are currently waiting for</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token comment" style="color:#999988;font-style:italic"># a peer to sync schema from</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">rabbitmq-diagnostics </span><span class="token function" style="color:#d73a49">ping</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>This basic check would allow the deployment to proceed and the nodes to eventually rejoin each other,
assuming they are <a href="/rabbitmq-website/docs/3.13/upgrade">compatible</a>.</p>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="restarting-with-hostname-changes">Hostname Changes Between Restarts<a href="#restarting-with-hostname-changes" class="hash-link" aria-label="Direct link to Hostname Changes Between Restarts" title="Direct link to Hostname Changes Between Restarts">​</a></h3>
<p>A node rejoining after a node name or host name change can start as <a href="/rabbitmq-website/docs/3.13/cluster-formation#peer-discovery-how-does-it-work">a blank node</a>
if its data directory path changes as a result. Such nodes will fail to rejoin the cluster.
While the node is offline, its peers can be reset or started with a blank data directory.
In that case the recovering node will fail to rejoin its peer as well since internal data store cluster
identity would no longer match.</p>
<p>Consider the following scenario:</p>
<ol>
<li>A cluster of 3 nodes, A, B and C is formed</li>
<li>Node A is shut down</li>
<li>Node B is reset</li>
<li>Node A is started</li>
<li>Node A tries to rejoin B but B&#x27;s cluster identity has changed</li>
<li>Node B doesn&#x27;t recognise A as a known cluster member because it&#x27;s been reset</li>
</ol>
<p>in this case node B will reject the clustering attempt from A with an appropriate error
message in the log:</p>
<div class="codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">Node &#x27;rabbit@node1.local&#x27; thinks it&#x27;s clustered with node &#x27;rabbit@node2.local&#x27;, but &#x27;rabbit@node2.local&#x27; disagrees</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>In this case B can be reset again and then will be able to join A, or A
can be reset and will successfully join B.</p>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="restarting-transcript">Cluster Node Restart Example<a href="#restarting-transcript" class="hash-link" aria-label="Direct link to Cluster Node Restart Example" title="Direct link to Cluster Node Restart Example">​</a></h3>
<p>The below example uses CLI tools to shut down the nodes <code>rabbit@rabbit1</code> and
<code>rabbit@rabbit3</code> and check on the cluster
status at each step:</p>
<div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token comment" style="color:#999988;font-style:italic"># on rabbit1</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">rabbitmqctl stop</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token comment" style="color:#999988;font-style:italic"># =&gt; Stopping and halting node rabbit@rabbit1 ...done.</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token comment" style="color:#999988;font-style:italic"># on rabbit2</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">rabbitmqctl cluster_status</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token comment" style="color:#999988;font-style:italic"># =&gt; Cluster status of node rabbit@rabbit2 ...</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token comment" style="color:#999988;font-style:italic"># =&gt; [{nodes,[{disc,[rabbit@rabbit1,rabbit@rabbit2,rabbit@rabbit3]}]},</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token comment" style="color:#999988;font-style:italic"># =&gt;  {running_nodes,[rabbit@rabbit3,rabbit@rabbit2]}]</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token comment" style="color:#999988;font-style:italic"># =&gt; ...done.</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token comment" style="color:#999988;font-style:italic"># on rabbit3</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">rabbitmqctl cluster_status</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token comment" style="color:#999988;font-style:italic"># =&gt; Cluster status of node rabbit@rabbit3 ...</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token comment" style="color:#999988;font-style:italic"># =&gt; [{nodes,[{disc,[rabbit@rabbit1,rabbit@rabbit2,rabbit@rabbit3]}]},</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token comment" style="color:#999988;font-style:italic"># =&gt;  {running_nodes,[rabbit@rabbit2,rabbit@rabbit3]}]</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token comment" style="color:#999988;font-style:italic"># =&gt; ...done.</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token comment" style="color:#999988;font-style:italic"># on rabbit3</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">rabbitmqctl stop</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token comment" style="color:#999988;font-style:italic"># =&gt; Stopping and halting node rabbit@rabbit3 ...done.</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token comment" style="color:#999988;font-style:italic"># on rabbit2</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">rabbitmqctl cluster_status</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token comment" style="color:#999988;font-style:italic"># =&gt; Cluster status of node rabbit@rabbit2 ...</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token comment" style="color:#999988;font-style:italic"># =&gt; [{nodes,[{disc,[rabbit@rabbit1,rabbit@rabbit2,rabbit@rabbit3]}]},</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token comment" style="color:#999988;font-style:italic"># =&gt;  {running_nodes,[rabbit@rabbit2]}]</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token comment" style="color:#999988;font-style:italic"># =&gt; ...done.</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>In the below example, the nodes are started back, checking on the cluster
status as we go along:</p>
<div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token comment" style="color:#999988;font-style:italic"># on rabbit1</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">rabbitmq-server </span><span class="token parameter variable" style="color:#36acaa">-detached</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">rabbitmqctl cluster_status</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token comment" style="color:#999988;font-style:italic"># =&gt; Cluster status of node rabbit@rabbit1 ...</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token comment" style="color:#999988;font-style:italic"># =&gt; [{nodes,[{disc,[rabbit@rabbit1,rabbit@rabbit2,rabbit@rabbit3]}]},</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token comment" style="color:#999988;font-style:italic"># =&gt;  {running_nodes,[rabbit@rabbit2,rabbit@rabbit1]}]</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token comment" style="color:#999988;font-style:italic"># =&gt; ...done.</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token comment" style="color:#999988;font-style:italic"># on rabbit2</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">rabbitmqctl cluster_status</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token comment" style="color:#999988;font-style:italic"># =&gt; Cluster status of node rabbit@rabbit2 ...</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token comment" style="color:#999988;font-style:italic"># =&gt; [{nodes,[{disc,[rabbit@rabbit1,rabbit@rabbit2,rabbit@rabbit3]}]},</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token comment" style="color:#999988;font-style:italic"># =&gt;  {running_nodes,[rabbit@rabbit1,rabbit@rabbit2]}]</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token comment" style="color:#999988;font-style:italic"># =&gt; ...done.</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token comment" style="color:#999988;font-style:italic"># on rabbit3</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">rabbitmq-server </span><span class="token parameter variable" style="color:#36acaa">-detached</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token comment" style="color:#999988;font-style:italic"># on rabbit1</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">rabbitmqctl cluster_status</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token comment" style="color:#999988;font-style:italic"># =&gt; Cluster status of node rabbit@rabbit1 ...</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token comment" style="color:#999988;font-style:italic"># =&gt; [{nodes,[{disc,[rabbit@rabbit1,rabbit@rabbit2,rabbit@rabbit3]}]},</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token comment" style="color:#999988;font-style:italic"># =&gt;  {running_nodes,[rabbit@rabbit2,rabbit@rabbit1,rabbit@rabbit3]}]</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token comment" style="color:#999988;font-style:italic"># =&gt; ...done.</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token comment" style="color:#999988;font-style:italic"># on rabbit2</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">rabbitmqctl cluster_status</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token comment" style="color:#999988;font-style:italic"># =&gt; Cluster status of node rabbit@rabbit2 ...</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token comment" style="color:#999988;font-style:italic"># =&gt; [{nodes,[{disc,[rabbit@rabbit1,rabbit@rabbit2,rabbit@rabbit3]}]},</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token comment" style="color:#999988;font-style:italic"># =&gt;  {running_nodes,[rabbit@rabbit1,rabbit@rabbit2,rabbit@rabbit3]}]</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token comment" style="color:#999988;font-style:italic"># =&gt; ...done.</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token comment" style="color:#999988;font-style:italic"># on rabbit3</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">rabbitmqctl cluster_status</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token comment" style="color:#999988;font-style:italic"># =&gt; Cluster status of node rabbit@rabbit3 ...</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token comment" style="color:#999988;font-style:italic"># =&gt; [{nodes,[{disc,[rabbit@rabbit1,rabbit@rabbit2,rabbit@rabbit3]}]},</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token comment" style="color:#999988;font-style:italic"># =&gt;  {running_nodes,[rabbit@rabbit2,rabbit@rabbit1,rabbit@rabbit3]}]</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token comment" style="color:#999988;font-style:italic"># =&gt; ...done.</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="removing-nodes">How to Remove a Node from the Cluster<a href="#removing-nodes" class="hash-link" aria-label="Direct link to How to Remove a Node from the Cluster" title="Direct link to How to Remove a Node from the Cluster">​</a></h2>
<p>Sometimes it is necessary to remove a node from the cluster.</p>
<p>The sequence of actions will be slightly different for the following
most common scenarios:</p>
<ul>
<li>The node is online and reachable</li>
<li>The node is offline and cannot be recovered</li>
</ul>
<p>In addition, if the cluster <a href="/rabbitmq-website/docs/3.13/cluster-formation">peer discovery mechanisms</a>
support node health checks and <a href="/rabbitmq-website/docs/3.13/cluster-formation#node-health-checks-and-cleanup">forced removal of nodes</a> not known to the discovery backend.</p>
<p>That feature is opt-in (deactivated by default).</p>
<p>Continuing with the three node cluster example used in this guide,
let&#x27;s demonstrate how to remove <code>rabbit@rabbit3</code> from the cluster, returning it to
independent operation.</p>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="removal-of-a-reachable-node">Removal of a Reachable Node<a href="#removal-of-a-reachable-node" class="hash-link" aria-label="Direct link to Removal of a Reachable Node" title="Direct link to Removal of a Reachable Node">​</a></h3>
<p>First step before removing a node from the cluster is to stop it:</p>
<div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token comment" style="color:#999988;font-style:italic"># on rabbit3</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">rabbitmqctl stop_app</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token comment" style="color:#999988;font-style:italic"># =&gt; Stopping node rabbit@rabbit3 ...done.</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>Then use <code>rabbitmqctl forget_cluster_node</code> on another node
and specify the node to remove as <strong>the first positional argument</strong>:</p>
<div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token comment" style="color:#999988;font-style:italic"># on rabbit2</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">rabbitmqctl forget_cluster_node rabbit@rabbit3</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token comment" style="color:#999988;font-style:italic"># =&gt; Removing node rabbit@rabbit3 from cluster ...</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>Running the</p>
<div class="language-shell codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-shell codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">rabbitmq-diagnostics cluster_status</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>command on the nodes confirms that <code>rabbit@rabbit3</code> now is no longer part of
the cluster and operates independently:</p>
<div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token comment" style="color:#999988;font-style:italic"># on rabbit1</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">rabbitmqctl cluster_status</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token comment" style="color:#999988;font-style:italic"># =&gt; Cluster status of node rabbit@rabbit1 ...</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token comment" style="color:#999988;font-style:italic"># =&gt; [{nodes,[{disc,[rabbit@rabbit1,rabbit@rabbit2]}]},</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token comment" style="color:#999988;font-style:italic"># =&gt; {running_nodes,[rabbit@rabbit2,rabbit@rabbit1]}]</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token comment" style="color:#999988;font-style:italic"># =&gt; ...done.</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token comment" style="color:#999988;font-style:italic"># on rabbit2</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">rabbitmqctl cluster_status</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token comment" style="color:#999988;font-style:italic"># =&gt; Cluster status of node rabbit@rabbit2 ...</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token comment" style="color:#999988;font-style:italic"># =&gt; [{nodes,[{disc,[rabbit@rabbit1,rabbit@rabbit2]}]},</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token comment" style="color:#999988;font-style:italic"># =&gt;  {running_nodes,[rabbit@rabbit1,rabbit@rabbit2]}]</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token comment" style="color:#999988;font-style:italic"># =&gt; ...done.</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>Now node <code>rabbit@rabbit3</code> can be decomissioned to reset and started as
a standalone node:</p>
<div class="language-shell codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-shell codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token comment" style="color:#999988;font-style:italic"># on rabbit3</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">rabbitmqctl reset</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">rabbitmqctl start_app</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token comment" style="color:#999988;font-style:italic"># =&gt; Starting node rabbit@rabbit3 ...</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">rabbitmqctl cluster_status</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token comment" style="color:#999988;font-style:italic"># =&gt; Cluster status of node rabbit@rabbit3 ...</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token comment" style="color:#999988;font-style:italic"># =&gt; [{nodes,[{disc,[rabbit@rabbit3]}]},{running_nodes,[rabbit@rabbit3]}]</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token comment" style="color:#999988;font-style:italic"># =&gt; ...done.</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>Nodes can be removed remotely, that is, from a different host, as long as CLI tools
on said host can <a href="/rabbitmq-website/docs/3.13/cli">connect and authenticate</a> to the target node.</p>
<p>This can useful, for example, when having to deal with a host that cannot be accessed.</p>
<p>In the rest of this example, <code>rabbit@rabbit1</code> will be removed from its remaining
two node cluster with <code>rabbit@rabbit2</code>:</p>
<div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token comment" style="color:#999988;font-style:italic"># on rabbit1</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">rabbitmqctl stop_app</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token comment" style="color:#999988;font-style:italic"># =&gt; Stopping node rabbit@rabbit1 ...done.</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token comment" style="color:#999988;font-style:italic"># on rabbit2</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">rabbitmqctl forget_cluster_node rabbit@rabbit1</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token comment" style="color:#999988;font-style:italic"># =&gt; Removing node rabbit@rabbit1 from cluster ...</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token comment" style="color:#999988;font-style:italic"># =&gt; ...done.</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="removal-of-stopped-nodes-and-their-revival">Removal of Stopped Nodes and Their Revival<a href="#removal-of-stopped-nodes-and-their-revival" class="hash-link" aria-label="Direct link to Removal of Stopped Nodes and Their Revival" title="Direct link to Removal of Stopped Nodes and Their Revival">​</a></h3>
<div class="theme-admonition theme-admonition-important admonition_xJq3 alert alert--info"><div class="admonitionHeading_Gvgb"><span class="admonitionIcon_Rf37"><svg viewBox="0 0 14 16"><path fill-rule="evenodd" d="M7 2.3c3.14 0 5.7 2.56 5.7 5.7s-2.56 5.7-5.7 5.7A5.71 5.71 0 0 1 1.3 8c0-3.14 2.56-5.7 5.7-5.7zM7 1C3.14 1 0 4.14 0 8s3.14 7 7 7 7-3.14 7-7-3.14-7-7-7zm1 3H6v5h2V4zm0 6H6v2h2v-2z"></path></svg></span>important</div><div class="admonitionContent_BuS1"><p>A node that was removed from the cluster when stopped with <code>rabbitmqctl stop_app</code>
must be either reset or decomissioned. If started without a reset,
it won&#x27;t be able to rejoin its original cluster.</p></div></div>
<p>At this point <code>rabbit1</code> still thinks it is clustered with
<code>rabbit2</code>, and trying to start it will result in an
error because the rest of the cluster no longer considers it to be a known member:</p>
<div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token comment" style="color:#999988;font-style:italic"># on rabbit1</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">rabbitmqctl start_app</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token comment" style="color:#999988;font-style:italic"># =&gt; Starting node rabbit@rabbit1 ...</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token comment" style="color:#999988;font-style:italic"># =&gt; Error: inconsistent_cluster: Node rabbit@rabbit1 thinks it&#x27;s clustered with node rabbit@rabbit2, but rabbit@rabbit2 disagrees</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>In order to completely detach it from the cluster, such
stopped node must be reset:</p>
<div class="language-shell codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-shell codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">rabbitmqctl reset</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token comment" style="color:#999988;font-style:italic"># =&gt; Resetting node rabbit@rabbit1 ...done.</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">rabbitmqctl start_app</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token comment" style="color:#999988;font-style:italic"># =&gt; Starting node rabbit@rabbit1 ...</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token comment" style="color:#999988;font-style:italic"># =&gt; ...done.</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>The <code>cluster_status</code> command now shows all three nodes
operating as independent RabbitMQ nodes (single node clusters):</p>
<div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token comment" style="color:#999988;font-style:italic"># on rabbit1</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">rabbitmqctl cluster_status</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token comment" style="color:#999988;font-style:italic"># =&gt; Cluster status of node rabbit@rabbit1 ...</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token comment" style="color:#999988;font-style:italic"># =&gt; [{nodes,[{disc,[rabbit@rabbit1]}]},{running_nodes,[rabbit@rabbit1]}]</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token comment" style="color:#999988;font-style:italic"># =&gt; ...done.</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token comment" style="color:#999988;font-style:italic"># on rabbit2</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">rabbitmqctl cluster_status</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token comment" style="color:#999988;font-style:italic"># =&gt; Cluster status of node rabbit@rabbit2 ...</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token comment" style="color:#999988;font-style:italic"># =&gt; [{nodes,[{disc,[rabbit@rabbit2]}]},{running_nodes,[rabbit@rabbit2]}]</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token comment" style="color:#999988;font-style:italic"># =&gt; ...done.</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token comment" style="color:#999988;font-style:italic"># on rabbit3</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">rabbitmqctl cluster_status</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token comment" style="color:#999988;font-style:italic"># =&gt; Cluster status of node rabbit@rabbit3 ...</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token comment" style="color:#999988;font-style:italic"># =&gt; [{nodes,[{disc,[rabbit@rabbit3]}]},{running_nodes,[rabbit@rabbit3]}]</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token comment" style="color:#999988;font-style:italic"># =&gt; ...done.</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>Note that <code>rabbit@rabbit2</code> retains the residual
state of the cluster, whereas <code>rabbit@rabbit1</code>
and <code>rabbit@rabbit3</code> are freshly initialised
RabbitMQ brokers. If we want to re-initialise
<code>rabbit@rabbit2</code> we follow the same steps as
for the other nodes:</p>
<div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token comment" style="color:#999988;font-style:italic"># on rabbit2</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">rabbitmqctl stop_app</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token comment" style="color:#999988;font-style:italic"># =&gt; Stopping node rabbit@rabbit2 ...done.</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">rabbitmqctl reset</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token comment" style="color:#999988;font-style:italic"># =&gt; Resetting node rabbit@rabbit2 ...done.</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">rabbitmqctl start_app</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token comment" style="color:#999988;font-style:italic"># =&gt; Starting node rabbit@rabbit2 ...done.</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="removal-of-unresponsive-queues">Removal of Unresponsive Queues<a href="#removal-of-unresponsive-queues" class="hash-link" aria-label="Direct link to Removal of Unresponsive Queues" title="Direct link to Removal of Unresponsive Queues">​</a></h3>
<p>When target node is not running, it can still be removed from the cluster using
using <code>rabbitmqctl forget_cluster_node</code>:</p>
<div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token comment" style="color:#999988;font-style:italic"># Tell rabbit@rabbit1 to permanently remove rabbit@rabbit2</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">rabbitmqctl forget_cluster_node </span><span class="token parameter variable" style="color:#36acaa">-n</span><span class="token plain"> rabbit@rabbit1 rabbit@rabbit2</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token comment" style="color:#999988;font-style:italic"># =&gt; Removing node rabbit@rabbit1 from cluster ...</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token comment" style="color:#999988;font-style:italic"># =&gt; ...done.</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="what-happens-to-quorum-queue-and-stream-replicas">What Happens to Quorum Queue and Stream Replicas?<a href="#what-happens-to-quorum-queue-and-stream-replicas" class="hash-link" aria-label="Direct link to What Happens to Quorum Queue and Stream Replicas?" title="Direct link to What Happens to Quorum Queue and Stream Replicas?">​</a></h3>
<p>When a node is removed from the cluster using CLI tools, all <a href="/rabbitmq-website/docs/3.13/quorum-queues#member-management">quorum queue</a>
and <a href="/rabbitmq-website/docs/3.13/streams#member-management">stream replicas</a> on the node will be removed,
even if that means that queues and streams would temporarily have an even (e.g. two) replicas.</p>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="node-removal-is-explicit-manual-or-opt-in">Node Removal is Explicit (Manual) or Opt-in<a href="#node-removal-is-explicit-manual-or-opt-in" class="hash-link" aria-label="Direct link to Node Removal is Explicit (Manual) or Opt-in" title="Direct link to Node Removal is Explicit (Manual) or Opt-in">​</a></h3>
<p>Besides <code>rabbitmqctl forget_cluster_node</code> and the automatic cleanup of unknown nodes
by some <a href="/rabbitmq-website/docs/3.13/cluster-formation">peer discovery</a> plugins, there are no scenarios
in which a RabbitMQ node will permanently remove its peer node from a cluster.</p>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="resetting-nodes">How to Reset a Node<a href="#resetting-nodes" class="hash-link" aria-label="Direct link to How to Reset a Node" title="Direct link to How to Reset a Node">​</a></h2>
<div class="theme-admonition theme-admonition-danger admonition_xJq3 alert alert--danger"><div class="admonitionHeading_Gvgb"><span class="admonitionIcon_Rf37"><svg viewBox="0 0 12 16"><path fill-rule="evenodd" d="M5.05.31c.81 2.17.41 3.38-.52 4.31C3.55 5.67 1.98 6.45.9 7.98c-1.45 2.05-1.7 6.53 3.53 7.7-2.2-1.16-2.67-4.52-.3-6.61-.61 2.03.53 3.33 1.94 2.86 1.39-.47 2.3.53 2.27 1.67-.02.78-.31 1.44-1.13 1.81 3.42-.59 4.78-3.42 4.78-5.56 0-2.84-2.53-3.22-1.25-5.61-1.52.13-2.03 1.13-1.89 2.75.09 1.08-1.02 1.8-1.86 1.33-.67-.41-.66-1.19-.06-1.78C8.18 5.31 8.68 2.45 5.05.32L5.03.3l.02.01z"></path></svg></span>danger</div><div class="admonitionContent_BuS1"><p>Resetting a node will delete all of its data, cluster membership information, configured <a href="/rabbitmq-website/docs/3.13/parameters">runtime parameters</a>,
users, virtual hosts and any other node data. It will also alter its internal identity.</p></div></div>
<p>Sometimes it may be necessary to reset a node (what specifically this means, see below),
and later make it rejoin the cluster as a new node.</p>
<p>Generally speaking, there are two possible scenarios: when the node is running, and when the node cannot start
or won&#x27;t respond to CLI tool commands for any reason.</p>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="reset-a-running-and-responsive-node">Reset a Running and Responsive Node<a href="#reset-a-running-and-responsive-node" class="hash-link" aria-label="Direct link to Reset a Running and Responsive Node" title="Direct link to Reset a Running and Responsive Node">​</a></h3>
<p>To reset a running and responsive node, first stop RabbitMQ on it using <code>rabbitmqctl stop_app</code>
and then reset it using <code>rabbitmqctl reset</code>:</p>
<div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token comment" style="color:#999988;font-style:italic"># on rabbit1</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">rabbitmqctl stop_app</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token comment" style="color:#999988;font-style:italic"># =&gt; Stopping node rabbit@rabbit1 ...done.</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">rabbitmqctl reset</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token comment" style="color:#999988;font-style:italic"># =&gt; Resetting node rabbit@rabbit1 ...done.</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<div class="theme-admonition theme-admonition-info admonition_xJq3 alert alert--info"><div class="admonitionHeading_Gvgb"><span class="admonitionIcon_Rf37"><svg viewBox="0 0 14 16"><path fill-rule="evenodd" d="M7 2.3c3.14 0 5.7 2.56 5.7 5.7s-2.56 5.7-5.7 5.7A5.71 5.71 0 0 1 1.3 8c0-3.14 2.56-5.7 5.7-5.7zM7 1C3.14 1 0 4.14 0 8s3.14 7 7 7 7-3.14 7-7-3.14-7-7-7zm1 3H6v5h2V4zm0 6H6v2h2v-2z"></path></svg></span>info</div><div class="admonitionContent_BuS1"><p>If the reset node is online and its cluster peers are reachable, the node
will first try to permanently remove itself from its cluster.</p></div></div>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="reset-an-unresponsive-node">Reset an Unresponsive Node<a href="#reset-an-unresponsive-node" class="hash-link" aria-label="Direct link to Reset an Unresponsive Node" title="Direct link to Reset an Unresponsive Node">​</a></h3>
<p>In case of a non-responsive node, it must be stopped first using any means necessary.
For nodes that fail to start this is already the case. Then <a href="/rabbitmq-website/docs/3.13/relocate">override</a>
the node&#x27;s data directory location or remove the existing data store. This will make the node
start as a blank one. It will have to be instructed to <a href="#cluster-formation">rejoin its original cluster</a>, if any.</p>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="resetting-a-node-to-re-add-it-as-a-brand-new-node-to-its-original-cluster">Resetting a Node to Re-add It as a Brand New Node to Its Original Cluster<a href="#resetting-a-node-to-re-add-it-as-a-brand-new-node-to-its-original-cluster" class="hash-link" aria-label="Direct link to Resetting a Node to Re-add It as a Brand New Node to Its Original Cluster" title="Direct link to Resetting a Node to Re-add It as a Brand New Node to Its Original Cluster">​</a></h3>
<p>A reset node that was <a href="#removing-nodes">removed from the cluster</a> can be re-added to its original
cluster as a brand new node.</p>
<p>In that case it will sync all virtual hosts, users, permissions and topology (queues, exchanges, bindings),
runtime parameters and policies.</p>
<p>For <a href="/rabbitmq-website/docs/3.13/quorum-queues">quorum queue</a> and <a href="/rabbitmq-website/docs/3.13/streams">stream</a> contents to be replicated to the new [re]added node,
the node must be added to the list of nodes to place replicas on using <code>rabbitmq-queues grow</code>.</p>
<p>Non-replicated queue contents on a reset node will be lost.</p>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="forced-boot">Forcing Node Boot in Case of Unavailable Peers<a href="#forced-boot" class="hash-link" aria-label="Direct link to Forcing Node Boot in Case of Unavailable Peers" title="Direct link to Forcing Node Boot in Case of Unavailable Peers">​</a></h2>
<p>In some cases the last node to go
offline cannot be brought back up. It can be removed from the
cluster using the <code>forget_cluster_node</code> <a href="/rabbitmq-website/docs/3.13/cli">rabbitmqctl</a> command.</p>
<p>Alternatively <code>force_boot</code> <a href="/rabbitmq-website/docs/3.13/cli">rabbitmqctl</a> command can be used
on a node to make it boot without trying to sync with any
peers (as if they were last to shut down). This is
usually only necessary if the last node to shut down or a
set of nodes will never be brought back online.</p>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="upgrading">Upgrading clusters<a href="#upgrading" class="hash-link" aria-label="Direct link to Upgrading clusters" title="Direct link to Upgrading clusters">​</a></h2>
<p>You can find instructions for upgrading a cluster in <a href="/rabbitmq-website/docs/3.13/upgrade">the upgrade
guide</a>.</p>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="single-machine">A Cluster on a Single Machine<a href="#single-machine" class="hash-link" aria-label="Direct link to A Cluster on a Single Machine" title="Direct link to A Cluster on a Single Machine">​</a></h2>
<p>Under some circumstances it can be useful to run a cluster
of RabbitMQ nodes on a single machine. This would
typically be useful for experimenting with clustering on a
desktop or laptop without the overhead of starting several
virtual machines for the cluster.</p>
<p>In order to run multiple RabbitMQ nodes on a single
machine, it is necessary to make sure the nodes have
distinct node names, data store locations, log file
locations, and bind to different ports, including those
used by plugins. See <code>RABBITMQ_NODENAME</code>,
<code>RABBITMQ_NODE_PORT</code>, and
<code>RABBITMQ_DIST_PORT</code> in the <a href="/rabbitmq-website/docs/3.13/configure#supported-environment-variables">Configuration
guide</a>, as well as <code>RABBITMQ_MNESIA_DIR</code>,
<code>RABBITMQ_CONFIG_FILE</code>, and
<code>RABBITMQ_LOG_BASE</code> in the <a href="/rabbitmq-website/docs/3.13/relocate">File and Directory Locations guide</a>.</p>
<p>You can start multiple nodes on the same host manually by
repeated invocation of <code>rabbitmq-server</code> (
<code>rabbitmq-server.bat</code> on Windows). For example:</p>
<div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token assign-left variable" style="color:#36acaa">RABBITMQ_NODE_PORT</span><span class="token operator" style="color:#393A34">=</span><span class="token number" style="color:#36acaa">5672</span><span class="token plain"> </span><span class="token assign-left variable" style="color:#36acaa">RABBITMQ_NODENAME</span><span class="token operator" style="color:#393A34">=</span><span class="token plain">rabbit rabbitmq-server </span><span class="token parameter variable" style="color:#36acaa">-detached</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token assign-left variable" style="color:#36acaa">RABBITMQ_NODE_PORT</span><span class="token operator" style="color:#393A34">=</span><span class="token number" style="color:#36acaa">5673</span><span class="token plain"> </span><span class="token assign-left variable" style="color:#36acaa">RABBITMQ_NODENAME</span><span class="token operator" style="color:#393A34">=</span><span class="token plain">hare rabbitmq-server </span><span class="token parameter variable" style="color:#36acaa">-detached</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">rabbitmqctl </span><span class="token parameter variable" style="color:#36acaa">-n</span><span class="token plain"> hare stop_app</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">rabbitmqctl </span><span class="token parameter variable" style="color:#36acaa">-n</span><span class="token plain"> hare join_cluster rabbit@</span><span class="token variable" style="color:#36acaa">`</span><span class="token variable function" style="color:#d73a49">hostname</span><span class="token variable" style="color:#36acaa"> </span><span class="token variable parameter variable" style="color:#36acaa">-s</span><span class="token variable" style="color:#36acaa">`</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">rabbitmqctl </span><span class="token parameter variable" style="color:#36acaa">-n</span><span class="token plain"> hare start_app</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>will set up a two node cluster, both nodes as disc nodes.
Note that if the node <a href="/rabbitmq-website/docs/3.13/networking">listens on any ports</a> other
than AMQP 0-9-1 and AMQP 1.0 ones, those must be configured to avoid a collision as
well. This can be done via command line:</p>
<div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token assign-left variable" style="color:#36acaa">RABBITMQ_NODE_PORT</span><span class="token operator" style="color:#393A34">=</span><span class="token number" style="color:#36acaa">5672</span><span class="token plain"> </span><span class="token assign-left variable" style="color:#36acaa">RABBITMQ_SERVER_START_ARGS</span><span class="token operator" style="color:#393A34">=</span><span class="token string" style="color:#e3116c">&quot;-rabbitmq_management listener [{port,15672}]&quot;</span><span class="token plain"> </span><span class="token assign-left variable" style="color:#36acaa">RABBITMQ_NODENAME</span><span class="token operator" style="color:#393A34">=</span><span class="token plain">rabbit rabbitmq-server </span><span class="token parameter variable" style="color:#36acaa">-detached</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token assign-left variable" style="color:#36acaa">RABBITMQ_NODE_PORT</span><span class="token operator" style="color:#393A34">=</span><span class="token number" style="color:#36acaa">5673</span><span class="token plain"> </span><span class="token assign-left variable" style="color:#36acaa">RABBITMQ_SERVER_START_ARGS</span><span class="token operator" style="color:#393A34">=</span><span class="token string" style="color:#e3116c">&quot;-rabbitmq_management listener [{port,15673}]&quot;</span><span class="token plain"> </span><span class="token assign-left variable" style="color:#36acaa">RABBITMQ_NODENAME</span><span class="token operator" style="color:#393A34">=</span><span class="token plain">hare rabbitmq-server </span><span class="token parameter variable" style="color:#36acaa">-detached</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>will start two nodes (which can then be clustered) when
the management plugin is installed.</p>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="issues-hostname">Hostname Changes<a href="#issues-hostname" class="hash-link" aria-label="Direct link to Hostname Changes" title="Direct link to Hostname Changes">​</a></h2>
<p>RabbitMQ nodes use hostnames to communicate with each other. Therefore,
all node names must be able to resolve names of all cluster peers. This is
also true for tools such as <code>rabbitmqctl</code>.</p>
<p>In addition to that, by default RabbitMQ names the database directory using the
current hostname of the system. If the hostname
changes, a new empty database is created. To avoid data loss it&#x27;s
crucial to set up a fixed and resolvable hostname.</p>
<p>Whenever the hostname changes RabbitMQ node must be restarted.</p>
<p>A similar effect can be achieved by using <code>rabbit@localhost</code>
as the broker nodename.
The impact of this solution is that clustering will not work because
the chosen hostname does not resolve to a routable address from the remote
hosts. The <code>rabbitmqctl</code> command fails when
invoked from a remote host. A better solution is to use DNS, for example,
<a href="http://aws.amazon.com/route53/" target="_blank" rel="noopener noreferrer">Amazon Route 53</a> if running
on EC2. If you want to use the full hostname for your nodename (RabbitMQ
defaults to the short name), and that full hostname is resolvable using DNS,
you may want to investigate setting the environment variable
<code>RABBITMQ_USE_LONGNAME=true</code>.</p>
<p>See the section on <a href="/rabbitmq-website/docs/3.13/clustering#hostname-resolution-requirement">hostname resolution</a> for more information.</p>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="firewall">Firewalled Nodes<a href="#firewall" class="hash-link" aria-label="Direct link to Firewalled Nodes" title="Direct link to Firewalled Nodes">​</a></h2>
<p>Nodes can have a firewall enabled on them. In such case, traffic on certain ports must be
allowed by the firewall in both directions, or nodes won&#x27;t be able to join each other and
perform all the operations they expect to be available on cluster peers.</p>
<p>Learn more in the <a href="#ports">section on ports</a> above and dedicated <a href="/rabbitmq-website/docs/3.13/networking">RabbitMQ Networking guide</a>.</p>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="erlang">Erlang Versions Across the Cluster<a href="#erlang" class="hash-link" aria-label="Direct link to Erlang Versions Across the Cluster" title="Direct link to Erlang Versions Across the Cluster">​</a></h2>
<p>All nodes in a cluster are <em>highly recommended</em> to run the same major <a href="/rabbitmq-website/docs/3.13/which-erlang">version of Erlang</a>: <code>26.2.0</code>
and <code>26.1.2</code> can be mixed but <code>25.3.2.8</code> and <code>26.2.0</code> can potentially introduce breaking changes in
inter-node communication protocols. While such breaking changes are rare, they are possible.</p>
<p>Incompatibilities between patch releases of Erlang/OTP versions
are very rare.</p>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="clients">Connecting to Clusters from Clients<a href="#clients" class="hash-link" aria-label="Direct link to Connecting to Clusters from Clients" title="Direct link to Connecting to Clusters from Clients">​</a></h2>
<p>A client can connect as normal to any node within a
cluster. If that node should fail, and the rest of the
cluster survives, then the client should notice the closed
connection, and should be able to reconnect to some
surviving member of the cluster.</p>
<p>Many clients support lists of hostnames that will be tried in order
at connection time.</p>
<p>Generally it is not recommended to hardcode IP addresses into
client applications: this introduces inflexibility and will
require client applications to be edited, recompiled and
redeployed should the configuration of the cluster change or
the number of nodes in the cluster change.</p>
<p>Instead, consider a more abstracted approach: this could be a
dynamic DNS service which has a very short TTL
configuration, or a plain TCP load balancer, or a combination of them.</p>
<p>In general, this aspect of managing the
connection to nodes within a cluster is beyond the scope of
this guide, and we recommend the use of other
technologies designed specifically to address these problems.</p></div><footer class="theme-doc-footer docusaurus-mt-lg"><div class="row margin-top--sm theme-doc-footer-edit-meta-row"><div class="col"><a href="https://github.com/rabbitmq/rabbitmq-website/tree/main/versioned_docs/version-3.13/clustering.md" target="_blank" rel="noopener noreferrer" class="theme-edit-this-page"><svg fill="currentColor" height="20" width="20" viewBox="0 0 40 40" class="iconEdit_Z9Sw" aria-hidden="true"><g><path d="m34.5 11.7l-3 3.1-6.3-6.3 3.1-3q0.5-0.5 1.2-0.5t1.1 0.5l3.9 3.9q0.5 0.4 0.5 1.1t-0.5 1.2z m-29.5 17.1l18.4-18.5 6.3 6.3-18.4 18.4h-6.3v-6.2z"></path></g></svg>Edit this page</a></div><div class="col lastUpdated_JAkA"></div></div></footer></article><nav class="pagination-nav docusaurus-mt-lg" aria-label="Docs pages"><a class="pagination-nav__link pagination-nav__link--prev" href="/rabbitmq-website/docs/3.13/troubleshooting-ssl"><div class="pagination-nav__sublabel">Previous</div><div class="pagination-nav__label">Troubleshooting TLS</div></a><a class="pagination-nav__link pagination-nav__link--next" href="/rabbitmq-website/docs/3.13/cluster-formation"><div class="pagination-nav__sublabel">Next</div><div class="pagination-nav__label">Cluster Formation</div></a></nav></div></div><div class="col col--3"><div class="tableOfContents_bqdL thin-scrollbar theme-doc-toc-desktop"><ul class="table-of-contents table-of-contents__left-border"><li><a href="#overview" class="table-of-contents__link toc-highlight">Overview</a></li><li><a href="#what-is-a-cluster" class="table-of-contents__link toc-highlight">What is a Cluster?</a></li><li><a href="#cluster-formation" class="table-of-contents__link toc-highlight">Cluster Formation</a><ul><li><a href="#cluster-formation-options" class="table-of-contents__link toc-highlight">Ways of Forming a Cluster</a></li><li><a href="#node-names" class="table-of-contents__link toc-highlight">Node Names (Identifiers)</a></li></ul></li><li><a href="#cluster-formation-requirements" class="table-of-contents__link toc-highlight">Cluster Formation Requirements</a><ul><li><a href="#hostname-resolution-requirement" class="table-of-contents__link toc-highlight">Hostname Resolution</a></li></ul></li><li><a href="#ports" class="table-of-contents__link toc-highlight">Ports That Must Be Opened for Clustering and Replication</a></li><li><a href="#cluster-membership" class="table-of-contents__link toc-highlight">Nodes in a Cluster</a><ul><li><a href="#overview-what-is-replicated" class="table-of-contents__link toc-highlight">What is Replicated?</a></li><li><a href="#peer-equality" class="table-of-contents__link toc-highlight">Nodes are Equal Peers</a></li><li><a href="#erlang-cookie" class="table-of-contents__link toc-highlight">How CLI Tools Authenticate to Nodes (and Nodes to Each Other): the Erlang Cookie</a></li><li><a href="#cookie-file-locations" class="table-of-contents__link toc-highlight">Cookie File Locations</a></li><li><a href="#overriding-using-cli-and-runtime-command-line-arguments" class="table-of-contents__link toc-highlight">Overriding Using CLI and Runtime Command Line Arguments</a></li><li><a href="#cookie-file-troubleshooting" class="table-of-contents__link toc-highlight">Troubleshooting</a></li><li><a href="#peer-authentication-failures" class="table-of-contents__link toc-highlight">Authentication Failures</a></li></ul></li><li><a href="#node-count" class="table-of-contents__link toc-highlight">Node Counts and Quorum</a></li><li><a href="#clustering-and-clients" class="table-of-contents__link toc-highlight">Clustering and Clients</a><ul><li><a href="#messaging-protocols" class="table-of-contents__link toc-highlight">Messaging Protocols</a></li><li><a href="#stream-clients" class="table-of-contents__link toc-highlight">Stream Clients</a></li><li><a href="#replica-placement" class="table-of-contents__link toc-highlight">Queue and Stream Leader Replica Placement</a></li></ul></li><li><a href="#clustering-and-observability" class="table-of-contents__link toc-highlight">Clustering and Observability</a><ul><li><a href="#clustering-dealing-with-failure" class="table-of-contents__link toc-highlight">Node Failure Handling</a></li><li><a href="#clustering-and-stats" class="table-of-contents__link toc-highlight">Metrics and Statistics</a></li></ul></li><li><a href="#manual-transcript" class="table-of-contents__link toc-highlight">Clustering Transcript with <code>rabbitmqctl</code></a></li><li><a href="#starting" class="table-of-contents__link toc-highlight">Starting Independent Nodes</a></li><li><a href="#creating" class="table-of-contents__link toc-highlight">Creating a Cluster</a></li><li><a href="#restarting" class="table-of-contents__link toc-highlight">Restarting Cluster Nodes</a><ul><li><a href="#restarting-schema-sync" class="table-of-contents__link toc-highlight">Schema Syncing from Online Peers</a></li><li><a href="#restarting-readiness-probes" class="table-of-contents__link toc-highlight">Node Restarts, Kubernetes Pod Management and Health Checks (Readiness Probes)</a></li><li><a href="#restarting-with-hostname-changes" class="table-of-contents__link toc-highlight">Hostname Changes Between Restarts</a></li><li><a href="#restarting-transcript" class="table-of-contents__link toc-highlight">Cluster Node Restart Example</a></li></ul></li><li><a href="#removing-nodes" class="table-of-contents__link toc-highlight">How to Remove a Node from the Cluster</a><ul><li><a href="#removal-of-a-reachable-node" class="table-of-contents__link toc-highlight">Removal of a Reachable Node</a></li><li><a href="#removal-of-stopped-nodes-and-their-revival" class="table-of-contents__link toc-highlight">Removal of Stopped Nodes and Their Revival</a></li><li><a href="#removal-of-unresponsive-queues" class="table-of-contents__link toc-highlight">Removal of Unresponsive Queues</a></li><li><a href="#what-happens-to-quorum-queue-and-stream-replicas" class="table-of-contents__link toc-highlight">What Happens to Quorum Queue and Stream Replicas?</a></li><li><a href="#node-removal-is-explicit-manual-or-opt-in" class="table-of-contents__link toc-highlight">Node Removal is Explicit (Manual) or Opt-in</a></li></ul></li><li><a href="#resetting-nodes" class="table-of-contents__link toc-highlight">How to Reset a Node</a><ul><li><a href="#reset-a-running-and-responsive-node" class="table-of-contents__link toc-highlight">Reset a Running and Responsive Node</a></li><li><a href="#reset-an-unresponsive-node" class="table-of-contents__link toc-highlight">Reset an Unresponsive Node</a></li><li><a href="#resetting-a-node-to-re-add-it-as-a-brand-new-node-to-its-original-cluster" class="table-of-contents__link toc-highlight">Resetting a Node to Re-add It as a Brand New Node to Its Original Cluster</a></li></ul></li><li><a href="#forced-boot" class="table-of-contents__link toc-highlight">Forcing Node Boot in Case of Unavailable Peers</a></li><li><a href="#upgrading" class="table-of-contents__link toc-highlight">Upgrading clusters</a></li><li><a href="#single-machine" class="table-of-contents__link toc-highlight">A Cluster on a Single Machine</a></li><li><a href="#issues-hostname" class="table-of-contents__link toc-highlight">Hostname Changes</a></li><li><a href="#firewall" class="table-of-contents__link toc-highlight">Firewalled Nodes</a></li><li><a href="#erlang" class="table-of-contents__link toc-highlight">Erlang Versions Across the Cluster</a></li><li><a href="#clients" class="table-of-contents__link toc-highlight">Connecting to Clusters from Clients</a></li></ul></div></div></div></div></main></div></div></div><footer class="footer footer--dark"><div class="container container-fluid"><div class="row footer__links"><div class="col footer__col"><div class="footer__title">Learn about RabbitMQ</div><ul class="footer__items clean-list"><li class="footer__item"><a class="footer__link-item" href="/rabbitmq-website/tutorials">Getting Started</a></li><li class="footer__item"><a class="footer__link-item" href="/rabbitmq-website/docs">Documentation</a></li><li class="footer__item"><a class="footer__link-item" href="/rabbitmq-website/blog">Blog</a></li></ul></div><div class="col footer__col"><div class="footer__title">Reach out to the RabbitMQ team</div><ul class="footer__items clean-list"><li class="footer__item"><a href="https://github.com/rabbitmq" target="_blank" rel="noopener noreferrer" class="footer__link-item">GitHub<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_nPIU"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a></li><li class="footer__item"><a href="https://github.com/rabbitmq/rabbitmq-server/discussions" target="_blank" rel="noopener noreferrer" class="footer__link-item">GitHub Discussions<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_nPIU"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a></li><li class="footer__item"><a class="footer__link-item" href="/rabbitmq-website/contact?utm_source=rmq_release-information_tableheader&amp;utm_medium=rmq_website&amp;utm_campaign=tanzu">Long Term Commercial Support</a></li><li class="footer__item"><a class="footer__link-item" href="/rabbitmq-website/contact">Contact Us</a></li><li class="footer__item"><a href="https://www.rabbitmq.com/discord" target="_blank" rel="noopener noreferrer" class="footer__link-item">Discord<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_nPIU"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a></li></ul></div><div class="col footer__col"><div class="footer__title">Broadcom</div><ul class="footer__items clean-list"><li class="footer__item"><a href="https://tanzu.vmware.com/" target="_blank" rel="noopener noreferrer" class="footer__link-item">VMware Tanzu<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_nPIU"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a></li><li class="footer__item"><a href="https://www.vmware.com/help/legal.html" target="_blank" rel="noopener noreferrer" class="footer__link-item">Terms of Use<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_nPIU"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a></li><li class="footer__item"><a href="https://www.vmware.com/help/privacy.html" target="_blank" rel="noopener noreferrer" class="footer__link-item">Privacy<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_nPIU"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a></li><li class="footer__item"><a class="footer__link-item" href="/rabbitmq-website/trademark-guidelines">Trademark Guidelines</a></li><li class="footer__item"><a href="https://www.vmware.com/help/privacy/california-privacy-rights.html" target="_blank" rel="noopener noreferrer" class="footer__link-item">Your California Privacy Rights<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_nPIU"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a></li><li class="footer__item"><a class="footer__link-item ot-sdk-show-settings">Cookie Settings</a></li></ul></div></div><div class="footer__bottom text--center"><div class="footer__copyright">Copyright © 2005-2025 Broadcom. All Rights Reserved. The term "Broadcom" refers to Broadcom Inc. and/or its subsidiaries.</div></div></div></footer></div>
</body>
</html>
<!doctype html>
<html lang="en" dir="ltr" class="docs-wrapper plugin-docs plugin-id-default docs-version-3.13 docs-doc-page docs-doc-id-consumers" data-has-hydrated="false">
<head>
<meta charset="UTF-8">
<meta name="generator" content="Docusaurus v3.7.0">
<title data-rh="true">Consumers | RabbitMQ</title><meta data-rh="true" name="viewport" content="width=device-width,initial-scale=1"><meta data-rh="true" name="twitter:card" content="summary_large_image"><meta data-rh="true" property="og:image" content="https://www.rabbitmq.com/rabbitmq-website/img/rabbitmq-social-media-card.svg"><meta data-rh="true" name="twitter:image" content="https://www.rabbitmq.com/rabbitmq-website/img/rabbitmq-social-media-card.svg"><meta data-rh="true" property="og:url" content="https://www.rabbitmq.com/rabbitmq-website/docs/3.13/consumers"><meta data-rh="true" property="og:locale" content="en"><meta data-rh="true" name="docusaurus_locale" content="en"><meta data-rh="true" name="docsearch:language" content="en"><meta data-rh="true" name="docusaurus_version" content="3.13"><meta data-rh="true" name="docusaurus_tag" content="docs-default-3.13"><meta data-rh="true" name="docsearch:version" content="3.13"><meta data-rh="true" name="docsearch:docusaurus_tag" content="docs-default-3.13"><meta data-rh="true" property="og:title" content="Consumers | RabbitMQ"><meta data-rh="true" name="description" content="&lt;!--"><meta data-rh="true" property="og:description" content="&lt;!--"><link data-rh="true" rel="icon" href="/rabbitmq-website/img/rabbitmq-logo.svg"><link data-rh="true" rel="canonical" href="https://www.rabbitmq.com/rabbitmq-website/docs/3.13/consumers"><link data-rh="true" rel="alternate" href="https://www.rabbitmq.com/rabbitmq-website/docs/3.13/consumers" hreflang="en"><link data-rh="true" rel="alternate" href="https://www.rabbitmq.com/rabbitmq-website/docs/3.13/consumers" hreflang="x-default"><link data-rh="true" rel="preconnect" href="https://H10VQIW16Y-dsn.algolia.net" crossorigin="anonymous"><link rel="alternate" type="application/rss+xml" href="/rabbitmq-website/blog/rss.xml" title="RabbitMQ RSS Feed">
<link rel="alternate" type="application/atom+xml" href="/rabbitmq-website/blog/atom.xml" title="RabbitMQ Atom Feed">




<link rel="search" type="application/opensearchdescription+xml" title="RabbitMQ" href="/rabbitmq-website/opensearch.xml">







<link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Raleway:400,700">
<script src="https://cdn.cookielaw.org/scripttemplates/otSDKStub.js" data-domain-script="018ee308-473e-754f-b0c2-cbe82d25512f"></script>
<script>function OptanonWrapper(){}</script>
<script>function setGTM(e,t,o,n,r){e[n]=e[n]||[],e[n].push({"gtm.start":(new Date).getTime(),event:"gtm.js"});var i=t.getElementsByTagName(o)[0],a=t.createElement(o),s="dataLayer"!=n?"&l="+n:"";a.async=!0,a.src="https://www.googletagmanager.com/gtm.js?id="+r+s,i.parentNode.insertBefore(a,i)}var timer;function waitForOnetrustActiveGroups(){document.cookie.indexOf("OptanonConsent")>-1&&document.cookie.indexOf("groups=")>-1?(clearTimeout(timer),setGTM(window,document,"script","dataLayer","GTM-TT84L8K")):timer=setTimeout(waitForOnetrustActiveGroups,250)}document.cookie.indexOf("OptanonConsent")>-1&&document.cookie.indexOf("groups=")>-1?setGTM(window,document,"script","dataLayer","GTM-TT84L8K"):waitForOnetrustActiveGroups()</script><link rel="stylesheet" href="/rabbitmq-website/styles.css">
<script src="/rabbitmq-website/runtime~main.js" defer="defer"></script>
<script src="/rabbitmq-website/main.js" defer="defer"></script>
</head>
<body class="navigation-with-keyboard">
<script>!function(){function t(t){document.documentElement.setAttribute("data-theme",t)}var e=function(){try{return new URLSearchParams(window.location.search).get("docusaurus-theme")}catch(t){}}()||function(){try{return window.localStorage.getItem("theme")}catch(t){}}();null!==e?t(e):window.matchMedia("(prefers-color-scheme: dark)").matches?t("dark"):(window.matchMedia("(prefers-color-scheme: light)").matches,t("light"))}(),function(){try{const n=new URLSearchParams(window.location.search).entries();for(var[t,e]of n)if(t.startsWith("docusaurus-data-")){var a=t.replace("docusaurus-data-","data-");document.documentElement.setAttribute(a,e)}}catch(t){}}(),document.documentElement.setAttribute("data-announcement-bar-initially-dismissed",function(){try{return"true"===localStorage.getItem("docusaurus.announcement.dismiss")}catch(t){}return!1}())</script><div id="__docusaurus"><div role="region" aria-label="Skip to main content"><a class="skipToContent_fXgn" href="#__docusaurus_skipToContent_fallback">Skip to main content</a></div><div class="announcementBar_mb4j" style="background-color:var(--ifm-color-primary-contrast-background);color:var(--ifm-font-color-base)" role="banner"><div class="announcementBarPlaceholder_vyr4"></div><div class="content_knG7 announcementBarContent_xLdY"><strong style="font-size: var(--ifm-h4-font-size);"><a href="https://github.com/rabbitmq/rabbitmq-server/releases/tag/v4.1.0">RabbitMQ 4.1.0 is out</a></strong></div><button type="button" aria-label="Close" class="clean-btn close closeButton_CVFx announcementBarClose_gvF7"><svg viewBox="0 0 15 15" width="14" height="14"><g stroke="currentColor" stroke-width="3.1"><path d="M.75.75l13.5 13.5M14.25.75L.75 14.25"></path></g></svg></button></div><nav aria-label="Main" class="navbar navbar--fixed-top"><div class="navbar__inner"><div class="navbar__items"><button aria-label="Toggle navigation bar" aria-expanded="false" class="navbar__toggle clean-btn" type="button"><svg width="30" height="30" viewBox="0 0 30 30" aria-hidden="true"><path stroke="currentColor" stroke-linecap="round" stroke-miterlimit="10" stroke-width="2" d="M4 7h22M4 15h22M4 23h22"></path></svg></button><a class="navbar__brand" href="/rabbitmq-website/"><div class="navbar__logo"><img src="/rabbitmq-website/img/rabbitmq-logo-with-name.svg" alt="RabbitMQ" class="themedComponent_mlkZ themedComponent--light_NVdE"><img src="/rabbitmq-website/img/rabbitmq-logo-with-name.svg" alt="RabbitMQ" class="themedComponent_mlkZ themedComponent--dark_xIcU"></div></a><a class="navbar__item navbar__link" href="/rabbitmq-website/tutorials">Getting Started</a><a aria-current="page" class="navbar__item navbar__link navbar__link--active" href="/rabbitmq-website/docs/3.13">Docs</a><a class="navbar__item navbar__link" href="/rabbitmq-website/blog">Blog</a><a class="navbar__item navbar__link" href="/rabbitmq-website/contact">Support</a></div><div class="navbar__items navbar__items--right"><div class="navbar__item dropdown dropdown--hoverable dropdown--right"><a aria-current="page" class="navbar__link active" aria-haspopup="true" aria-expanded="false" role="button" href="/rabbitmq-website/docs/3.13/consumers">3.13</a><ul class="dropdown__menu"><li class=""><strong>Release series</strong></li><li><a class="dropdown__link" href="/rabbitmq-website/docs/next/consumers">Next</a></li><li><a class="dropdown__link" href="/rabbitmq-website/docs/consumers">4.1</a></li><li><a class="dropdown__link" href="/rabbitmq-website/docs/4.0/consumers">4.0</a></li><li><a aria-current="page" class="dropdown__link dropdown__link--active" href="/rabbitmq-website/docs/3.13/consumers">3.13</a></li><li><a href="https://v3-12.rabbitmq.com/documentation.html" target="_blank" rel="noopener noreferrer" class="dropdown__link">3.12<svg width="12" height="12" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_nPIU"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a></li><li><a class="dropdown__link" href="/rabbitmq-website/release-information">Release Information</a></li></ul></div><a href="https://github.com/rabbitmq/rabbitmq-website" target="_blank" rel="noopener noreferrer" class="navbar__item navbar__link">GitHub<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_nPIU"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a><div class="toggle_vylO colorModeToggle_DEke"><button class="clean-btn toggleButton_gllP toggleButtonDisabled_aARS" type="button" disabled="" title="Switch between dark and light mode (currently light mode)" aria-label="Switch between dark and light mode (currently light mode)" aria-live="polite" aria-pressed="false"><svg viewBox="0 0 24 24" width="24" height="24" class="lightToggleIcon_pyhR"><path fill="currentColor" d="M12,9c1.65,0,3,1.35,3,3s-1.35,3-3,3s-3-1.35-3-3S10.35,9,12,9 M12,7c-2.76,0-5,2.24-5,5s2.24,5,5,5s5-2.24,5-5 S14.76,7,12,7L12,7z M2,13l2,0c0.55,0,1-0.45,1-1s-0.45-1-1-1l-2,0c-0.55,0-1,0.45-1,1S1.45,13,2,13z M20,13l2,0c0.55,0,1-0.45,1-1 s-0.45-1-1-1l-2,0c-0.55,0-1,0.45-1,1S19.45,13,20,13z M11,2v2c0,0.55,0.45,1,1,1s1-0.45,1-1V2c0-0.55-0.45-1-1-1S11,1.45,11,2z M11,20v2c0,0.55,0.45,1,1,1s1-0.45,1-1v-2c0-0.55-0.45-1-1-1C11.45,19,11,19.45,11,20z M5.99,4.58c-0.39-0.39-1.03-0.39-1.41,0 c-0.39,0.39-0.39,1.03,0,1.41l1.06,1.06c0.39,0.39,1.03,0.39,1.41,0s0.39-1.03,0-1.41L5.99,4.58z M18.36,16.95 c-0.39-0.39-1.03-0.39-1.41,0c-0.39,0.39-0.39,1.03,0,1.41l1.06,1.06c0.39,0.39,1.03,0.39,1.41,0c0.39-0.39,0.39-1.03,0-1.41 L18.36,16.95z M19.42,5.99c0.39-0.39,0.39-1.03,0-1.41c-0.39-0.39-1.03-0.39-1.41,0l-1.06,1.06c-0.39,0.39-0.39,1.03,0,1.41 s1.03,0.39,1.41,0L19.42,5.99z M7.05,18.36c0.39-0.39,0.39-1.03,0-1.41c-0.39-0.39-1.03-0.39-1.41,0l-1.06,1.06 c-0.39,0.39-0.39,1.03,0,1.41s1.03,0.39,1.41,0L7.05,18.36z"></path></svg><svg viewBox="0 0 24 24" width="24" height="24" class="darkToggleIcon_wfgR"><path fill="currentColor" d="M9.37,5.51C9.19,6.15,9.1,6.82,9.1,7.5c0,4.08,3.32,7.4,7.4,7.4c0.68,0,1.35-0.09,1.99-0.27C17.45,17.19,14.93,19,12,19 c-3.86,0-7-3.14-7-7C5,9.07,6.81,6.55,9.37,5.51z M12,3c-4.97,0-9,4.03-9,9s4.03,9,9,9s9-4.03,9-9c0-0.46-0.04-0.92-0.1-1.36 c-0.98,1.37-2.58,2.26-4.4,2.26c-2.98,0-5.4-2.42-5.4-5.4c0-1.81,0.89-3.42,2.26-4.4C12.92,3.04,12.46,3,12,3L12,3z"></path></svg></button></div><div class="navbarSearchContainer_Bca1"><button type="button" class="DocSearch DocSearch-Button" aria-label="Search (Command+K)"><span class="DocSearch-Button-Container"><svg width="20" height="20" class="DocSearch-Search-Icon" viewBox="0 0 20 20" aria-hidden="true"><path d="M14.386 14.386l4.0877 4.0877-4.0877-4.0877c-2.9418 2.9419-7.7115 2.9419-10.6533 0-2.9419-2.9418-2.9419-7.7115 0-10.6533 2.9418-2.9419 7.7115-2.9419 10.6533 0 2.9419 2.9418 2.9419 7.7115 0 10.6533z" stroke="currentColor" fill="none" fill-rule="evenodd" stroke-linecap="round" stroke-linejoin="round"></path></svg><span class="DocSearch-Button-Placeholder">Search</span></span><span class="DocSearch-Button-Keys"></span></button></div></div></div><div role="presentation" class="navbar-sidebar__backdrop"></div></nav><div id="__docusaurus_skipToContent_fallback" class="main-wrapper mainWrapper_z2l0"><div class="docsWrapper_hBAB"><button aria-label="Scroll back to top" class="clean-btn theme-back-to-top-button backToTopButton_sjWU" type="button"></button><div class="docRoot_UBD9"><aside class="theme-doc-sidebar-container docSidebarContainer_YfHR"><div class="sidebarViewport_aRkj"><div class="sidebar_njMd"><nav aria-label="Docs sidebar" class="menu thin-scrollbar menu_SIkG menuWithAnnouncementBar_GW3s"><ul class="theme-doc-sidebar-menu menu__list"><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/rabbitmq-website/docs/3.13">Introduction</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/rabbitmq-website/docs/3.13/whats-new">What&#x27;s New</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/rabbitmq-website/tutorials">Getting Started</a></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist" href="/rabbitmq-website/docs/3.13/download">Install and Upgrade</a><button aria-label="Expand sidebar category &#x27;Install and Upgrade&#x27;" aria-expanded="false" type="button" class="clean-btn menu__caret"></button></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--active" href="/rabbitmq-website/docs/3.13/use-rabbitmq">How to Use RabbitMQ</a><button aria-label="Collapse sidebar category &#x27;How to Use RabbitMQ&#x27;" aria-expanded="true" type="button" class="clean-btn menu__caret"></button></div><ul style="display:block;overflow:visible;height:auto" class="menu__list"><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-2 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist" tabindex="0" href="/rabbitmq-website/docs/3.13/publishers">Publishing Messages</a><button aria-label="Expand sidebar category &#x27;Publishing Messages&#x27;" aria-expanded="false" type="button" class="clean-btn menu__caret"></button></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-2 menu__list-item"><div class="menu__list-item-collapsible menu__list-item-collapsible--active"><a class="menu__link menu__link--sublist menu__link--active" aria-current="page" tabindex="0" href="/rabbitmq-website/docs/3.13/consumers">Consuming Messages</a><button aria-label="Collapse sidebar category &#x27;Consuming Messages&#x27;" aria-expanded="true" type="button" class="clean-btn menu__caret"></button></div><ul style="display:block;overflow:visible;height:auto" class="menu__list"><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class="menu__link" tabindex="0" href="/rabbitmq-website/docs/3.13/consumer-cancel">Consumer Cancellation Notifications</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class="menu__link" tabindex="0" href="/rabbitmq-website/docs/3.13/consumer-prefetch">Consumer Prefetch</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class="menu__link" tabindex="0" href="/rabbitmq-website/docs/3.13/consumer-priority">Consumer Priorites</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class="menu__link" tabindex="0" href="/rabbitmq-website/docs/3.13/nack">Negative Acknowledgements</a></li></ul></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-2 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist" tabindex="0" href="/rabbitmq-website/docs/3.13/queues">Queues</a><button aria-label="Expand sidebar category &#x27;Queues&#x27;" aria-expanded="false" type="button" class="clean-btn menu__caret"></button></div></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/rabbitmq-website/docs/3.13/streams">Streams</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/rabbitmq-website/docs/3.13/channels">Channels</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/rabbitmq-website/docs/3.13/reliability">Reliability and Data Safety</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/rabbitmq-website/docs/3.13/confirms">Consumer Acknowledgements and Publisher Confirms</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/rabbitmq-website/docs/3.13/distributed">Network Distribution</a></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-2 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist" tabindex="0" href="/rabbitmq-website/docs/3.13/plugins">Plugins</a><button aria-label="Expand sidebar category &#x27;Plugins&#x27;" aria-expanded="false" type="button" class="clean-btn menu__caret"></button></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-2 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist" tabindex="0" href="/rabbitmq-website/docs/3.13/protocols">Protocols</a><button aria-label="Expand sidebar category &#x27;Protocols&#x27;" aria-expanded="false" type="button" class="clean-btn menu__caret"></button></div></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/rabbitmq-website/client-libraries">Client Libraries</a></li></ul></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist" href="/rabbitmq-website/docs/3.13/manage-rabbitmq">How to Manage RabbitMQ</a><button aria-label="Expand sidebar category &#x27;How to Manage RabbitMQ&#x27;" aria-expanded="false" type="button" class="clean-btn menu__caret"></button></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist" href="/rabbitmq-website/docs/3.13/monitoring">How to Monitor RabbitMQ</a><button aria-label="Expand sidebar category &#x27;How to Monitor RabbitMQ&#x27;" aria-expanded="false" type="button" class="clean-btn menu__caret"></button></div></li></ul></nav></div></div></aside><main class="docMainContainer_TBSr"><div class="container padding-top--md padding-bottom--lg"><div class="row"><div class="col docItemCol_VOVn"><div class="theme-doc-version-banner alert alert--warning margin-bottom--md" role="alert"><div>This is documentation for <!-- -->RabbitMQ<!-- --> <b>3.13</b>, which is no longer actively maintained.</div><div class="margin-top--md">For up-to-date documentation, see the <b><a href="/rabbitmq-website/docs/consumers">latest version</a></b> (<!-- -->4.1<!-- -->).</div></div><div class="docItemContainer_Djhp"><article><nav class="theme-doc-breadcrumbs breadcrumbsContainer_Z_bl" aria-label="Breadcrumbs"><ul class="breadcrumbs" itemscope="" itemtype="https://schema.org/BreadcrumbList"><li class="breadcrumbs__item"><a aria-label="Home page" class="breadcrumbs__link" href="/rabbitmq-website/"><svg viewBox="0 0 24 24" class="breadcrumbHomeIcon_YNFT"><path d="M10 19v-5h4v5c0 .55.45 1 1 1h3c.55 0 1-.45 1-1v-7h1.7c.46 0 .68-.57.33-.87L12.67 3.6c-.38-.34-.96-.34-1.34 0l-8.36 7.53c-.34.3-.13.87.33.87H5v7c0 .55.45 1 1 1h3c.55 0 1-.45 1-1z" fill="currentColor"></path></svg></a></li><li itemscope="" itemprop="itemListElement" itemtype="https://schema.org/ListItem" class="breadcrumbs__item"><a class="breadcrumbs__link" itemprop="item" href="/rabbitmq-website/docs/3.13/use-rabbitmq"><span itemprop="name">How to Use RabbitMQ</span></a><meta itemprop="position" content="1"></li><li itemscope="" itemprop="itemListElement" itemtype="https://schema.org/ListItem" class="breadcrumbs__item breadcrumbs__item--active"><span class="breadcrumbs__link" itemprop="name">Consuming Messages</span><meta itemprop="position" content="2"></li></ul></nav><span class="theme-doc-version-badge badge badge--secondary">Version: 3.13</span><div class="tocCollapsible_ETCw theme-doc-toc-mobile tocMobile_ITEo"><button type="button" class="clean-btn tocCollapsibleButton_TO0P">On this page</button></div><div class="theme-doc-markdown markdown"><header><h1>Consumers</h1></header>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="overview">Overview<a href="#overview" class="hash-link" aria-label="Direct link to Overview" title="Direct link to Overview">​</a></h2>
<p>This guide covers various topics related to consumers:</p>
<ul>
<li><a href="#basics">The basics</a></li>
<li><a href="#consumer-lifecycle">Consumer lifecycle</a></li>
<li><a href="#subscribing">How to register a consumer</a> (subscribe, &quot;push API&quot;)</li>
<li><a href="#acknowledgement-modes">Acknowledgement modes</a></li>
<li><a href="#message-properties">Message properties</a> and delivery metadata</li>
<li><a href="#prefetch">How to limit number of outstanding deliveries with prefetch</a></li>
<li><a href="#acknowledgement-timeout">Delivery acknowledgement timeout</a></li>
<li><a href="#metrics-capacity">Consumer capacity</a> metric</li>
<li><a href="#unsubscribing">How to cancel a consumer</a></li>
<li><a href="#exclusivity">Consumer exclusivity</a></li>
<li><a href="#single-active-consumer">Single active consumer</a></li>
<li><a href="#active-consumer">Consumer activity</a></li>
<li><a href="#priority">Consumer priority</a></li>
<li><a href="#connection-recovery">Connection failure recovery</a></li>
<li><a href="#exceptions">Exception Handling</a></li>
<li><a href="#concurrency">Concurrency Consideration</a></li>
</ul>
<p>and more.</p>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="terminology">Terminology<a href="#terminology" class="hash-link" aria-label="Direct link to Terminology" title="Direct link to Terminology">​</a></h2>
<p>The term &quot;consumer&quot; means different things in different contexts. In general, in the context of messaging
and streaming, a consumer is an application (or application instance) that consumes and <a href="/rabbitmq-website/docs/3.13/confirms">acknowledges</a>
messages. The same application can also publish messages and thus be a publisher at the same time.</p>
<p>Messaging protocols also have the concept of a lasting subscription for message delivery.
Subscription is one term commonly used to describe such entity. Consumer is another.
Messaging protocols supported by RabbitMQ use both terms but RabbitMQ documentation tends to
prefer the latter.</p>
<p>In this sense a consumer is a subscription for message delivery that has to be
registered before deliveries begin and can be cancelled by the application.</p>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="basics">The Basics<a href="#basics" class="hash-link" aria-label="Direct link to The Basics" title="Direct link to The Basics">​</a></h2>
<p>RabbitMQ is a messaging broker. It accepts messages from publishers, routes them
and, if there were queues to route to, stores them for consumption or immediately
delivers to consumers, if any.</p>
<p>Consumers consume from queues. In order to consume messages there has to be a queue.
When a new consumer is added, assuming there are already messages ready in the queue,
deliveries will start immediately.</p>
<p>The target queue can be empty at the time of consumer registration. In that case
first deliveries will happen when new messages are enqueued.</p>
<p>An attempt to consume from a non-existent queue will result in a channel-level
exception with the code of <code>404 Not Found</code> and render the channel it was attempted
on to be closed.</p>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="consumer-tags">Consumer Tags<a href="#consumer-tags" class="hash-link" aria-label="Direct link to Consumer Tags" title="Direct link to Consumer Tags">​</a></h3>
<p>Every consumer has an identifier that is used by client libraries to determine
what handler to invoke for a given delivery. Their names vary from protocol to protocol.
Consumer tags and subscription IDs are two most commonly used terms. RabbitMQ documentation
tends to use the former.</p>
<p>Consumer tags are also used to cancel consumers.</p>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="consumer-lifecycle">Consumer Lifecycle<a href="#consumer-lifecycle" class="hash-link" aria-label="Direct link to Consumer Lifecycle" title="Direct link to Consumer Lifecycle">​</a></h3>
<p>Consumers are meant to be long lived: that is, throughout the lifetime of a consumer it receives
multiple deliveries. Registering a consumer to consume a single message is not optimal.</p>
<p>Consumers are typically registered during application
startup. They often would live as long as their connection or even application
runs.</p>
<p>Consumers can be more dynamic and register in reaction to a system event, unsubscribing
when they are no longer necessary. This is common with WebSocket clients
used via <a href="/rabbitmq-website/docs/3.13/web-stomp">Web STOMP</a> and <a href="/rabbitmq-website/docs/3.13/web-mqtt">Web MQTT</a> plugins, mobile clients and so on.</p>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="connection-recovery">Connection Recovery<a href="#connection-recovery" class="hash-link" aria-label="Direct link to Connection Recovery" title="Direct link to Connection Recovery">​</a></h3>
<p>Client can lose their connection to RabbitMQ. When connection loss is <a href="/rabbitmq-website/docs/3.13/heartbeats">detected</a>,
message delivery stops.</p>
<p>Some client libraries offer automatic connection recovery features that involves consumer recovery.
<a href="/rabbitmq-website/client-libraries/java-api-guide#recovery">Java</a>, <a href="/rabbitmq-website/client-libraries/dotnet-api-guide#recovery">.NET</a> and <a href="http://rubybunny.info/articles/error_handling.html" target="_blank" rel="noopener noreferrer">Bunny</a>
are examples of such libraries.
While connection recovery cannot cover 100% of scenarios and workloads, it generally works very well for consuming
applications and is recommended.</p>
<p>With other client libraries application developers are responsible for performing connection
recovery. Usually the following recovery sequence works well:</p>
<ul>
<li>Recover connection</li>
<li>Recover channels</li>
<li>Recover queues</li>
<li>Recover exchanges</li>
<li>Recover bindings</li>
<li>Recover consumers</li>
</ul>
<p>In other words, consumers are usually recovered last, after their target queues and those queues&#x27;
bindings are in place.</p>
<div class="theme-admonition theme-admonition-important admonition_xJq3 alert alert--info"><div class="admonitionHeading_Gvgb"><span class="admonitionIcon_Rf37"><svg viewBox="0 0 14 16"><path fill-rule="evenodd" d="M7 2.3c3.14 0 5.7 2.56 5.7 5.7s-2.56 5.7-5.7 5.7A5.71 5.71 0 0 1 1.3 8c0-3.14 2.56-5.7 5.7-5.7zM7 1C3.14 1 0 4.14 0 8s3.14 7 7 7 7-3.14 7-7-3.14-7-7-7zm1 3H6v5h2V4zm0 6H6v2h2v-2z"></path></svg></span>important</div><div class="admonitionContent_BuS1"><p>Note that automatically recovering connections that use auto-delete and exclusive queues
should <a href="/rabbitmq-website/docs/3.13/queues#shared-temporary-queues">make sure that these queues are server-named</a>.</p></div></div>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="subscribing">Registering a Consumer (Subscribing, &quot;Push API&quot;)<a href="#subscribing" class="hash-link" aria-label="Direct link to Registering a Consumer (Subscribing, &quot;Push API&quot;)" title="Direct link to Registering a Consumer (Subscribing, &quot;Push API&quot;)">​</a></h2>
<p>Applications can subscribe to have RabbitMQ push enqueued messages (deliveries) to them.
This is done by registering a consumer (subscription) on a queue. After a subscription
is in place, RabbitMQ will begin delivering messages. For each delivery
a user-provided handler will be invoked. Depending on the client library used
this can be a user-provided function or object that adheres to a certain interface.</p>
<p>A successful subscription operation returns a subscription identifier (consumer tag).
It can later be used to cancel the consumer.</p>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="java-client">Java Client<a href="#java-client" class="hash-link" aria-label="Direct link to Java Client" title="Direct link to Java Client">​</a></h3>
<p>See <a href="/rabbitmq-website/client-libraries/java-api-guide#consuming">Java client guide</a> for examples.</p>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="net-client">.NET Client<a href="#net-client" class="hash-link" aria-label="Direct link to .NET Client" title="Direct link to .NET Client">​</a></h3>
<p>See <a href="/rabbitmq-website/client-libraries/dotnet-api-guide#consuming">.NET client guide</a> for examples.</p>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="message-properties">Message Properties and Delivery Metadata<a href="#message-properties" class="hash-link" aria-label="Direct link to Message Properties and Delivery Metadata" title="Direct link to Message Properties and Delivery Metadata">​</a></h2>
<p>Every delivery combines message metadata and delivery information. Different client
libraries use slightly different ways of providing access to those properties. Typically
delivery handlers have access to a delivery data structure.</p>
<p>The following properties are delivery and routing details; they are not message properties per se
and set by RabbitMQ at routing and delivery time:</p>
<table><thead><tr><td>Property</td><td>Type</td><td>Description</td></tr></thead><tbody><tr><td>Delivery tag</td><td>Positive integer</td><td><p>Delivery identifier, see <a href="./confirms">Confirms</a>.</p></td></tr><tr><td>Redelivered</td><td>Boolean</td><td>Set to <code>true</code> if this message was previously <a href="./confirms#consumer-nacks-requeue">delivered and requeued</a></td></tr><tr><td>Exchange</td><td>String</td><td>Exchange which routed this message</td></tr><tr><td>Routing key</td><td>String</td><td>Routing key used by the publisher</td></tr><tr><td>Consumer tag</td><td>String</td><td>Consumer (subscription) identifier</td></tr></tbody></table>
<p>The following are message properties. Most of them are optional. They are set by publishers
at the time of publishing:</p>
<table><thead><tr><td>Property</td><td>Type</td><td>Description</td><td>Required?</td></tr></thead><tbody><tr><td>Delivery mode</td><td>Enum (1 or 2)</td><td><p>2 for &quot;persistent&quot;, 1 for &quot;transient&quot;. Some client libraries expose this property
as a boolean or enum.</p></td><td>Yes</td></tr><tr><td>Type</td><td>String</td><td>Application-specific message type, e.g. &quot;orders.created&quot;</td><td>No</td></tr><tr><td>Headers</td><td>Map (string =&gt; any)</td><td>An arbitrary map of headers with string header names</td><td>No</td></tr><tr><td>Content type</td><td>String</td><td>Content type, e.g. &quot;application/json&quot;. Used by applications, not core RabbitMQ</td><td>No</td></tr><tr><td>Content encoding</td><td>String</td><td>Content encoding, e.g. &quot;gzip&quot;. Used by applications, not core RabbitMQ</td><td>No</td></tr><tr><td>Message ID</td><td>String</td><td>Arbitrary message ID</td><td>No</td></tr><tr><td>Correlation ID</td><td>String</td><td>Helps correlate requests with responses, see <a href="/tutorials">tutorial 6</a></td><td>No</td></tr><tr><td>Reply To</td><td>String</td><td>Carries response queue name, see <a href="/tutorials">tutorial 6</a></td><td>No</td></tr><tr><td>Expiration</td><td>String</td><td><a href="./ttl">Per-message TTL</a></td><td>No</td></tr><tr><td>Timestamp</td><td>Timestamp</td><td>Application-provided timestamp</td><td>No</td></tr><tr><td>User ID</td><td>String</td><td>User ID, <a href="./validated-user-id">validated</a> if set</td><td>No</td></tr><tr><td>App ID</td><td>String</td><td>Application name</td><td>No</td></tr></tbody></table>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="message-types">Message Types<a href="#message-types" class="hash-link" aria-label="Direct link to Message Types" title="Direct link to Message Types">​</a></h3>
<p>The type property on messages is an arbitrary string that helps applications communicate what kind
of message that is. It is set by the publishers at the time of publishing.
The value can be any domain-specific string that publishers and consumers agree on.</p>
<p>RabbitMQ does not validate or use this field, it exists for applications and plugins to use
and interpret.</p>
<p>Message types in practice naturally fall into groups, a dot-separated naming convention is
common (but not required by RabbitMQ or clients), e.g. <code>orders.created</code> or <code>logs.line</code> or <code>profiles.image.changed</code>.</p>
<p>If a consumer gets a delivery of a type it cannot handle, it is highly advised to log
such events to make troubleshooting easier.</p>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="content-type-and-encoding">Content Type and Encoding<a href="#content-type-and-encoding" class="hash-link" aria-label="Direct link to Content Type and Encoding" title="Direct link to Content Type and Encoding">​</a></h3>
<p>The content (MIME media) type and content encoding fields allow publishers communicate how message payload
should be deserialized and decoded by consumers.</p>
<p>RabbitMQ does not validate or use these fields, it exists for applications and plugins to use
and interpret.</p>
<p>For example, messages with JSON payload <a href="http://www.ietf.org/rfc/rfc4627.txt" target="_blank" rel="noopener noreferrer">should use <code>application/json</code></a>.
If the payload is compressed with the LZ77 (GZip) algorithm, its content encoding should be <code>gzip</code>.</p>
<p>Multiple encodings can be specified by separating them with commas.</p>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="acknowledgement-modes">Acknowledgement Modes<a href="#acknowledgement-modes" class="hash-link" aria-label="Direct link to Acknowledgement Modes" title="Direct link to Acknowledgement Modes">​</a></h2>
<p>When registering a consumer applications can choose one of two delivery modes:</p>
<ul>
<li>Automatic (deliveries require no acknowledgement, a.k.a. &quot;fire and forget&quot;)</li>
<li>Manual (deliveries require client acknowledgement)</li>
</ul>
<p>Consumer acknowledgements are a subject of a <a href="/rabbitmq-website/docs/3.13/confirms">separate documentation guide</a>, together with
publisher confirms, a closely related concept for publishers.</p>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="prefetch">Limiting Simultaneous Deliveries with Prefetch<a href="#prefetch" class="hash-link" aria-label="Direct link to Limiting Simultaneous Deliveries with Prefetch" title="Direct link to Limiting Simultaneous Deliveries with Prefetch">​</a></h2>
<p>With manual acknowledgement mode consumers have a way of limiting how many deliveries can be &quot;in flight&quot; (in transit
over the network or delivered but unacknowledged). This can avoid consumer overload.</p>
<p>This feature, together with consumer acknowledgements are a subject of a <a href="/rabbitmq-website/docs/3.13/confirms">separate documentation guide</a>.</p>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="metrics-capacity">The Consumer Capacity Metric<a href="#metrics-capacity" class="hash-link" aria-label="Direct link to The Consumer Capacity Metric" title="Direct link to The Consumer Capacity Metric">​</a></h2>
<p>RabbitMQ <a href="/rabbitmq-website/docs/3.13/management">management UI</a> as well as <a href="/rabbitmq-website/docs/3.13/monitoring">monitoring data</a> endpoints such as that for <a href="/rabbitmq-website/docs/3.13/prometheus">Prometheus scraping</a>
display a metric called consumer capacity (previously consumer utilisation) for individual queues.</p>
<p>The metric is computed as a fraction of the time that the queue is able to immediately deliver messages to consumers.
It helps the operator notice conditions where it <strong>may</strong> be worthwhile adding more consumers (application instances)
to the queue.</p>
<p>If this number is less than 100%, the queue leader replica may be able to deliver messages faster if:</p>
<ul>
<li>There were more consumers or</li>
<li>The consumers spent less time processing deliveries or</li>
<li>The consumer channels used a higher <a href="#prefetch">prefetch value</a></li>
</ul>
<p>Consumer capacity will be 0% for queues that have no consumers. For queues that have online consumers but
no message flow, the value will be 100%: the idea is that any number of consumers can sustain this
kind of delivery rate.</p>
<p>Note that consumer capacity is merely a hint. Consumer applications can and should collect more specific
metrics about their operations to help with sizing and any possible capacity changes.</p>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="unsubscribing">Cancelling a Consumer (Unsubscribing)<a href="#unsubscribing" class="hash-link" aria-label="Direct link to Cancelling a Consumer (Unsubscribing)" title="Direct link to Cancelling a Consumer (Unsubscribing)">​</a></h2>
<p>To cancel a consumer, its identifier (consumer tag) must be known.</p>
<p>After a consumer is cancelled there will be no future deliveries dispatched
to it. Note that there can still be &quot;in flight&quot; deliveries dispatched previously.
Cancelling a consumer will neither discard nor requeue them.</p>
<p>A cancelled consumer will not observe any new deliveries besides those in-flight at
the moment of processing <code>basic.cancel</code> method by RabbitMQ. All previously unconfirmed
deliveries will not be affected in any way. To re-queue in-flight deliveries, the
application must close the channel.</p>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="java-client-1">Java Client<a href="#java-client-1" class="hash-link" aria-label="Direct link to Java Client" title="Direct link to Java Client">​</a></h3>
<p>See <a href="/rabbitmq-website/client-libraries/java-api-guide#consuming">Java client guide</a> for examples.</p>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="net-client-1">.NET Client<a href="#net-client-1" class="hash-link" aria-label="Direct link to .NET Client" title="Direct link to .NET Client">​</a></h3>
<p>See <a href="/rabbitmq-website/client-libraries/dotnet-api-guide#consuming">.NET client guide</a> for examples.</p>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="polling">Polling for Individual Messages (&quot;Pull API&quot;)<a href="#polling" class="hash-link" aria-label="Direct link to Polling for Individual Messages (&quot;Pull API&quot;)" title="Direct link to Polling for Individual Messages (&quot;Pull API&quot;)">​</a></h2>
<div class="theme-admonition theme-admonition-danger admonition_xJq3 alert alert--danger"><div class="admonitionHeading_Gvgb"><span class="admonitionIcon_Rf37"><svg viewBox="0 0 12 16"><path fill-rule="evenodd" d="M5.05.31c.81 2.17.41 3.38-.52 4.31C3.55 5.67 1.98 6.45.9 7.98c-1.45 2.05-1.7 6.53 3.53 7.7-2.2-1.16-2.67-4.52-.3-6.61-.61 2.03.53 3.33 1.94 2.86 1.39-.47 2.3.53 2.27 1.67-.02.78-.31 1.44-1.13 1.81 3.42-.59 4.78-3.42 4.78-5.56 0-2.84-2.53-3.22-1.25-5.61-1.52.13-2.03 1.13-1.89 2.75.09 1.08-1.02 1.8-1.86 1.33-.67-.41-.66-1.19-.06-1.78C8.18 5.31 8.68 2.45 5.05.32L5.03.3l.02.01z"></path></svg></span>danger</div><div class="admonitionContent_BuS1"><p>The mechanism described in this section is a form of polling. As any polling-based
approach in distributed systems, it is highly inefficient, in particular in cases where queues can
be empty for periods of time.</p><p>Besides integration tests, this AMQP 0-9-1 consumption mechanism is strongly recommended against.</p><p>RabbitMQ <a href="/rabbitmq-website/docs/3.13/management">management</a> and <a href="/rabbitmq-website/docs/3.13/prometheus">Prometheus</a> plugins provide several metrics that help detect
applications that use polling (<code>basic.get</code>).</p></div></div>
<div class="theme-admonition theme-admonition-tip admonition_xJq3 alert alert--success"><div class="admonitionHeading_Gvgb"><span class="admonitionIcon_Rf37"><svg viewBox="0 0 12 16"><path fill-rule="evenodd" d="M6.5 0C3.48 0 1 2.19 1 5c0 .92.55 2.25 1 3 1.34 2.25 1.78 2.78 2 4v1h5v-1c.22-1.22.66-1.75 2-4 .45-.75 1-2.08 1-3 0-2.81-2.48-5-5.5-5zm3.64 7.48c-.25.44-.47.8-.67 1.11-.86 1.41-1.25 2.06-1.45 3.23-.02.05-.02.11-.02.17H5c0-.06 0-.13-.02-.17-.2-1.17-.59-1.83-1.45-3.23-.2-.31-.42-.67-.67-1.11C2.44 6.78 2 5.65 2 5c0-2.2 2.02-4 4.5-4 1.22 0 2.36.42 3.22 1.19C10.55 2.94 11 3.94 11 5c0 .66-.44 1.78-.86 2.48zM4 14h5c-.23 1.14-1.3 2-2.5 2s-2.27-.86-2.5-2z"></path></svg></span>tip</div><div class="admonitionContent_BuS1"><p>Use <a href="#consumer-lifecycle">long-lived consumers</a> instead of polling.</p></div></div>
<p>With AMQP 0-9-1 it is possible to fetch messages one by one using the <code>basic.get</code> protocol
method. Messages are fetched in the FIFO order. It is possible to use automatic or manual acknowledgements,
just like with consumers (subscriptions).</p>
<p>Fetching messages one by one is <strong>highly discouraged</strong> as it is <strong>very inefficient</strong>
compared to <a href="#subscribing">regular long-lived consumers</a>. As with any polling-based algorithm,
it will be <strong>extremely wasteful</strong> in systems where message publishing is sporadic and queues
can stay empty for prolonged periods of time.</p>
<p>When in doubt, prefer using a regular long-lived consumer.</p>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="java-client-2">Java Client<a href="#java-client-2" class="hash-link" aria-label="Direct link to Java Client" title="Direct link to Java Client">​</a></h3>
<p>See <a href="/rabbitmq-website/client-libraries/java-api-guide#getting">Java client guide</a> for examples.</p>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="net-client-2">.NET Client<a href="#net-client-2" class="hash-link" aria-label="Direct link to .NET Client" title="Direct link to .NET Client">​</a></h3>
<p>See <a href="/rabbitmq-website/client-libraries/dotnet-api-guide#basic-get">.NET client guide</a> for examples.</p>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="acknowledgement-timeout">Delivery Acknowledgement Timeout<a href="#acknowledgement-timeout" class="hash-link" aria-label="Direct link to Delivery Acknowledgement Timeout" title="Direct link to Delivery Acknowledgement Timeout">​</a></h2>
<p>RabbitMQ enforces a timeout on consumer delivery acknowledgement.
This is a <strong>protection mechanism</strong> that detects when consumers do not acknowledge message deliveries.
Configuring a delivery acknowledgement timeout can help prevent on-disk data compaction
and driving nodes out of disk space.</p>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="how-it-works">How it works<a href="#how-it-works" class="hash-link" aria-label="Direct link to How it works" title="Direct link to How it works">​</a></h3>
<p>If a consumer does not ack its delivery within the timeout value,
its channel is closed with a <code>PRECONDITION_FAILED</code> channel exception.
The message will look like this:</p>
<div class="codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">Consumer &#x27;consumer-tag-998754663370&#x27; on channel 1 and queue &#x27;qq.1&#x27; in vhost &#x27;/&#x27; has timed out</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">waiting for a consumer acknowledgement of a delivery with delivery tag = 10. Timeout used: 180000 ms.</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">This timeout value can be configured, see consumers doc guide to learn more</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>The error is <a href="/rabbitmq-website/docs/3.13/logging">logged</a> by the node to which the consumer was connected.
All the following deliveries on that channel, from all consumers,
are then <a href="/rabbitmq-website/docs/3.13/confirms#automatic-requeueing">requeued</a>.
To resolve a <code>PRECONDITION_FAILED</code> channel exception, reevaluate your consumer
and consider increasing the timeout value.</p>
<p>The default timeout value for RabbitMQ is 30 minutes.
Whether the timeout should be enforced is evaluated periodically, at one minute intervals.
Values lower than one minute are not supported, and values lower than five minutes
are not recommended.</p>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="per-node-configuration">Per-node Configuration<a href="#per-node-configuration" class="hash-link" aria-label="Direct link to Per-node Configuration" title="Direct link to Per-node Configuration">​</a></h3>
<p>The timeout value is configurable in <a href="/rabbitmq-website/docs/3.13/configure#config-file">rabbitmq.conf</a> (in milliseconds):</p>
<div class="language-ini codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-ini codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain"># 30 minutes in milliseconds</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">consumer_timeout = 1800000</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<div class="language-ini codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-ini codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain"># one hour in milliseconds</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">consumer_timeout = 3600000</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>The timeout can be deactivated using <a href="/rabbitmq-website/docs/3.13/configure#advanced-config-file"><code>advanced.config</code></a>. This is <strong>not recommended</strong>:</p>
<div class="language-erlang codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-erlang codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token comment" style="color:#999988;font-style:italic">%% advanced.config</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">[</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token punctuation" style="color:#393A34">{</span><span class="token atom">rabbit</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">[</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token punctuation" style="color:#393A34">{</span><span class="token atom">consumer_timeout</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token atom">undefined</span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token punctuation" style="color:#393A34">]</span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">]</span><span class="token punctuation" style="color:#393A34">.</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>Instead of disabling the timeout entirely, consider using a high value (for example, a few hours).</p>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="per-queue-configuration">Per-queue Configuration<a href="#per-queue-configuration" class="hash-link" aria-label="Direct link to Per-queue Configuration" title="Direct link to Per-queue Configuration">​</a></h3>
<p>Starting with RabbitMQ 3.12, the timeout value can also be configured per-queue.</p>
<h4 class="anchor anchorWithStickyNavbar_LWe7" id="per-queue-delivery-timeouts-using-a-policy">Per-queue Delivery Timeouts Using a Policy<a href="#per-queue-delivery-timeouts-using-a-policy" class="hash-link" aria-label="Direct link to Per-queue Delivery Timeouts Using a Policy" title="Direct link to Per-queue Delivery Timeouts Using a Policy">​</a></h4>
<p>Set the <code>consumer-timeout</code> policy key.</p>
<p>The value must be in milliseconds.
Whether the timeout should be enforced is evaluated periodically, at one minute intervals.</p>
<div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token comment" style="color:#999988;font-style:italic"># override consumer timeout for a group of queues using a policy</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">rabbitmqctl set_policy queue_consumer_timeout </span><span class="token string" style="color:#e3116c">&quot;with_delivery_timeout\.*&quot;</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&#x27;{&quot;consumer-timeout&quot;:3600000}&#x27;</span><span class="token plain"> --apply-to classic_queues</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<h4 class="anchor anchorWithStickyNavbar_LWe7" id="per-queue-delivery-timeouts-using-an-optional-queue-argument">Per-queue Delivery Timeouts Using an Optional Queue Argument<a href="#per-queue-delivery-timeouts-using-an-optional-queue-argument" class="hash-link" aria-label="Direct link to Per-queue Delivery Timeouts Using an Optional Queue Argument" title="Direct link to Per-queue Delivery Timeouts Using an Optional Queue Argument">​</a></h4>
<p>Set the <code>x-consumer-timeout</code> <a href="/rabbitmq-website/docs/3.13/queues#optional-arguments">optional queue argument</a> on a queue when the queue is declared.
The timeout is specified in milliseconds.
Whether the timeout should be enforced is evaluated periodically, at one minute intervals.</p>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="limiting-the-number-of-consumers-per-channel">Limiting the number of Consumers per channel<a href="#limiting-the-number-of-consumers-per-channel" class="hash-link" aria-label="Direct link to Limiting the number of Consumers per channel" title="Direct link to Limiting the number of Consumers per channel">​</a></h2>
<p>In some scenarios where consumer leaks can happen it is good to limit the number of consumers that can be active on
each channel. This can be configured in <a href="/rabbitmq-website/docs/3.13/configure#config-file">rabbitmq.conf</a> using the setting <code>consumer_max_per_channel</code>:</p>
<div class="language-ini codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-ini codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">consumer_max_per_channel = 100</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="exclusivity">Exclusivity<a href="#exclusivity" class="hash-link" aria-label="Direct link to Exclusivity" title="Direct link to Exclusivity">​</a></h2>
<p>For <a href="/rabbitmq-website/docs/3.13/quorum-queues#feature-matrix">Classic Queues only</a>, when registering a consumer
with an AMQP 0-9-1 client, the <code>exclusive</code> flag of the <code>basic.consume</code> method can be
set to true to request the consumer to be the only one on the target queue. The call
succeeds only if there&#x27;s no consumer already registered to the queue at that time.
This allows to make sure only one consumer at a time consumes from the queue.</p>
<p>If the exclusive consumer is cancelled or dies, this is the application
responsibility to register a new one to keep on consuming from the queue.</p>
<p>If exclusive consumption <strong>and</strong> consumption continuity are required,
use <a href="#single-active-consumer">single active consumer</a>.</p>
<div class="theme-admonition theme-admonition-important admonition_xJq3 alert alert--info"><div class="admonitionHeading_Gvgb"><span class="admonitionIcon_Rf37"><svg viewBox="0 0 14 16"><path fill-rule="evenodd" d="M7 2.3c3.14 0 5.7 2.56 5.7 5.7s-2.56 5.7-5.7 5.7A5.71 5.71 0 0 1 1.3 8c0-3.14 2.56-5.7 5.7-5.7zM7 1C3.14 1 0 4.14 0 8s3.14 7 7 7 7-3.14 7-7-3.14-7-7-7zm1 3H6v5h2V4zm0 6H6v2h2v-2z"></path></svg></span>important</div><div class="admonitionContent_BuS1"><p><a href="/rabbitmq-website/docs/3.13/quorum-queues">Quorum queues</a> will ignore the <code>exclusive</code> flag on the <code>basic.consume</code> frame.
With quorum queues, use <a href="#single-active-consumer">single active consumer</a> instead.</p></div></div>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="single-active-consumer">Single Active Consumer<a href="#single-active-consumer" class="hash-link" aria-label="Direct link to Single Active Consumer" title="Direct link to Single Active Consumer">​</a></h2>
<p>Single active consumer allows to have only one consumer
at a time consuming from a queue and to fail over to another registered consumer
in case the active one is cancelled or dies. Consuming with only one consumer
is useful when messages must be consumed and processed in the same order
they arrive in the queue.</p>
<p>A typical sequence of events would be the following:</p>
<ul>
<li>A queue is declared and some consumers register to it at roughly the
same time.</li>
<li>The very first registered consumer become the <em>single active consumer</em>:
messages are dispatched to it and the other consumers are ignored.</li>
<li>The single active consumer is cancelled for some reason or simply dies.
One of the registered consumer becomes the new single active consumer and
messages are now dispatched to it. In other terms, the queue fails over
automatically to another consumer.</li>
</ul>
<p>Note that without the single active consumer feature enabled, messages
would be dispatched to all consumers using round-robin.</p>
<div class="theme-admonition theme-admonition-warning admonition_xJq3 alert alert--warning"><div class="admonitionHeading_Gvgb"><span class="admonitionIcon_Rf37"><svg viewBox="0 0 16 16"><path fill-rule="evenodd" d="M8.893 1.5c-.183-.31-.52-.5-.887-.5s-.703.19-.886.5L.138 13.499a.98.98 0 0 0 0 1.001c.193.31.53.501.886.501h13.964c.367 0 .704-.19.877-.5a1.03 1.03 0 0 0 .01-1.002L8.893 1.5zm.133 11.497H6.987v-2.003h2.039v2.003zm0-3.004H6.987V5.987h2.039v4.006z"></path></svg></span>warning</div><div class="admonitionContent_BuS1"><p>This section covers the single active consumer that&#x27;s available to AMQP 0-9-1 and AMQP 1.0 clients
on classic and quorum queues. It is meaningfully different from the <a href="/rabbitmq-website/docs/3.13/streams#single-active-consumer">Single Active Consumer feature for streams</a>.</p><p>An attempt to enable SAC using an AMQP 0-9-1 client on a stream <strong>will not work</strong>.
To use SAC on a stream, a <a href="https://rabbitmq.github.io/rabbitmq-stream-java-client/snapshot/htmlsingle/#single-active-consumer" target="_blank" rel="noopener noreferrer">native RabbitMQ stream protocol client</a>
must be used.</p></div></div>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="enabling-single-active-consumer-on-quorum-and-classic-queues">Enabling Single Active Consumer on Quorum and Classic Queues<a href="#enabling-single-active-consumer-on-quorum-and-classic-queues" class="hash-link" aria-label="Direct link to Enabling Single Active Consumer on Quorum and Classic Queues" title="Direct link to Enabling Single Active Consumer on Quorum and Classic Queues">​</a></h3>
<p>Single active consumer can be enabled when declaring a queue, with the
<code>x-single-active-consumer</code> argument set to <code>true</code>, e.g. with the Java client:</p>
<div class="language-java codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-java codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token class-name">Channel</span><span class="token plain"> ch </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">.</span><span class="token punctuation" style="color:#393A34">.</span><span class="token punctuation" style="color:#393A34">.</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token class-name">Map</span><span class="token generics punctuation" style="color:#393A34">&lt;</span><span class="token generics class-name">String</span><span class="token generics punctuation" style="color:#393A34">,</span><span class="token generics"> </span><span class="token generics class-name">Object</span><span class="token generics punctuation" style="color:#393A34">&gt;</span><span class="token plain"> arguments </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">new</span><span class="token plain"> </span><span class="token class-name">HashMap</span><span class="token generics punctuation" style="color:#393A34">&lt;</span><span class="token generics class-name">String</span><span class="token generics punctuation" style="color:#393A34">,</span><span class="token generics"> </span><span class="token generics class-name">Object</span><span class="token generics punctuation" style="color:#393A34">&gt;</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">arguments</span><span class="token punctuation" style="color:#393A34">.</span><span class="token function" style="color:#d73a49">put</span><span class="token punctuation" style="color:#393A34">(</span><span class="token string" style="color:#e3116c">&quot;x-single-active-consumer&quot;</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token boolean" style="color:#36acaa">true</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">ch</span><span class="token punctuation" style="color:#393A34">.</span><span class="token function" style="color:#d73a49">queueDeclare</span><span class="token punctuation" style="color:#393A34">(</span><span class="token string" style="color:#e3116c">&quot;my-queue&quot;</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token boolean" style="color:#36acaa">false</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token boolean" style="color:#36acaa">false</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token boolean" style="color:#36acaa">false</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> arguments</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="difference-from-exclusive-consumers">Difference from Exclusive Consumers<a href="#difference-from-exclusive-consumers" class="hash-link" aria-label="Direct link to Difference from Exclusive Consumers" title="Direct link to Difference from Exclusive Consumers">​</a></h3>
<p>Compared to <a href="#exclusivity">AMQP 0-9-1 exclusive consumer</a>, single active consumer puts
less pressure on the application side to maintain consumption continuity.
Consumers just need to be registered and failover is handled automatically,
there&#x27;s no need to detect the active consumer failure and to register
a new consumer.</p>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="determining-which-consumer-is-currently-active">Determining Which Consumer is Currently Active<a href="#determining-which-consumer-is-currently-active" class="hash-link" aria-label="Direct link to Determining Which Consumer is Currently Active" title="Direct link to Determining Which Consumer is Currently Active">​</a></h3>
<p>The <a href="/rabbitmq-website/docs/3.13/management">management UI</a> and the
<a href="/rabbitmq-website/docs/3.13/man/rabbitmqctl.8">CLI</a> can <a href="#active-consumer">report</a> which consumer is the current
active one on a queue where the feature is enabled.</p>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="sac-behavior">SAC Behavior<a href="#sac-behavior" class="hash-link" aria-label="Direct link to SAC Behavior" title="Direct link to SAC Behavior">​</a></h3>
<p>Please note the following about single active consumer:</p>
<ul>
<li>There&#x27;s no guarantee on the selected active consumer, it is
picked up randomly, even if <a href="#priority">consumer priorities</a>
are in use.</li>
<li>Trying to register a consumer with the exclusive consume flag set to
true will result in an error if single active consumer is enabled on
the queue.</li>
<li>Messages are always delivered to the active consumer, even if it is
too busy at some point. This can happen when using manual acknowledgment
and <code>basic.qos</code>, the consumer may be busy dealing with the maximum number of
unacknowledged messages it requested with <code>basic.qos</code>.
In this case, the other consumers are ignored and
messages are enqueued.</li>
<li>It is not possible to enable single active consumer with a <a href="/rabbitmq-website/docs/3.13/policies">policy</a>.
Here is the reason why. Policies in RabbitMQ are dynamic by nature, they can
come and go, enabling and disabling the features they declare. Imagine suddenly
disabling single active consumer on a queue: the broker would start sending messages to
inactive consumers and messages would be processed in parallel, exactly
the opposite of what single active consumer is trying to achieve. As the semantics
of single active consumer do not play well with the dynamic nature of policies,
this feature can be enabled only when declaring a queue, with queue arguments.</li>
</ul>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="active-consumer">Consumer Activity<a href="#active-consumer" class="hash-link" aria-label="Direct link to Consumer Activity" title="Direct link to Consumer Activity">​</a></h2>
<p>The <a href="/rabbitmq-website/docs/3.13/management">management UI</a> and the <code>list_consumers</code>
<a href="/rabbitmq-website/docs/3.13/man/rabbitmqctl.8#list_consumers">CLI</a> command report an <code>active</code>
flag for consumers. The value of this flag depends on several parameters.</p>
<ul>
<li>for classic queues, the flag is always <code>true</code>
when <a href="#single-active-consumer">single active consumer</a> is not enabled.</li>
<li>for quorum queues and when <a href="#single-active-consumer">single active consumer</a> is not enabled,
the flag is <code>true</code> by default and is set to <code>false</code> if the node
the consumer is connected to is suspected to be down.</li>
<li>if <a href="#single-active-consumer">single active consumer</a> is enabled,
the flag is set to <code>true</code> only for the current single active consumer,
other consumers on the queue are waiting to be promoted if the active
one goes away, so their active is set to <code>false</code>.</li>
</ul>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="priority">Priority<a href="#priority" class="hash-link" aria-label="Direct link to Priority" title="Direct link to Priority">​</a></h2>
<p>Normally, active consumers connected to a queue receive messages from it in a round-robin fashion.</p>
<p>Consumer priorities allow you to ensure that high priority consumers receive messages while they are active,
with messages only going to lower priority consumers when the high priority consumers are blocked, e.g.
by effective <a href="#prefetch">prefetch</a> setting.</p>
<p>When consumer priorities are in use, messages are delivered round-robin if multiple active consumers
exist with the same high priority.</p>
<p>Consumer priorities are covered in a <a href="/rabbitmq-website/docs/3.13/consumer-priority">separate guide</a>.</p>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="exceptions">Exception Handling<a href="#exceptions" class="hash-link" aria-label="Direct link to Exception Handling" title="Direct link to Exception Handling">​</a></h2>
<p>Consumers are expected to handle any exceptions that arise during handling of deliveries
or any other consumer operations. Such exceptions should be logged, collected and ignored.</p>
<p>If a consumer cannot process deliveries due to a dependency not being available or similar reasons
it should clearly log so and cancel itself until it is capable of processing deliveries again.
This will make the consumer&#x27;s unavailability visible to RabbitMQ and <a href="/rabbitmq-website/docs/3.13/monitoring">monitoring systems</a>.</p>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="concurrency">Concurrency Considerations<a href="#concurrency" class="hash-link" aria-label="Direct link to Concurrency Considerations" title="Direct link to Concurrency Considerations">​</a></h2>
<p>Consumer concurrency is primarily a matter of client library implementation details and application
configuration. With most client libraries (e.g. Java, .NET, Go, Erlang) deliveries are dispatched to a thread pool (or similar) that handles
all asynchronous consumer operations. The pool usually has controllable degree of concurrency.</p>
<p>Java and .NET clients guarantee that deliveries on a single channel will be dispatched in the same order there
were received regardless of the degree of concurrency. Note that once dispatched, concurrent
processing of deliveries will result in a natural race condition between the threads doing the processing.</p>
<p>Certain clients (e.g. Bunny) and frameworks might choose to limit consumer dispatch pool to a single thread (or similar)
to avoid a natural race condition when deliveries are processed concurrently. Some applications depend on strictly sequential
processing of deliveries and thus must use concurrency factor of one or handle synchronisation
in their own code. Applications that can process deliveries concurrently can use the degree of concurrency up to
the number of cores available to them.</p>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="queue-parallelism-considerations">Queue Parallelism Considerations<a href="#queue-parallelism-considerations" class="hash-link" aria-label="Direct link to Queue Parallelism Considerations" title="Direct link to Queue Parallelism Considerations">​</a></h3>
<p>A single RabbitMQ queue is <a href="/rabbitmq-website/docs/3.13/queues#runtime-characteristics">bounded to a single core</a>. Use more than
one queue to improve CPU utilisation on the nodes. Plugins such as <a href="https://github.com/rabbitmq/rabbitmq-sharding" target="_blank" rel="noopener noreferrer">sharding</a>
and <a href="https://github.com/rabbitmq/rabbitmq-consistent-hash-exchange" target="_blank" rel="noopener noreferrer">consistent hash exchange</a> can be helpful
in increasing parallelism.</p></div><footer class="theme-doc-footer docusaurus-mt-lg"><div class="row margin-top--sm theme-doc-footer-edit-meta-row"><div class="col"><a href="https://github.com/rabbitmq/rabbitmq-website/tree/main/versioned_docs/version-3.13/consumers.md" target="_blank" rel="noopener noreferrer" class="theme-edit-this-page"><svg fill="currentColor" height="20" width="20" viewBox="0 0 40 40" class="iconEdit_Z9Sw" aria-hidden="true"><g><path d="m34.5 11.7l-3 3.1-6.3-6.3 3.1-3q0.5-0.5 1.2-0.5t1.1 0.5l3.9 3.9q0.5 0.4 0.5 1.1t-0.5 1.2z m-29.5 17.1l18.4-18.5 6.3 6.3-18.4 18.4h-6.3v-6.2z"></path></g></svg>Edit this page</a></div><div class="col lastUpdated_JAkA"></div></div></footer></article><nav class="pagination-nav docusaurus-mt-lg" aria-label="Docs pages"><a class="pagination-nav__link pagination-nav__link--prev" href="/rabbitmq-website/docs/3.13/validated-user-id"><div class="pagination-nav__sublabel">Previous</div><div class="pagination-nav__label">Validated User ID</div></a><a class="pagination-nav__link pagination-nav__link--next" href="/rabbitmq-website/docs/3.13/consumer-cancel"><div class="pagination-nav__sublabel">Next</div><div class="pagination-nav__label">Consumer Cancellation Notifications</div></a></nav></div></div><div class="col col--3"><div class="tableOfContents_bqdL thin-scrollbar theme-doc-toc-desktop"><ul class="table-of-contents table-of-contents__left-border"><li><a href="#overview" class="table-of-contents__link toc-highlight">Overview</a></li><li><a href="#terminology" class="table-of-contents__link toc-highlight">Terminology</a></li><li><a href="#basics" class="table-of-contents__link toc-highlight">The Basics</a><ul><li><a href="#consumer-tags" class="table-of-contents__link toc-highlight">Consumer Tags</a></li><li><a href="#consumer-lifecycle" class="table-of-contents__link toc-highlight">Consumer Lifecycle</a></li><li><a href="#connection-recovery" class="table-of-contents__link toc-highlight">Connection Recovery</a></li></ul></li><li><a href="#subscribing" class="table-of-contents__link toc-highlight">Registering a Consumer (Subscribing, &quot;Push API&quot;)</a><ul><li><a href="#java-client" class="table-of-contents__link toc-highlight">Java Client</a></li><li><a href="#net-client" class="table-of-contents__link toc-highlight">.NET Client</a></li></ul></li><li><a href="#message-properties" class="table-of-contents__link toc-highlight">Message Properties and Delivery Metadata</a><ul><li><a href="#message-types" class="table-of-contents__link toc-highlight">Message Types</a></li><li><a href="#content-type-and-encoding" class="table-of-contents__link toc-highlight">Content Type and Encoding</a></li></ul></li><li><a href="#acknowledgement-modes" class="table-of-contents__link toc-highlight">Acknowledgement Modes</a></li><li><a href="#prefetch" class="table-of-contents__link toc-highlight">Limiting Simultaneous Deliveries with Prefetch</a></li><li><a href="#metrics-capacity" class="table-of-contents__link toc-highlight">The Consumer Capacity Metric</a></li><li><a href="#unsubscribing" class="table-of-contents__link toc-highlight">Cancelling a Consumer (Unsubscribing)</a><ul><li><a href="#java-client-1" class="table-of-contents__link toc-highlight">Java Client</a></li><li><a href="#net-client-1" class="table-of-contents__link toc-highlight">.NET Client</a></li></ul></li><li><a href="#polling" class="table-of-contents__link toc-highlight">Polling for Individual Messages (&quot;Pull API&quot;)</a><ul><li><a href="#java-client-2" class="table-of-contents__link toc-highlight">Java Client</a></li><li><a href="#net-client-2" class="table-of-contents__link toc-highlight">.NET Client</a></li></ul></li><li><a href="#acknowledgement-timeout" class="table-of-contents__link toc-highlight">Delivery Acknowledgement Timeout</a><ul><li><a href="#how-it-works" class="table-of-contents__link toc-highlight">How it works</a></li><li><a href="#per-node-configuration" class="table-of-contents__link toc-highlight">Per-node Configuration</a></li><li><a href="#per-queue-configuration" class="table-of-contents__link toc-highlight">Per-queue Configuration</a></li></ul></li><li><a href="#limiting-the-number-of-consumers-per-channel" class="table-of-contents__link toc-highlight">Limiting the number of Consumers per channel</a></li><li><a href="#exclusivity" class="table-of-contents__link toc-highlight">Exclusivity</a></li><li><a href="#single-active-consumer" class="table-of-contents__link toc-highlight">Single Active Consumer</a><ul><li><a href="#enabling-single-active-consumer-on-quorum-and-classic-queues" class="table-of-contents__link toc-highlight">Enabling Single Active Consumer on Quorum and Classic Queues</a></li><li><a href="#difference-from-exclusive-consumers" class="table-of-contents__link toc-highlight">Difference from Exclusive Consumers</a></li><li><a href="#determining-which-consumer-is-currently-active" class="table-of-contents__link toc-highlight">Determining Which Consumer is Currently Active</a></li><li><a href="#sac-behavior" class="table-of-contents__link toc-highlight">SAC Behavior</a></li></ul></li><li><a href="#active-consumer" class="table-of-contents__link toc-highlight">Consumer Activity</a></li><li><a href="#priority" class="table-of-contents__link toc-highlight">Priority</a></li><li><a href="#exceptions" class="table-of-contents__link toc-highlight">Exception Handling</a></li><li><a href="#concurrency" class="table-of-contents__link toc-highlight">Concurrency Considerations</a><ul><li><a href="#queue-parallelism-considerations" class="table-of-contents__link toc-highlight">Queue Parallelism Considerations</a></li></ul></li></ul></div></div></div></div></main></div></div></div><footer class="footer footer--dark"><div class="container container-fluid"><div class="row footer__links"><div class="col footer__col"><div class="footer__title">Learn about RabbitMQ</div><ul class="footer__items clean-list"><li class="footer__item"><a class="footer__link-item" href="/rabbitmq-website/tutorials">Getting Started</a></li><li class="footer__item"><a class="footer__link-item" href="/rabbitmq-website/docs">Documentation</a></li><li class="footer__item"><a class="footer__link-item" href="/rabbitmq-website/blog">Blog</a></li></ul></div><div class="col footer__col"><div class="footer__title">Reach out to the RabbitMQ team</div><ul class="footer__items clean-list"><li class="footer__item"><a href="https://github.com/rabbitmq" target="_blank" rel="noopener noreferrer" class="footer__link-item">GitHub<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_nPIU"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a></li><li class="footer__item"><a href="https://github.com/rabbitmq/rabbitmq-server/discussions" target="_blank" rel="noopener noreferrer" class="footer__link-item">GitHub Discussions<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_nPIU"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a></li><li class="footer__item"><a class="footer__link-item" href="/rabbitmq-website/contact?utm_source=rmq_release-information_tableheader&amp;utm_medium=rmq_website&amp;utm_campaign=tanzu">Long Term Commercial Support</a></li><li class="footer__item"><a class="footer__link-item" href="/rabbitmq-website/contact">Contact Us</a></li><li class="footer__item"><a href="https://www.rabbitmq.com/discord" target="_blank" rel="noopener noreferrer" class="footer__link-item">Discord<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_nPIU"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a></li></ul></div><div class="col footer__col"><div class="footer__title">Broadcom</div><ul class="footer__items clean-list"><li class="footer__item"><a href="https://tanzu.vmware.com/" target="_blank" rel="noopener noreferrer" class="footer__link-item">VMware Tanzu<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_nPIU"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a></li><li class="footer__item"><a href="https://www.vmware.com/help/legal.html" target="_blank" rel="noopener noreferrer" class="footer__link-item">Terms of Use<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_nPIU"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a></li><li class="footer__item"><a href="https://www.vmware.com/help/privacy.html" target="_blank" rel="noopener noreferrer" class="footer__link-item">Privacy<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_nPIU"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a></li><li class="footer__item"><a class="footer__link-item" href="/rabbitmq-website/trademark-guidelines">Trademark Guidelines</a></li><li class="footer__item"><a href="https://www.vmware.com/help/privacy/california-privacy-rights.html" target="_blank" rel="noopener noreferrer" class="footer__link-item">Your California Privacy Rights<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_nPIU"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a></li><li class="footer__item"><a class="footer__link-item ot-sdk-show-settings">Cookie Settings</a></li></ul></div></div><div class="footer__bottom text--center"><div class="footer__copyright">Copyright © 2005-2025 Broadcom. All Rights Reserved. The term "Broadcom" refers to Broadcom Inc. and/or its subsidiaries.</div></div></div></footer></div>
</body>
</html>